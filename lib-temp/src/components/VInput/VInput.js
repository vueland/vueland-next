import { defineComponent, h, watch, inject, computed, onBeforeMount, onBeforeUnmount } from 'vue';
import { useValidation, validationProps } from '../../composable/use-validation';
import { useColors, colorProps } from '../../composable/use-colors';
import { useInputStates } from '../../composable/use-input-states';
import { useTransition } from '../../composable/use-transition';
import { VLabel } from '../VLabel';
import { VIcon } from '../VIcon';
export const VInput = defineComponent({
    name: 'v-input',
    components: {
        VLabel,
        VIcon
    },
    inheritAttrs: false,
    props: {
        label: {
            type: String,
            default: ''
        },
        prependIcon: {
            type: String,
            default: ''
        },
        appendIcon: {
            type: String,
            default: ''
        },
        disabled: Boolean,
        focused: Boolean,
        readonly: Boolean,
        file: Boolean,
        hints: {
            type: Boolean,
            default: true
        },
        hintMessage: {
            type: String,
            default: ''
        },
        textColor: {
            type: String,
            default: ''
        },
        ...validationProps(),
        ...colorProps()
    },
    emits: ['click'],
    setup(props, { attrs, emit, slots }) {
        const { validate, errorState } = useValidation(props);
        const { setTextCssColor, setTextClassNameColor } = useColors();
        const { isDisabled, isReadonly } = useInputStates(props, { attrs, emit });
        const form = inject('form', null);
        const textClassColor = setTextClassNameColor(props.textColor);
        const textCssColor = setTextCssColor(props.textColor);
        const hasPrependIcon = computed(() => {
            return !!props.prependIcon || !!slots['prepend-icon'];
        });
        const hasAppendIcon = computed(() => {
            return !!props.appendIcon || !!slots['append-icon'];
        });
        const classes = computed(() => ({
            'v-input': true,
            'v-input--primary': !props.color,
            'v-input--focused': props.focused && !isReadonly.value,
            'v-input--disabled': isDisabled.value,
            'v-input--readonly': isReadonly.value,
            'v-input--file': props.file,
            'v-input--has-prepend-icon': hasPrependIcon.value,
            'v-input--has-append-icon': hasAppendIcon.value,
            'v-input--not-valid': !!errorState.innerError,
            ...(!props.disabled && !errorState.innerError
                ? setTextClassNameColor(props.color)
                : {}),
            ...attrs.class
        }));
        const styles = computed(() => ({
            ...(!props.disabled && !errorState.innerError
                ? setTextCssColor(props.color)
                : {}),
            ...attrs.style
        }));
        watch(() => props.focused, (to) => !to && validate());
        watch(() => props.value, () => validate());
        const genLabel = () => {
            const label = h(VLabel, {
                class: 'v-label--on-input',
                disabled: isDisabled.value,
                focused: props.focused,
                color: !errorState.innerError ? props.color : ''
            }, {
                default: () => props.label
            });
            return h('div', { class: 'v-input__label' }, [label]);
        };
        const genIcon = (iconName, clickable = false) => {
            return h(VIcon, {
                icon: iconName,
                size: 16,
                disabled: props.disabled,
                clickable
            });
        };
        const genPrependIcon = () => {
            let content;
            if (props.prependIcon) {
                content = genIcon(props.prependIcon);
            }
            else {
                content = slots['prepend-icon']?.();
            }
            return content ?
                h('div', { class: 'v-input__prepend-icon' }, content)
                : null;
        };
        const genAppendIcon = () => {
            let content;
            if (props.appendIcon) {
                content = genIcon(props.appendIcon);
            }
            else {
                content = slots['append-icon']?.();
            }
            return content ?
                h('div', { class: 'v-input__append-icon' }, content)
                : null;
        };
        const genTextFieldSlot = () => {
            const prependIconContent = genPrependIcon();
            const appendIconContent = genAppendIcon();
            const { disabled } = props;
            const textFieldContent = slots['text-field']?.({
                textCssColor,
                textClassColor,
                disabled
            });
            return h('div', { class: 'v-input__text-field' }, [prependIconContent, textFieldContent, appendIconContent]);
        };
        const genHintMessage = () => {
            return props.hintMessage || errorState.innerErrorMessage ?
                h('span', { class: 'v-input__hints-message' }, [errorState.innerErrorMessage])
                : null;
        };
        const genHints = () => {
            return (props.hints || props.rules) ? h('div', { class: 'v-input__hints' }, useTransition(genHintMessage(), 'fade')) : null;
        };
        const genSelectSlot = () => {
            return slots.select ?
                h('div', { class: 'v-input__selects' }, slots.select?.())
                : null;
        };
        onBeforeMount(() => {
            if (props.rules)
                form?.add(validate);
        });
        onBeforeUnmount(() => {
            form?.remove(validate);
        });
        return () => h('div', { class: classes.value, style: styles.value }, [
            props.label && genLabel(),
            genTextFieldSlot(),
            genHints(),
            genSelectSlot()
        ]);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVklucHV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVklucHV0L1ZJbnB1dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0wsZUFBZSxFQUNmLENBQUMsRUFDRCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFFBQVEsRUFDUixhQUFhLEVBQ2IsZUFBZSxFQUVoQixNQUFNLEtBQUssQ0FBQTtBQUdaLE9BQU8sRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFFLE1BQU0saUNBQWlDLENBQUE7QUFDaEYsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUNuRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sbUNBQW1DLENBQUE7QUFDbEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlDQUFpQyxDQUFBO0FBRy9ELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFDbEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQVNoQyxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsZUFBZSxDQUFDO0lBQ3BDLElBQUksRUFBRSxTQUFTO0lBQ2YsVUFBVSxFQUFFO1FBQ1YsTUFBTTtRQUNOLEtBQUs7S0FDTjtJQUNELFlBQVksRUFBRSxLQUFLO0lBQ25CLEtBQUssRUFBRTtRQUNMLEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELFdBQVcsRUFBRTtZQUNYLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELFVBQVUsRUFBRTtZQUNWLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELFFBQVEsRUFBRSxPQUFPO1FBQ2pCLE9BQU8sRUFBRSxPQUFPO1FBQ2hCLFFBQVEsRUFBRSxPQUFPO1FBQ2pCLElBQUksRUFBRSxP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Q3hCLENBQUMsQ0FBQyxDQUFBO1FBRUYsT0FBTyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQ1osS0FBSyxFQUNMLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFLLEVBQUUsRUFDN0M7WUFDRSxLQUFLLENBQUMsS0FBSyxJQUFJLFFBQVEsRUFBRTtZQUN6QixnQkFBZ0IsRUFBRTtZQUNsQixRQUFRLEVBQUU7WUFDVixhQUFhLEVBQUU7U0FDaEIsQ0FDRixDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7XG4gIGRlZmluZUNvbXBvbmVudCxcbiAgaCxcbiAgd2F0Y2gsXG4gIGluamVjdCxcbiAgY29tcHV0ZWQsXG4gIG9uQmVmb3JlTW91bnQsXG4gIG9uQmVmb3JlVW5tb3VudCxcbiAgVk5vZGVcbn0gZnJvbSAndnVlJ1xuXG4vLyBDb21wb3NhYmxlXG5pbXBvcnQgeyB1c2VWYWxpZGF0aW9uLCB2YWxpZGF0aW9uUHJvcHMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS12YWxpZGF0aW9uJ1xuaW1wb3J0IHsgdXNlQ29sb3JzLCBjb2xvclByb3BzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtY29sb3JzJ1xuaW1wb3J0IHsgdXNlSW5wdXRTdGF0ZXMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS1pbnB1dC1zdGF0ZXMnXG5pbXBvcnQgeyB1c2VUcmFuc2l0aW9uIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtdHJhbnNpdGlvbidcblxuLy8gQ29tcG9uZW50c1xuaW1wb3J0IHsgVkxhYmVsIH0gZnJvbSAnLi4vVkxhYmVsJ1xuaW1wb3J0IHsgVkljb24gfSBmcm9tICcuLi9WSWNvbidcblxuaW1wb3J0IHsgTWF5YmUgfSBmcm9tICcuLi8uLi8uLi90eXBlcy9iYXNlJ1xuXG50eXBlIEZvcm0gPSB7XG4gIGFkZDogKGl0ZW06ICh2YWw/OiBhbnkpID0+IGJvb2xlYW4gfCB2b2lkKSA9PiB2b2lkXG4gIHJlbW92ZTogKGl0ZW06ICh2YWw/OiBhbnkpID0+IGJvb2xlYW4gfCB2b2lkKSA9PiB2b2lkXG59XG5cbmV4cG9ydCBjb25zdCBWSW5wdXQgPSBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAndi1pbnB1dCcsXG4gIGNvbXBvbmVudHM6IHtcbiAgICBWTGFiZWwsXG4gICAgVkljb25cbiAgfSxcbiAgaW5oZXJpdEF0dHJzOiBmYWxzZSxcbiAgcHJvcHM6IHtcbiAgICBsYWJlbDoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJydcbiAgICB9LFxuICAgIHByZXBlbmRJY29uOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJ1xuICAgIH0sXG4gICAgYXBwZW5kSWNvbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJydcbiAgICB9LFxuICAgIGRpc2FibGVkOiBCb29sZWFuLFxuICAgIGZvY3VzZWQ6IEJvb2xlYW4sXG4gICAgcmVhZG9ubHk6IEJvb2xlYW4sXG4gICAgZmlsZTogQm9vbGVhbixcbiAgICBoaW50czoge1xuICAgICAgdHlwZTogQm9vbGVhbixcbiAgICAgIGRlZmF1bHQ6IHRydWVcbiAgICB9LFxuICAgIGhpbnRNZXNzYWdlOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJ1xuICAgIH0sXG4gICAgdGV4dENvbG9yOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJ1xuICAgIH0sXG4gICAgLi4udmFsaWRhdGlvblByb3BzKCksXG4gICAgLi4uY29sb3JQcm9wcygpXG4gIH0sXG4gIGVtaXRzOiBbICdjbGljaycgXSxcbiAgc2V0dXAocHJvcHMsIHsgYXR0cnMsIGVtaXQsIHNsb3RzIH0pIHtcbiAgICBjb25zdCB7IHZhbGlkYXRlLCBlcnJvclN0YXRlIH0gPSB1c2VWYWxpZGF0aW9uKHByb3BzKVxuICAgIGNvbnN0IHsgc2V0VGV4dENzc0NvbG9yLCBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IgfSA9IHVzZUNvbG9ycygpXG4gICAgY29uc3QgeyBpc0Rpc2FibGVkLCBpc1JlYWRvbmx5IH0gPSB1c2VJbnB1dFN0YXRlcyhwcm9wcywgeyBhdHRycywgZW1pdCB9KVxuXG4gICAgY29uc3QgZm9ybTogTWF5YmU8Rm9ybT4gPSBpbmplY3QoJ2Zvcm0nLCBudWxsIGFzIGFueSlcblxuICAgIGNvbnN0IHRleHRDbGFzc0NvbG9yID0gc2V0VGV4dENsYXNzTmFtZUNvbG9yKHByb3BzLnRleHRDb2xvcilcbiAgICBjb25zdCB0ZXh0Q3NzQ29sb3IgPSBzZXRUZXh0Q3NzQ29sb3IocHJvcHMudGV4dENvbG9yKVxuXG4gICAgY29uc3QgaGFzUHJlcGVuZEljb24gPSBjb21wdXRlZDxib29sZWFuPigoKSA9PiB7XG4gICAgICByZXR1cm4gISFwcm9wcy5wcmVwZW5kSWNvbiB8fCAhIXNsb3RzWydwcmVwZW5kLWljb24nXVxuICAgIH0pXG5cbiAgICBjb25zdCBoYXNBcHBlbmRJY29uID0gY29tcHV0ZWQ8Ym9vbGVhbj4oKCkgPT4ge1xuICAgICAgcmV0dXJuICEhcHJvcHMuYXBwZW5kSWNvbiB8fCAhIXNsb3RzWydhcHBlbmQtaWNvbiddXG4gICAgfSlcblxuICAgIGNvbnN0IGNsYXNzZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBib29sZWFuPj4oKCkgPT4gKHtcbiAgICAgICd2LWlucHV0JzogdHJ1ZSxcbiAgICAgICd2LWlucHV0LS1wcmltYXJ5JzogIXByb3BzLmNvbG9yLFxuICAgICAgJ3YtaW5wdXQtLWZvY3VzZWQnOiBwcm9wcy5mb2N1c2VkICYmICFpc1JlYWRvbmx5LnZhbHVlLFxuICAgICAgJ3YtaW5wdXQtLWRpc2FibGVkJzogaXNEaXNhYmxlZC52YWx1ZSxcbiAgICAgICd2LWlucHV0LS1yZWFkb25seSc6IGlzUmVhZG9ubHkudmFsdWUsXG4gICAgICAndi1pbnB1dC0tZmlsZSc6IHByb3BzLmZpbGUsXG4gICAgICAndi1pbnB1dC0taGFzLXByZXBlbmQtaWNvbic6IGhhc1ByZXBlbmRJY29uLnZhbHVlLFxuICAgICAgJ3YtaW5wdXQtLWhhcy1hcHBlbmQtaWNvbic6IGhhc0FwcGVuZEljb24udmFsdWUsXG4gICAgICAndi1pbnB1dC0tbm90LXZhbGlkJzogISFlcnJvclN0YXRlLmlubmVyRXJyb3IsXG4gICAgICAuLi4oIXByb3BzLmRpc2FibGVkICYmICFlcnJvclN0YXRlLmlubmVyRXJyb3JcbiAgICAgICAgPyBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IocHJvcHMuY29sb3IpXG4gICAgICAgIDoge30pLFxuICAgICAgLi4uKGF0dHJzLmNsYXNzIGFzIG9iamVjdClcbiAgICB9KSlcblxuICAgIGNvbnN0IHN0eWxlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIHN0cmluZz4+KCgpID0+ICh7XG4gICAgICAuLi4oIXByb3BzLmRpc2FibGVkICYmICFlcnJvclN0YXRlLmlubmVyRXJyb3JcbiAgICAgICAgPyBzZXRUZXh0Q3NzQ29sb3IocHJvcHMuY29sb3IpXG4gICAgICAgIDoge30pLFxuICAgICAgLi4uKGF0dHJzLnN0eWxlIGFzIG9iamVjdClcbiAgICB9KSlcblxuICAgIHdhdGNoKFxuICAgICAgKCkgPT4gcHJvcHMuZm9jdXNlZCxcbiAgICAgICh0bykgPT4gIXRvICYmIHZhbGlkYXRlKClcbiAgICApXG5cbiAgICB3YXRjaChcbiAgICAgICgpID0+IHByb3BzLnZhbHVlLFxuICAgICAgKCkgPT4gdmFsaWRhdGUoKVxuICAgIClcblxuICAgIGNvbnN0IGdlbkxhYmVsID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IGxhYmVsID0gaChcbiAgICAgICAgVkxhYmVsLFxuICAgICAgICB7XG4gICAgICAgICAgY2xhc3M6ICd2LWxhYmVsLS1vbi1pbnB1dCcsXG4gICAgICAgICAgZGlzYWJsZWQ6IGlzRGlzYWJsZWQudmFsdWUsXG4gICAgICAgICAgZm9jdXNlZDogcHJvcHMuZm9jdXNlZCxcbiAgICAgICAgICBjb2xvcjogIWVycm9yU3RhdGUuaW5uZXJFcnJvciA/IHByb3BzLmNvbG9yIDogJydcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRlZmF1bHQ6ICgpID0+IHByb3BzLmxhYmVsXG4gICAgICAgIH1cbiAgICAgIClcblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWlucHV0X19sYWJlbCcgfSwgWyBsYWJlbCBdKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkljb24gPSAoaWNvbk5hbWUsIGNsaWNrYWJsZSA9IGZhbHNlKTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoVkljb24sIHtcbiAgICAgICAgaWNvbjogaWNvbk5hbWUsXG4gICAgICAgIHNpemU6IDE2LFxuICAgICAgICBkaXNhYmxlZDogcHJvcHMuZGlzYWJsZWQsXG4gICAgICAgIGNsaWNrYWJsZVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5QcmVwZW5kSWNvbiA9ICgpOiBNYXliZTxWTm9kZT4gPT4ge1xuICAgICAgbGV0IGNvbnRlbnRcblxuICAgICAgaWYgKHByb3BzLnByZXBlbmRJY29uKSB7XG4gICAgICAgIGNvbnRlbnQgPSBnZW5JY29uKHByb3BzLnByZXBlbmRJY29uKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udGVudCA9IHNsb3RzWydwcmVwZW5kLWljb24nXT8uKClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNvbnRlbnQgP1xuICAgICAgICBoKCdkaXYnLCB7IGNsYXNzOiAndi1pbnB1dF9fcHJlcGVuZC1pY29uJyB9LCBjb250ZW50KVxuICAgICAgICA6IG51bGxcbiAgICB9XG5cbiAgICBjb25zdCBnZW5BcHBlbmRJY29uID0gKCk6IE1heWJlPFZOb2RlPiA9PiB7XG4gICAgICBsZXQgY29udGVudFxuXG4gICAgICBpZiAocHJvcHMuYXBwZW5kSWNvbikge1xuICAgICAgICBjb250ZW50ID0gZ2VuSWNvbihwcm9wcy5hcHBlbmRJY29uKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udGVudCA9IHNsb3RzWydhcHBlbmQtaWNvbiddPy4oKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gY29udGVudCA/XG4gICAgICAgIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWlucHV0X19hcHBlbmQtaWNvbicgfSwgY29udGVudClcbiAgICAgICAgOiBudWxsXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuVGV4dEZpZWxkU2xvdCA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHByZXBlbmRJY29uQ29udGVudCA9IGdlblByZXBlbmRJY29uKClcbiAgICAgIGNvbnN0IGFwcGVuZEljb25Db250ZW50ID0gZ2VuQXBwZW5kSWNvbigpXG4gICAgICBjb25zdCB7IGRpc2FibGVkIH0gPSBwcm9wc1xuXG4gICAgICBjb25zdCB0ZXh0RmllbGRDb250ZW50ID0gc2xvdHNbJ3RleHQtZmllbGQnXT8uKHtcbiAgICAgICAgdGV4dENzc0NvbG9yLFxuICAgICAgICB0ZXh0Q2xhc3NDb2xvcixcbiAgICAgICAgZGlzYWJsZWRcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCB7IGNsYXNzOiAndi1pbnB1dF9fdGV4dC1maWVsZCcgfSxcbiAgICAgICAgWyBwcmVwZW5kSWNvbkNvbnRlbnQsIHRleHRGaWVsZENvbnRlbnQsIGFwcGVuZEljb25Db250ZW50IF1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5IaW50TWVzc2FnZSA9ICgpOiBNYXliZTxWTm9kZT4gPT4ge1xuICAgICAgcmV0dXJuIHByb3BzLmhpbnRNZXNzYWdlIHx8IGVycm9yU3RhdGUuaW5uZXJFcnJvck1lc3NhZ2UgP1xuICAgICAgICBoKFxuICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICB7IGNsYXNzOiAndi1pbnB1dF9faGludHMtbWVzc2FnZScgfSxcbiAgICAgICAgICBbIGVycm9yU3RhdGUuaW5uZXJFcnJvck1lc3NhZ2UgXVxuICAgICAgICApXG4gICAgICAgIDogbnVsbFxuICAgIH1cblxuICAgIGNvbnN0IGdlbkhpbnRzID0gKCk6IE1heWJlPFZOb2RlPiA9PiB7XG4gICAgICByZXR1cm4gKHByb3BzLmhpbnRzIHx8IHByb3BzLnJ1bGVzKSA/IGgoXG4gICAgICAgICdkaXYnLFxuICAgICAgICB7IGNsYXNzOiAndi1pbnB1dF9faGludHMnIH0sXG4gICAgICAgIHVzZVRyYW5zaXRpb24oZ2VuSGludE1lc3NhZ2UoKSEsICdmYWRlJylcbiAgICAgICkgOiBudWxsXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuU2VsZWN0U2xvdCA9ICgpOiBNYXliZTxWTm9kZT4gPT4ge1xuICAgICAgcmV0dXJuIHNsb3RzLnNlbGVjdCA/XG4gICAgICAgIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWlucHV0X19zZWxlY3RzJyB9LCBzbG90cy5zZWxlY3Q/LigpKVxuICAgICAgICA6IG51bGxcbiAgICB9XG5cbiAgICBvbkJlZm9yZU1vdW50KCgpID0+IHtcbiAgICAgIGlmIChwcm9wcy5ydWxlcykgZm9ybT8uYWRkKHZhbGlkYXRlKVxuICAgIH0pXG5cbiAgICBvbkJlZm9yZVVubW91bnQoKCkgPT4ge1xuICAgICAgZm9ybT8ucmVtb3ZlKHZhbGlkYXRlKVxuICAgIH0pXG5cbiAgICByZXR1cm4gKCkgPT4gaChcbiAgICAgICdkaXYnLFxuICAgICAgeyBjbGFzczogY2xhc3Nlcy52YWx1ZSwgc3R5bGU6IHN0eWxlcy52YWx1ZSB9LFxuICAgICAgW1xuICAgICAgICBwcm9wcy5sYWJlbCAmJiBnZW5MYWJlbCgpLFxuICAgICAgICBnZW5UZXh0RmllbGRTbG90KCksXG4gICAgICAgIGdlbkhpbnRzKCksXG4gICAgICAgIGdlblNlbGVjdFNsb3QoKVxuICAgICAgXVxuICAgIClcbiAgfVxufSlcbiJdfQ==