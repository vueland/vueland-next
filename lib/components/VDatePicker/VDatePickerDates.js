import { h, ref, inject, computed, watch, defineComponent } from 'vue';
import { genTableRows, parseDate, toDateString } from './helpers';
import { useTransition } from '../../composable/use-transition';
export const VDatePickerDates = defineComponent({
    name: 'v-date-picker-dates',
    props: {
        locale: Array,
        year: [String, Number],
        month: [String, Number],
        date: [String, Number],
        value: Object,
        mondayFirst: Boolean,
        disabledDates: Object,
    },
    emits: ['update:month', 'update:value'],
    setup(props, { emit, slots }) {
        const FIRST_MONTH = 0;
        const LAST_MONTH = 11;
        const DAYS = [0, 1, 2, 3, 4, 5, 6];
        const ANIMATION_TIMEOUT = 0;
        const dates = ref([]);
        const isDatesChanged = ref(false);
        const today = parseDate(new Date());
        const handlers = inject('handlers');
        handlers.value = {
            onNext: () => updateMonth(true),
            onPrev: () => updateMonth(false),
        };
        if (props.mondayFirst) {
            DAYS.push(DAYS.splice(0, 1)[0]);
        }
        const daysInMonth = computed(() => {
            return new Date(props.year, props.month + 1, 0).getDate();
        });
        const updateMonth = (isNext) => {
            const params = {};
            params.month = props.month + (isNext ? 1 : -1);
            if (!isNext && params.month < FIRST_MONTH)
                params.month = LAST_MONTH;
            if (isNext && params.month > LAST_MONTH)
                params.month = FIRST_MONTH;
            if (isNext && !params.month)
                params.year = props.year + 1;
            if (!isNext && params.month === LAST_MONTH)
                params.year = props.year - 1;
            isDatesChanged.value = true;
            emit('update:month', params);
        };
        const genWeekDays = () => {
            const propsData = {
                class: 'v-date-picker-dates__day',
            };
            return DAYS.map((day) => h('span', propsData, props.locale[day]));
        };
        const genDateObject = (date) => {
            const { year, month } = props;
            return parseDate(new Date(year, month, date));
        };
        const setEmptiesBeforeFirstDate = (dateObject) => {
            const firstDay = DAYS[0];
            const startDay = firstDay && !dateObject.day ? dateObject.day : firstDay;
            const tillDay = firstDay && !dateObject.day ? DAYS.length - 1 : dateObject.day;
            for (let i = startDay; i <= tillDay; i += 1) {
                dates.value[i] = { date: null };
            }
            dates.value[tillDay] = dateObject;
        };
        const genTableDates = () => {
            dates.value = [];
            for (let i = 1; i <= daysInMonth.value; i += 1) {
                const dateObject = genDateObject(i);
                if (i === 1) {
                    setEmptiesBeforeFirstDate(dateObject);
                }
                else {
                    dates.value[dates.value.length] = dateObject;
                }
            }
        };
        const compareDates = (date1, date2) => {
            return (date1.date === date2.date &&
                date1.month === date2.month &&
                date1.year === date2.year);
        };
        const setDisabled = (date) => {
            if (!date.date)
                return false;
            if (!props.disabledDates)
                return !!date.isHoliday;
            const { disabledDates } = props;
            return ((disabledDates.daysOfMonth && disableDaysOfMonth(date)) ||
                (disabledDates.from && disableFromTo(date, disabledDates)) ||
                (disabledDates.dates && disableDates(date)) ||
                (disabledDates.days && disableDays(date)) ||
                (disabledDates.ranges && disableRanges(date)) ||
                (disabledDates.custom && disabledDates.custom(date)));
        };
        const disableFromTo = (date, { from, to }) => {
            const dateFrom = parseDate(from);
            const dateTo = parseDate(to);
            return date.mls >= dateFrom.mls && date.mls <= dateTo.mls;
        };
        const disableDaysOfMonth = (date) => {
            return props.disabledDates.daysOfMonth.some((it) => it === date.date);
        };
        const disableDates = (date) => {
            return props.disabledDates.dates.find((d) => {
                return String(d) === String(toDateString(date));
            });
        };
        const disableDays = (date) => {
            return props.disabledDates.days.find((d) => d === date.day) >= 0;
        };
        const disableRanges = (date) => {
            const { ranges } = props.disabledDates;
            for (let i = 0; i < ranges.length; i += 1) {
                if (disableFromTo(date, ranges[i]))
                    return true;
            }
        };
        const genDateCell = (date) => {
            const isSelected = compareDates(date, props.value);
            const isToday = compareDates(date, today);
            date.isHoliday = setDisabled(date);
            const propsData = {
                class: {
                    'v-date-picker-dates__cell': !!date.date,
                    'v-date-picker-dates__cell--empty': !date.date,
                    'v-date-picker-dates__cell--selected': isSelected && !props.value.default,
                    'v-date-picker-dates__cell--current-date': isToday,
                    'v-date-picker-dates__cell--holiday': date.date && date.isHoliday,
                },
                onClick: () => date.date && emit('update:value', date),
            };
            return h('div', propsData, [
                (date.date && slots.date && slots.date(date)) || date.date,
            ]);
        };
        const genDateCells = () => {
            return dates.value.reduce((acc, dateObject) => {
                acc.push(genDateCell(dateObject));
                return acc;
            }, []);
        };
        const genDateRows = () => {
            const datesVNodes = genDateCells();
            return genTableRows(datesVNodes, 'v-date-picker-dates__row', DAYS.length);
        };
        const genDates = () => {
            return ((!isDatesChanged.value &&
                h('div', { class: 'v-date-picker-dates__dates' }, genDateRows())) ||
                null);
        };
        const genWeek = () => {
            return h('div', { class: 'v-date-picker-dates__week' }, genWeekDays());
        };
        watch(() => props.month, () => genTableDates(), { immediate: true });
        watch(() => isDatesChanged.value, () => setTimeout(() => (isDatesChanged.value = false), ANIMATION_TIMEOUT));
        return () => h('div', { class: 'v-date-picker-dates' }, [
            genWeek(),
            useTransition(genDates(), 'fade'),
        ]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGVQaWNrZXJEYXRlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZEYXRlUGlja2VyL1ZEYXRlUGlja2VyRGF0ZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFLE1BQU0sS0FBSyxDQUFBO0FBR3RFLE9BQU8sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLFdBQVcsQ0FBQTtBQUdqRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUNBQWlDLENBQUE7QUFZL0QsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUcsZUFBZSxDQUFDO0lBQzlDLElBQUksRUFBRSxxQkFBcUI7SUFFM0IsS0FBSyxFQUFFO1FBQ0wsTUFBTSxFQUFFLEtBQUs7UUFDYixJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1FBQ3RCLEtBQUssRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7UUFDdkIsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztRQUN0QixLQUFLLEVBQUUsTUFBTTtRQUNiLFdBQVcsRUFBRSxPQUFPO1FBQ3BCLGFBQWEsRUFBRSxNQUFNO0tBQ2Y7SUFFUixLQUFLLEVBQUUsQ0FBQyxjQUFjLEVBQUUsY0FBYyxDQUFDO0lBRXZDLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFO1FBQzFCLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBQTtRQUNyQixNQUFNLFVBQVUsR0FBRyxFQUFFLENBQUE7UUFDckIsTUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUNsQyxN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QUcsRUFBRSxDQUNWLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUscUJBQXFCLEVBQUUsRUFBRTtZQUN6QyxPQUFPLEVBQUU7WUFDVCxhQUFhLENBQUMsUUFBUSxFQUFTLEVBQUUsTUFBTSxDQUFDO1NBQ3pDLENBQUMsQ0FBQTtJQUNOLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBWdWUgQVBJXG5pbXBvcnQgeyBoLCByZWYsIGluamVjdCwgY29tcHV0ZWQsIHdhdGNoLCBkZWZpbmVDb21wb25lbnQgfSBmcm9tICd2dWUnXG5cbi8vIEhlbHBlcnNcbmltcG9ydCB7IGdlblRhYmxlUm93cywgcGFyc2VEYXRlLCB0b0RhdGVTdHJpbmcgfSBmcm9tICcuL2hlbHBlcnMnXG5cbi8vIEVmZmVjdHNcbmltcG9ydCB7IHVzZVRyYW5zaXRpb24gfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS10cmFuc2l0aW9uJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUsIFJlZiB9IGZyb20gJ3Z1ZSdcbmltcG9ydCB7IERhdGVQaWNrZXJCdG5IYW5kbGVycywgRGF0ZVBpY2tlckRhdGUgfSBmcm9tICcuLi8uLi8uLi90eXBlcydcbmltcG9ydCB7IE1heWJlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvYmFzZSdcblxudHlwZSBVcGRhdGVQYXJhbXMgPSB7XG4gIG1vbnRoPzogbnVtYmVyXG4gIHllYXI/OiBudW1iZXJcbn1cblxuZXhwb3J0IGNvbnN0IFZEYXRlUGlja2VyRGF0ZXMgPSBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAndi1kYXRlLXBpY2tlci1kYXRlcycsXG5cbiAgcHJvcHM6IHtcbiAgICBsb2NhbGU6IEFycmF5LFxuICAgIHllYXI6IFtTdHJpbmcsIE51bWJlcl0sXG4gICAgbW9udGg6IFtTdHJpbmcsIE51bWJlcl0sXG4gICAgZGF0ZTogW1N0cmluZywgTnVtYmVyXSxcbiAgICB2YWx1ZTogT2JqZWN0LFxuICAgIG1vbmRheUZpcnN0OiBCb29sZWFuLFxuICAgIGRpc2FibGVkRGF0ZXM6IE9iamVjdCxcbiAgfSBhcyBhbnksXG5cbiAgZW1pdHM6IFsndXBkYXRlOm1vbnRoJywgJ3VwZGF0ZTp2YWx1ZSddLFxuXG4gIHNldHVwKHByb3BzLCB7IGVtaXQsIHNsb3RzIH0pOiAoKSA9PiBWTm9kZSB7XG4gICAgY29uc3QgRklSU1RfTU9OVEggPSAwXG4gICAgY29uc3QgTEFTVF9NT05USCA9IDExXG4gICAgY29uc3QgREFZUyA9IFswLCAxLCAyLCAzLCA0LCA1LCA2XVxuICAgIGNvbnN0IEFOSU1BVElPTl9USU1FT1VUID0gMFxuXG4gICAgY29uc3QgZGF0ZXMgPSByZWY8KERhdGVQaWNrZXJEYXRlIHwgbnVsbClbXT4oW10pXG4gICAgY29uc3QgaXNEYXRlc0NoYW5nZWQgPSByZWY8Ym9vbGVhbj4oZmFsc2UpXG4gICAgY29uc3QgdG9kYXkgPSBwYXJzZURhdGUobmV3IERhdGUoKSlcblxuICAgIGNvbnN0IGhhbmRsZXJzID0gaW5qZWN0KCdoYW5kbGVycycpIGFzIFJlZjxEYXRlUGlja2VyQnRuSGFuZGxlcnM+XG5cbiAgICBoYW5kbGVycy52YWx1ZSA9IHtcbiAgICAgIG9uTmV4dDogKCkgPT4gdXBkYXRlTW9udGgodHJ1ZSksXG4gICAgICBvblByZXY6ICgpID0+IHVwZGF0ZU1vbnRoKGZhbHNlKSxcbiAgICB9XG5cbiAgICBpZiAocHJvcHMubW9uZGF5Rmlyc3QpIHtcbiAgICAgIERBWVMucHVzaChEQVlTLnNwbGljZSgwLCAxKVswXSlcbiAgICB9XG5cbiAgICBjb25zdCBkYXlzSW5Nb250aCA9IGNvbXB1dGVkPG51bWJlcj4oKCkgPT4ge1xuICAgICAgcmV0dXJuIG5ldyBEYXRlKHByb3BzLnllYXIsIHByb3BzLm1vbnRoICsgMSwgMCkuZ2V0RGF0ZSgpXG4gICAgfSlcblxuICAgIGNvbnN0IHVwZGF0ZU1vbnRoID0gKGlzTmV4dDogYm9vbGVhbikgPT4ge1xuICAgICAgY29uc3QgcGFyYW1zOiBVcGRhdGVQYXJhbXMgPSB7fVxuXG4gICAgICBwYXJhbXMubW9udGggPSBwcm9wcy5tb250aCArIChpc05leHQgPyAxIDogLTEpXG5cbiAgICAgIGlmICghaXNOZXh0ICYmIHBhcmFtcy5tb250aCEgPCBGSVJTVF9NT05USCkgcGFyYW1zLm1vbnRoID0gTEFTVF9NT05USFxuICAgICAgaWYgKGlzTmV4dCAmJiBwYXJhbXMubW9udGghID4gTEFTVF9NT05USCkgcGFyYW1zLm1vbnRoID0gRklSU1RfTU9OVEhcbiAgICAgIGlmIChpc05leHQgJiYgIXBhcmFtcy5tb250aCkgcGFyYW1zLnllYXIgPSBwcm9wcy55ZWFyICsgMVxuICAgICAgaWYgKCFpc05leHQgJiYgcGFyYW1zLm1vbnRoID09PSBMQVNUX01PTlRIKSBwYXJhbXMueWVhciA9IHByb3BzLnllYXIgLSAxXG5cbiAgICAgIGlzRGF0ZXNDaGFuZ2VkLnZhbHVlID0gdHJ1ZVxuICAgICAgZW1pdCgndXBkYXRlOm1vbnRoJywgcGFyYW1zKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbldlZWtEYXlzID0gKCk6IFZOb2RlW10gPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczogJ3YtZGF0ZS1waWNrZXItZGF0ZXNfX2RheScsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBEQVlTLm1hcCgoZGF5KSA9PlxuICAgICAgICBoKCdzcGFuJywgcHJvcHNEYXRhLCBwcm9wcy5sb2NhbGUhW2RheV0gYXMgc3RyaW5nKSxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlT2JqZWN0ID0gKGRhdGUpOiBEYXRlUGlja2VyRGF0ZSA9PiB7XG4gICAgICBjb25zdCB7IHllYXIsIG1vbnRoIH0gPSBwcm9wc1xuICAgICAgcmV0dXJuIHBhcnNlRGF0ZShuZXcgRGF0ZSh5ZWFyLCBtb250aCwgZGF0ZSkpXG4gICAgfVxuXG4gICAgY29uc3Qgc2V0RW1wdGllc0JlZm9yZUZpcnN0RGF0ZSA9IChkYXRlT2JqZWN0KSA9PiB7XG4gICAgICBjb25zdCBmaXJzdERheSA9IERBWVNbMF1cbiAgICAgIGNvbnN0IHN0YXJ0RGF5ID0gZmlyc3REYXkgJiYgIWRhdGVPYmplY3QuZGF5ID8gZGF0ZU9iamVjdC5kYXkgOiBmaXJzdERheVxuICAgICAgY29uc3QgdGlsbERheSA9XG4gICAgICAgIGZpcnN0RGF5ICYmICFkYXRlT2JqZWN0LmRheSA/IERBWVMubGVuZ3RoIC0gMSA6IGRhdGVPYmplY3QuZGF5XG5cbiAgICAgIGZvciAobGV0IGkgPSBzdGFydERheTsgaSA8PSB0aWxsRGF5OyBpICs9IDEpIHtcbiAgICAgICAgZGF0ZXMudmFsdWVbaV0gPSB7IGRhdGU6IG51bGwgfSBhcyBhbnlcbiAgICAgIH1cblxuICAgICAgZGF0ZXMudmFsdWVbdGlsbERheV0gPSBkYXRlT2JqZWN0XG4gICAgfVxuXG4gICAgY29uc3QgZ2VuVGFibGVEYXRlcyA9ICgpID0+IHtcbiAgICAgIGRhdGVzLnZhbHVlID0gW11cbiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IGRheXNJbk1vbnRoLnZhbHVlOyBpICs9IDEpIHtcbiAgICAgICAgY29uc3QgZGF0ZU9iamVjdCA9IGdlbkRhdGVPYmplY3QoaSlcblxuICAgICAgICBpZiAoaSA9PT0gMSkge1xuICAgICAgICAgIHNldEVtcHRpZXNCZWZvcmVGaXJzdERhdGUoZGF0ZU9iamVjdClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkYXRlcy52YWx1ZVtkYXRlcy52YWx1ZS5sZW5ndGhdID0gZGF0ZU9iamVjdCBhcyBhbnlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGNvbXBhcmVEYXRlcyA9IChkYXRlMSwgZGF0ZTIpID0+IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGRhdGUxLmRhdGUgPT09IGRhdGUyLmRhdGUgJiZcbiAgICAgICAgZGF0ZTEubW9udGggPT09IGRhdGUyLm1vbnRoICYmXG4gICAgICAgIGRhdGUxLnllYXIgPT09IGRhdGUyLnllYXJcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBzZXREaXNhYmxlZCA9IChkYXRlOiBEYXRlUGlja2VyRGF0ZSk6IGJvb2xlYW4gPT4ge1xuICAgICAgaWYgKCFkYXRlLmRhdGUpIHJldHVybiBmYWxzZVxuICAgICAgaWYgKCFwcm9wcy5kaXNhYmxlZERhdGVzKSByZXR1cm4gISFkYXRlLmlzSG9saWRheVxuXG4gICAgICBjb25zdCB7IGRpc2FibGVkRGF0ZXMgfSA9IHByb3BzXG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIChkaXNhYmxlZERhdGVzLmRheXNPZk1vbnRoICYmIGRpc2FibGVEYXlzT2ZNb250aChkYXRlKSkgfHxcbiAgICAgICAgKGRpc2FibGVkRGF0ZXMuZnJvbSAmJiBkaXNhYmxlRnJvbVRvKGRhdGUsIGRpc2FibGVkRGF0ZXMpKSB8fFxuICAgICAgICAoZGlzYWJsZWREYXRlcy5kYXRlcyAmJiBkaXNhYmxlRGF0ZXMoZGF0ZSkpIHx8XG4gICAgICAgIChkaXNhYmxlZERhdGVzLmRheXMgJiYgZGlzYWJsZURheXMoZGF0ZSkpIHx8XG4gICAgICAgIChkaXNhYmxlZERhdGVzLnJhbmdlcyAmJiBkaXNhYmxlUmFuZ2VzKGRhdGUpKSB8fFxuICAgICAgICAoZGlzYWJsZWREYXRlcy5jdXN0b20gJiYgZGlzYWJsZWREYXRlcy5jdXN0b20oZGF0ZSkpXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZGlzYWJsZUZyb21UbyA9IChkYXRlOiBEYXRlUGlja2VyRGF0ZSwgeyBmcm9tLCB0byB9KTogYm9vbGVhbiA9PiB7XG4gICAgICBjb25zdCBkYXRlRnJvbTogRGF0ZVBpY2tlckRhdGUgPSBwYXJzZURhdGUoZnJvbSlcbiAgICAgIGNvbnN0IGRhdGVUbzogRGF0ZVBpY2tlckRhdGUgPSBwYXJzZURhdGUodG8pXG5cbiAgICAgIHJldHVybiBkYXRlLm1scyA+PSBkYXRlRnJvbS5tbHMgJiYgZGF0ZS5tbHMgPD0gZGF0ZVRvLm1sc1xuICAgIH1cblxuICAgIGNvbnN0IGRpc2FibGVEYXlzT2ZNb250aCA9IChkYXRlOiBEYXRlUGlja2VyRGF0ZSk6IGJvb2xlYW4gPT4ge1xuICAgICAgcmV0dXJuIHByb3BzLmRpc2FibGVkRGF0ZXMuZGF5c09mTW9udGguc29tZSgoaXQpID0+IGl0ID09PSBkYXRlLmRhdGUpXG4gICAgfVxuXG4gICAgY29uc3QgZGlzYWJsZURhdGVzID0gKGRhdGU6IERhdGVQaWNrZXJEYXRlKTogYm9vbGVhbiA9PiB7XG4gICAgICByZXR1cm4gcHJvcHMuZGlzYWJsZWREYXRlcy5kYXRlcy5maW5kKChkKSA9PiB7XG4gICAgICAgIHJldHVybiBTdHJpbmcoZCkgPT09IFN0cmluZyh0b0RhdGVTdHJpbmcoZGF0ZSkpXG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGRpc2FibGVEYXlzID0gKGRhdGU6IERhdGVQaWNrZXJEYXRlKTogYm9vbGVhbiA9PiB7XG4gICAgICByZXR1cm4gcHJvcHMuZGlzYWJsZWREYXRlcy5kYXlzLmZpbmQoKGQpID0+IGQgPT09IGRhdGUuZGF5KSA+PSAwXG4gICAgfVxuXG4gICAgY29uc3QgZGlzYWJsZVJhbmdlcyA9IChkYXRlOiBEYXRlUGlja2VyRGF0ZSkgPT4ge1xuICAgICAgY29uc3QgeyByYW5nZXMgfSA9IHByb3BzLmRpc2FibGVkRGF0ZXNcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgaWYgKGRpc2FibGVGcm9tVG8oZGF0ZSwgcmFuZ2VzW2ldKSkgcmV0dXJuIHRydWVcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlQ2VsbCA9IChkYXRlOiBEYXRlUGlja2VyRGF0ZSk6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IGlzU2VsZWN0ZWQ6IGJvb2xlYW4gPSBjb21wYXJlRGF0ZXMoZGF0ZSwgcHJvcHMudmFsdWUpXG4gICAgICBjb25zdCBpc1RvZGF5OiBib29sZWFuID0gY29tcGFyZURhdGVzKGRhdGUsIHRvZGF5KVxuXG4gICAgICBkYXRlLmlzSG9saWRheSA9IHNldERpc2FibGVkKGRhdGUpXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1kYXRlLXBpY2tlci1kYXRlc19fY2VsbCc6ICEhZGF0ZS5kYXRlLFxuICAgICAgICAgICd2LWRhdGUtcGlja2VyLWRhdGVzX19jZWxsLS1lbXB0eSc6ICFkYXRlLmRhdGUsXG4gICAgICAgICAgJ3YtZGF0ZS1waWNrZXItZGF0ZXNfX2NlbGwtLXNlbGVjdGVkJzpcbiAgICAgICAgICAgIGlzU2VsZWN0ZWQgJiYgIXByb3BzLnZhbHVlLmRlZmF1bHQsXG4gICAgICAgICAgJ3YtZGF0ZS1waWNrZXItZGF0ZXNfX2NlbGwtLWN1cnJlbnQtZGF0ZSc6IGlzVG9kYXksXG4gICAgICAgICAgJ3YtZGF0ZS1waWNrZXItZGF0ZXNfX2NlbGwtLWhvbGlkYXknOiBkYXRlLmRhdGUgJiYgZGF0ZS5pc0hvbGlkYXksXG4gICAgICAgIH0sXG4gICAgICAgIG9uQ2xpY2s6ICgpID0+IGRhdGUuZGF0ZSAmJiBlbWl0KCd1cGRhdGU6dmFsdWUnLCBkYXRlKSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHByb3BzRGF0YSwgW1xuICAgICAgICAoZGF0ZS5kYXRlICYmIHNsb3RzLmRhdGUgJiYgc2xvdHMuZGF0ZShkYXRlKSkgfHwgZGF0ZS5kYXRlLFxuICAgICAgXSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlQ2VsbHMgPSAoKTogVk5vZGVbXSA9PiB7XG4gICAgICByZXR1cm4gZGF0ZXMudmFsdWUucmVkdWNlKChhY2MsIGRhdGVPYmplY3QpID0+IHtcbiAgICAgICAgYWNjLnB1c2goZ2VuRGF0ZUNlbGwoZGF0ZU9iamVjdCEpKVxuICAgICAgICByZXR1cm4gYWNjXG4gICAgICB9LCBbXSBhcyBWTm9kZVtdKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkRhdGVSb3dzID0gKCk6IFZOb2RlW10gPT4ge1xuICAgICAgY29uc3QgZGF0ZXNWTm9kZXMgPSBnZW5EYXRlQ2VsbHMoKVxuXG4gICAgICByZXR1cm4gZ2VuVGFibGVSb3dzKGRhdGVzVk5vZGVzLCAndi1kYXRlLXBpY2tlci1kYXRlc19fcm93JywgREFZUy5sZW5ndGgpXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuRGF0ZXMgPSAoKTogTWF5YmU8Vk5vZGU+ID0+IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgICghaXNEYXRlc0NoYW5nZWQudmFsdWUgJiZcbiAgICAgICAgICBoKCdkaXYnLCB7IGNsYXNzOiAndi1kYXRlLXBpY2tlci1kYXRlc19fZGF0ZXMnIH0sIGdlbkRhdGVSb3dzKCkpKSB8fFxuICAgICAgICBudWxsXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuV2VlayA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogJ3YtZGF0ZS1waWNrZXItZGF0ZXNfX3dlZWsnIH0sIGdlbldlZWtEYXlzKCkpXG4gICAgfVxuXG4gICAgd2F0Y2goXG4gICAgICAoKSA9PiBwcm9wcy5tb250aCxcbiAgICAgICgpID0+IGdlblRhYmxlRGF0ZXMoKSxcbiAgICAgIHsgaW1tZWRpYXRlOiB0cnVlIH0sXG4gICAgKVxuXG4gICAgd2F0Y2goXG4gICAgICAoKSA9PiBpc0RhdGVzQ2hhbmdlZC52YWx1ZSxcbiAgICAgICgpID0+IHNldFRpbWVvdXQoKCkgPT4gKGlzRGF0ZXNDaGFuZ2VkLnZhbHVlID0gZmFsc2UpLCBBTklNQVRJT05fVElNRU9VVCksXG4gICAgKVxuXG4gICAgcmV0dXJuICgpID0+XG4gICAgICBoKCdkaXYnLCB7IGNsYXNzOiAndi1kYXRlLXBpY2tlci1kYXRlcycgfSwgW1xuICAgICAgICBnZW5XZWVrKCksXG4gICAgICAgIHVzZVRyYW5zaXRpb24oZ2VuRGF0ZXMoKSBhcyBhbnksICdmYWRlJyksXG4gICAgICBdKVxuICB9LFxufSlcbiJdfQ==