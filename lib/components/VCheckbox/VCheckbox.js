import { h, ref, watch, defineComponent, inject, toRaw, computed, onBeforeMount, onBeforeUnmount, } from 'vue';
import { useValidation } from '../../composable/use-validation';
import { useIcons } from '../../composable/use-icons';
import { VIcon } from '../VIcon';
import { VLabel } from '../VLabel';
import { sizes } from '../../services/sizes';
export default defineComponent({
    name: 'v-checkbox',
    props: {
        modelValue: {
            type: [Array, Boolean],
            default: null,
        },
        label: {
            type: String,
            default: '',
        },
        disabled: Boolean,
        validate: Boolean,
        value: {
            type: [Array, Object, String, Number],
            default: null,
        },
        color: {
            type: String,
            default: 'primary',
        },
    },
    emits: ['change', 'update:modelValue'],
    setup(props, { emit }) {
        const isChecked = ref(false);
        const form = inject('form', null);
        const valuesMap = new Map();
        const { validate } = useValidation(props);
        const { icons } = useIcons();
        const classes = computed(() => ({
            'v-checkbox': true,
            'v-checkbox--disabled': props.disabled,
            'v-checkbox--checked': isChecked.value,
            'v-validatable': props.validate,
        }));
        watch(() => props.modelValue, to => {
            if (Array.isArray(to)) {
                valuesMap.clear();
                to.forEach(it => valuesMap.set(toRaw(it), toRaw(it)));
                isChecked.value = !!valuesMap.get(toRaw(props.value));
            }
            else {
                isChecked.value = !!props.modelValue;
            }
        }, { immediate: true });
        const validateValue = () => {
            return validate(isChecked.value);
        };
        const genLabel = () => {
            const propsData = {
                absolute: false,
                disabled: props.disabled,
            };
            return h(VLabel, propsData, { default: () => props.label });
        };
        const genLabelWrapper = () => {
            return h('div', { class: 'v-checkbox__label' }, genLabel());
        };
        const genIcon = () => {
            const icon = isChecked.value ? icons.$checkbox : icons.$box;
            const propsData = {
                icon,
                size: sizes.sm,
                color: props.color,
                disabled: props.disabled,
            };
            return h(VIcon, propsData);
        };
        const genCheckbox = () => {
            return h('div', { class: 'v-checkbox__square' }, genIcon());
        };
        const computeValue = () => {
            if (Array.isArray(props.modelValue)) {
                if (isChecked.value) {
                    valuesMap.delete(toRaw(props.value));
                }
                else {
                    valuesMap.set(toRaw(props.value), toRaw(props.value));
                }
                return Array.from(valuesMap.values());
            }
            return (isChecked.value = !isChecked.value);
        };
        const onClick = () => {
            if (props.disabled)
                return;
            const value = computeValue();
            props.validate && validateValue();
            emit('update:modelValue', value);
            emit('change', value);
        };
        onBeforeMount(() => {
            form?.add(validateValue);
        });
        onBeforeUnmount(() => {
            form?.remove(validateValue);
        });
        return () => h('div', { class: classes.value, onClick }, [genCheckbox(), props.label && genLabelWrapper()]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkNoZWNrYm94LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVkNoZWNrYm94L1ZDaGVja2JveC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0wsQ0FBQyxFQUNELEdBQUcsRUFDSCxLQUFLLEVBQ0wsZUFBZSxFQUNmLE1BQU0sRUFDTixLQUFLLEVBQ0wsUUFBUSxFQUNSLGFBQWEsRUFDYixlQUFlLEdBQ2hCLE1BQU0sS0FBSyxDQUFBO0FBR1osT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlDQUFpQyxDQUFBO0FBQy9ELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQTtBQUdyRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ2hDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFHbEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHNCQUFzQixDQUFBO0FBVzVDLGVBQWUsZUFBZSxDQUFDO0lBQzdCLElBQUksRUFBRSxZQUFZO0lBQ2xCLEtBQUssRUFBRTtRQUNMLFVBQVUsRUFBRTtZQUNWLElBQUksRUFBRSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUM7WUFDdEIsT0FBTyxFQUFFLElBQUk7U0FDZDtRQUNELEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELFFBQVEsRUFBRSxPQUFPO1FBQ2pCLFFBQVEsRUFBRSxPQUFPO1FBQ2pCLEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQztZQUNyQyxPQUFPLEVBQUUsSUFBSTtTQUNkO1FBQ0QsS0FBSyxFQUFFO1lBQ0wsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsU0FBUztTQUNuQjtLQUNGO0lBQ0QsS0FBSyxFQUFFLENBQUMsUUFB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QyxHQUFHLEVBQUU7WUFDbkIsSUFBSSxFQUFFLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQTtRQUM3QixDQUFDLENBQUMsQ0FBQTtRQUVGLE9BQU8sR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFDbEIsRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsRUFDakMsQ0FBQyxXQUFXLEVBQUUsRUFBRSxLQUFLLENBQUMsS0FBSyxJQUFJLGVBQWUsRUFBRSxDQUFDLENBQ2xELENBQUE7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVnVlIEFQSVxuaW1wb3J0IHtcbiAgaCxcbiAgcmVmLFxuICB3YXRjaCxcbiAgZGVmaW5lQ29tcG9uZW50LFxuICBpbmplY3QsXG4gIHRvUmF3LFxuICBjb21wdXRlZCxcbiAgb25CZWZvcmVNb3VudCxcbiAgb25CZWZvcmVVbm1vdW50LFxufSBmcm9tICd2dWUnXG5cbi8vIENvbXBvc2FibGVzXG5pbXBvcnQgeyB1c2VWYWxpZGF0aW9uIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtdmFsaWRhdGlvbidcbmltcG9ydCB7IHVzZUljb25zIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtaWNvbnMnXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCB7IFZJY29uIH0gZnJvbSAnLi4vVkljb24nXG5pbXBvcnQgeyBWTGFiZWwgfSBmcm9tICcuLi9WTGFiZWwnXG5cbi8vIFNlcnZpY2VzXG5pbXBvcnQgeyBzaXplcyB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3NpemVzJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5pbXBvcnQgeyBNYXliZSB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL2Jhc2UnXG5cbnR5cGUgRm9ybSA9IHtcbiAgYWRkOiAoaXRlbSkgPT4gdm9pZFxuICByZW1vdmU6IChpdGVtKSA9PiB2b2lkXG59XG5cbmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LWNoZWNrYm94JyxcbiAgcHJvcHM6IHtcbiAgICBtb2RlbFZhbHVlOiB7XG4gICAgICB0eXBlOiBbQXJyYXksIEJvb2xlYW5dLFxuICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICB9LFxuICAgIGxhYmVsOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJyxcbiAgICB9LFxuICAgIGRpc2FibGVkOiBCb29sZWFuLFxuICAgIHZhbGlkYXRlOiBCb29sZWFuLFxuICAgIHZhbHVlOiB7XG4gICAgICB0eXBlOiBbQXJyYXksIE9iamVjdCwgU3RyaW5nLCBOdW1iZXJdLFxuICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICB9LFxuICAgIGNvbG9yOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAncHJpbWFyeScsXG4gICAgfSxcbiAgfSxcbiAgZW1pdHM6IFsnY2hhbmdlJywgJ3VwZGF0ZTptb2RlbFZhbHVlJ10sXG4gIHNldHVwKHByb3BzLCB7IGVtaXQgfSk6ICgpID0+IFZOb2RlIHtcbiAgICBjb25zdCBpc0NoZWNrZWQgPSByZWYoZmFsc2UpXG4gICAgY29uc3QgZm9ybSA9IGluamVjdDxNYXliZTxGb3JtPj4oJ2Zvcm0nLCBudWxsKVxuICAgIGNvbnN0IHZhbHVlc01hcDogTWFwPGFueSwgYW55PiA9IG5ldyBNYXAoKVxuXG4gICAgY29uc3QgeyB2YWxpZGF0ZSB9ID0gdXNlVmFsaWRhdGlvbihwcm9wcylcbiAgICBjb25zdCB7IGljb25zIH0gPSB1c2VJY29ucygpXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+ICh7XG4gICAgICAndi1jaGVja2JveCc6IHRydWUsXG4gICAgICAndi1jaGVja2JveC0tZGlzYWJsZWQnOiBwcm9wcy5kaXNhYmxlZCxcbiAgICAgICd2LWNoZWNrYm94LS1jaGVja2VkJzogaXNDaGVja2VkLnZhbHVlLFxuICAgICAgJ3YtdmFsaWRhdGFibGUnOiBwcm9wcy52YWxpZGF0ZSxcbiAgICB9KSlcblxuICAgIHdhdGNoKCgpID0+IHByb3BzLm1vZGVsVmFsdWUsIHRvID0+IHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHRvKSkge1xuICAgICAgICB2YWx1ZXNNYXAuY2xlYXIoKVxuICAgICAgICB0by5mb3JFYWNoKGl0ID0+IHZhbHVlc01hcC5zZXQodG9SYXcoaXQpLCB0b1JhdyhpdCkpKVxuICAgICAgICBpc0NoZWNrZWQudmFsdWUgPSAhIXZhbHVlc01hcC5nZXQodG9SYXcocHJvcHMudmFsdWUpKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXNDaGVja2VkLnZhbHVlID0gISFwcm9wcy5tb2RlbFZhbHVlXG4gICAgICB9XG4gICAgfSwgeyBpbW1lZGlhdGU6IHRydWUgfSlcblxuICAgIGNvbnN0IHZhbGlkYXRlVmFsdWUgPSAoKTogYm9vbGVhbiB8IHZvaWQgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlKGlzQ2hlY2tlZC52YWx1ZSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5MYWJlbCA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGFic29sdXRlOiBmYWxzZSxcbiAgICAgICAgZGlzYWJsZWQ6IHByb3BzLmRpc2FibGVkLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWTGFiZWwsIHByb3BzRGF0YSwgeyBkZWZhdWx0OiAoKSA9PiBwcm9wcy5sYWJlbCB9KVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkxhYmVsV3JhcHBlciA9ICgpID0+IHtcbiAgICAgIHJldHVybiBoKCdkaXYnLCB7IGNsYXNzOiAndi1jaGVja2JveF9fbGFiZWwnIH0sIGdlbkxhYmVsKCkpXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuSWNvbiA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBpY29uID0gaXNDaGVja2VkLnZhbHVlID8gaWNvbnMuJGNoZWNrYm94IDogaWNvbnMuJGJveFxuXG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGljb24sXG4gICAgICAgIHNpemU6IHNpemVzLnNtLFxuICAgICAgICBjb2xvcjogcHJvcHMuY29sb3IsXG4gICAgICAgIGRpc2FibGVkOiBwcm9wcy5kaXNhYmxlZCxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoVkljb24sIHByb3BzRGF0YSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5DaGVja2JveCA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogJ3YtY2hlY2tib3hfX3NxdWFyZScgfSwgZ2VuSWNvbigpKVxuICAgIH1cblxuICAgIGNvbnN0IGNvbXB1dGVWYWx1ZSA9ICgpOiBhbnlbXSB8IGJvb2xlYW4gPT4ge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocHJvcHMubW9kZWxWYWx1ZSkpIHtcbiAgICAgICAgaWYgKGlzQ2hlY2tlZC52YWx1ZSkge1xuICAgICAgICAgIHZhbHVlc01hcC5kZWxldGUodG9SYXcocHJvcHMudmFsdWUpKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhbHVlc01hcC5zZXQodG9SYXcocHJvcHMudmFsdWUpLCB0b1Jhdyhwcm9wcy52YWx1ZSkpXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh2YWx1ZXNNYXAudmFsdWVzKCkpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoaXNDaGVja2VkLnZhbHVlID0gIWlzQ2hlY2tlZC52YWx1ZSlcbiAgICB9XG5cbiAgICBjb25zdCBvbkNsaWNrID0gKCkgPT4ge1xuICAgICAgaWYgKHByb3BzLmRpc2FibGVkKSByZXR1cm5cblxuICAgICAgY29uc3QgdmFsdWUgPSBjb21wdXRlVmFsdWUoKVxuXG4gICAgICBwcm9wcy52YWxpZGF0ZSAmJiB2YWxpZGF0ZVZhbHVlKClcbiAgICAgIGVtaXQoJ3VwZGF0ZTptb2RlbFZhbHVlJywgdmFsdWUpXG4gICAgICBlbWl0KCdjaGFuZ2UnLCB2YWx1ZSlcbiAgICB9XG5cbiAgICBvbkJlZm9yZU1vdW50KCgpID0+IHtcbiAgICAgIGZvcm0/LmFkZCh2YWxpZGF0ZVZhbHVlKVxuICAgIH0pXG5cbiAgICBvbkJlZm9yZVVubW91bnQoKCkgPT4ge1xuICAgICAgZm9ybT8ucmVtb3ZlKHZhbGlkYXRlVmFsdWUpXG4gICAgfSlcblxuICAgIHJldHVybiAoKSA9PiBoKCdkaXYnLFxuICAgICAgeyBjbGFzczogY2xhc3Nlcy52YWx1ZSwgb25DbGljayB9LFxuICAgICAgW2dlbkNoZWNrYm94KCksIHByb3BzLmxhYmVsICYmIGdlbkxhYmVsV3JhcHBlcigpXSxcbiAgICApXG4gIH0sXG59KVxuIl19