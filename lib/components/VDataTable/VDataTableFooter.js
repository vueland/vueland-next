import { watch, computed, defineComponent, h, ref } from 'vue';
import { VIcon } from '../VIcon';
import { VButton } from '../VButton';
import { VMenu } from '../VMenu';
import { useColors } from '../../composables/use-colors';
import { useIcons } from '../../composables/use-icons';
export const VDataTableFooter = defineComponent({
    name: 'v-data-table-footer',
    props: {
        pages: Number,
        page: Number,
        firstOnPage: Number,
        lastOnPage: Number,
        pageCorrection: Number,
        rowsLength: Number,
        rowsOnPage: Number,
        options: Object,
    },
    emits: [
        'last-page',
        'correct-page',
        'select-rows-count',
        'next-page',
        'prev-page',
    ],
    setup(props, { emit, slots }) {
        const { setBackgroundCssColor, setBackgroundClassNameColor, setTextClassNameColor, setTextCssColor, } = useColors();
        const { icons } = useIcons();
        const activator = ref(null);
        const paginationDisplayText = computed(() => {
            return `${props.firstOnPage} - ${props.lastOnPage}
        of ${props.rowsLength}`;
        });
        const isLastPage = computed(() => {
            return props.page >= props.pages;
        });
        watch(() => isLastPage.value, (to) => to && emit('last-page'));
        function changeTableRowsPage(isNext) {
            if (props.page === props.pages && isNext)
                return;
            const event = isNext ? 'next-page' : 'prev-page';
            emit(event, isNext ? 1 : -1);
        }
        function genPaginationButton(isNext = false) {
            const btnColor = props.options?.pagination?.buttonsColor || 'primary';
            const contentColor = props.options.contentColor || 'white';
            const disableIf = (isNext && props.lastOnPage >= props.rowsLength) ||
                (!isNext && props.firstOnPage === 1);
            const propsData = {
                width: 42,
                color: btnColor,
                elevation: 3,
                disabled: disableIf,
                text: disableIf,
                onClick: () => changeTableRowsPage(isNext),
            };
            return h(VButton, propsData, {
                default: () => h(VIcon, {
                    icon: isNext ? icons.$arrowRight : icons.$arrowLeft,
                    color: disableIf ? 'grey lighten-1' : contentColor,
                }),
            });
        }
        function genPaginationPageDisplay() {
            const displayColor = props.options?.pagination?.displayColor || 'primary';
            const propsData = {
                width: 42,
                style: { margin: '0 10px' },
                color: displayColor,
                elevation: 3,
            };
            return h(VButton, propsData, { default: () => props.page });
        }
        const genRowsCountSelectList = () => {
            const options = props.options.counts?.rowsPerPageOptions || [5, 10, 15, 20];
            const color = props.options?.counts?.displayColor || 'primary';
            const contentColor = props.options.contentColor || 'white';
            return h('div', {
                class: {
                    'v-data-table__rows-count-list': true,
                    ...(color ? setBackgroundClassNameColor(color) : {}),
                    ...(contentColor ? setTextClassNameColor(contentColor) : {}),
                },
                style: {
                    ...(color ? setBackgroundCssColor(color) : {}),
                    ...(contentColor ? setTextCssColor(contentColor) : {}),
                },
            }, options.map((it) => h('div', {
                class: 'v-data-table__rows-count-item',
                onClick: () => emit('select-rows-count', it),
            }, [it])));
        };
        const genMenu = () => {
            return h(VMenu, {
                activator: activator.value,
                maxHeight: 240,
                zIndex: 12,
                openOnClick: true,
            }, {
                default: () => genRowsCountSelectList(),
            });
        };
        const genRowsCountField = () => {
            return h('div', {
                class: 'v-data-table__rows-count-value',
                textColor: props.options.contentColor,
            }, props.rowsOnPage);
        };
        const genRowsCountSelect = () => {
            const displayColor = props.options?.counts?.displayColor || 'primary';
            return h(VButton, {
                color: displayColor,
                ref: activator,
            }, {
                default: () => [
                    genRowsCountField(),
                    activator.value && genMenu(),
                ],
            });
        };
        const genRowsCountSelectCaption = () => {
            const color = props.options.contentColor;
            const propsData = {
                class: {
                    'v-data-table__pagination-label': true,
                    ...(color ? setTextClassNameColor(color) : {}),
                },
                style: {
                    ...(color ? setTextCssColor(color) : {}),
                },
            };
            return h('span', propsData, props.options?.counts?.rowsPerPageText || 'Rows per page');
        };
        const genRowsCountSelectBlock = () => {
            return h('div', { class: 'v-data-table__pagination-select' }, [
                genRowsCountSelectCaption(),
                genRowsCountSelect(),
            ]);
        };
        const genPagesCountDisplay = () => {
            const color = props.options.contentColor;
            const propsData = {
                class: {
                    'v-data-table__pagination-pages': true,
                    ...(color ? setTextClassNameColor(color) : {}),
                },
                style: {
                    ...(color ? setTextCssColor(color) : {}),
                },
            };
            props.pageCorrection && emit('correct-page', -props.pageCorrection);
            return h('div', propsData, (props.rowsLength && slots['pagination-text']?.()) ||
                (props.rowsLength && paginationDisplayText.value) ||
                '-');
        };
        const genPaginationButtonsBlock = () => {
            return h('div', { class: { 'v-data-table__pagination-route': true } }, [
                genPaginationButton(),
                genPaginationPageDisplay(),
                genPaginationButton(true),
            ]);
        };
        const genPaginationBlock = () => {
            return h('div', { class: 'v-data-table__pagination' }, [
                genRowsCountSelectBlock(),
                genPagesCountDisplay(),
                genPaginationButtonsBlock(),
            ]);
        };
        return () => {
            const propsData = {
                class: {
                    'v-data-table__footer': true,
                    ...(props.options.color
                        ? setBackgroundClassNameColor(props.options.color)
                        : {}),
                },
                style: {
                    ...(props.options.color
                        ? setBackgroundCssColor(props.options.color)
                        : {}),
                },
            };
            return h('div', propsData, genPaginationBlock());
        };
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGFUYWJsZUZvb3Rlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZEYXRhVGFibGUvVkRhdGFUYWJsZUZvb3Rlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxlQUFlLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBWSxNQUFNLEtBQUssQ0FBQTtBQUd4RSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ2hDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxZQUFZLENBQUE7QUFDcEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUdoQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sOEJBQThCLENBQUE7QUFFeEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDZCQUE2QixDQUFBO0FBS3RELE1BQU0sQ0FBQyxNQUFNLGdCQUFnQixHQUFHLGVBQWUsQ0FBQztJQUM5QyxJQUFJLEVBQUUscUJBQXFCO0lBQzNCLEtBQUssRUFBRTtRQUNMLEtBQUssRUFBRSxNQUFNO1FBQ2IsSUFBSSxFQUFFLE1BQU07UUFDWixXQUFXLEVBQUUsTUFBTTtRQUNuQixVQUFVLEVBQUUsTUFBTTtRQUNsQixjQUFjLEVBQUUsTUFBTTtRQUN0QixVQUFVLEVBQUUsTUFBTTtRQUNsQixVQUFVLEVBQUUsTUFBTTtRQUNsQixPQUFPLEVBQUUsTUFBMkM7S0FDOUM7SUFFUixLQUFLLEVBQUU7UUFDTCxXQUFXO1FBQ1gsY0FBYztRQUNkLG1CQUFtQjtRQUNuQixXQUFXO1FBQ1gsV0FBVztLQUNaO0lBRUQsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUU7UUFDMUIsTUFBTSxFQUNKLHFCQUFxQixFQUNyQiwyQkFBMkIsRUFDM0IscUJBQXFCLEVBQ3JCLGVBQWUsR0FDaEIsR0FBRyxTQUFTLEVBQUUs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QUFDLE9BQU8sQ0FBQyxLQUFLO3dCQUNyQixDQUFDLENBQUMscUJBQXFCLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7d0JBQzVDLENBQUMsQ0FBQyxFQUFFLENBQUM7aUJBQ1I7YUFDRixDQUFBO1lBRUQsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUE7UUFDbEQsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7IHdhdGNoLCBjb21wdXRlZCwgZGVmaW5lQ29tcG9uZW50LCBoLCByZWYsIFByb3BUeXBlIH0gZnJvbSAndnVlJ1xuXG4vLyBDb21wb25lbnRzXG5pbXBvcnQgeyBWSWNvbiB9IGZyb20gJy4uL1ZJY29uJ1xuaW1wb3J0IHsgVkJ1dHRvbiB9IGZyb20gJy4uL1ZCdXR0b24nXG5pbXBvcnQgeyBWTWVudSB9IGZyb20gJy4uL1ZNZW51J1xuXG4vLyBFZmZlY3RzXG5pbXBvcnQgeyB1c2VDb2xvcnMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlcy91c2UtY29sb3JzJ1xuXG5pbXBvcnQgeyB1c2VJY29ucyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGVzL3VzZS1pY29ucydcbi8vIFR5cGVzXG5pbXBvcnQgeyBWTm9kZSB9IGZyb20gJ3Z1ZSdcbmltcG9ydCB7IElEYXRhVGFibGVGb290ZXJPcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuZXhwb3J0IGNvbnN0IFZEYXRhVGFibGVGb290ZXIgPSBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAndi1kYXRhLXRhYmxlLWZvb3RlcicsXG4gIHByb3BzOiB7XG4gICAgcGFnZXM6IE51bWJlcixcbiAgICBwYWdlOiBOdW1iZXIsXG4gICAgZmlyc3RPblBhZ2U6IE51bWJlcixcbiAgICBsYXN0T25QYWdlOiBOdW1iZXIsXG4gICAgcGFnZUNvcnJlY3Rpb246IE51bWJlcixcbiAgICByb3dzTGVuZ3RoOiBOdW1iZXIsXG4gICAgcm93c09uUGFnZTogTnVtYmVyLFxuICAgIG9wdGlvbnM6IE9iamVjdCBhcyBQcm9wVHlwZTxJRGF0YVRhYmxlRm9vdGVyT3B0aW9ucz4sXG4gIH0gYXMgYW55LFxuXG4gIGVtaXRzOiBbXG4gICAgJ2xhc3QtcGFnZScsXG4gICAgJ2NvcnJlY3QtcGFnZScsXG4gICAgJ3NlbGVjdC1yb3dzLWNvdW50JyxcbiAgICAnbmV4dC1wYWdlJyxcbiAgICAncHJldi1wYWdlJyxcbiAgXSxcblxuICBzZXR1cChwcm9wcywgeyBlbWl0LCBzbG90cyB9KTogKCkgPT4gVk5vZGUge1xuICAgIGNvbnN0IHtcbiAgICAgIHNldEJhY2tncm91bmRDc3NDb2xvcixcbiAgICAgIHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcixcbiAgICAgIHNldFRleHRDbGFzc05hbWVDb2xvcixcbiAgICAgIHNldFRleHRDc3NDb2xvcixcbiAgICB9ID0gdXNlQ29sb3JzKClcbiAgICBjb25zdCB7IGljb25zIH0gPSB1c2VJY29ucygpXG5cbiAgICBjb25zdCBhY3RpdmF0b3IgPSByZWY8TWF5YmU8SFRNTEVsZW1lbnQ+PihudWxsKVxuXG4gICAgY29uc3QgcGFnaW5hdGlvbkRpc3BsYXlUZXh0ID0gY29tcHV0ZWQ8c3RyaW5nPigoKSA9PiB7XG4gICAgICByZXR1cm4gYCR7IHByb3BzLmZpcnN0T25QYWdlIH0gLSAkeyBwcm9wcy5sYXN0T25QYWdlIH1cbiAgICAgICAgb2YgJHsgcHJvcHMucm93c0xlbmd0aCB9YFxuICAgIH0pXG5cbiAgICBjb25zdCBpc0xhc3RQYWdlID0gY29tcHV0ZWQ8Ym9vbGVhbj4oKCkgPT4ge1xuICAgICAgcmV0dXJuIHByb3BzLnBhZ2UgPj0gcHJvcHMucGFnZXNcbiAgICB9KVxuXG4gICAgd2F0Y2goXG4gICAgICAoKSA9PiBpc0xhc3RQYWdlLnZhbHVlLFxuICAgICAgKHRvKSA9PiB0byAmJiBlbWl0KCdsYXN0LXBhZ2UnKSxcbiAgICApXG5cbiAgICBmdW5jdGlvbiBjaGFuZ2VUYWJsZVJvd3NQYWdlKGlzTmV4dCkge1xuICAgICAgaWYgKHByb3BzLnBhZ2UgPT09IHByb3BzLnBhZ2VzICYmIGlzTmV4dCkgcmV0dXJuXG5cbiAgICAgIGNvbnN0IGV2ZW50ID0gaXNOZXh0ID8gJ25leHQtcGFnZScgOiAncHJldi1wYWdlJ1xuICAgICAgZW1pdChldmVudCwgaXNOZXh0ID8gMSA6IC0xKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlblBhZ2luYXRpb25CdXR0b24oaXNOZXh0ID0gZmFsc2UpOiBWTm9kZSB7XG4gICAgICBjb25zdCBidG5Db2xvciA9IHByb3BzLm9wdGlvbnM/LnBhZ2luYXRpb24/LmJ1dHRvbnNDb2xvciB8fCAncHJpbWFyeSdcbiAgICAgIGNvbnN0IGNvbnRlbnRDb2xvciA9IHByb3BzLm9wdGlvbnMuY29udGVudENvbG9yIHx8ICd3aGl0ZSdcblxuICAgICAgY29uc3QgZGlzYWJsZUlmID1cbiAgICAgICAgKGlzTmV4dCAmJiBwcm9wcy5sYXN0T25QYWdlID49IHByb3BzLnJvd3NMZW5ndGgpIHx8XG4gICAgICAgICghaXNOZXh0ICYmIHByb3BzLmZpcnN0T25QYWdlID09PSAxKVxuXG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIHdpZHRoOiA0MixcbiAgICAgICAgY29sb3I6IGJ0bkNvbG9yLFxuICAgICAgICBlbGV2YXRpb246IDMsXG4gICAgICAgIGRpc2FibGVkOiBkaXNhYmxlSWYsXG4gICAgICAgIHRleHQ6IGRpc2FibGVJZixcbiAgICAgICAgb25DbGljazogKCkgPT4gY2hhbmdlVGFibGVSb3dzUGFnZShpc05leHQpLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWQnV0dG9uLCBwcm9wc0RhdGEsIHtcbiAgICAgICAgZGVmYXVsdDogKCkgPT5cbiAgICAgICAgICBoKFZJY29uLCB7XG4gICAgICAgICAgICBpY29uOiBpc05leHQgPyBpY29ucy4kYXJyb3dSaWdodCA6IGljb25zLiRhcnJvd0xlZnQsXG4gICAgICAgICAgICBjb2xvcjogZGlzYWJsZUlmID8gJ2dyZXkgbGlnaHRlbi0xJyA6IGNvbnRlbnRDb2xvcixcbiAgICAgICAgICB9KSxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuUGFnaW5hdGlvblBhZ2VEaXNwbGF5KCk6IFZOb2RlIHtcbiAgICAgIGNvbnN0IGRpc3BsYXlDb2xvciA9IHByb3BzLm9wdGlvbnM/LnBhZ2luYXRpb24/LmRpc3BsYXlDb2xvciB8fCAncHJpbWFyeSdcblxuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICB3aWR0aDogNDIsXG4gICAgICAgIHN0eWxlOiB7IG1hcmdpbjogJzAgMTBweCcgfSxcbiAgICAgICAgY29sb3I6IGRpc3BsYXlDb2xvcixcbiAgICAgICAgZWxldmF0aW9uOiAzLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWQnV0dG9uLCBwcm9wc0RhdGEsIHsgZGVmYXVsdDogKCkgPT4gcHJvcHMucGFnZSB9KVxuICAgIH1cblxuICAgIGNvbnN0IGdlblJvd3NDb3VudFNlbGVjdExpc3QgPSAoKSA9PiB7XG4gICAgICBjb25zdCBvcHRpb25zID0gcHJvcHMub3B0aW9ucy5jb3VudHM/LnJvd3NQZXJQYWdlT3B0aW9ucyB8fCBbNSwgMTAsIDE1LCAyMF1cbiAgICAgIGNvbnN0IGNvbG9yID0gcHJvcHMub3B0aW9ucz8uY291bnRzPy5kaXNwbGF5Q29sb3IgfHwgJ3ByaW1hcnknXG4gICAgICBjb25zdCBjb250ZW50Q29sb3IgPSBwcm9wcy5vcHRpb25zLmNvbnRlbnRDb2xvciB8fCAnd2hpdGUnXG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCB7XG4gICAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAgICd2LWRhdGEtdGFibGVfX3Jvd3MtY291bnQtbGlzdCc6IHRydWUsXG4gICAgICAgICAgICAuLi4oY29sb3IgPyBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IoY29sb3IpIDoge30pLFxuICAgICAgICAgICAgLi4uKGNvbnRlbnRDb2xvciA/IHNldFRleHRDbGFzc05hbWVDb2xvcihjb250ZW50Q29sb3IpIDoge30pLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgIC4uLihjb2xvciA/IHNldEJhY2tncm91bmRDc3NDb2xvcihjb2xvcikgOiB7fSksXG4gICAgICAgICAgICAuLi4oY29udGVudENvbG9yID8gc2V0VGV4dENzc0NvbG9yKGNvbnRlbnRDb2xvcikgOiB7fSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSwgb3B0aW9ucy5tYXAoKGl0KSA9PiBoKCdkaXYnLCB7XG4gICAgICAgICAgY2xhc3M6ICd2LWRhdGEtdGFibGVfX3Jvd3MtY291bnQtaXRlbScsXG4gICAgICAgICAgb25DbGljazogKCkgPT4gZW1pdCgnc2VsZWN0LXJvd3MtY291bnQnLCBpdCksXG4gICAgICAgIH0sIFtpdF0pKSxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5NZW51ID0gKCkgPT4ge1xuXG4gICAgICByZXR1cm4gaChWTWVudSwge1xuICAgICAgICBhY3RpdmF0b3I6IGFjdGl2YXRvci52YWx1ZSEsXG4gICAgICAgIG1heEhlaWdodDogMjQwLFxuICAgICAgICB6SW5kZXg6IDEyLFxuICAgICAgICBvcGVuT25DbGljazogdHJ1ZSxcbiAgICAgIH0sIHtcbiAgICAgICAgZGVmYXVsdDogKCkgPT4gZ2VuUm93c0NvdW50U2VsZWN0TGlzdCgpLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5Sb3dzQ291bnRGaWVsZCA9ICgpID0+IHtcbiAgICAgIHJldHVybiBoKCdkaXYnLCB7XG4gICAgICAgIGNsYXNzOiAndi1kYXRhLXRhYmxlX19yb3dzLWNvdW50LXZhbHVlJyxcbiAgICAgICAgdGV4dENvbG9yOiBwcm9wcy5vcHRpb25zLmNvbnRlbnRDb2xvcixcbiAgICAgIH0sIHByb3BzLnJvd3NPblBhZ2UpXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUm93c0NvdW50U2VsZWN0ID0gKCkgPT4ge1xuICAgICAgY29uc3QgZGlzcGxheUNvbG9yID0gcHJvcHMub3B0aW9ucz8uY291bnRzPy5kaXNwbGF5Q29sb3IgfHwgJ3ByaW1hcnknXG5cbiAgICAgIHJldHVybiBoKFZCdXR0b24sIHtcbiAgICAgICAgY29sb3I6IGRpc3BsYXlDb2xvcixcbiAgICAgICAgcmVmOiBhY3RpdmF0b3IsXG4gICAgICB9LCB7XG4gICAgICAgIGRlZmF1bHQ6ICgpID0+IFtcbiAgICAgICAgICBnZW5Sb3dzQ291bnRGaWVsZCgpLFxuICAgICAgICAgIGFjdGl2YXRvci52YWx1ZSAmJiBnZW5NZW51KCksXG4gICAgICAgIF0sXG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGdlblJvd3NDb3VudFNlbGVjdENhcHRpb24gPSAoKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3QgY29sb3IgPSBwcm9wcy5vcHRpb25zLmNvbnRlbnRDb2xvclxuXG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgJ3YtZGF0YS10YWJsZV9fcGFnaW5hdGlvbi1sYWJlbCc6IHRydWUsXG4gICAgICAgICAgLi4uKGNvbG9yID8gc2V0VGV4dENsYXNzTmFtZUNvbG9yKGNvbG9yKSA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAuLi4oY29sb3IgPyBzZXRUZXh0Q3NzQ29sb3IoY29sb3IpIDoge30pLFxuICAgICAgICB9LFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChcbiAgICAgICAgJ3NwYW4nLFxuICAgICAgICBwcm9wc0RhdGEsXG4gICAgICAgIHByb3BzLm9wdGlvbnM/LmNvdW50cz8ucm93c1BlclBhZ2VUZXh0IHx8ICdSb3dzIHBlciBwYWdlJyxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5Sb3dzQ291bnRTZWxlY3RCbG9jayA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogJ3YtZGF0YS10YWJsZV9fcGFnaW5hdGlvbi1zZWxlY3QnIH0sIFtcbiAgICAgICAgZ2VuUm93c0NvdW50U2VsZWN0Q2FwdGlvbigpLFxuICAgICAgICBnZW5Sb3dzQ291bnRTZWxlY3QoKSxcbiAgICAgIF0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUGFnZXNDb3VudERpc3BsYXkgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3QgY29sb3IgPSBwcm9wcy5vcHRpb25zLmNvbnRlbnRDb2xvclxuXG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgJ3YtZGF0YS10YWJsZV9fcGFnaW5hdGlvbi1wYWdlcyc6IHRydWUsXG4gICAgICAgICAgLi4uKGNvbG9yID8gc2V0VGV4dENsYXNzTmFtZUNvbG9yKGNvbG9yKSA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAuLi4oY29sb3IgPyBzZXRUZXh0Q3NzQ29sb3IoY29sb3IpIDoge30pLFxuICAgICAgICB9LFxuICAgICAgfVxuXG4gICAgICBwcm9wcy5wYWdlQ29ycmVjdGlvbiAmJiBlbWl0KCdjb3JyZWN0LXBhZ2UnLCAtcHJvcHMucGFnZUNvcnJlY3Rpb24pXG5cbiAgICAgIHJldHVybiBoKFxuICAgICAgICAnZGl2JyxcbiAgICAgICAgcHJvcHNEYXRhLFxuICAgICAgICAocHJvcHMucm93c0xlbmd0aCAmJiBzbG90c1sncGFnaW5hdGlvbi10ZXh0J10/LigpKSB8fFxuICAgICAgICAocHJvcHMucm93c0xlbmd0aCAmJiBwYWdpbmF0aW9uRGlzcGxheVRleHQudmFsdWUpIHx8XG4gICAgICAgICctJyxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5QYWdpbmF0aW9uQnV0dG9uc0Jsb2NrID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKCdkaXYnLCB7IGNsYXNzOiB7ICd2LWRhdGEtdGFibGVfX3BhZ2luYXRpb24tcm91dGUnOiB0cnVlIH0gfSwgW1xuICAgICAgICBnZW5QYWdpbmF0aW9uQnV0dG9uKCksXG4gICAgICAgIGdlblBhZ2luYXRpb25QYWdlRGlzcGxheSgpLFxuICAgICAgICBnZW5QYWdpbmF0aW9uQnV0dG9uKHRydWUpLFxuICAgICAgXSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5QYWdpbmF0aW9uQmxvY2sgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWRhdGEtdGFibGVfX3BhZ2luYXRpb24nIH0sIFtcbiAgICAgICAgZ2VuUm93c0NvdW50U2VsZWN0QmxvY2soKSxcbiAgICAgICAgZ2VuUGFnZXNDb3VudERpc3BsYXkoKSxcbiAgICAgICAgZ2VuUGFnaW5hdGlvbkJ1dHRvbnNCbG9jaygpLFxuICAgICAgXSlcbiAgICB9XG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczoge1xuICAgICAgICAgICd2LWRhdGEtdGFibGVfX2Zvb3Rlcic6IHRydWUsXG4gICAgICAgICAgLi4uKHByb3BzLm9wdGlvbnMuY29sb3JcbiAgICAgICAgICAgID8gc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yKHByb3BzLm9wdGlvbnMuY29sb3IpXG4gICAgICAgICAgICA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAuLi4ocHJvcHMub3B0aW9ucy5jb2xvclxuICAgICAgICAgICAgPyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IocHJvcHMub3B0aW9ucy5jb2xvcilcbiAgICAgICAgICAgIDoge30pLFxuICAgICAgICB9LFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaCgnZGl2JywgcHJvcHNEYXRhLCBnZW5QYWdpbmF0aW9uQmxvY2soKSlcbiAgICB9XG4gIH0sXG59KVxuIl19