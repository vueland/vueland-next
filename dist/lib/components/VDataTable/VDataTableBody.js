import { h, ref, watch, computed, defineComponent } from 'vue';
import { colorProps, useColors } from '../../composable/use-colors';
import { VDataTableCell } from './VDataTableCell';
import { VCheckbox } from '../VCheckbox';
export const VDataTableBody = defineComponent({
    name: 'v-data-table-body',
    props: {
        cols: Array,
        rows: Array,
        dark: Boolean,
        showSequence: Boolean,
        showCheckbox: Boolean,
        checkAllRows: Boolean,
        align: String,
        colWidth: {
            type: [String, Number],
            default: 125,
        },
        page: Number,
        rowsOnPage: Number,
        ...colorProps(),
    },
    emits: ['select', 'click:row', 'dblclick:row', 'contextmenu:row'],
    setup(props, { slots, emit }) {
        const checkedRows = ref([]);
        const { setBackgroundCssColor, setBackgroundClassNameColor } = useColors();
        const classes = computed(() => ({
            'v-data-table__body': true,
            ...(props.color ? setBackgroundClassNameColor(props.color) : {}),
        }));
        const styles = computed(() => ({
            ...(props.color ? setBackgroundCssColor(props.color) : {}),
        }));
        const rowsOnTable = computed(() => {
            return props.rows?.slice((props.page - 1) * props.rowsOnPage, props.page * props.rowsOnPage);
        });
        watch(() => props.checkAllRows, (to) => {
            if (to)
                onSelectRows(props.rows);
            else
                onSelectRows([]);
        });
        const onSelectRows = (rows) => {
            checkedRows.value = rows;
            emit('select', checkedRows.value);
        };
        const genNumberCell = (count) => {
            return h(VDataTableCell, {
                width: 50,
                align: 'center',
                dark: props.dark,
                color: props.color,
                class: 'v-data-table__row-number',
            }, {
                default: () => count + 1,
            });
        };
        const genCheckboxCell = (row) => {
            return h(VDataTableCell, {
                width: 50,
                align: 'center',
                dark: props.dark,
                color: props.color,
                class: 'v-data-table__row-checkbox',
            }, {
                default: () => h(VCheckbox, {
                    modelValue: checkedRows.value,
                    color: props.dark ? 'white' : '',
                    value: row,
                    onChecked: onSelectRows,
                }),
            });
        };
        const genRowCell = (col, row) => {
            const { format } = col;
            const slotContent = slots[col.key] &&
                slots[col.key]({
                    row,
                    format,
                });
            return h(VDataTableCell, {
                width: col.width,
                align: col.align || props.align,
                dark: props.dark,
            }, {
                default: () => slotContent
                    ? slotContent
                    : format
                        ? format(row)
                        : String(row[col.key]),
            });
        };
        const genTableRow = (row, rowCount) => {
            const rowCells = [];
            props.showSequence && rowCells.push(genNumberCell(rowCount));
            props.showCheckbox && rowCells.push(genCheckboxCell(row));
            props.cols.forEach((col) => {
                col.show && rowCells.push(genRowCell(col, row));
            });
            return h('div', {
                class: { 'v-data-table__row': true },
                onClick: () => emit('click:row', row),
                onDblclick: () => emit('dblclick:row', row),
                onContextmenu: (e) => {
                    e.preventDefault();
                    emit('contextmenu:row', row);
                },
            }, rowCells);
        };
        const genTableRows = () => {
            const tableRows = [];
            const rowsLength = rowsOnTable.value?.length;
            const count = (props.page - 1) * props.rowsOnPage;
            for (let i = 0; i < rowsLength; i += 1) {
                tableRows.push(genTableRow(rowsOnTable.value[i], count + i));
            }
            return tableRows;
        };
        return () => h('div', {
            class: classes.value,
            style: styles.value,
        }, genTableRows());
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGFUYWJsZUJvZHkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WRGF0YVRhYmxlL1ZEYXRhVGFibGVCb2R5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsZUFBZSxFQUFFLE1BQU0sS0FBSyxDQUFBO0FBRzlELE9BQU8sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sNkJBQTZCLENBQUE7QUFHbkUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFBO0FBQ2pELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUE7QUFLeEMsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLGVBQWUsQ0FBQztJQUM1QyxJQUFJLEVBQUUsbUJBQW1CO0lBRXpCLEtBQUssRUFBRTtRQUNMLElBQUksRUFBRSxLQUFLO1FBQ1gsSUFBSSxFQUFFLEtBQUs7UUFDWCxJQUFJLEVBQUUsT0FBTztRQUNiLFlBQVksRUFBRSxPQUFPO1FBQ3JCLFlBQVksRUFBRSxPQUFPO1FBQ3JCLFlBQVksRUFBRSxPQUFPO1FBQ3JCLEtBQUssRUFBRSxNQUFNO1FBQ2IsUUFBUSxFQUFFO1lBQ1IsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztZQUN0QixPQUFPLEVBQUUsR0FBRztTQUNiO1FBQ0QsSUFBSSxFQUFFLE1BQU07UUFDWixVQUFVLEVBQUUsTUFBTTtRQUNsQixHQUFHLFVBQVUsRUFBRTtLQUNUO0lBRVIsS0FBSyxFQUFFLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsaUJBQWlCLENBQUM7SUFFakUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7UUFDMUIsTUFBTSxXQUFXLEdBQUcsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBRTNC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QUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVnVlIEFQSVxuaW1wb3J0IHsgaCwgcmVmLCB3YXRjaCwgY29tcHV0ZWQsIGRlZmluZUNvbXBvbmVudCB9IGZyb20gJ3Z1ZSdcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgY29sb3JQcm9wcywgdXNlQ29sb3JzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtY29sb3JzJ1xuXG4vLyBDb21wb25lbnRzXG5pbXBvcnQgeyBWRGF0YVRhYmxlQ2VsbCB9IGZyb20gJy4vVkRhdGFUYWJsZUNlbGwnXG5pbXBvcnQgeyBWQ2hlY2tib3ggfSBmcm9tICcuLi9WQ2hlY2tib3gnXG5cbi8vIFR5cGVzXG5pbXBvcnQgeyBWTm9kZSB9IGZyb20gJ3Z1ZSdcblxuZXhwb3J0IGNvbnN0IFZEYXRhVGFibGVCb2R5ID0gZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3YtZGF0YS10YWJsZS1ib2R5JyxcblxuICBwcm9wczoge1xuICAgIGNvbHM6IEFycmF5LFxuICAgIHJvd3M6IEFycmF5LFxuICAgIGRhcms6IEJvb2xlYW4sXG4gICAgc2hvd1NlcXVlbmNlOiBCb29sZWFuLFxuICAgIHNob3dDaGVja2JveDogQm9vbGVhbixcbiAgICBjaGVja0FsbFJvd3M6IEJvb2xlYW4sXG4gICAgYWxpZ246IFN0cmluZyxcbiAgICBjb2xXaWR0aDoge1xuICAgICAgdHlwZTogW1N0cmluZywgTnVtYmVyXSxcbiAgICAgIGRlZmF1bHQ6IDEyNSxcbiAgICB9LFxuICAgIHBhZ2U6IE51bWJlcixcbiAgICByb3dzT25QYWdlOiBOdW1iZXIsXG4gICAgLi4uY29sb3JQcm9wcygpLFxuICB9IGFzIGFueSxcblxuICBlbWl0czogWydzZWxlY3QnLCAnY2xpY2s6cm93JywgJ2RibGNsaWNrOnJvdycsICdjb250ZXh0bWVudTpyb3cnXSxcblxuICBzZXR1cChwcm9wcywgeyBzbG90cywgZW1pdCB9KTogKCkgPT4gVk5vZGUge1xuICAgIGNvbnN0IGNoZWNrZWRSb3dzID0gcmVmKFtdKVxuXG4gICAgY29uc3QgeyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IsIHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvciB9ID0gdXNlQ29sb3JzKClcblxuICAgIGNvbnN0IGNsYXNzZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBib29sZWFuPj4oKCkgPT4gKHtcbiAgICAgICd2LWRhdGEtdGFibGVfX2JvZHknOiB0cnVlLFxuICAgICAgLi4uKHByb3BzLmNvbG9yID8gc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yKHByb3BzLmNvbG9yKSA6IHt9KSxcbiAgICB9KSlcblxuICAgIGNvbnN0IHN0eWxlcyA9IGNvbXB1dGVkKCgpID0+ICh7XG4gICAgICAuLi4ocHJvcHMuY29sb3IgPyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgIH0pKVxuXG4gICAgY29uc3Qgcm93c09uVGFibGUgPSBjb21wdXRlZDxhbnlbXT4oKCkgPT4ge1xuICAgICAgcmV0dXJuIHByb3BzLnJvd3M/LnNsaWNlKFxuICAgICAgICAocHJvcHMucGFnZSAtIDEpICogcHJvcHMucm93c09uUGFnZSxcbiAgICAgICAgcHJvcHMucGFnZSAqIHByb3BzLnJvd3NPblBhZ2UsXG4gICAgICApXG4gICAgfSlcblxuICAgIHdhdGNoKFxuICAgICAgKCkgPT4gcHJvcHMuY2hlY2tBbGxSb3dzLFxuICAgICAgKHRvKSA9PiB7XG4gICAgICAgIGlmICh0bykgb25TZWxlY3RSb3dzKHByb3BzLnJvd3MpXG4gICAgICAgIGVsc2Ugb25TZWxlY3RSb3dzKFtdKVxuICAgICAgfSxcbiAgICApXG5cbiAgICBjb25zdCBvblNlbGVjdFJvd3MgPSAocm93cykgPT4ge1xuICAgICAgY2hlY2tlZFJvd3MudmFsdWUgPSByb3dzXG4gICAgICBlbWl0KCdzZWxlY3QnLCBjaGVja2VkUm93cy52YWx1ZSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5OdW1iZXJDZWxsID0gKGNvdW50KTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoXG4gICAgICAgIFZEYXRhVGFibGVDZWxsLFxuICAgICAgICB7XG4gICAgICAgICAgd2lkdGg6IDUwLFxuICAgICAgICAgIGFsaWduOiAnY2VudGVyJyxcbiAgICAgICAgICBkYXJrOiBwcm9wcy5kYXJrLFxuICAgICAgICAgIGNvbG9yOiBwcm9wcy5jb2xvcixcbiAgICAgICAgICBjbGFzczogJ3YtZGF0YS10YWJsZV9fcm93LW51bWJlcicsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWZhdWx0OiAoKSA9PiBjb3VudCArIDEsXG4gICAgICAgIH0sXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuQ2hlY2tib3hDZWxsID0gKHJvdyk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKFxuICAgICAgICBWRGF0YVRhYmxlQ2VsbCxcbiAgICAgICAge1xuICAgICAgICAgIHdpZHRoOiA1MCxcbiAgICAgICAgICBhbGlnbjogJ2NlbnRlcicsXG4gICAgICAgICAgZGFyazogcHJvcHMuZGFyayxcbiAgICAgICAgICBjb2xvcjogcHJvcHMuY29sb3IsXG4gICAgICAgICAgY2xhc3M6ICd2LWRhdGEtdGFibGVfX3Jvdy1jaGVja2JveCcsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWZhdWx0OiAoKSA9PlxuICAgICAgICAgICAgaChWQ2hlY2tib3gsIHtcbiAgICAgICAgICAgICAgbW9kZWxWYWx1ZTogY2hlY2tlZFJvd3MudmFsdWUsXG4gICAgICAgICAgICAgIGNvbG9yOiBwcm9wcy5kYXJrID8gJ3doaXRlJyA6ICcnLFxuICAgICAgICAgICAgICB2YWx1ZTogcm93LFxuICAgICAgICAgICAgICBvbkNoZWNrZWQ6IG9uU2VsZWN0Um93cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlblJvd0NlbGwgPSAoY29sLCByb3cpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCB7IGZvcm1hdCB9ID0gY29sXG4gICAgICBjb25zdCBzbG90Q29udGVudCA9XG4gICAgICAgIHNsb3RzW2NvbC5rZXldICYmXG4gICAgICAgIHNsb3RzW2NvbC5rZXldISh7XG4gICAgICAgICAgcm93LFxuICAgICAgICAgIGZvcm1hdCxcbiAgICAgICAgfSlcblxuICAgICAgcmV0dXJuIGgoXG4gICAgICAgIFZEYXRhVGFibGVDZWxsLFxuICAgICAgICB7XG4gICAgICAgICAgd2lkdGg6IGNvbC53aWR0aCxcbiAgICAgICAgICBhbGlnbjogY29sLmFsaWduIHx8IHByb3BzLmFsaWduLFxuICAgICAgICAgIGRhcms6IHByb3BzLmRhcmssXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWZhdWx0OiAoKSA9PlxuICAgICAgICAgICAgc2xvdENvbnRlbnRcbiAgICAgICAgICAgICAgPyBzbG90Q29udGVudFxuICAgICAgICAgICAgICA6IGZvcm1hdFxuICAgICAgICAgICAgICA/IGZvcm1hdChyb3cpXG4gICAgICAgICAgICAgIDogU3RyaW5nKHJvd1tjb2wua2V5XSksXG4gICAgICAgIH0sXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuVGFibGVSb3cgPSAocm93LCByb3dDb3VudDogbnVtYmVyKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3Qgcm93Q2VsbHM6IFZOb2RlW10gPSBbXVxuXG4gICAgICBwcm9wcy5zaG93U2VxdWVuY2UgJiYgcm93Q2VsbHMucHVzaChnZW5OdW1iZXJDZWxsKHJvd0NvdW50KSlcbiAgICAgIHByb3BzLnNob3dDaGVja2JveCAmJiByb3dDZWxscy5wdXNoKGdlbkNoZWNrYm94Q2VsbChyb3cpKVxuXG4gICAgICBwcm9wcy5jb2xzLmZvckVhY2goKGNvbCkgPT4ge1xuICAgICAgICBjb2wuc2hvdyAmJiByb3dDZWxscy5wdXNoKGdlblJvd0NlbGwoY29sLCByb3cpKVxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIGgoXG4gICAgICAgICdkaXYnLFxuICAgICAgICB7XG4gICAgICAgICAgY2xhc3M6IHsgJ3YtZGF0YS10YWJsZV9fcm93JzogdHJ1ZSB9LFxuICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IGVtaXQoJ2NsaWNrOnJvdycsIHJvdyksXG4gICAgICAgICAgb25EYmxjbGljazogKCkgPT4gZW1pdCgnZGJsY2xpY2s6cm93Jywgcm93KSxcbiAgICAgICAgICBvbkNvbnRleHRtZW51OiAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICBlbWl0KCdjb250ZXh0bWVudTpyb3cnLCByb3cpXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcm93Q2VsbHMsXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuVGFibGVSb3dzID0gKCk6IFZOb2RlW10gPT4ge1xuICAgICAgY29uc3QgdGFibGVSb3dzOiBWTm9kZVtdID0gW11cbiAgICAgIGNvbnN0IHJvd3NMZW5ndGggPSByb3dzT25UYWJsZS52YWx1ZT8ubGVuZ3RoXG4gICAgICBjb25zdCBjb3VudCA9IChwcm9wcy5wYWdlIC0gMSkgKiBwcm9wcy5yb3dzT25QYWdlXG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm93c0xlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIHRhYmxlUm93cy5wdXNoKGdlblRhYmxlUm93KHJvd3NPblRhYmxlLnZhbHVlW2ldLCBjb3VudCArIGkpKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGFibGVSb3dzXG4gICAgfVxuXG4gICAgcmV0dXJuICgpID0+IGgoJ2RpdicsIHtcbiAgICAgIGNsYXNzOiBjbGFzc2VzLnZhbHVlLFxuICAgICAgc3R5bGU6IHN0eWxlcy52YWx1ZSxcbiAgICB9LCBnZW5UYWJsZVJvd3MoKSlcbiAgfSxcbn0pXG4iXX0=