import { h, computed, withDirectives, defineComponent } from 'vue';
import { useColors } from '../../composable/use-colors';
import { useIcons } from '../../composable/use-icons';
import { VIcon } from '../VIcon';
import { VCheckbox } from '../VCheckbox';
import { VDataTableCell } from './VDataTableCell';
import { VTextField } from '../VTextField';
import { vShow } from 'vue';
import { clickOutside } from '../../directives/v-click-outside';
export const VDataTableHeader = defineComponent({
    name: 'v-data-table-header',
    props: {
        showSequence: Boolean,
        showCheckbox: Boolean,
        cols: Array,
        colWidth: {
            type: [String, Number],
            default: 125,
        },
        align: String,
        options: Object,
    },
    emits: ['sort', 'filter', 'select-all', 'update:cols'],
    setup(props, { emit, slots }) {
        const { setBackgroundClassNameColor, setBackgroundCssColor } = useColors();
        const { icons, } = useIcons();
        const classes = computed(() => ({
            'v-data-table__header': true,
            ...(props.options.color
                ? setBackgroundClassNameColor(props.options.color)
                : {}),
        }));
        const styles = computed(() => ({
            ...(props.options.color
                ? setBackgroundCssColor(props.options.color)
                : {}),
        }));
        const computedContentColor = computed(() => {
            return props.options.dark
                ? props.options?.contentColor || 'white'
                : props.options?.contentColor;
        });
        const cols = computed(() => [...props.cols]);
        const onSort = (item) => {
            emit('sort', item);
        };
        const onInput = ($value, item) => {
            item.filtered = !!$value;
            emit('filter', { value: $value, col: item });
        };
        const showFilter = (item) => {
            if (item.showFilter)
                return;
            item.showFilter = true;
        };
        const genSortButton = (item) => {
            const classes = {
                'v-data-table-col__actions-sort': true,
                'v-data-table-col__actions-sort--active': item.sorted,
            };
            const propsData = {
                clickable: true,
                class: classes,
                icon: icons.$arrowUp,
                onClick: () => onSort(item),
            };
            return h(VIcon, propsData);
        };
        const genFilterButton = (item) => {
            const classes = {
                'v-data-table-col__actions-filter': true,
                'v-data-table-col__actions-filter--active': item.filtered,
            };
            const propsData = {
                clickable: true,
                class: classes,
                icon: icons.$filter,
                color: !item.cellClass ? computedContentColor.value : '',
                onClick: () => showFilter(item),
            };
            return h(VIcon, propsData);
        };
        const genHeaderActions = (item) => {
            return h('span', { class: 'v-data-table-col__actions' }, [
                item.sortable && genSortButton(item),
                item.filterable && genFilterButton(item),
            ]);
        };
        const genFilterInput = (item) => {
            const propsData = {
                label: 'search',
                dark: props.options.dark,
                color: !item.cellClass ? computedContentColor.value : '',
                prependIcon: icons.$search,
                clearable: true,
                onInput: ($value) => onInput($value, item),
            };
            return h(VTextField, propsData);
        };
        const genFilterWrapper = (col) => {
            const color = props.options.dark
                ? props.options?.color || 'grey darken-3'
                : props.options?.color || 'white';
            const slotName = `${col.key}-filter`;
            const filterSlot = slots[slotName] && slots[slotName]({
                filter: (event) => onInput(event, col),
            });
            const directive = col.showFilter
                ? {
                    handler: () => setTimeout(() => (col.showFilter = false)),
                    closeConditional: false,
                }
                : undefined;
            const propsData = {
                class: {
                    'v-data-table-col__filter': !filterSlot,
                    'v-data-table-col__custom-filter': !!filterSlot,
                    'elevation-5': true,
                    [col.cellClass]: !!col.cellClass,
                    ...(color ? setBackgroundClassNameColor(color) : {}),
                },
                style: {
                    ...(color ? setBackgroundCssColor(color) : {}),
                },
            };
            return (col.filterable &&
                withDirectives(h('div', propsData, filterSlot || genFilterInput(col)), [
                    [clickOutside, directive],
                    [vShow, col.showFilter],
                ]));
        };
        const genHeaderTitle = (col) => {
            return h('div', { class: 'v-data-table-col__title' }, col.title);
        };
        const genNumberCell = () => {
            const propsData = {
                align: 'center',
                class: {
                    'v-data-table-col__number': true,
                    [props.cellClass]: !!props.cellClass,
                },
                contentColor: computedContentColor.value,
                color: props.options.color,
                width: 50,
            };
            return h(VDataTableCell, propsData, { default: () => 'â„–' });
        };
        const genCheckboxCell = () => {
            const propsData = {
                align: 'center',
                class: {
                    'v-data-table-col__checkbox': true,
                    [props.cellClass]: !!props.cellClass,
                },
                dark: props.options.dark,
                contentColor: computedContentColor.value,
                color: props.options.color,
                width: 50,
            };
            const content = {
                default: () => h(VCheckbox, {
                    color: computedContentColor.value,
                    onChecked: (e) => emit('select-all', e),
                }),
            };
            return h(VDataTableCell, propsData, content);
        };
        const genHeaderCell = (col) => {
            const propsData = {
                dark: props.options.dark,
                class: {
                    'v-data-table-col': true,
                    'v-data-table-col--sorted': col.sorted,
                    [col.cellClass]: !!col.cellClass,
                },
                contentColor: !col.cellClass ? computedContentColor.value : '',
                color: !col.cellClass ? props.options.color : '',
                width: col.width,
                resizeable: col.resizeable,
                align: col.align || props.align,
                onResize: ($size) => (col.width = $size),
            };
            return h(VDataTableCell, propsData, {
                default: () => [
                    genHeaderTitle(col),
                    genHeaderActions(col),
                    genFilterWrapper(col),
                ],
            });
        };
        const genHeaderChildren = () => {
            const children = [];
            const headerSlot = slots.header && slots.header(props);
            props.showSequence && children.push(genNumberCell());
            props.showCheckbox && children.push(genCheckboxCell());
            cols.value.forEach((col) => {
                col.width = col.width || props.colWidth;
                if (!col.hasOwnProperty('show')) {
                    col.show = !col.show;
                }
                !headerSlot[0].children &&
                    col.show &&
                    children.push(genHeaderCell(col));
            });
            headerSlot[0].children && children.push(headerSlot);
            return children;
        };
        return () => {
            const propsData = {
                class: classes.value,
                style: styles.value,
            };
            return h('div', propsData, genHeaderChildren());
        };
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGFUYWJsZUhlYWRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZEYXRhVGFibGUvVkRhdGFUYWJsZUhlYWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxjQUFjLEVBQUUsZUFBZSxFQUFFLE1BQU0sS0FBSyxDQUFBO0FBR2xFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUN2RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sNEJBQTRCLENBQUE7QUFHckQsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUNoQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBQ3hDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQTtBQUNqRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFBO0FBRzFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxLQUFLLENBQUE7QUFDM0IsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGtDQUFrQyxDQUFBO0FBTS9ELE1BQU0sQ0FBQyxNQUFNLGdCQUFnQixHQUFHLGVBQWUsQ0FBQztJQUM5QyxJQUFJLEVBQUUscUJBQXFCO0lBRTNCLEtBQUssRUFBRTtRQUNMLFlBQVksRUFBRSxPQUFPO1FBQ3JCLFlBQVksRUFBRSxPQUFPO1FBQ3JCLElBQUksRUFBRSxLQUFLO1FBQ1gsUUFBUSxFQUFFO1lBQ1IsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztZQUN0QixPQUFPLEVBQUUsR0FBRztTQUNiO1FBQ0QsS0FBSyxFQUFFLE1BQU07UUFDYixPQUFPLEVBQUUsTUFBTTtLQUNUO0lBRVIsS0FBSyxFQUFFLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxZQUFZLEVBQUUsYUFBYSxDQUFDO0lBRXRELEtBQUss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LENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxFQUFFO29CQUMvQixHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQTtpQkFDckI7Z0JBRUQsQ0FBQyxVQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUTtvQkFDeEIsR0FBRyxDQUFDLElBQUk7b0JBQ1IsUUFBUSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtZQUNuQyxDQUFDLENBQUMsQ0FBQTtZQUVGLFVBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFpQixDQUFDLENBQUE7WUFFM0QsT0FBTyxRQUFRLENBQUE7UUFDakIsQ0FBQyxDQUFBO1FBRUQsT0FBTyxHQUFHLEVBQUU7WUFDVixNQUFNLFNBQVMsR0FBRztnQkFDaEIsS0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFLO2dCQUNwQixLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUs7YUFDcEIsQ0FBQTtZQUVELE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQyxDQUFBO1FBQ2pELENBQUMsQ0FBQTtJQUNILENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBWdWUgQVBJXG5pbXBvcnQgeyBoLCBjb21wdXRlZCwgd2l0aERpcmVjdGl2ZXMsIGRlZmluZUNvbXBvbmVudCB9IGZyb20gJ3Z1ZSdcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgdXNlQ29sb3JzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtY29sb3JzJ1xuaW1wb3J0IHsgdXNlSWNvbnMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS1pY29ucydcblxuLy8gQ29tcG9uZW50c1xuaW1wb3J0IHsgVkljb24gfSBmcm9tICcuLi9WSWNvbidcbmltcG9ydCB7IFZDaGVja2JveCB9IGZyb20gJy4uL1ZDaGVja2JveCdcbmltcG9ydCB7IFZEYXRhVGFibGVDZWxsIH0gZnJvbSAnLi9WRGF0YVRhYmxlQ2VsbCdcbmltcG9ydCB7IFZUZXh0RmllbGQgfSBmcm9tICcuLi9WVGV4dEZpZWxkJ1xuXG4vLyBEaXJlY3RpdmVzXG5pbXBvcnQgeyB2U2hvdyB9IGZyb20gJ3Z1ZSdcbmltcG9ydCB7IGNsaWNrT3V0c2lkZSB9IGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMvdi1jbGljay1vdXRzaWRlJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5pbXBvcnQgeyBEYXRhQ29sdW1uIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMnXG5cbmV4cG9ydCBjb25zdCBWRGF0YVRhYmxlSGVhZGVyID0gZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3YtZGF0YS10YWJsZS1oZWFkZXInLFxuXG4gIHByb3BzOiB7XG4gICAgc2hvd1NlcXVlbmNlOiBCb29sZWFuLFxuICAgIHNob3dDaGVja2JveDogQm9vbGVhbixcbiAgICBjb2xzOiBBcnJheSxcbiAgICBjb2xXaWR0aDoge1xuICAgICAgdHlwZTogW1N0cmluZywgTnVtYmVyXSxcbiAgICAgIGRlZmF1bHQ6IDEyNSxcbiAgICB9LFxuICAgIGFsaWduOiBTdHJpbmcsXG4gICAgb3B0aW9uczogT2JqZWN0LFxuICB9IGFzIGFueSxcblxuICBlbWl0czogWydzb3J0JywgJ2ZpbHRlcicsICdzZWxlY3QtYWxsJywgJ3VwZGF0ZTpjb2xzJ10sXG5cbiAgc2V0dXAocHJvcHMsIHsgZW1pdCwgc2xvdHMgfSkge1xuICAgIGNvbnN0IHsgc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yLCBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IgfSA9IHVzZUNvbG9ycygpXG4gICAgY29uc3QgeyBpY29ucywgIH0gPSB1c2VJY29ucygpXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+ICh7XG4gICAgICAndi1kYXRhLXRhYmxlX19oZWFkZXInOiB0cnVlLFxuICAgICAgLi4uKHByb3BzLm9wdGlvbnMuY29sb3JcbiAgICAgICAgPyBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IocHJvcHMub3B0aW9ucy5jb2xvcilcbiAgICAgICAgOiB7fSksXG4gICAgfSkpXG5cbiAgICBjb25zdCBzdHlsZXMgPSBjb21wdXRlZCgoKSA9PiAoe1xuICAgICAgLi4uKHByb3BzLm9wdGlvbnMuY29sb3JcbiAgICAgICAgPyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IocHJvcHMub3B0aW9ucy5jb2xvcilcbiAgICAgICAgOiB7fSksXG4gICAgfSkpXG5cbiAgICBjb25zdCBjb21wdXRlZENvbnRlbnRDb2xvciA9IGNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuICAgICAgcmV0dXJuIHByb3BzLm9wdGlvbnMuZGFya1xuICAgICAgICA/IHByb3BzLm9wdGlvbnM/LmNvbnRlbnRDb2xvciB8fCAnd2hpdGUnXG4gICAgICAgIDogcHJvcHMub3B0aW9ucz8uY29udGVudENvbG9yXG4gICAgfSlcblxuICAgIGNvbnN0IGNvbHMgPSBjb21wdXRlZDxEYXRhQ29sdW1uW10+KCgpID0+IFsuLi5wcm9wcy5jb2xzXSlcblxuICAgIGNvbnN0IG9uU29ydCA9IChpdGVtKSA9PiB7XG4gICAgICBlbWl0KCdzb3J0JywgaXRlbSlcbiAgICB9XG5cbiAgICBjb25zdCBvbklucHV0ID0gKCR2YWx1ZSwgaXRlbSkgPT4ge1xuICAgICAgaXRlbS5maWx0ZXJlZCA9ICEhJHZhbHVlXG4gICAgICBlbWl0KCdmaWx0ZXInLCB7IHZhbHVlOiAkdmFsdWUsIGNvbDogaXRlbSB9KVxuICAgIH1cblxuICAgIGNvbnN0IHNob3dGaWx0ZXIgPSAoaXRlbSkgPT4ge1xuICAgICAgaWYgKGl0ZW0uc2hvd0ZpbHRlcikgcmV0dXJuXG4gICAgICBpdGVtLnNob3dGaWx0ZXIgPSB0cnVlXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuU29ydEJ1dHRvbiA9IChpdGVtKSA9PiB7XG4gICAgICBjb25zdCBjbGFzc2VzID0ge1xuICAgICAgICAndi1kYXRhLXRhYmxlLWNvbF9fYWN0aW9ucy1zb3J0JzogdHJ1ZSxcbiAgICAgICAgJ3YtZGF0YS10YWJsZS1jb2xfX2FjdGlvbnMtc29ydC0tYWN0aXZlJzogaXRlbS5zb3J0ZWQsXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xpY2thYmxlOiB0cnVlLFxuICAgICAgICBjbGFzczogY2xhc3NlcyxcbiAgICAgICAgaWNvbjogaWNvbnMuJGFycm93VXAsXG4gICAgICAgIG9uQ2xpY2s6ICgpID0+IG9uU29ydChpdGVtKSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoVkljb24sIHByb3BzRGF0YSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5GaWx0ZXJCdXR0b24gPSAoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgY2xhc3NlcyA9IHtcbiAgICAgICAgJ3YtZGF0YS10YWJsZS1jb2xfX2FjdGlvbnMtZmlsdGVyJzogdHJ1ZSxcbiAgICAgICAgJ3YtZGF0YS10YWJsZS1jb2xfX2FjdGlvbnMtZmlsdGVyLS1hY3RpdmUnOiBpdGVtLmZpbHRlcmVkLFxuICAgICAgfVxuXG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsaWNrYWJsZTogdHJ1ZSxcbiAgICAgICAgY2xhc3M6IGNsYXNzZXMsXG4gICAgICAgIGljb246IGljb25zLiRmaWx0ZXIsXG4gICAgICAgIGNvbG9yOiAhaXRlbS5jZWxsQ2xhc3MgPyBjb21wdXRlZENvbnRlbnRDb2xvci52YWx1ZSA6ICcnLFxuICAgICAgICBvbkNsaWNrOiAoKSA9PiBzaG93RmlsdGVyKGl0ZW0pLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWSWNvbiwgcHJvcHNEYXRhKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkhlYWRlckFjdGlvbnMgPSAoaXRlbSkgPT4ge1xuICAgICAgcmV0dXJuIGgoJ3NwYW4nLCB7IGNsYXNzOiAndi1kYXRhLXRhYmxlLWNvbF9fYWN0aW9ucycgfSwgW1xuICAgICAgICBpdGVtLnNvcnRhYmxlICYmIGdlblNvcnRCdXR0b24oaXRlbSksXG4gICAgICAgIGl0ZW0uZmlsdGVyYWJsZSAmJiBnZW5GaWx0ZXJCdXR0b24oaXRlbSksXG4gICAgICBdKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkZpbHRlcklucHV0ID0gKGl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgbGFiZWw6ICdzZWFyY2gnLFxuICAgICAgICBkYXJrOiBwcm9wcy5vcHRpb25zLmRhcmssXG4gICAgICAgIGNvbG9yOiAhaXRlbS5jZWxsQ2xhc3MgPyBjb21wdXRlZENvbnRlbnRDb2xvci52YWx1ZSA6ICcnLFxuICAgICAgICBwcmVwZW5kSWNvbjogaWNvbnMuJHNlYXJjaCxcbiAgICAgICAgY2xlYXJhYmxlOiB0cnVlLFxuICAgICAgICBvbklucHV0OiAoJHZhbHVlKSA9PiBvbklucHV0KCR2YWx1ZSwgaXRlbSksXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKFZUZXh0RmllbGQsIHByb3BzRGF0YSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5GaWx0ZXJXcmFwcGVyID0gKGNvbCkgPT4ge1xuICAgICAgY29uc3QgY29sb3IgPSBwcm9wcy5vcHRpb25zLmRhcmtcbiAgICAgICAgPyBwcm9wcy5vcHRpb25zPy5jb2xvciB8fCAnZ3JleSBkYXJrZW4tMydcbiAgICAgICAgOiBwcm9wcy5vcHRpb25zPy5jb2xvciB8fCAnd2hpdGUnXG5cbiAgICAgIGNvbnN0IHNsb3ROYW1lID0gYCR7IGNvbC5rZXkgfS1maWx0ZXJgXG5cbiAgICAgIGNvbnN0IGZpbHRlclNsb3QgPSBzbG90c1tzbG90TmFtZV0gJiYgc2xvdHNbc2xvdE5hbWVdISh7XG4gICAgICAgIGZpbHRlcjogKGV2ZW50KSA9PiBvbklucHV0KGV2ZW50LCBjb2wpLFxuICAgICAgfSlcblxuICAgICAgY29uc3QgZGlyZWN0aXZlID0gY29sLnNob3dGaWx0ZXJcbiAgICAgICAgPyB7XG4gICAgICAgICAgaGFuZGxlcjogKCkgPT4gc2V0VGltZW91dCgoKSA9PiAoY29sLnNob3dGaWx0ZXIgPSBmYWxzZSkpLFxuICAgICAgICAgIGNsb3NlQ29uZGl0aW9uYWw6IGZhbHNlLFxuICAgICAgICB9XG4gICAgICAgIDogdW5kZWZpbmVkXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1kYXRhLXRhYmxlLWNvbF9fZmlsdGVyJzogIWZpbHRlclNsb3QsXG4gICAgICAgICAgJ3YtZGF0YS10YWJsZS1jb2xfX2N1c3RvbS1maWx0ZXInOiAhIWZpbHRlclNsb3QsXG4gICAgICAgICAgJ2VsZXZhdGlvbi01JzogdHJ1ZSxcbiAgICAgICAgICBbY29sLmNlbGxDbGFzc106ICEhY29sLmNlbGxDbGFzcyxcbiAgICAgICAgICAuLi4oY29sb3IgPyBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IoY29sb3IpIDoge30pLFxuICAgICAgICB9LFxuICAgICAgICBzdHlsZToge1xuICAgICAgICAgIC4uLihjb2xvciA/IHNldEJhY2tncm91bmRDc3NDb2xvcihjb2xvcikgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIGNvbC5maWx0ZXJhYmxlICYmXG4gICAgICAgIHdpdGhEaXJlY3RpdmVzKGgoJ2RpdicsIHByb3BzRGF0YSwgZmlsdGVyU2xvdCB8fCBnZW5GaWx0ZXJJbnB1dChjb2wpKSwgW1xuICAgICAgICAgIFtjbGlja091dHNpZGUsIGRpcmVjdGl2ZV0sXG4gICAgICAgICAgW3ZTaG93LCBjb2wuc2hvd0ZpbHRlcl0sXG4gICAgICAgIF0pXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuSGVhZGVyVGl0bGUgPSAoY29sKTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWRhdGEtdGFibGUtY29sX190aXRsZScgfSwgY29sLnRpdGxlKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbk51bWJlckNlbGwgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBhbGlnbjogJ2NlbnRlcicsXG4gICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgJ3YtZGF0YS10YWJsZS1jb2xfX251bWJlcic6IHRydWUsXG4gICAgICAgICAgW3Byb3BzLmNlbGxDbGFzc106ICEhcHJvcHMuY2VsbENsYXNzLFxuICAgICAgICB9LFxuICAgICAgICBjb250ZW50Q29sb3I6IGNvbXB1dGVkQ29udGVudENvbG9yLnZhbHVlLFxuICAgICAgICBjb2xvcjogcHJvcHMub3B0aW9ucy5jb2xvcixcbiAgICAgICAgd2lkdGg6IDUwLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWRGF0YVRhYmxlQ2VsbCwgcHJvcHNEYXRhLCB7IGRlZmF1bHQ6ICgpID0+ICfihJYnIH0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuQ2hlY2tib3hDZWxsID0gKCkgPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBhbGlnbjogJ2NlbnRlcicsXG4gICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgJ3YtZGF0YS10YWJsZS1jb2xfX2NoZWNrYm94JzogdHJ1ZSxcbiAgICAgICAgICBbcHJvcHMuY2VsbENsYXNzXTogISFwcm9wcy5jZWxsQ2xhc3MsXG4gICAgICAgIH0sXG4gICAgICAgIGRhcms6IHByb3BzLm9wdGlvbnMuZGFyayxcbiAgICAgICAgY29udGVudENvbG9yOiBjb21wdXRlZENvbnRlbnRDb2xvci52YWx1ZSxcbiAgICAgICAgY29sb3I6IHByb3BzLm9wdGlvbnMuY29sb3IsXG4gICAgICAgIHdpZHRoOiA1MCxcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29udGVudCA9IHtcbiAgICAgICAgZGVmYXVsdDogKCkgPT5cbiAgICAgICAgICBoKFZDaGVja2JveCwge1xuICAgICAgICAgICAgY29sb3I6IGNvbXB1dGVkQ29udGVudENvbG9yLnZhbHVlLFxuICAgICAgICAgICAgb25DaGVja2VkOiAoZSkgPT4gZW1pdCgnc2VsZWN0LWFsbCcsIGUpLFxuICAgICAgICAgIH0pLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWRGF0YVRhYmxlQ2VsbCwgcHJvcHNEYXRhLCBjb250ZW50KVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkhlYWRlckNlbGwgPSAoY29sKSA9PiB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGRhcms6IHByb3BzLm9wdGlvbnMuZGFyayxcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1kYXRhLXRhYmxlLWNvbCc6IHRydWUsXG4gICAgICAgICAgJ3YtZGF0YS10YWJsZS1jb2wtLXNvcnRlZCc6IGNvbC5zb3J0ZWQsXG4gICAgICAgICAgW2NvbC5jZWxsQ2xhc3NdOiAhIWNvbC5jZWxsQ2xhc3MsXG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRlbnRDb2xvcjogIWNvbC5jZWxsQ2xhc3MgPyBjb21wdXRlZENvbnRlbnRDb2xvci52YWx1ZSA6ICcnLFxuICAgICAgICBjb2xvcjogIWNvbC5jZWxsQ2xhc3MgPyBwcm9wcy5vcHRpb25zLmNvbG9yIDogJycsXG4gICAgICAgIHdpZHRoOiBjb2wud2lkdGgsXG4gICAgICAgIHJlc2l6ZWFibGU6IGNvbC5yZXNpemVhYmxlLFxuICAgICAgICBhbGlnbjogY29sLmFsaWduIHx8IHByb3BzLmFsaWduLFxuICAgICAgICBvblJlc2l6ZTogKCRzaXplKSA9PiAoY29sLndpZHRoID0gJHNpemUpLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWRGF0YVRhYmxlQ2VsbCwgcHJvcHNEYXRhLCB7XG4gICAgICAgIGRlZmF1bHQ6ICgpID0+IFtcbiAgICAgICAgICBnZW5IZWFkZXJUaXRsZShjb2wpLFxuICAgICAgICAgIGdlbkhlYWRlckFjdGlvbnMoY29sKSxcbiAgICAgICAgICBnZW5GaWx0ZXJXcmFwcGVyKGNvbCksXG4gICAgICAgIF0sXG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkhlYWRlckNoaWxkcmVuID0gKCkgPT4ge1xuICAgICAgY29uc3QgY2hpbGRyZW46IFZOb2RlW10gPSBbXVxuICAgICAgY29uc3QgaGVhZGVyU2xvdCA9IHNsb3RzLmhlYWRlciAmJiBzbG90cy5oZWFkZXIocHJvcHMpXG5cbiAgICAgIHByb3BzLnNob3dTZXF1ZW5jZSAmJiBjaGlsZHJlbi5wdXNoKGdlbk51bWJlckNlbGwoKSlcbiAgICAgIHByb3BzLnNob3dDaGVja2JveCAmJiBjaGlsZHJlbi5wdXNoKGdlbkNoZWNrYm94Q2VsbCgpKVxuXG4gICAgICBjb2xzLnZhbHVlIS5mb3JFYWNoKChjb2w6IERhdGFDb2x1bW4pID0+IHtcbiAgICAgICAgY29sLndpZHRoID0gY29sLndpZHRoIHx8IHByb3BzLmNvbFdpZHRoXG5cbiAgICAgICAgaWYgKCFjb2wuaGFzT3duUHJvcGVydHkoJ3Nob3cnKSkge1xuICAgICAgICAgIGNvbC5zaG93ID0gIWNvbC5zaG93XG4gICAgICAgIH1cblxuICAgICAgICAhaGVhZGVyU2xvdCFbMF0uY2hpbGRyZW4gJiZcbiAgICAgICAgY29sLnNob3cgJiZcbiAgICAgICAgY2hpbGRyZW4ucHVzaChnZW5IZWFkZXJDZWxsKGNvbCkpXG4gICAgICB9KVxuXG4gICAgICBoZWFkZXJTbG90IVswXS5jaGlsZHJlbiAmJiBjaGlsZHJlbi5wdXNoKGhlYWRlclNsb3QgYXMgYW55KVxuXG4gICAgICByZXR1cm4gY2hpbGRyZW5cbiAgICB9XG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczogY2xhc3Nlcy52YWx1ZSxcbiAgICAgICAgc3R5bGU6IHN0eWxlcy52YWx1ZSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHByb3BzRGF0YSwgZ2VuSGVhZGVyQ2hpbGRyZW4oKSlcbiAgICB9XG4gIH0sXG59KVxuIl19