import { h, ref, computed, reactive, defineComponent, onMounted, onBeforeUnmount, } from 'vue';
import { positionProps } from '../../composables/use-position';
import { useColors } from '../../composables/use-colors';
export default defineComponent({
    name: 'v-resize',
    props: {
        emit: {
            type: Boolean,
            default: false,
        },
        customClass: {
            type: String,
        },
        minSize: {
            type: [String, Number],
            default: 50,
        },
        color: {
            type: String,
            default: 'primary',
        },
        ...positionProps(),
    },
    emits: ['resize'],
    setup(props, { emit }) {
        const data = reactive({
            parentNode: null,
            startOffset: null,
            offsetTop: 0,
            offsetLeft: 0,
            parentHeight: 0,
            parentWidth: 0,
            marginLeft: 0,
            marginTop: 0,
            left: 0,
            top: 0,
            isActive: false,
        });
        const resizeRef = ref(null);
        const { setBackgroundClassNameColor, setBackgroundCssColor } = useColors();
        const classes = computed(() => {
            return {
                'v-resize': true,
                'v-resize--active': data.isActive,
                'v-resize--top': props.top,
                'v-resize--bottom': props.bottom,
                'v-resize--right': props.right,
                'v-resize--left': props.left,
                [props.customClass]: !!props.customClass,
                ...(props.color ? setBackgroundClassNameColor(props.color) : {}),
            };
        });
        const styles = computed(() => ({
            ...(props.color ? setBackgroundCssColor(props.color) : {}),
        }));
        const isDirectY = computed(() => {
            return props.top || props.bottom;
        });
        const isNeedReverse = computed(() => {
            return props.top || props.left;
        });
        const currentSize = computed(() => {
            return isDirectY.value ? data.parentHeight : data.parentWidth;
        });
        const sizeProp = computed(() => {
            return isDirectY.value ? 'height' : 'width';
        });
        const reverseDirection = computed(() => {
            return props.top ? 'top' : 'left';
        });
        const reverseOffsetKey = computed(() => {
            const side = reverseDirection.value;
            return 'offset' + side[0].toUpperCase() + side.slice(1);
        });
        const offset = computed(() => {
            return isDirectY.value ? data.offsetTop : data.offsetLeft;
        });
        const direction = computed(() => {
            return isDirectY.value ? 'clientY' : 'clientX';
        });
        const moveReverse = (size) => {
            const { parentNode, left, top } = data;
            const reverseTo = reverseDirection.value;
            const value = !isDirectY.value
                ? currentSize.value - size + left
                : currentSize.value - size + top;
            parentNode.style[reverseTo] = `${value}px`;
        };
        const setOrEmitSize = (size) => {
            if (props.emit)
                return emit('resize', size);
            data.parentNode.style[sizeProp.value] = `${size}px`;
            isNeedReverse.value && moveReverse(size);
        };
        const resize = (e) => {
            let size;
            if (isNeedReverse.value) {
                size =
                    currentSize.value -
                        (e[direction.value] - offset.value) +
                        data.startOffset;
            }
            else {
                size =
                    currentSize.value +
                        (e[direction.value] -
                            currentSize.value -
                            offset.value -
                            data.startOffset);
            }
            size > props.minSize && setOrEmitSize(size);
        };
        const resetMinMaxStyles = () => {
            if (isDirectY.value) {
                data.parentNode.style.maxHeight = '';
                data.parentNode.style.minHeight = '';
            }
            else {
                data.parentNode.style.maxWidth = '';
                data.parentNode.style.minWidth = '';
            }
        };
        const setParent = () => {
            const parent = resizeRef.value.parentNode;
            data.parentNode = parent;
        };
        const computeSizes = () => {
            const { top, left, height, width, marginLeft, marginTop } = getComputedStyle(data.parentNode);
            data.offsetTop = data.parentNode.offsetTop;
            data.offsetLeft = data.parentNode.offsetLeft;
            data.marginLeft = parseFloat(marginLeft);
            data.marginTop = parseFloat(marginTop);
            data.parentHeight = parseFloat(height);
            data.parentWidth = parseFloat(width);
            data.top = parseFloat(top);
            data.left = parseFloat(left);
        };
        const setStartPositions = () => {
            const side = reverseDirection.value;
            const offset = reverseOffsetKey.value;
            if (data[side] === data[offset]) {
                data.parentNode.style[side] = `${data[offset]}px`;
            }
        };
        const disableSelection = (e) => {
            e.preventDefault();
        };
        const initResize = (e) => {
            if (!data.isActive) {
                data.isActive = true;
                computeSizes();
                resetMinMaxStyles();
                setStartPositions();
                setStartOffset(e);
            }
            requestAnimationFrame(() => resize(e));
        };
        const setStartOffset = (e) => {
            if (isNeedReverse.value)
                data.startOffset = e[direction.value];
            else
                data.startOffset = e[direction.value] - currentSize.value;
            data.startOffset -= offset.value;
        };
        const reset = () => {
            data.isActive = false;
            resetMinMaxStyles();
        };
        const onMouseup = () => {
            reset();
            removeHandlers();
        };
        const onMousedown = () => {
            document.addEventListener('mousemove', initResize);
            document.addEventListener('mouseup', onMouseup);
            document.addEventListener('selectstart', disableSelection);
        };
        const removeHandlers = () => {
            document.removeEventListener('mousemove', initResize);
            document.removeEventListener('mouseup', onMouseup);
            document.removeEventListener('selectstart', disableSelection);
        };
        onMounted(() => setParent());
        onBeforeUnmount(() => document.removeEventListener('mousedown', onMousedown));
        return () => h('div', {
            class: classes.value,
            style: styles.value,
            key: 'resize',
            ref: resizeRef,
            onMousedown,
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlJlc2l6ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL3Z1ZWxhbmQvc3JjL2NvbXBvbmVudHMvVlJlc2l6ZS9WUmVzaXplLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFDTCxDQUFDLEVBQ0QsR0FBRyxFQUNILFFBQVEsRUFDUixRQUFRLEVBQ1IsZUFBZSxFQUNmLFNBQVMsRUFDVCxlQUFlLEdBQ2hCLE1BQU0sS0FBSyxDQUFBO0FBR1osT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGdDQUFnQyxDQUFBO0FBQzlELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQTtBQW1CeEQsZUFBZSxlQUFlLENBQUM7SUFDN0IsSUFBSSxFQUFFLFVBQVU7SUFFaEIsS0FBSyxFQUFFO1FBQ0wsSUFBSSxFQUFFO1lBQ0osSUFBSSxFQUFFLE9BQU87WUFDYixPQUFPLEVBQUUsS0FBSztTQUNmO1FBQ0QsV0FBVyxFQUFFO1lBQ1gsSUFBSSxFQUFFLE1BQU07U0FDYjtRQUNELE9BQU8sRUFBRTtZQUNQLElBQUksRUFBRSxDQUFFLE1BQU0sRUFBRSxNQUFNLENBQUU7WUFDeEIsT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLFNBQVM7U0FDbkI7UUFDRCxHQUFHLGFBQWEsRUFBRTtLQUNaO0lBRVIsS0FBSyxFQUFFLENBQUUsUUFBUSxDQUFFO0lBRW5CLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUU7UUFDbkIsTUFBTSxJQUFJLEdBQWUsUUFBUSxDQUFDO1lBQ2hDLFVBQVUsRUFBRSxJQUFJO1lBQ2hCLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLFNBQVMsRUFBRSxDQUFDO1lBQ1osVUFBVSxFQUFFLENBQUM7WUFDYixZQUFZLEVBQUUsQ0FBQztZQUNmLFdBQVcsRUFBRSxDQUFDO1lBQ2QsVUFB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QkFBZ0IsQ0FBQyxDQUFBO1FBQzVELENBQUMsQ0FBQTtRQUVELE1BQU0sY0FBYyxHQUFHLEdBQUcsRUFBRTtZQUMxQixRQUFRLENBQUMsbUJBQW1CLENBQUMsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFBO1lBQ3JELFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUE7WUFDbEQsUUFBUSxDQUFDLG1CQUFtQixDQUFDLGFBQWEsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFBO1FBQy9ELENBQUMsQ0FBQTtRQUVELFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFBO1FBRTVCLGVBQWUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsbUJBQW1CLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUE7UUFFN0UsT0FBTyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFO1lBQ3BCLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSztZQUNwQixLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUs7WUFDbkIsR0FBRyxFQUFFLFFBQVE7WUFDYixHQUFHLEVBQUUsU0FBUztZQUNkLFdBQVc7U0FDWixDQUFDLENBQUE7SUFDSixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVnVlIEFQSVxuaW1wb3J0IHtcbiAgaCxcbiAgcmVmLFxuICBjb21wdXRlZCxcbiAgcmVhY3RpdmUsXG4gIGRlZmluZUNvbXBvbmVudCxcbiAgb25Nb3VudGVkLFxuICBvbkJlZm9yZVVubW91bnQsXG59IGZyb20gJ3Z1ZSdcblxuLy8gQ29tcG9zYWJsZXNcbmltcG9ydCB7IHBvc2l0aW9uUHJvcHMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlcy91c2UtcG9zaXRpb24nXG5pbXBvcnQgeyB1c2VDb2xvcnMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlcy91c2UtY29sb3JzJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5cbnR5cGUgUmVzaXplRGF0YSA9IHtcbiAgcGFyZW50Tm9kZTogSFRNTEVsZW1lbnQgfCBudWxsXG4gIHN0YXJ0T2Zmc2V0OiBudW1iZXIgfCBudWxsXG4gIG9mZnNldFRvcDogbnVtYmVyXG4gIG9mZnNldExlZnQ6IG51bWJlclxuICBwYXJlbnRIZWlnaHQ6IG51bWJlclxuICBwYXJlbnRXaWR0aDogbnVtYmVyXG4gIG1hcmdpbkxlZnQ6IG51bWJlclxuICBtYXJnaW5Ub3A6IG51bWJlclxuICBsZWZ0OiBudW1iZXJcbiAgdG9wOiBudW1iZXJcbiAgaXNBY3RpdmU6IGJvb2xlYW5cbn1cblxuZXhwb3J0IGRlZmF1bHQgZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3YtcmVzaXplJyxcblxuICBwcm9wczoge1xuICAgIGVtaXQ6IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiBmYWxzZSxcbiAgICB9LFxuICAgIGN1c3RvbUNsYXNzOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgfSxcbiAgICBtaW5TaXplOiB7XG4gICAgICB0eXBlOiBbIFN0cmluZywgTnVtYmVyIF0sXG4gICAgICBkZWZhdWx0OiA1MCxcbiAgICB9LFxuICAgIGNvbG9yOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAncHJpbWFyeScsXG4gICAgfSxcbiAgICAuLi5wb3NpdGlvblByb3BzKCksXG4gIH0gYXMgYW55LFxuXG4gIGVtaXRzOiBbICdyZXNpemUnIF0sXG5cbiAgc2V0dXAocHJvcHMsIHsgZW1pdCB9KTogKCkgPT4gVk5vZGUge1xuICAgIGNvbnN0IGRhdGE6IFJlc2l6ZURhdGEgPSByZWFjdGl2ZSh7XG4gICAgICBwYXJlbnROb2RlOiBudWxsLFxuICAgICAgc3RhcnRPZmZzZXQ6IG51bGwsXG4gICAgICBvZmZzZXRUb3A6IDAsXG4gICAgICBvZmZzZXRMZWZ0OiAwLFxuICAgICAgcGFyZW50SGVpZ2h0OiAwLFxuICAgICAgcGFyZW50V2lkdGg6IDAsXG4gICAgICBtYXJnaW5MZWZ0OiAwLFxuICAgICAgbWFyZ2luVG9wOiAwLFxuICAgICAgbGVmdDogMCxcbiAgICAgIHRvcDogMCxcbiAgICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgICB9KVxuXG4gICAgY29uc3QgcmVzaXplUmVmID0gcmVmPEhUTUxFbGVtZW50IHwgbnVsbD4obnVsbClcblxuICAgIGNvbnN0IHsgc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yLCBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IgfSA9IHVzZUNvbG9ycygpXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICd2LXJlc2l6ZSc6IHRydWUsXG4gICAgICAgICd2LXJlc2l6ZS0tYWN0aXZlJzogZGF0YS5pc0FjdGl2ZSxcbiAgICAgICAgJ3YtcmVzaXplLS10b3AnOiBwcm9wcy50b3AsXG4gICAgICAgICd2LXJlc2l6ZS0tYm90dG9tJzogcHJvcHMuYm90dG9tLFxuICAgICAgICAndi1yZXNpemUtLXJpZ2h0JzogcHJvcHMucmlnaHQsXG4gICAgICAgICd2LXJlc2l6ZS0tbGVmdCc6IHByb3BzLmxlZnQsXG4gICAgICAgIFtwcm9wcy5jdXN0b21DbGFzc106ICEhcHJvcHMuY3VzdG9tQ2xhc3MsXG4gICAgICAgIC4uLihwcm9wcy5jb2xvciA/IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcihwcm9wcy5jb2xvcikgOiB7fSksXG4gICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IHN0eWxlcyA9IGNvbXB1dGVkKCgpID0+ICh7XG4gICAgICAuLi4ocHJvcHMuY29sb3IgPyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgIH0pKVxuXG4gICAgY29uc3QgaXNEaXJlY3RZID0gY29tcHV0ZWQ8Ym9vbGVhbj4oKCkgPT4ge1xuICAgICAgcmV0dXJuIHByb3BzLnRvcCB8fCBwcm9wcy5ib3R0b21cbiAgICB9KVxuXG4gICAgY29uc3QgaXNOZWVkUmV2ZXJzZSA9IGNvbXB1dGVkPGJvb2xlYW4+KCgpID0+IHtcbiAgICAgIHJldHVybiBwcm9wcy50b3AgfHwgcHJvcHMubGVmdFxuICAgIH0pXG5cbiAgICBjb25zdCBjdXJyZW50U2l6ZSA9IGNvbXB1dGVkPG51bWJlcj4oKCkgPT4ge1xuICAgICAgcmV0dXJuIGlzRGlyZWN0WS52YWx1ZSA/IGRhdGEucGFyZW50SGVpZ2h0ISA6IGRhdGEucGFyZW50V2lkdGghXG4gICAgfSlcblxuICAgIGNvbnN0IHNpemVQcm9wID0gY29tcHV0ZWQ8c3RyaW5nPigoKSA9PiB7XG4gICAgICByZXR1cm4gaXNEaXJlY3RZLnZhbHVlID8gJ2hlaWdodCcgOiAnd2lkdGgnXG4gICAgfSlcblxuICAgIGNvbnN0IHJldmVyc2VEaXJlY3Rpb24gPSBjb21wdXRlZDxzdHJpbmc+KCgpID0+IHtcbiAgICAgIHJldHVybiBwcm9wcy50b3AgPyAndG9wJyA6ICdsZWZ0J1xuICAgIH0pXG5cbiAgICBjb25zdCByZXZlcnNlT2Zmc2V0S2V5ID0gY29tcHV0ZWQ8c3RyaW5nPigoKSA9PiB7XG4gICAgICBjb25zdCBzaWRlID0gcmV2ZXJzZURpcmVjdGlvbi52YWx1ZVxuICAgICAgcmV0dXJuICdvZmZzZXQnICsgc2lkZVswXS50b1VwcGVyQ2FzZSgpICsgc2lkZS5zbGljZSgxKVxuICAgIH0pXG5cbiAgICBjb25zdCBvZmZzZXQgPSBjb21wdXRlZDxudW1iZXI+KCgpID0+IHtcbiAgICAgIHJldHVybiBpc0RpcmVjdFkudmFsdWUgPyBkYXRhLm9mZnNldFRvcCEgOiBkYXRhLm9mZnNldExlZnQhXG4gICAgfSlcblxuICAgIGNvbnN0IGRpcmVjdGlvbiA9IGNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuICAgICAgcmV0dXJuIGlzRGlyZWN0WS52YWx1ZSA/ICdjbGllbnRZJyA6ICdjbGllbnRYJ1xuICAgIH0pXG5cbiAgICBjb25zdCBtb3ZlUmV2ZXJzZSA9IChzaXplKSA9PiB7XG4gICAgICBjb25zdCB7IHBhcmVudE5vZGUsIGxlZnQsIHRvcCB9ID0gZGF0YVxuICAgICAgY29uc3QgcmV2ZXJzZVRvID0gcmV2ZXJzZURpcmVjdGlvbi52YWx1ZVxuXG4gICAgICBjb25zdCB2YWx1ZSA9ICFpc0RpcmVjdFkudmFsdWVcbiAgICAgICAgPyBjdXJyZW50U2l6ZS52YWx1ZSAtIHNpemUgKyBsZWZ0XG4gICAgICAgIDogY3VycmVudFNpemUudmFsdWUgLSBzaXplICsgdG9wXG5cbiAgICAgIHBhcmVudE5vZGUhLnN0eWxlW3JldmVyc2VUb10gPSBgJHsgdmFsdWUgfXB4YFxuICAgIH1cblxuICAgIGNvbnN0IHNldE9yRW1pdFNpemUgPSAoc2l6ZSkgPT4ge1xuICAgICAgaWYgKHByb3BzLmVtaXQpIHJldHVybiBlbWl0KCdyZXNpemUnLCBzaXplKVxuXG4gICAgICBkYXRhLnBhcmVudE5vZGUhLnN0eWxlW3NpemVQcm9wLnZhbHVlXSA9IGAkeyBzaXplIH1weGBcblxuICAgICAgaXNOZWVkUmV2ZXJzZS52YWx1ZSAmJiBtb3ZlUmV2ZXJzZShzaXplKVxuICAgIH1cblxuICAgIGNvbnN0IHJlc2l6ZSA9IChlKSA9PiB7XG4gICAgICBsZXQgc2l6ZVxuXG4gICAgICBpZiAoaXNOZWVkUmV2ZXJzZS52YWx1ZSkge1xuICAgICAgICBzaXplID1cbiAgICAgICAgICBjdXJyZW50U2l6ZS52YWx1ZSAtXG4gICAgICAgICAgKGVbZGlyZWN0aW9uLnZhbHVlXSAtIG9mZnNldC52YWx1ZSkgK1xuICAgICAgICAgIGRhdGEuc3RhcnRPZmZzZXQhXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzaXplID1cbiAgICAgICAgICBjdXJyZW50U2l6ZS52YWx1ZSArXG4gICAgICAgICAgKGVbZGlyZWN0aW9uLnZhbHVlXSAtXG4gICAgICAgICAgICBjdXJyZW50U2l6ZS52YWx1ZSAtXG4gICAgICAgICAgICBvZmZzZXQudmFsdWUgLVxuICAgICAgICAgICAgZGF0YS5zdGFydE9mZnNldCEpXG4gICAgICB9XG5cbiAgICAgIHNpemUgPiBwcm9wcy5taW5TaXplICYmIHNldE9yRW1pdFNpemUoc2l6ZSlcbiAgICB9XG5cbiAgICBjb25zdCByZXNldE1pbk1heFN0eWxlcyA9ICgpID0+IHtcbiAgICAgIGlmIChpc0RpcmVjdFkudmFsdWUpIHtcbiAgICAgICAgZGF0YS5wYXJlbnROb2RlIS5zdHlsZS5tYXhIZWlnaHQgPSAnJ1xuICAgICAgICBkYXRhLnBhcmVudE5vZGUhLnN0eWxlLm1pbkhlaWdodCA9ICcnXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkYXRhLnBhcmVudE5vZGUhLnN0eWxlLm1heFdpZHRoID0gJydcbiAgICAgICAgZGF0YS5wYXJlbnROb2RlIS5zdHlsZS5taW5XaWR0aCA9ICcnXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3Qgc2V0UGFyZW50ID0gKCkgPT4ge1xuICAgICAgY29uc3QgcGFyZW50ID0gcmVzaXplUmVmLnZhbHVlIS5wYXJlbnROb2RlXG4gICAgICBkYXRhLnBhcmVudE5vZGUgPSBwYXJlbnQgYXMgSFRNTEVsZW1lbnRcbiAgICB9XG5cbiAgICBjb25zdCBjb21wdXRlU2l6ZXMgPSAoKSA9PiB7XG4gICAgICBjb25zdCB7IHRvcCwgbGVmdCwgaGVpZ2h0LCB3aWR0aCwgbWFyZ2luTGVmdCwgbWFyZ2luVG9wIH0gPVxuICAgICAgICBnZXRDb21wdXRlZFN0eWxlKGRhdGEucGFyZW50Tm9kZSEpXG5cbiAgICAgIGRhdGEub2Zmc2V0VG9wID0gZGF0YS5wYXJlbnROb2RlIS5vZmZzZXRUb3BcbiAgICAgIGRhdGEub2Zmc2V0TGVmdCA9IGRhdGEucGFyZW50Tm9kZSEub2Zmc2V0TGVmdFxuICAgICAgZGF0YS5tYXJnaW5MZWZ0ID0gcGFyc2VGbG9hdChtYXJnaW5MZWZ0KVxuICAgICAgZGF0YS5tYXJnaW5Ub3AgPSBwYXJzZUZsb2F0KG1hcmdpblRvcClcbiAgICAgIGRhdGEucGFyZW50SGVpZ2h0ID0gcGFyc2VGbG9hdChoZWlnaHQpXG4gICAgICBkYXRhLnBhcmVudFdpZHRoID0gcGFyc2VGbG9hdCh3aWR0aClcbiAgICAgIGRhdGEudG9wID0gcGFyc2VGbG9hdCh0b3ApXG4gICAgICBkYXRhLmxlZnQgPSBwYXJzZUZsb2F0KGxlZnQpXG4gICAgfVxuXG4gICAgY29uc3Qgc2V0U3RhcnRQb3NpdGlvbnMgPSAoKSA9PiB7XG4gICAgICBjb25zdCBzaWRlID0gcmV2ZXJzZURpcmVjdGlvbi52YWx1ZVxuICAgICAgY29uc3Qgb2Zmc2V0ID0gcmV2ZXJzZU9mZnNldEtleS52YWx1ZVxuXG4gICAgICBpZiAoZGF0YVtzaWRlXSA9PT0gZGF0YVtvZmZzZXRdKSB7XG4gICAgICAgIGRhdGEucGFyZW50Tm9kZSEuc3R5bGVbc2lkZV0gPSBgJHsgZGF0YVtvZmZzZXRdIH1weGBcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBkaXNhYmxlU2VsZWN0aW9uID0gKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIH1cblxuICAgIGNvbnN0IGluaXRSZXNpemUgPSAoZSkgPT4ge1xuICAgICAgaWYgKCFkYXRhLmlzQWN0aXZlKSB7XG4gICAgICAgIGRhdGEuaXNBY3RpdmUgPSB0cnVlXG4gICAgICAgIGNvbXB1dGVTaXplcygpXG4gICAgICAgIHJlc2V0TWluTWF4U3R5bGVzKClcbiAgICAgICAgc2V0U3RhcnRQb3NpdGlvbnMoKVxuICAgICAgICBzZXRTdGFydE9mZnNldChlKVxuICAgICAgfVxuXG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gcmVzaXplKGUpKVxuICAgIH1cblxuICAgIGNvbnN0IHNldFN0YXJ0T2Zmc2V0ID0gKGUpID0+IHtcbiAgICAgIGlmIChpc05lZWRSZXZlcnNlLnZhbHVlKSBkYXRhLnN0YXJ0T2Zmc2V0ID0gZVtkaXJlY3Rpb24udmFsdWVdXG4gICAgICBlbHNlIGRhdGEuc3RhcnRPZmZzZXQgPSBlW2RpcmVjdGlvbi52YWx1ZV0gLSBjdXJyZW50U2l6ZS52YWx1ZVxuXG4gICAgICBkYXRhLnN0YXJ0T2Zmc2V0ISAtPSBvZmZzZXQudmFsdWVcbiAgICB9XG5cbiAgICBjb25zdCByZXNldCA9ICgpID0+IHtcbiAgICAgIGRhdGEuaXNBY3RpdmUgPSBmYWxzZVxuICAgICAgcmVzZXRNaW5NYXhTdHlsZXMoKVxuICAgIH1cblxuICAgIGNvbnN0IG9uTW91c2V1cCA9ICgpID0+IHtcbiAgICAgIHJlc2V0KClcbiAgICAgIHJlbW92ZUhhbmRsZXJzKClcbiAgICB9XG5cbiAgICBjb25zdCBvbk1vdXNlZG93biA9ICgpID0+IHtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGluaXRSZXNpemUpXG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgb25Nb3VzZXVwKVxuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2VsZWN0c3RhcnQnLCBkaXNhYmxlU2VsZWN0aW9uKVxuICAgIH1cblxuICAgIGNvbnN0IHJlbW92ZUhhbmRsZXJzID0gKCkgPT4ge1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgaW5pdFJlc2l6ZSlcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBvbk1vdXNldXApXG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdzZWxlY3RzdGFydCcsIGRpc2FibGVTZWxlY3Rpb24pXG4gICAgfVxuXG4gICAgb25Nb3VudGVkKCgpID0+IHNldFBhcmVudCgpKVxuXG4gICAgb25CZWZvcmVVbm1vdW50KCgpID0+IGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIG9uTW91c2Vkb3duKSlcblxuICAgIHJldHVybiAoKSA9PiBoKCdkaXYnLCB7XG4gICAgICBjbGFzczogY2xhc3Nlcy52YWx1ZSxcbiAgICAgIHN0eWxlOiBzdHlsZXMudmFsdWUsXG4gICAgICBrZXk6ICdyZXNpemUnLFxuICAgICAgcmVmOiByZXNpemVSZWYsXG4gICAgICBvbk1vdXNlZG93bixcbiAgICB9KVxuICB9LFxufSlcbiJdfQ==