import { h, ref, watch, defineComponent, inject, toRaw, computed, onBeforeMount, onBeforeUnmount, } from 'vue';
import { useValidation } from '../../composable/use-validation';
import { useIcons } from '../../composable/use-icons';
import { VIcon } from '../VIcon';
import { VLabel } from '../VLabel';
import { sizes } from '../../services/sizes';
export default defineComponent({
    name: 'v-checkbox',
    props: {
        modelValue: {
            type: [Array, Boolean],
            default: null,
        },
        label: {
            type: String,
            default: '',
        },
        disabled: Boolean,
        validate: Boolean,
        value: {
            type: [Array, Object, String, Number],
            default: null,
        },
        color: {
            type: String,
            default: 'primary',
        },
    },
    emits: ['change', 'update:modelValue'],
    setup(props, { emit }) {
        const isChecked = ref(false);
        const form = inject('form', null);
        const valuesMap = new Map();
        const { validate } = useValidation(props);
        const { icons } = useIcons();
        const classes = computed(() => ({
            'v-checkbox': true,
            'v-checkbox--disabled': props.disabled,
            'v-checkbox--checked': isChecked.value,
            'v-validatable': props.validate,
        }));
        watch(() => props.modelValue, to => {
            if (Array.isArray(to)) {
                valuesMap.clear();
                to.forEach(it => valuesMap.set(toRaw(it), toRaw(it)));
                isChecked.value = !!valuesMap.get(toRaw(props.value));
            }
            else {
                isChecked.value = !!props.modelValue;
            }
        }, { immediate: true });
        const validateValue = () => {
            return validate(isChecked.value);
        };
        const genLabel = () => {
            const propsData = {
                absolute: false,
                disabled: props.disabled,
            };
            return h(VLabel, propsData, { default: () => props.label });
        };
        const genLabelWrapper = () => {
            return h('div', { class: 'v-checkbox__label' }, genLabel());
        };
        const genIcon = () => {
            const icon = isChecked.value ? icons.$checkbox : icons.$box;
            const propsData = {
                icon,
                size: sizes.sm,
                color: props.color,
                disabled: props.disabled,
            };
            return h(VIcon, propsData);
        };
        const genCheckbox = () => {
            return h('div', { class: 'v-checkbox__square' }, genIcon());
        };
        const computeValue = () => {
            if (Array.isArray(props.modelValue)) {
                if (isChecked.value) {
                    valuesMap.delete(toRaw(props.value));
                }
                else {
                    valuesMap.set(toRaw(props.value), toRaw(props.value));
                }
                return Array.from(valuesMap.values());
            }
            return (isChecked.value = !isChecked.value);
        };
        const onClick = () => {
            if (props.disabled)
                return;
            const value = computeValue();
            props.validate && validateValue();
            emit('update:modelValue', value);
            emit('change', value);
        };
        onBeforeMount(() => {
            form?.add(validateValue);
        });
        onBeforeUnmount(() => {
            form?.remove(validateValue);
        });
        return () => h('div', { class: classes.value, onClick }, [genCheckbox(), props.label && genLabelWrapper()]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkNoZWNrYm94LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVkNoZWNrYm94L1ZDaGVja2JveC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0wsQ0FBQyxFQUNELEdBQUcsRUFDSCxLQUFLLEVBQ0wsZUFBZSxFQUNmLE1BQU0sRUFDTixLQUFLLEVBQ0wsUUFBUSxFQUNSLGFBQWEsRUFDYixlQUFlLEdBQ2hCLE1BQU0sS0FBSyxDQUFBO0FBR1osT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlDQUFpQyxDQUFBO0FBQy9ELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQTtBQUdyRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ2hDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFHbEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHNCQUFzQixDQUFBO0FBSzVDLGVBQWUsZUFBZSxDQUFDO0lBQzdCLElBQUksRUFBRSxZQUFZO0lBQ2xCLEtBQUssRUFBRTtRQUNMLFVBQVUsRUFBRTtZQUNWLElBQUksRUFBRSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUM7WUFDdEIsT0FBTyxFQUFFLElBQUk7U0FDZDtRQUNELEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELFFBQVEsRUFBRSxPQUFPO1FBQ2pCLFFBQVEsRUFBRSxPQUFPO1FBQ2pCLEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQztZQUNyQyxPQUFPLEVBQUUsSUFBSTtTQUNkO1FBQ0QsS0FBSyxFQUFFO1lBQ0wsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsU0FBUztTQUNuQjtLQUNGO0lBQ0QsS0FBSyxFQUFFLENBQUMsUUFB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QyxHQUFHLEVBQUU7WUFDbkIsSUFBSSxFQUFFLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQTtRQUM3QixDQUFDLENBQUMsQ0FBQTtRQUVGLE9BQU8sR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFDbEIsRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsRUFDakMsQ0FBQyxXQUFXLEVBQUUsRUFBRSxLQUFLLENBQUMsS0FBSyxJQUFJLGVBQWUsRUFBRSxDQUFDLENBQ2xELENBQUE7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVnVlIEFQSVxuaW1wb3J0IHtcbiAgaCxcbiAgcmVmLFxuICB3YXRjaCxcbiAgZGVmaW5lQ29tcG9uZW50LFxuICBpbmplY3QsXG4gIHRvUmF3LFxuICBjb21wdXRlZCxcbiAgb25CZWZvcmVNb3VudCxcbiAgb25CZWZvcmVVbm1vdW50LFxufSBmcm9tICd2dWUnXG5cbi8vIENvbXBvc2FibGVzXG5pbXBvcnQgeyB1c2VWYWxpZGF0aW9uIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtdmFsaWRhdGlvbidcbmltcG9ydCB7IHVzZUljb25zIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtaWNvbnMnXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCB7IFZJY29uIH0gZnJvbSAnLi4vVkljb24nXG5pbXBvcnQgeyBWTGFiZWwgfSBmcm9tICcuLi9WTGFiZWwnXG5cbi8vIFNlcnZpY2VzXG5pbXBvcnQgeyBzaXplcyB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3NpemVzJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5cbmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LWNoZWNrYm94JyxcbiAgcHJvcHM6IHtcbiAgICBtb2RlbFZhbHVlOiB7XG4gICAgICB0eXBlOiBbQXJyYXksIEJvb2xlYW5dLFxuICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICB9LFxuICAgIGxhYmVsOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJyxcbiAgICB9LFxuICAgIGRpc2FibGVkOiBCb29sZWFuLFxuICAgIHZhbGlkYXRlOiBCb29sZWFuLFxuICAgIHZhbHVlOiB7XG4gICAgICB0eXBlOiBbQXJyYXksIE9iamVjdCwgU3RyaW5nLCBOdW1iZXJdLFxuICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICB9LFxuICAgIGNvbG9yOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAncHJpbWFyeScsXG4gICAgfSxcbiAgfSxcbiAgZW1pdHM6IFsnY2hhbmdlJywgJ3VwZGF0ZTptb2RlbFZhbHVlJ10sXG4gIHNldHVwKHByb3BzLCB7IGVtaXQgfSk6ICgpID0+IFZOb2RlIHtcbiAgICBjb25zdCBpc0NoZWNrZWQgPSByZWYoZmFsc2UpXG4gICAgY29uc3QgZm9ybTogYW55ID0gaW5qZWN0KCdmb3JtJywgbnVsbClcbiAgICBjb25zdCB2YWx1ZXNNYXA6IE1hcDxhbnksIGFueT4gPSBuZXcgTWFwKClcblxuICAgIGNvbnN0IHsgdmFsaWRhdGUgfSA9IHVzZVZhbGlkYXRpb24ocHJvcHMpXG4gICAgY29uc3QgeyBpY29ucyB9ID0gdXNlSWNvbnMoKVxuXG4gICAgY29uc3QgY2xhc3NlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+PigoKSA9PiAoe1xuICAgICAgJ3YtY2hlY2tib3gnOiB0cnVlLFxuICAgICAgJ3YtY2hlY2tib3gtLWRpc2FibGVkJzogcHJvcHMuZGlzYWJsZWQsXG4gICAgICAndi1jaGVja2JveC0tY2hlY2tlZCc6IGlzQ2hlY2tlZC52YWx1ZSxcbiAgICAgICd2LXZhbGlkYXRhYmxlJzogcHJvcHMudmFsaWRhdGUsXG4gICAgfSkpXG5cbiAgICB3YXRjaCgoKSA9PiBwcm9wcy5tb2RlbFZhbHVlLCB0byA9PiB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh0bykpIHtcbiAgICAgICAgdmFsdWVzTWFwLmNsZWFyKClcbiAgICAgICAgdG8uZm9yRWFjaChpdCA9PiB2YWx1ZXNNYXAuc2V0KHRvUmF3KGl0KSwgdG9SYXcoaXQpKSlcbiAgICAgICAgaXNDaGVja2VkLnZhbHVlID0gISF2YWx1ZXNNYXAuZ2V0KHRvUmF3KHByb3BzLnZhbHVlKSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlzQ2hlY2tlZC52YWx1ZSA9ICEhcHJvcHMubW9kZWxWYWx1ZVxuICAgICAgfVxuICAgIH0sIHsgaW1tZWRpYXRlOiB0cnVlIH0pXG5cbiAgICBjb25zdCB2YWxpZGF0ZVZhbHVlID0gKCk6IGJvb2xlYW4gfCB2b2lkID0+IHtcbiAgICAgIHJldHVybiB2YWxpZGF0ZShpc0NoZWNrZWQudmFsdWUpXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuTGFiZWwgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBhYnNvbHV0ZTogZmFsc2UsXG4gICAgICAgIGRpc2FibGVkOiBwcm9wcy5kaXNhYmxlZCxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoVkxhYmVsLCBwcm9wc0RhdGEsIHsgZGVmYXVsdDogKCkgPT4gcHJvcHMubGFiZWwgfSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5MYWJlbFdyYXBwZXIgPSAoKSA9PiB7XG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogJ3YtY2hlY2tib3hfX2xhYmVsJyB9LCBnZW5MYWJlbCgpKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkljb24gPSAoKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3QgaWNvbiA9IGlzQ2hlY2tlZC52YWx1ZSA/IGljb25zLiRjaGVja2JveCA6IGljb25zLiRib3hcblxuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBpY29uLFxuICAgICAgICBzaXplOiBzaXplcy5zbSxcbiAgICAgICAgY29sb3I6IHByb3BzLmNvbG9yLFxuICAgICAgICBkaXNhYmxlZDogcHJvcHMuZGlzYWJsZWQsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKFZJY29uLCBwcm9wc0RhdGEpXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuQ2hlY2tib3ggPSAoKTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWNoZWNrYm94X19zcXVhcmUnIH0sIGdlbkljb24oKSlcbiAgICB9XG5cbiAgICBjb25zdCBjb21wdXRlVmFsdWUgPSAoKTogYW55W10gfCBib29sZWFuID0+IHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHByb3BzLm1vZGVsVmFsdWUpKSB7XG4gICAgICAgIGlmIChpc0NoZWNrZWQudmFsdWUpIHtcbiAgICAgICAgICB2YWx1ZXNNYXAuZGVsZXRlKHRvUmF3KHByb3BzLnZhbHVlKSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YWx1ZXNNYXAuc2V0KHRvUmF3KHByb3BzLnZhbHVlKSwgdG9SYXcocHJvcHMudmFsdWUpKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odmFsdWVzTWFwLnZhbHVlcygpKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gKGlzQ2hlY2tlZC52YWx1ZSA9ICFpc0NoZWNrZWQudmFsdWUpXG4gICAgfVxuXG4gICAgY29uc3Qgb25DbGljayA9ICgpID0+IHtcbiAgICAgIGlmIChwcm9wcy5kaXNhYmxlZCkgcmV0dXJuXG5cbiAgICAgIGNvbnN0IHZhbHVlID0gY29tcHV0ZVZhbHVlKClcblxuICAgICAgcHJvcHMudmFsaWRhdGUgJiYgdmFsaWRhdGVWYWx1ZSgpXG4gICAgICBlbWl0KCd1cGRhdGU6bW9kZWxWYWx1ZScsIHZhbHVlKVxuICAgICAgZW1pdCgnY2hhbmdlJywgdmFsdWUpXG4gICAgfVxuXG4gICAgb25CZWZvcmVNb3VudCgoKSA9PiB7XG4gICAgICBmb3JtPy5hZGQodmFsaWRhdGVWYWx1ZSlcbiAgICB9KVxuXG4gICAgb25CZWZvcmVVbm1vdW50KCgpID0+IHtcbiAgICAgIGZvcm0/LnJlbW92ZSh2YWxpZGF0ZVZhbHVlKVxuICAgIH0pXG5cbiAgICByZXR1cm4gKCkgPT4gaCgnZGl2JyxcbiAgICAgIHsgY2xhc3M6IGNsYXNzZXMudmFsdWUsIG9uQ2xpY2sgfSxcbiAgICAgIFtnZW5DaGVja2JveCgpLCBwcm9wcy5sYWJlbCAmJiBnZW5MYWJlbFdyYXBwZXIoKV0sXG4gICAgKVxuICB9LFxufSlcbiJdfQ==