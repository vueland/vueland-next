import { h, ref, watch, computed, defineComponent } from 'vue';
import { colorProps, useColors } from '../../composables/use-colors';
import { VDataTableCell } from './VDataTableCell';
import { VCheckbox } from '../VCheckbox';
export const VDataTableBody = defineComponent({
    name: 'v-data-table-body',
    props: {
        cols: Array,
        rows: Array,
        dark: Boolean,
        showSequence: Boolean,
        showCheckbox: Boolean,
        checkAllRows: Boolean,
        align: String,
        colWidth: {
            type: [String, Number],
            default: 125,
        },
        page: Number,
        rowsOnPage: Number,
        ...colorProps(),
    },
    emits: ['select', 'click:row', 'dblclick:row', 'contextmenu:row'],
    setup(props, { slots, emit }) {
        const checkedRows = ref([]);
        const { setBackgroundCssColor, setBackgroundClassNameColor } = useColors();
        const classes = computed(() => ({
            'v-data-table__body': true,
            ...(props.color ? setBackgroundClassNameColor(props.color) : {}),
        }));
        const styles = computed(() => ({
            ...(props.color ? setBackgroundCssColor(props.color) : {}),
        }));
        const rowsOnTable = computed(() => {
            return props.rows?.slice((props.page - 1) * props.rowsOnPage, props.page * props.rowsOnPage);
        });
        watch(() => props.checkAllRows, (to) => {
            if (to)
                onSelectRows(props.rows);
            else
                onSelectRows([]);
        });
        const onSelectRows = (rows) => {
            checkedRows.value = rows;
            emit('select', checkedRows.value);
        };
        const genNumberCell = (count) => {
            return h(VDataTableCell, {
                width: 50,
                align: 'center',
                dark: props.dark,
                color: props.color,
                class: 'v-data-table__row-number',
            }, {
                default: () => count + 1,
            });
        };
        const genCheckboxCell = (row) => {
            return h(VDataTableCell, {
                width: 50,
                align: 'center',
                dark: props.dark,
                color: props.color,
                class: 'v-data-table__row-checkbox',
            }, {
                default: () => h(VCheckbox, {
                    modelValue: checkedRows.value,
                    value: row,
                    onChange: onSelectRows,
                }),
            });
        };
        const genRowCell = (col, row) => {
            const { format } = col;
            const slotContent = slots[col.key] &&
                slots[col.key]({
                    row,
                    format,
                });
            return h(VDataTableCell, {
                width: col.width,
                align: col.align || props.align,
                dark: props.dark,
            }, {
                default: () => slotContent
                    ? slotContent
                    : format
                        ? format(row)
                        : String(row[col.key]),
            });
        };
        const genTableRow = (row, rowCount) => {
            const rowCells = [];
            props.showSequence && rowCells.push(genNumberCell(rowCount));
            props.showCheckbox && rowCells.push(genCheckboxCell(row));
            props.cols.forEach((col) => {
                col.show && rowCells.push(genRowCell(col, row));
            });
            return h('div', {
                class: { 'v-data-table__row': true },
                onClick: () => emit('click:row', row),
                onDblclick: () => emit('dblclick:row', row),
                onContextmenu: (e) => {
                    e.preventDefault();
                    emit('contextmenu:row', row);
                },
            }, rowCells);
        };
        const genTableRows = () => {
            const tableRows = [];
            const rowsLength = rowsOnTable.value?.length;
            const count = (props.page - 1) * props.rowsOnPage;
            for (let i = 0; i < rowsLength; i += 1) {
                tableRows.push(genTableRow(rowsOnTable.value[i], count + i));
            }
            return tableRows;
        };
        return () => h('div', {
            class: classes.value,
            style: styles.value,
        }, genTableRows());
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGFUYWJsZUJvZHkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WRGF0YVRhYmxlL1ZEYXRhVGFibGVCb2R5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsZUFBZSxFQUFFLE1BQU0sS0FBSyxDQUFBO0FBRzlELE9BQU8sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sOEJBQThCLENBQUE7QUFHcEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFBO0FBQ2pELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUE7QUFLeEMsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLGVBQWUsQ0FBQztJQUM1QyxJQUFJLEVBQUUsbUJBQW1CO0lBRXpCLEtBQUssRUFBRTtRQUNMLElBQUksRUFBRSxLQUFLO1FBQ1gsSUFBSSxFQUFFLEtBQUs7UUFDWCxJQUFJLEVBQUUsT0FBTztRQUNiLFlBQVksRUFBRSxPQUFPO1FBQ3JCLFlBQVksRUFBRSxPQUFPO1FBQ3JCLFlBQVksRUFBRSxPQUFPO1FBQ3JCLEtBQUssRUFBRSxNQUFNO1FBQ2IsUUFBUSxFQUFFO1lBQ1IsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztZQUN0QixPQUFPLEVBQUUsR0FBRztTQUNiO1FBQ0QsSUFBSSxFQUFFLE1BQU07UUFDWixVQUFVLEVBQUUsTUFBTTtRQUNsQixHQUFHLFVBQVUsRUFBRTtLQUNUO0lBRVIsS0FBSyxFQUFFLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsaUJBQWlCLENBQUM7SUFFakUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7UUFDMUIsTUFBTSxXQUFXLEdBQUcsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBRTNCLE1BQU0sRUFBRSxxQkFBcUIsRUFBRSwyQkFBMkIsRUFBRSxHQUFHLFNBQVMsRUFBRSxDQUFBO1FBRTFFLE1BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBMEIsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUN2RCxvQkFBb0IsRUFBRSxJQUFJO1lBQzFCLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQywyQkFBMkIsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztTQUNqRSxDQUFDLENBQUMsQ0FBQTtRQUVILE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQzdCLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztTQUMzRCxDQUFDLENBQUMsQ0FBQTtRQUVILE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBUSxHQUFHLEVBQUU7WUFDdkMsT0FBTyxLQUFLLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FDdEIsQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxVQUFVLEVBQ25DLEtBQUssQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FDOUIsQ0FBQTtRQUNILENBQUMsQ0FBQyxDQUFBO1FBRUYsS0FBSyxDQUNILEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQ3hCLENBQUMsRUFBRSxFQUFFLEVBQUU7WUFDTCxJQUFJLEVBQUU7Z0JBQUUsWUFBWSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQTs7Z0JBQzNCLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUN2QixDQUFDLENBQ0YsQ0FBQTtRQUVELE1BQU0sWUFBWSxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFDNUIsV0FBVyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUE7WUFDeEIsSUFBSSxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDbkMsQ0FBQyxDQUFBO1FBRUQsTUFBTSxhQUFhLEdBQUcsQ0FBQyxLQUFLLEVBQVMsRUFBRTtZQUNyQyxPQUFPLENBQUMsQ0FDTixjQUFjLEVBQ2Q7Z0JBQ0UsS0FBSyxFQUFFLEVBQUU7Z0JBQ1QsS0FBSyxFQUFFLFFBQVE7Z0JBQ2YsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJO2dCQUNoQixLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7Z0JBQ2xCLEtBQUssRUFBRSwwQkFBMEI7YUFDbEMsRUFDRDtnQkFDRSxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsS0FBSyxHQUFHLENBQUM7YUFDekIsQ0FDRixDQUFBO1FBQ0gsQ0FBQyxDQUFBO1FBRUQsTUFBTSxlQUFlLEdBQUcsQ0FBQyxHQUFHLEVBQVMsRUFBRTtZQUNyQyxPQUFPLENBQUMsQ0FDTixjQUFjLEVBQ2Q7Z0JBQ0UsS0FBSyxFQUFFLEVBQUU7Z0JBQ1QsS0FBSyxFQUFFLFFBQVE7Z0JBQ2YsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJO2dCQUNoQixLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7Z0JBQ2xCLEtBQUssRUFBRSw0QkFBNEI7YUFDcEMsRUFDRDtnQkFDRSxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQ1osQ0FBQyxDQUFDLFNBQVMsRUFBRTtvQkFDWCxVQUFVLEVBQUUsV0FBVyxDQUFDLEtBQUs7b0JBQzdCLEtBQUssRUFBRSxHQUFHO29CQUNWLFFBQVEsRUFBRSxZQUFZO2lCQUN2QixDQUFDO2FBQ0wsQ0FDRixDQUFBO1FBQ0gsQ0FBQyxDQUFBO1FBRUQsTUFBTSxVQUFVLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFTLEVBQUU7WUFDckMsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQTtZQUN0QixNQUFNLFdBQVcsR0FDZixLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQztnQkFDZCxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBRSxDQUFDO29CQUNkLEdBQUc7b0JBQ0gsTUFBTTtpQkFDUCxDQUFDLENBQUE7WUFFSixPQUFPLENBQUMsQ0FDTixjQUFjLEVBQ2Q7Z0JBQ0UsS0FBSyxFQUFFLEdBQUcsQ0FBQyxLQUFLO2dCQUNoQixLQUFLLEVBQUUsR0FBRyxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsS0FBSztnQkFDL0IsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJO2FBQ2pCLEVBQ0Q7Z0JBQ0UsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUNaLFdBQVc7b0JBQ1QsQ0FBQyxDQUFDLFdBQVc7b0JBQ2IsQ0FBQyxDQUFDLE1BQU07d0JBQ1IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUM7d0JBQ2IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQzNCLENBQ0YsQ0FBQTtRQUNILENBQUMsQ0FBQTtRQUVELE1BQU0sV0FBVyxHQUFHLENBQUMsR0FBRyxFQUFFLFFBQWdCLEVBQVMsRUFBRTtZQUNuRCxNQUFNLFFBQVEsR0FBWSxFQUFFLENBQUE7WUFFNUIsS0FBSyxDQUFDLFlBQVksSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFBO1lBQzVELEtBQUssQ0FBQyxZQUFZLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtZQUV6RCxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO2dCQUN6QixHQUFHLENBQUMsSUFBSSxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFBO1lBQ2pELENBQUMsQ0FBQyxDQUFBO1lBRUYsT0FBTyxDQUFDLENBQ04sS0FBSyxFQUNMO2dCQUNFLEtBQUssRUFBRSxFQUFFLG1CQUFtQixFQUFFLElBQUksRUFBRTtnQkFDcEMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxDQUFDO2dCQUNyQyxVQUFVLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxHQUFHLENBQUM7Z0JBQzNDLGFBQWEsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO29CQUNuQixDQUFDLENBQUMsY0FBYyxFQUFFLENBQUE7b0JBQ2xCLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLENBQUMsQ0FBQTtnQkFDOUIsQ0FBQzthQUNGLEVBQ0QsUUFBUSxDQUNULENBQUE7UUFDSCxDQUFDLENBQUE7UUFFRCxNQUFNLFlBQVksR0FBRyxHQUFZLEVBQUU7WUFDakMsTUFBTSxTQUFTLEdBQVksRUFBRSxDQUFBO1lBQzdCLE1BQU0sVUFBVSxHQUFHLFdBQVcsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFBO1lBQzVDLE1BQU0sS0FBSyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFBO1lBRWpELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxVQUFVLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDdEMsU0FBUyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQTthQUM3RDtZQUVELE9BQU8sU0FBUyxDQUFBO1FBQ2xCLENBQUMsQ0FBQTtRQUVELE9BQU8sR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRTtZQUNwQixLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7WUFDcEIsS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFLO1NBQ3BCLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQTtJQUNwQixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVnVlIEFQSVxuaW1wb3J0IHsgaCwgcmVmLCB3YXRjaCwgY29tcHV0ZWQsIGRlZmluZUNvbXBvbmVudCB9IGZyb20gJ3Z1ZSdcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgY29sb3JQcm9wcywgdXNlQ29sb3JzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZXMvdXNlLWNvbG9ycydcblxuLy8gQ29tcG9uZW50c1xuaW1wb3J0IHsgVkRhdGFUYWJsZUNlbGwgfSBmcm9tICcuL1ZEYXRhVGFibGVDZWxsJ1xuaW1wb3J0IHsgVkNoZWNrYm94IH0gZnJvbSAnLi4vVkNoZWNrYm94J1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5cbmV4cG9ydCBjb25zdCBWRGF0YVRhYmxlQm9keSA9IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LWRhdGEtdGFibGUtYm9keScsXG5cbiAgcHJvcHM6IHtcbiAgICBjb2xzOiBBcnJheSxcbiAgICByb3dzOiBBcnJheSxcbiAgICBkYXJrOiBCb29sZWFuLFxuICAgIHNob3dTZXF1ZW5jZTogQm9vbGVhbixcbiAgICBzaG93Q2hlY2tib3g6IEJvb2xlYW4sXG4gICAgY2hlY2tBbGxSb3dzOiBCb29sZWFuLFxuICAgIGFsaWduOiBTdHJpbmcsXG4gICAgY29sV2lkdGg6IHtcbiAgICAgIHR5cGU6IFtTdHJpbmcsIE51bWJlcl0sXG4gICAgICBkZWZhdWx0OiAxMjUsXG4gICAgfSxcbiAgICBwYWdlOiBOdW1iZXIsXG4gICAgcm93c09uUGFnZTogTnVtYmVyLFxuICAgIC4uLmNvbG9yUHJvcHMoKSxcbiAgfSBhcyBhbnksXG5cbiAgZW1pdHM6IFsnc2VsZWN0JywgJ2NsaWNrOnJvdycsICdkYmxjbGljazpyb3cnLCAnY29udGV4dG1lbnU6cm93J10sXG5cbiAgc2V0dXAocHJvcHMsIHsgc2xvdHMsIGVtaXQgfSk6ICgpID0+IFZOb2RlIHtcbiAgICBjb25zdCBjaGVja2VkUm93cyA9IHJlZihbXSlcblxuICAgIGNvbnN0IHsgc2V0QmFja2dyb3VuZENzc0NvbG9yLCBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IgfSA9IHVzZUNvbG9ycygpXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+ICh7XG4gICAgICAndi1kYXRhLXRhYmxlX19ib2R5JzogdHJ1ZSxcbiAgICAgIC4uLihwcm9wcy5jb2xvciA/IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcihwcm9wcy5jb2xvcikgOiB7fSksXG4gICAgfSkpXG5cbiAgICBjb25zdCBzdHlsZXMgPSBjb21wdXRlZCgoKSA9PiAoe1xuICAgICAgLi4uKHByb3BzLmNvbG9yID8gc2V0QmFja2dyb3VuZENzc0NvbG9yKHByb3BzLmNvbG9yKSA6IHt9KSxcbiAgICB9KSlcblxuICAgIGNvbnN0IHJvd3NPblRhYmxlID0gY29tcHV0ZWQ8YW55W10+KCgpID0+IHtcbiAgICAgIHJldHVybiBwcm9wcy5yb3dzPy5zbGljZShcbiAgICAgICAgKHByb3BzLnBhZ2UgLSAxKSAqIHByb3BzLnJvd3NPblBhZ2UsXG4gICAgICAgIHByb3BzLnBhZ2UgKiBwcm9wcy5yb3dzT25QYWdlLFxuICAgICAgKVxuICAgIH0pXG5cbiAgICB3YXRjaChcbiAgICAgICgpID0+IHByb3BzLmNoZWNrQWxsUm93cyxcbiAgICAgICh0bykgPT4ge1xuICAgICAgICBpZiAodG8pIG9uU2VsZWN0Um93cyhwcm9wcy5yb3dzKVxuICAgICAgICBlbHNlIG9uU2VsZWN0Um93cyhbXSlcbiAgICAgIH0sXG4gICAgKVxuXG4gICAgY29uc3Qgb25TZWxlY3RSb3dzID0gKHJvd3MpID0+IHtcbiAgICAgIGNoZWNrZWRSb3dzLnZhbHVlID0gcm93c1xuICAgICAgZW1pdCgnc2VsZWN0JywgY2hlY2tlZFJvd3MudmFsdWUpXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuTnVtYmVyQ2VsbCA9IChjb3VudCk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKFxuICAgICAgICBWRGF0YVRhYmxlQ2VsbCxcbiAgICAgICAge1xuICAgICAgICAgIHdpZHRoOiA1MCxcbiAgICAgICAgICBhbGlnbjogJ2NlbnRlcicsXG4gICAgICAgICAgZGFyazogcHJvcHMuZGFyayxcbiAgICAgICAgICBjb2xvcjogcHJvcHMuY29sb3IsXG4gICAgICAgICAgY2xhc3M6ICd2LWRhdGEtdGFibGVfX3Jvdy1udW1iZXInLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgZGVmYXVsdDogKCkgPT4gY291bnQgKyAxLFxuICAgICAgICB9LFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkNoZWNrYm94Q2VsbCA9IChyb3cpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaChcbiAgICAgICAgVkRhdGFUYWJsZUNlbGwsXG4gICAgICAgIHtcbiAgICAgICAgICB3aWR0aDogNTAsXG4gICAgICAgICAgYWxpZ246ICdjZW50ZXInLFxuICAgICAgICAgIGRhcms6IHByb3BzLmRhcmssXG4gICAgICAgICAgY29sb3I6IHByb3BzLmNvbG9yLFxuICAgICAgICAgIGNsYXNzOiAndi1kYXRhLXRhYmxlX19yb3ctY2hlY2tib3gnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgZGVmYXVsdDogKCkgPT5cbiAgICAgICAgICAgIGgoVkNoZWNrYm94LCB7XG4gICAgICAgICAgICAgIG1vZGVsVmFsdWU6IGNoZWNrZWRSb3dzLnZhbHVlLFxuICAgICAgICAgICAgICB2YWx1ZTogcm93LFxuICAgICAgICAgICAgICBvbkNoYW5nZTogb25TZWxlY3RSb3dzLFxuICAgICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUm93Q2VsbCA9IChjb2wsIHJvdyk6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IHsgZm9ybWF0IH0gPSBjb2xcbiAgICAgIGNvbnN0IHNsb3RDb250ZW50ID1cbiAgICAgICAgc2xvdHNbY29sLmtleV0gJiZcbiAgICAgICAgc2xvdHNbY29sLmtleV0hKHtcbiAgICAgICAgICByb3csXG4gICAgICAgICAgZm9ybWF0LFxuICAgICAgICB9KVxuXG4gICAgICByZXR1cm4gaChcbiAgICAgICAgVkRhdGFUYWJsZUNlbGwsXG4gICAgICAgIHtcbiAgICAgICAgICB3aWR0aDogY29sLndpZHRoLFxuICAgICAgICAgIGFsaWduOiBjb2wuYWxpZ24gfHwgcHJvcHMuYWxpZ24sXG4gICAgICAgICAgZGFyazogcHJvcHMuZGFyayxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRlZmF1bHQ6ICgpID0+XG4gICAgICAgICAgICBzbG90Q29udGVudFxuICAgICAgICAgICAgICA/IHNsb3RDb250ZW50XG4gICAgICAgICAgICAgIDogZm9ybWF0XG4gICAgICAgICAgICAgID8gZm9ybWF0KHJvdylcbiAgICAgICAgICAgICAgOiBTdHJpbmcocm93W2NvbC5rZXldKSxcbiAgICAgICAgfSxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5UYWJsZVJvdyA9IChyb3csIHJvd0NvdW50OiBudW1iZXIpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCByb3dDZWxsczogVk5vZGVbXSA9IFtdXG5cbiAgICAgIHByb3BzLnNob3dTZXF1ZW5jZSAmJiByb3dDZWxscy5wdXNoKGdlbk51bWJlckNlbGwocm93Q291bnQpKVxuICAgICAgcHJvcHMuc2hvd0NoZWNrYm94ICYmIHJvd0NlbGxzLnB1c2goZ2VuQ2hlY2tib3hDZWxsKHJvdykpXG5cbiAgICAgIHByb3BzLmNvbHMuZm9yRWFjaCgoY29sKSA9PiB7XG4gICAgICAgIGNvbC5zaG93ICYmIHJvd0NlbGxzLnB1c2goZ2VuUm93Q2VsbChjb2wsIHJvdykpXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gaChcbiAgICAgICAgJ2RpdicsXG4gICAgICAgIHtcbiAgICAgICAgICBjbGFzczogeyAndi1kYXRhLXRhYmxlX19yb3cnOiB0cnVlIH0sXG4gICAgICAgICAgb25DbGljazogKCkgPT4gZW1pdCgnY2xpY2s6cm93Jywgcm93KSxcbiAgICAgICAgICBvbkRibGNsaWNrOiAoKSA9PiBlbWl0KCdkYmxjbGljazpyb3cnLCByb3cpLFxuICAgICAgICAgIG9uQ29udGV4dG1lbnU6IChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgIGVtaXQoJ2NvbnRleHRtZW51OnJvdycsIHJvdylcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICByb3dDZWxscyxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5UYWJsZVJvd3MgPSAoKTogVk5vZGVbXSA9PiB7XG4gICAgICBjb25zdCB0YWJsZVJvd3M6IFZOb2RlW10gPSBbXVxuICAgICAgY29uc3Qgcm93c0xlbmd0aCA9IHJvd3NPblRhYmxlLnZhbHVlPy5sZW5ndGhcbiAgICAgIGNvbnN0IGNvdW50ID0gKHByb3BzLnBhZ2UgLSAxKSAqIHByb3BzLnJvd3NPblBhZ2VcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3dzTGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgdGFibGVSb3dzLnB1c2goZ2VuVGFibGVSb3cocm93c09uVGFibGUudmFsdWVbaV0sIGNvdW50ICsgaSkpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0YWJsZVJvd3NcbiAgICB9XG5cbiAgICByZXR1cm4gKCkgPT4gaCgnZGl2Jywge1xuICAgICAgY2xhc3M6IGNsYXNzZXMudmFsdWUsXG4gICAgICBzdHlsZTogc3R5bGVzLnZhbHVlLFxuICAgIH0sIGdlblRhYmxlUm93cygpKVxuICB9LFxufSlcbiJdfQ==