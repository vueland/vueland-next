import './VListGroup.scss';
import { h, ref, computed, provide, inject, withDirectives, defineComponent, onBeforeUnmount, vShow, } from 'vue';
import { useColors } from '../../effects/use-colors';
import { elevationProps, useElevation } from '../../effects/use-elevation';
import { VIcon } from '../VIcon';
import { VListItem } from './VListItem';
import { VListItemIcon } from './index';
import { VExpandTransition } from '../transitions';
import { FaIcons } from '../../services/icons';
import { Sizes } from '../../services/sizes';
export const VListGroup = defineComponent({
    name: 'v-list-group',
    props: {
        activeClass: {
            type: String,
            default: '',
        },
        appendIcon: {
            type: String,
            default: FaIcons.$expand,
        },
        prependIcon: {
            type: String,
            default: '',
        },
        color: {
            type: String,
        },
        disabled: Boolean,
        group: String,
        noAction: Boolean,
        subGroup: Boolean,
        ...elevationProps(),
    },
    setup(props, { slots }) {
        const { setTextColor } = useColors();
        const { elevationClasses } = useElevation(props);
        const refGroup = ref(null);
        const isActive = ref(false);
        const children = ref([]);
        const groups = inject('groups');
        provide('subgroups', children);
        const subgroups = props.subGroup && inject('subgroups');
        const currentGroup = {
            ref: refGroup,
            active: isActive,
        };
        groups && groups.register(currentGroup);
        subgroups && subgroups.value.push(currentGroup);
        const classes = computed(() => ({
            'v-list-group': true,
            'v-list-group__sub-group': props.subGroup,
            'v-list-group--expanded': isActive.value && !props.noAction,
            [props.activeClass]: isActive.value,
            ...elevationClasses.value,
        }));
        function onClick() {
            if (props.noAction)
                return;
            groups?.items.length && groups.listClick(refGroup);
            children.value.length &&
                children.value.forEach((it) => (it.active = false));
        }
        function genIcon(icon) {
            const propsData = {
                size: Sizes.small,
            };
            return h(VIcon, propsData, {
                default: () => icon,
            });
        }
        function genAppendIcon() {
            const slotIcon = slots.appendIcon && slots.appendIcon();
            const icon = !props.subGroup && !props.noAction ? props.appendIcon : false;
            if (!icon && !slotIcon ||
                !props.subGroup && props.noAction)
                return null;
            const propsData = {
                class: {
                    'v-list-group__append-icon': true,
                },
            };
            return h(VListItemIcon, propsData, {
                default: () => slotIcon || genIcon(icon),
            });
        }
        function genPrependIcon() {
            const icon = props.subGroup && !props.noAction
                ? FaIcons.$subgroup
                : props.prependIcon;
            const slotIcon = slots.prependIcon && slots.prependIcon();
            if (!icon && !slotIcon)
                return null;
            const propsData = {
                class: {
                    'v-list-group__prepend-icon': true,
                },
            };
            return h(VListItemIcon, propsData, {
                default: () => slotIcon || genIcon(icon),
            });
        }
        function genGroupHeader() {
            const propsData = {
                class: {
                    'v-list-group__header': !props.subGroup,
                    'v-list-group__header--sub-group': props.subGroup,
                },
                onClick,
            };
            return h(VListItem, propsData, {
                default: () => [
                    genPrependIcon(),
                    slots.title && slots.title(),
                    genAppendIcon(),
                ],
            });
        }
        function genItems() {
            const propsData = {
                class: {
                    'v-list-group__items': true,
                },
            };
            return withDirectives(h('div', propsData, slots.default && slots.default()), [[vShow, isActive.value]]);
        }
        function genPropsData() {
            return {
                class: classes.value,
                ref: refGroup,
            };
        }
        onBeforeUnmount(() => {
            groups.unRegister(refGroup);
        });
        return () => {
            const items = slots.default && VExpandTransition(genItems());
            const header = slots.title && genGroupHeader();
            const propsData = props.color
                ? setTextColor(props.color, genPropsData())
                : genPropsData();
            const children = [header, items];
            return h('div', propsData, children);
        };
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkxpc3RHcm91cC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZMaXN0L1ZMaXN0R3JvdXAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxtQkFBbUIsQ0FBQTtBQUcxQixPQUFPLEVBQ0wsQ0FBQyxFQUNELEdBQUcsRUFDSCxRQUFRLEVBQ1IsT0FBTyxFQUNQLE1BQU0sRUFDTixjQUFjLEVBQ2QsZUFBZSxFQUNmLGVBQWUsRUFDZixLQUFLLEdBQ04sTUFBTSxLQUFLLENBQUE7QUFHWixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sMEJBQTBCLENBQUE7QUFDcEQsT0FBTyxFQUFFLGNBQWMsRUFBRSxZQUFZLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUcxRSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ2hDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxhQUFhLENBQUE7QUFDdkMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLFNBQVMsQ0FBQTtBQUN2QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQTtBQU1sRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sc0JBQXNCLENBQUE7QUFDOUMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHNCQUFzQixDQUFBO0FBRTVDLE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxlQUFlLENBQUM7SUFDeEMsSUFBSSxFQUFFLGNBQWM7SUFDcEIsS0FBSyxFQUFFO1FBQ0wsV0FBVyxFQUFFO1lBQ1gsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsRUFBRTtTQUNaO1FBQ0QsVUFBVSxFQUFFO1lBQ1YsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU87U0FDekI7UUFDRCxXQUFXLEVBQUU7WUFDWCxJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFD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Q0FBQyxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsUUFBUSxDQUFDLENBQUE7UUFDdEMsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFN0eWxlc1xuaW1wb3J0ICcuL1ZMaXN0R3JvdXAuc2NzcydcblxuLy8gVnVlIEFQSVxuaW1wb3J0IHtcbiAgaCxcbiAgcmVmLFxuICBjb21wdXRlZCxcbiAgcHJvdmlkZSxcbiAgaW5qZWN0LFxuICB3aXRoRGlyZWN0aXZlcyxcbiAgZGVmaW5lQ29tcG9uZW50LFxuICBvbkJlZm9yZVVubW91bnQsXG4gIHZTaG93LFxufSBmcm9tICd2dWUnXG5cbi8vIEVmZmVjdHNcbmltcG9ydCB7IHVzZUNvbG9ycyB9IGZyb20gJy4uLy4uL2VmZmVjdHMvdXNlLWNvbG9ycydcbmltcG9ydCB7IGVsZXZhdGlvblByb3BzLCB1c2VFbGV2YXRpb24gfSBmcm9tICcuLi8uLi9lZmZlY3RzL3VzZS1lbGV2YXRpb24nXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCB7IFZJY29uIH0gZnJvbSAnLi4vVkljb24nXG5pbXBvcnQgeyBWTGlzdEl0ZW0gfSBmcm9tICcuL1ZMaXN0SXRlbSdcbmltcG9ydCB7IFZMaXN0SXRlbUljb24gfSBmcm9tICcuL2luZGV4J1xuaW1wb3J0IHsgVkV4cGFuZFRyYW5zaXRpb24gfSBmcm9tICcuLi90cmFuc2l0aW9ucydcblxuLy8gVHlwZXNcbmltcG9ydCB7IFZOb2RlIH0gZnJvbSAndnVlJ1xuXG4vLyBTZXJ2aWNlc1xuaW1wb3J0IHsgRmFJY29ucyB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2ljb25zJ1xuaW1wb3J0IHsgU2l6ZXMgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zaXplcydcblxuZXhwb3J0IGNvbnN0IFZMaXN0R3JvdXAgPSBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAndi1saXN0LWdyb3VwJyxcbiAgcHJvcHM6IHtcbiAgICBhY3RpdmVDbGFzczoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJycsXG4gICAgfSxcbiAgICBhcHBlbmRJY29uOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiBGYUljb25zLiRleHBhbmQsXG4gICAgfSxcbiAgICBwcmVwZW5kSWNvbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJycsXG4gICAgfSxcbiAgICBjb2xvcjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgIH0sXG4gICAgZGlzYWJsZWQ6IEJvb2xlYW4sXG4gICAgZ3JvdXA6IFN0cmluZyxcbiAgICBub0FjdGlvbjogQm9vbGVhbixcbiAgICBzdWJHcm91cDogQm9vbGVhbixcbiAgICAuLi5lbGV2YXRpb25Qcm9wcygpLFxuICB9IGFzIGFueSxcblxuICBzZXR1cChwcm9wcywgeyBzbG90cyB9KSB7XG4gICAgY29uc3QgeyBzZXRUZXh0Q29sb3IgfSA9IHVzZUNvbG9ycygpXG4gICAgY29uc3QgeyBlbGV2YXRpb25DbGFzc2VzIH0gPSB1c2VFbGV2YXRpb24ocHJvcHMpXG5cbiAgICBjb25zdCByZWZHcm91cCA9IHJlZihudWxsKVxuICAgIGNvbnN0IGlzQWN0aXZlID0gcmVmKGZhbHNlKVxuICAgIGNvbnN0IGNoaWxkcmVuID0gcmVmKFtdKVxuICAgIGNvbnN0IGdyb3VwczogYW55ID0gaW5qZWN0KCdncm91cHMnKVxuXG4gICAgcHJvdmlkZSgnc3ViZ3JvdXBzJywgY2hpbGRyZW4pXG5cbiAgICBjb25zdCBzdWJncm91cHM6IGFueSA9IHByb3BzLnN1Ykdyb3VwICYmIGluamVjdCgnc3ViZ3JvdXBzJylcblxuICAgIGNvbnN0IGN1cnJlbnRHcm91cCA9IHtcbiAgICAgIHJlZjogcmVmR3JvdXAsXG4gICAgICBhY3RpdmU6IGlzQWN0aXZlLFxuICAgIH1cblxuICAgIGdyb3VwcyAmJiBncm91cHMucmVnaXN0ZXIoY3VycmVudEdyb3VwKVxuXG4gICAgc3ViZ3JvdXBzICYmIHN1Ymdyb3Vwcy52YWx1ZS5wdXNoKGN1cnJlbnRHcm91cClcblxuICAgIGNvbnN0IGNsYXNzZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBib29sZWFuPj4oKCkgPT4gKHtcbiAgICAgICd2LWxpc3QtZ3JvdXAnOiB0cnVlLFxuICAgICAgJ3YtbGlzdC1ncm91cF9fc3ViLWdyb3VwJzogcHJvcHMuc3ViR3JvdXAsXG4gICAgICAndi1saXN0LWdyb3VwLS1leHBhbmRlZCc6IGlzQWN0aXZlLnZhbHVlICYmICFwcm9wcy5ub0FjdGlvbixcbiAgICAgIFtwcm9wcy5hY3RpdmVDbGFzc106IGlzQWN0aXZlLnZhbHVlLFxuICAgICAgLi4uZWxldmF0aW9uQ2xhc3Nlcy52YWx1ZSxcbiAgICB9KSlcblxuICAgIGZ1bmN0aW9uIG9uQ2xpY2soKSB7XG4gICAgICBpZiAocHJvcHMubm9BY3Rpb24pIHJldHVyblxuXG4gICAgICBncm91cHM/Lml0ZW1zLmxlbmd0aCAmJiBncm91cHMubGlzdENsaWNrKHJlZkdyb3VwKVxuICAgICAgY2hpbGRyZW4udmFsdWUubGVuZ3RoICYmXG4gICAgICBjaGlsZHJlbi52YWx1ZS5mb3JFYWNoKChpdDogYW55KSA9PiAoaXQuYWN0aXZlID0gZmFsc2UpKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlbkljb24oaWNvbjogc3RyaW5nKTogVk5vZGUge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBzaXplOiBTaXplcy5zbWFsbCxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoVkljb24sIHByb3BzRGF0YSwge1xuICAgICAgICBkZWZhdWx0OiAoKSA9PiBpY29uLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5BcHBlbmRJY29uKCk6IFZOb2RlIHwgbnVsbCB7XG4gICAgICBjb25zdCBzbG90SWNvbiA9IHNsb3RzLmFwcGVuZEljb24gJiYgc2xvdHMuYXBwZW5kSWNvbigpXG4gICAgICBjb25zdCBpY29uID0gIXByb3BzLnN1Ykdyb3VwICYmICFwcm9wcy5ub0FjdGlvbiA/IHByb3BzLmFwcGVuZEljb24gOiBmYWxzZVxuXG4gICAgICBpZiAoIWljb24gJiYgIXNsb3RJY29uIHx8XG4gICAgICAgICFwcm9wcy5zdWJHcm91cCAmJiBwcm9wcy5ub0FjdGlvblxuICAgICAgKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgJ3YtbGlzdC1ncm91cF9fYXBwZW5kLWljb24nOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWTGlzdEl0ZW1JY29uLCBwcm9wc0RhdGEsIHtcbiAgICAgICAgZGVmYXVsdDogKCkgPT4gc2xvdEljb24gfHwgZ2VuSWNvbihpY29uIGFzIHN0cmluZyksXG4gICAgICB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlblByZXBlbmRJY29uKCk6IFZOb2RlIHwgbnVsbCB7XG4gICAgICBjb25zdCBpY29uID1cbiAgICAgICAgcHJvcHMuc3ViR3JvdXAgJiYgIXByb3BzLm5vQWN0aW9uXG4gICAgICAgICAgPyBGYUljb25zLiRzdWJncm91cFxuICAgICAgICAgIDogcHJvcHMucHJlcGVuZEljb25cblxuICAgICAgY29uc3Qgc2xvdEljb24gPSBzbG90cy5wcmVwZW5kSWNvbiAmJiBzbG90cy5wcmVwZW5kSWNvbigpXG5cbiAgICAgIGlmICghaWNvbiAmJiAhc2xvdEljb24pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1saXN0LWdyb3VwX19wcmVwZW5kLWljb24nOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWTGlzdEl0ZW1JY29uLCBwcm9wc0RhdGEsIHtcbiAgICAgICAgZGVmYXVsdDogKCkgPT4gc2xvdEljb24gfHwgZ2VuSWNvbihpY29uIGFzIHN0cmluZyksXG4gICAgICB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlbkdyb3VwSGVhZGVyKCk6IFZOb2RlIHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1saXN0LWdyb3VwX19oZWFkZXInOiAhcHJvcHMuc3ViR3JvdXAsXG4gICAgICAgICAgJ3YtbGlzdC1ncm91cF9faGVhZGVyLS1zdWItZ3JvdXAnOiBwcm9wcy5zdWJHcm91cCxcbiAgICAgICAgfSxcbiAgICAgICAgb25DbGljayxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoVkxpc3RJdGVtLCBwcm9wc0RhdGEsIHtcbiAgICAgICAgZGVmYXVsdDogKCkgPT4gW1xuICAgICAgICAgIGdlblByZXBlbmRJY29uKCksXG4gICAgICAgICAgc2xvdHMudGl0bGUgJiYgc2xvdHMudGl0bGUoKSxcbiAgICAgICAgICBnZW5BcHBlbmRJY29uKCksXG4gICAgICAgIF0sXG4gICAgICB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlbkl0ZW1zKCk6IFZOb2RlIHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1saXN0LWdyb3VwX19pdGVtcyc6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB3aXRoRGlyZWN0aXZlcyhcbiAgICAgICAgaCgnZGl2JywgcHJvcHNEYXRhLCBzbG90cy5kZWZhdWx0ICYmIHNsb3RzLmRlZmF1bHQoKSksXG4gICAgICAgIFtbdlNob3csIGlzQWN0aXZlLnZhbHVlXV0sXG4gICAgICApXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuUHJvcHNEYXRhKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2xhc3M6IGNsYXNzZXMudmFsdWUsXG4gICAgICAgIHJlZjogcmVmR3JvdXAsXG4gICAgICB9XG4gICAgfVxuXG4gICAgb25CZWZvcmVVbm1vdW50KCgpID0+IHtcbiAgICAgIGdyb3Vwcy51blJlZ2lzdGVyKHJlZkdyb3VwKVxuICAgIH0pXG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgY29uc3QgaXRlbXMgPSBzbG90cy5kZWZhdWx0ICYmIFZFeHBhbmRUcmFuc2l0aW9uKGdlbkl0ZW1zKCkpXG4gICAgICBjb25zdCBoZWFkZXIgPSBzbG90cy50aXRsZSAmJiBnZW5Hcm91cEhlYWRlcigpXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHByb3BzLmNvbG9yXG4gICAgICAgID8gc2V0VGV4dENvbG9yKHByb3BzLmNvbG9yLCBnZW5Qcm9wc0RhdGEoKSlcbiAgICAgICAgOiBnZW5Qcm9wc0RhdGEoKVxuXG4gICAgICBjb25zdCBjaGlsZHJlbiA9IFtoZWFkZXIsIGl0ZW1zXVxuXG4gICAgICByZXR1cm4gaCgnZGl2JywgcHJvcHNEYXRhLCBjaGlsZHJlbilcbiAgICB9XG4gIH0sXG59KVxuIl19