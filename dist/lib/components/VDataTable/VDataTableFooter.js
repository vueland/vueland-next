import { watch, computed, defineComponent, h, ref } from 'vue';
import { VIcon } from '../VIcon';
import { VButton } from '../VButton';
import { VMenu } from '../VMenu';
import { useColors } from '../../composable/use-colors';
import { useIcons } from '../../composable/use-icons';
export const VDataTableFooter = defineComponent({
    name: 'v-data-table-footer',
    props: {
        pages: Number,
        page: Number,
        firstOnPage: Number,
        lastOnPage: Number,
        pageCorrection: Number,
        rowsLength: Number,
        rowsOnPage: Number,
        options: Object,
    },
    emits: [
        'last-page',
        'correct-page',
        'select-rows-count',
        'next-page',
        'prev-page',
    ],
    setup(props, { emit, slots }) {
        const { setBackgroundCssColor, setBackgroundClassNameColor, setTextClassNameColor, setTextCssColor, } = useColors();
        const { icons } = useIcons();
        const activator = ref(null);
        const paginationDisplayText = computed(() => {
            return `${props.firstOnPage} - ${props.lastOnPage}
        of ${props.rowsLength}`;
        });
        const isLastPage = computed(() => {
            return props.page >= props.pages;
        });
        watch(() => isLastPage.value, (to) => to && emit('last-page'));
        function changeTableRowsPage(isNext) {
            if (props.page === props.pages && isNext)
                return;
            const event = isNext ? 'next-page' : 'prev-page';
            emit(event, isNext ? 1 : -1);
        }
        function genPaginationButton(isNext = false) {
            const btnColor = props.options?.pagination?.buttonsColor || 'primary';
            const contentColor = props.options.contentColor || 'white';
            const disableIf = (isNext && props.lastOnPage >= props.rowsLength) ||
                (!isNext && props.firstOnPage === 1);
            const propsData = {
                width: 42,
                color: btnColor,
                elevation: 3,
                disabled: disableIf,
                text: disableIf,
                onClick: () => changeTableRowsPage(isNext),
            };
            return h(VButton, propsData, {
                default: () => h(VIcon, {
                    icon: isNext ? icons.$arrowRight : icons.$arrowLeft,
                    color: disableIf ? 'grey lighten-1' : contentColor,
                }),
            });
        }
        function genPaginationPageDisplay() {
            const displayColor = props.options?.pagination?.displayColor || 'primary';
            const propsData = {
                width: 42,
                style: { margin: '0 10px' },
                color: displayColor,
                elevation: 3,
            };
            return h(VButton, propsData, { default: () => props.page });
        }
        const genRowsCountSelectList = () => {
            const options = props.options.counts?.rowsPerPageOptions || [5, 10, 15, 20];
            const color = props.options?.counts?.displayColor || 'primary';
            const contentColor = props.options.contentColor || 'white';
            return h('div', {
                class: {
                    'v-data-table__rows-count-list': true,
                    ...(color ? setBackgroundClassNameColor(color) : {}),
                    ...(contentColor ? setTextClassNameColor(contentColor) : {}),
                },
                style: {
                    ...(color ? setBackgroundCssColor(color) : {}),
                    ...(contentColor ? setTextCssColor(contentColor) : {}),
                },
            }, options.map((it) => h('div', {
                class: 'v-data-table__rows-count-item',
                onClick: () => emit('select-rows-count', it),
            }, [it])));
        };
        const genMenu = () => {
            return h(VMenu, {
                activator: activator.value,
                maxHeight: 240,
                zIndex: 12,
                openOnClick: true,
            }, {
                default: () => genRowsCountSelectList(),
            });
        };
        const genRowsCountField = () => {
            return h('div', {
                class: 'v-data-table__rows-count-value',
                textColor: props.options.contentColor,
            }, props.rowsOnPage);
        };
        const genRowsCountSelect = () => {
            const displayColor = props.options?.counts?.displayColor || 'primary';
            return h(VButton, {
                color: displayColor,
                ref: activator,
            }, {
                default: () => [
                    genRowsCountField(),
                    activator.value && genMenu(),
                ],
            });
        };
        const genRowsCountSelectCaption = () => {
            const color = props.options.contentColor;
            const propsData = {
                class: {
                    'v-data-table__pagination-label': true,
                    ...(color ? setTextClassNameColor(color) : {}),
                },
                style: {
                    ...(color ? setTextCssColor(color) : {}),
                },
            };
            return h('span', propsData, props.options?.counts?.rowsPerPageText || 'Rows per page');
        };
        const genRowsCountSelectBlock = () => {
            return h('div', { class: 'v-data-table__pagination-select' }, [
                genRowsCountSelectCaption(),
                genRowsCountSelect(),
            ]);
        };
        const genPagesCountDisplay = () => {
            const color = props.options.contentColor;
            const propsData = {
                class: {
                    'v-data-table__pagination-pages': true,
                    ...(color ? setTextClassNameColor(color) : {}),
                },
                style: {
                    ...(color ? setTextCssColor(color) : {}),
                },
            };
            props.pageCorrection && emit('correct-page', -props.pageCorrection);
            return h('div', propsData, (props.rowsLength && slots['pagination-text']?.()) ||
                (props.rowsLength && paginationDisplayText.value) ||
                '-');
        };
        const genPaginationButtonsBlock = () => {
            return h('div', { class: { 'v-data-table__pagination-route': true } }, [
                genPaginationButton(),
                genPaginationPageDisplay(),
                genPaginationButton(true),
            ]);
        };
        const genPaginationBlock = () => {
            return h('div', { class: 'v-data-table__pagination' }, [
                genRowsCountSelectBlock(),
                genPagesCountDisplay(),
                genPaginationButtonsBlock(),
            ]);
        };
        return () => {
            const propsData = {
                class: {
                    'v-data-table__footer': true,
                    ...(props.options.color
                        ? setBackgroundClassNameColor(props.options.color)
                        : {}),
                },
                style: {
                    ...(props.options.color
                        ? setBackgroundCssColor(props.options.color)
                        : {}),
                },
            };
            return h('div', propsData, genPaginationBlock());
        };
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGFUYWJsZUZvb3Rlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZEYXRhVGFibGUvVkRhdGFUYWJsZUZvb3Rlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxlQUFlLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBWSxNQUFNLEtBQUssQ0FBQTtBQUd4RSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ2hDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxZQUFZLENBQUE7QUFDcEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUdoQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sNkJBQTZCLENBQUE7QUFFdkQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDRCQUE0QixDQUFBO0FBTXJELE1BQU0sQ0FBQyxNQUFNLGdCQUFnQixHQUFHLGVBQWUsQ0FBQztJQUM5QyxJQUFJLEVBQUUscUJBQXFCO0lBQzNCLEtBQUssRUFBRTtRQUNMLEtBQUssRUFBRSxNQUFNO1FBQ2IsSUFBSSxFQUFFLE1BQU07UUFDWixXQUFXLEVBQUUsTUFBTTtRQUNuQixVQUFVLEVBQUUsTUFBTTtRQUNsQixjQUFjLEVBQUUsTUFBTTtRQUN0QixVQUFVLEVBQUUsTUFBTTtRQUNsQixVQUFVLEVBQUUsTUFBTTtRQUNsQixPQUFPLEVBQUUsTUFBMkM7S0FDOUM7SUFFUixLQUFLLEVBQUU7UUFDTCxXQUFXO1FBQ1gsY0FBYztRQUNkLG1CQUFtQjtRQUNuQixXQUFXO1FBQ1gsV0FBVztLQUNaO0lBRUQsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUU7UUFDMUIsTUFBTSxFQUNKLHFCQUFxQixFQUNyQiwyQkFBMkIsRUFDM0IscUJBQXFCLEVBQ3JCLGVBQWUsR0FDaEIsR0FBRyxTQUFTLEVBQUUs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QUFDLE9BQU8sQ0FBQyxLQUFLO3dCQUNyQixDQUFDLENBQUMscUJBQXFCLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7d0JBQzVDLENBQUMsQ0FBQyxFQUFFLENBQUM7aUJBQ1I7YUFDRixDQUFBO1lBRUQsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUE7UUFDbEQsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7IHdhdGNoLCBjb21wdXRlZCwgZGVmaW5lQ29tcG9uZW50LCBoLCByZWYsIFByb3BUeXBlIH0gZnJvbSAndnVlJ1xuXG4vLyBDb21wb25lbnRzXG5pbXBvcnQgeyBWSWNvbiB9IGZyb20gJy4uL1ZJY29uJ1xuaW1wb3J0IHsgVkJ1dHRvbiB9IGZyb20gJy4uL1ZCdXR0b24nXG5pbXBvcnQgeyBWTWVudSB9IGZyb20gJy4uL1ZNZW51J1xuXG4vLyBFZmZlY3RzXG5pbXBvcnQgeyB1c2VDb2xvcnMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS1jb2xvcnMnXG5cbmltcG9ydCB7IHVzZUljb25zIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtaWNvbnMnXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5pbXBvcnQgeyBNYXliZSB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL2Jhc2UnXG5pbXBvcnQgeyBJRGF0YVRhYmxlRm9vdGVyT3B0aW9ucyB9IGZyb20gJy4vdHlwZXMnXG5cbmV4cG9ydCBjb25zdCBWRGF0YVRhYmxlRm9vdGVyID0gZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3YtZGF0YS10YWJsZS1mb290ZXInLFxuICBwcm9wczoge1xuICAgIHBhZ2VzOiBOdW1iZXIsXG4gICAgcGFnZTogTnVtYmVyLFxuICAgIGZpcnN0T25QYWdlOiBOdW1iZXIsXG4gICAgbGFzdE9uUGFnZTogTnVtYmVyLFxuICAgIHBhZ2VDb3JyZWN0aW9uOiBOdW1iZXIsXG4gICAgcm93c0xlbmd0aDogTnVtYmVyLFxuICAgIHJvd3NPblBhZ2U6IE51bWJlcixcbiAgICBvcHRpb25zOiBPYmplY3QgYXMgUHJvcFR5cGU8SURhdGFUYWJsZUZvb3Rlck9wdGlvbnM+LFxuICB9IGFzIGFueSxcblxuICBlbWl0czogW1xuICAgICdsYXN0LXBhZ2UnLFxuICAgICdjb3JyZWN0LXBhZ2UnLFxuICAgICdzZWxlY3Qtcm93cy1jb3VudCcsXG4gICAgJ25leHQtcGFnZScsXG4gICAgJ3ByZXYtcGFnZScsXG4gIF0sXG5cbiAgc2V0dXAocHJvcHMsIHsgZW1pdCwgc2xvdHMgfSk6ICgpID0+IFZOb2RlIHtcbiAgICBjb25zdCB7XG4gICAgICBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IsXG4gICAgICBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IsXG4gICAgICBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IsXG4gICAgICBzZXRUZXh0Q3NzQ29sb3IsXG4gICAgfSA9IHVzZUNvbG9ycygpXG4gICAgY29uc3QgeyBpY29ucyB9ID0gdXNlSWNvbnMoKVxuXG4gICAgY29uc3QgYWN0aXZhdG9yID0gcmVmPE1heWJlPEhUTUxFbGVtZW50Pj4obnVsbClcblxuICAgIGNvbnN0IHBhZ2luYXRpb25EaXNwbGF5VGV4dCA9IGNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuICAgICAgcmV0dXJuIGAkeyBwcm9wcy5maXJzdE9uUGFnZSB9IC0gJHsgcHJvcHMubGFzdE9uUGFnZSB9XG4gICAgICAgIG9mICR7IHByb3BzLnJvd3NMZW5ndGggfWBcbiAgICB9KVxuXG4gICAgY29uc3QgaXNMYXN0UGFnZSA9IGNvbXB1dGVkPGJvb2xlYW4+KCgpID0+IHtcbiAgICAgIHJldHVybiBwcm9wcy5wYWdlID49IHByb3BzLnBhZ2VzXG4gICAgfSlcblxuICAgIHdhdGNoKFxuICAgICAgKCkgPT4gaXNMYXN0UGFnZS52YWx1ZSxcbiAgICAgICh0bykgPT4gdG8gJiYgZW1pdCgnbGFzdC1wYWdlJyksXG4gICAgKVxuXG4gICAgZnVuY3Rpb24gY2hhbmdlVGFibGVSb3dzUGFnZShpc05leHQpIHtcbiAgICAgIGlmIChwcm9wcy5wYWdlID09PSBwcm9wcy5wYWdlcyAmJiBpc05leHQpIHJldHVyblxuXG4gICAgICBjb25zdCBldmVudCA9IGlzTmV4dCA/ICduZXh0LXBhZ2UnIDogJ3ByZXYtcGFnZSdcbiAgICAgIGVtaXQoZXZlbnQsIGlzTmV4dCA/IDEgOiAtMSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5QYWdpbmF0aW9uQnV0dG9uKGlzTmV4dCA9IGZhbHNlKTogVk5vZGUge1xuICAgICAgY29uc3QgYnRuQ29sb3IgPSBwcm9wcy5vcHRpb25zPy5wYWdpbmF0aW9uPy5idXR0b25zQ29sb3IgfHwgJ3ByaW1hcnknXG4gICAgICBjb25zdCBjb250ZW50Q29sb3IgPSBwcm9wcy5vcHRpb25zLmNvbnRlbnRDb2xvciB8fCAnd2hpdGUnXG5cbiAgICAgIGNvbnN0IGRpc2FibGVJZiA9XG4gICAgICAgIChpc05leHQgJiYgcHJvcHMubGFzdE9uUGFnZSA+PSBwcm9wcy5yb3dzTGVuZ3RoKSB8fFxuICAgICAgICAoIWlzTmV4dCAmJiBwcm9wcy5maXJzdE9uUGFnZSA9PT0gMSlcblxuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICB3aWR0aDogNDIsXG4gICAgICAgIGNvbG9yOiBidG5Db2xvcixcbiAgICAgICAgZWxldmF0aW9uOiAzLFxuICAgICAgICBkaXNhYmxlZDogZGlzYWJsZUlmLFxuICAgICAgICB0ZXh0OiBkaXNhYmxlSWYsXG4gICAgICAgIG9uQ2xpY2s6ICgpID0+IGNoYW5nZVRhYmxlUm93c1BhZ2UoaXNOZXh0KSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoVkJ1dHRvbiwgcHJvcHNEYXRhLCB7XG4gICAgICAgIGRlZmF1bHQ6ICgpID0+XG4gICAgICAgICAgaChWSWNvbiwge1xuICAgICAgICAgICAgaWNvbjogaXNOZXh0ID8gaWNvbnMuJGFycm93UmlnaHQgOiBpY29ucy4kYXJyb3dMZWZ0LFxuICAgICAgICAgICAgY29sb3I6IGRpc2FibGVJZiA/ICdncmV5IGxpZ2h0ZW4tMScgOiBjb250ZW50Q29sb3IsXG4gICAgICAgICAgfSksXG4gICAgICB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlblBhZ2luYXRpb25QYWdlRGlzcGxheSgpOiBWTm9kZSB7XG4gICAgICBjb25zdCBkaXNwbGF5Q29sb3IgPSBwcm9wcy5vcHRpb25zPy5wYWdpbmF0aW9uPy5kaXNwbGF5Q29sb3IgfHwgJ3ByaW1hcnknXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgd2lkdGg6IDQyLFxuICAgICAgICBzdHlsZTogeyBtYXJnaW46ICcwIDEwcHgnIH0sXG4gICAgICAgIGNvbG9yOiBkaXNwbGF5Q29sb3IsXG4gICAgICAgIGVsZXZhdGlvbjogMyxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoVkJ1dHRvbiwgcHJvcHNEYXRhLCB7IGRlZmF1bHQ6ICgpID0+IHByb3BzLnBhZ2UgfSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5Sb3dzQ291bnRTZWxlY3RMaXN0ID0gKCkgPT4ge1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IHByb3BzLm9wdGlvbnMuY291bnRzPy5yb3dzUGVyUGFnZU9wdGlvbnMgfHwgWzUsIDEwLCAxNSwgMjBdXG4gICAgICBjb25zdCBjb2xvciA9IHByb3BzLm9wdGlvbnM/LmNvdW50cz8uZGlzcGxheUNvbG9yIHx8ICdwcmltYXJ5J1xuICAgICAgY29uc3QgY29udGVudENvbG9yID0gcHJvcHMub3B0aW9ucy5jb250ZW50Q29sb3IgfHwgJ3doaXRlJ1xuXG4gICAgICByZXR1cm4gaCgnZGl2Jywge1xuICAgICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgICAndi1kYXRhLXRhYmxlX19yb3dzLWNvdW50LWxpc3QnOiB0cnVlLFxuICAgICAgICAgICAgLi4uKGNvbG9yID8gc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yKGNvbG9yKSA6IHt9KSxcbiAgICAgICAgICAgIC4uLihjb250ZW50Q29sb3IgPyBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IoY29udGVudENvbG9yKSA6IHt9KSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgICAuLi4oY29sb3IgPyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IoY29sb3IpIDoge30pLFxuICAgICAgICAgICAgLi4uKGNvbnRlbnRDb2xvciA/IHNldFRleHRDc3NDb2xvcihjb250ZW50Q29sb3IpIDoge30pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sIG9wdGlvbnMubWFwKChpdCkgPT4gaCgnZGl2Jywge1xuICAgICAgICAgIGNsYXNzOiAndi1kYXRhLXRhYmxlX19yb3dzLWNvdW50LWl0ZW0nLFxuICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IGVtaXQoJ3NlbGVjdC1yb3dzLWNvdW50JywgaXQpLFxuICAgICAgICB9LCBbaXRdKSksXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuTWVudSA9ICgpID0+IHtcblxuICAgICAgcmV0dXJuIGgoVk1lbnUsIHtcbiAgICAgICAgYWN0aXZhdG9yOiBhY3RpdmF0b3IudmFsdWUhLFxuICAgICAgICBtYXhIZWlnaHQ6IDI0MCxcbiAgICAgICAgekluZGV4OiAxMixcbiAgICAgICAgb3Blbk9uQ2xpY2s6IHRydWUsXG4gICAgICB9LCB7XG4gICAgICAgIGRlZmF1bHQ6ICgpID0+IGdlblJvd3NDb3VudFNlbGVjdExpc3QoKSxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUm93c0NvdW50RmllbGQgPSAoKSA9PiB7XG4gICAgICByZXR1cm4gaCgnZGl2Jywge1xuICAgICAgICBjbGFzczogJ3YtZGF0YS10YWJsZV9fcm93cy1jb3VudC12YWx1ZScsXG4gICAgICAgIHRleHRDb2xvcjogcHJvcHMub3B0aW9ucy5jb250ZW50Q29sb3IsXG4gICAgICB9LCBwcm9wcy5yb3dzT25QYWdlKVxuICAgIH1cblxuICAgIGNvbnN0IGdlblJvd3NDb3VudFNlbGVjdCA9ICgpID0+IHtcbiAgICAgIGNvbnN0IGRpc3BsYXlDb2xvciA9IHByb3BzLm9wdGlvbnM/LmNvdW50cz8uZGlzcGxheUNvbG9yIHx8ICdwcmltYXJ5J1xuXG4gICAgICByZXR1cm4gaChWQnV0dG9uLCB7XG4gICAgICAgIGNvbG9yOiBkaXNwbGF5Q29sb3IsXG4gICAgICAgIHJlZjogYWN0aXZhdG9yLFxuICAgICAgfSwge1xuICAgICAgICBkZWZhdWx0OiAoKSA9PiBbXG4gICAgICAgICAgZ2VuUm93c0NvdW50RmllbGQoKSxcbiAgICAgICAgICBhY3RpdmF0b3IudmFsdWUgJiYgZ2VuTWVudSgpLFxuICAgICAgICBdLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5Sb3dzQ291bnRTZWxlY3RDYXB0aW9uID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IGNvbG9yID0gcHJvcHMub3B0aW9ucy5jb250ZW50Q29sb3JcblxuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczoge1xuICAgICAgICAgICd2LWRhdGEtdGFibGVfX3BhZ2luYXRpb24tbGFiZWwnOiB0cnVlLFxuICAgICAgICAgIC4uLihjb2xvciA/IHNldFRleHRDbGFzc05hbWVDb2xvcihjb2xvcikgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgLi4uKGNvbG9yID8gc2V0VGV4dENzc0NvbG9yKGNvbG9yKSA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoXG4gICAgICAgICdzcGFuJyxcbiAgICAgICAgcHJvcHNEYXRhLFxuICAgICAgICBwcm9wcy5vcHRpb25zPy5jb3VudHM/LnJvd3NQZXJQYWdlVGV4dCB8fCAnUm93cyBwZXIgcGFnZScsXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUm93c0NvdW50U2VsZWN0QmxvY2sgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWRhdGEtdGFibGVfX3BhZ2luYXRpb24tc2VsZWN0JyB9LCBbXG4gICAgICAgIGdlblJvd3NDb3VudFNlbGVjdENhcHRpb24oKSxcbiAgICAgICAgZ2VuUm93c0NvdW50U2VsZWN0KCksXG4gICAgICBdKVxuICAgIH1cblxuICAgIGNvbnN0IGdlblBhZ2VzQ291bnREaXNwbGF5ID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IGNvbG9yID0gcHJvcHMub3B0aW9ucy5jb250ZW50Q29sb3JcblxuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczoge1xuICAgICAgICAgICd2LWRhdGEtdGFibGVfX3BhZ2luYXRpb24tcGFnZXMnOiB0cnVlLFxuICAgICAgICAgIC4uLihjb2xvciA/IHNldFRleHRDbGFzc05hbWVDb2xvcihjb2xvcikgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgLi4uKGNvbG9yID8gc2V0VGV4dENzc0NvbG9yKGNvbG9yKSA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgIH1cblxuICAgICAgcHJvcHMucGFnZUNvcnJlY3Rpb24gJiYgZW1pdCgnY29ycmVjdC1wYWdlJywgLXByb3BzLnBhZ2VDb3JyZWN0aW9uKVxuXG4gICAgICByZXR1cm4gaChcbiAgICAgICAgJ2RpdicsXG4gICAgICAgIHByb3BzRGF0YSxcbiAgICAgICAgKHByb3BzLnJvd3NMZW5ndGggJiYgc2xvdHNbJ3BhZ2luYXRpb24tdGV4dCddPy4oKSkgfHxcbiAgICAgICAgKHByb3BzLnJvd3NMZW5ndGggJiYgcGFnaW5hdGlvbkRpc3BsYXlUZXh0LnZhbHVlKSB8fFxuICAgICAgICAnLScsXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUGFnaW5hdGlvbkJ1dHRvbnNCbG9jayA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogeyAndi1kYXRhLXRhYmxlX19wYWdpbmF0aW9uLXJvdXRlJzogdHJ1ZSB9IH0sIFtcbiAgICAgICAgZ2VuUGFnaW5hdGlvbkJ1dHRvbigpLFxuICAgICAgICBnZW5QYWdpbmF0aW9uUGFnZURpc3BsYXkoKSxcbiAgICAgICAgZ2VuUGFnaW5hdGlvbkJ1dHRvbih0cnVlKSxcbiAgICAgIF0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUGFnaW5hdGlvbkJsb2NrID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKCdkaXYnLCB7IGNsYXNzOiAndi1kYXRhLXRhYmxlX19wYWdpbmF0aW9uJyB9LCBbXG4gICAgICAgIGdlblJvd3NDb3VudFNlbGVjdEJsb2NrKCksXG4gICAgICAgIGdlblBhZ2VzQ291bnREaXNwbGF5KCksXG4gICAgICAgIGdlblBhZ2luYXRpb25CdXR0b25zQmxvY2soKSxcbiAgICAgIF0pXG4gICAgfVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1kYXRhLXRhYmxlX19mb290ZXInOiB0cnVlLFxuICAgICAgICAgIC4uLihwcm9wcy5vcHRpb25zLmNvbG9yXG4gICAgICAgICAgICA/IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcihwcm9wcy5vcHRpb25zLmNvbG9yKVxuICAgICAgICAgICAgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgLi4uKHByb3BzLm9wdGlvbnMuY29sb3JcbiAgICAgICAgICAgID8gc2V0QmFja2dyb3VuZENzc0NvbG9yKHByb3BzLm9wdGlvbnMuY29sb3IpXG4gICAgICAgICAgICA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHByb3BzRGF0YSwgZ2VuUGFnaW5hdGlvbkJsb2NrKCkpXG4gICAgfVxuICB9LFxufSlcbiJdfQ==