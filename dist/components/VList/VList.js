import { defineComponent, h, provide, watch, ref, toRaw, computed, onMounted } from 'vue';
import { useColors, colorProps } from '../../composable/use-colors';
import { mapToValArray } from '../../helpers';
export default defineComponent({
    name: 'v-list',
    props: {
        value: {
            type: [Number, Array],
            default: null,
        },
        multiple: Boolean,
        active: {
            type: Boolean,
            default: false,
        },
        activeClass: {
            type: String,
            default: '',
        },
        textColor: {
            type: String,
            default: '',
        },
        ...colorProps(),
    },
    emits: ['update:value'],
    setup(props, { emit, slots }) {
        const { setTextClassNameColor, setBackgroundClassNameColor, setTextCssColor, setBackgroundCssColor, } = useColors();
        const items = ref(new Map());
        let isTrustedSelect = false;
        const classes = computed(() => ({
            'v-list': true,
            'v-list--active': props.active,
            ...setTextClassNameColor(props.textColor),
            ...setBackgroundClassNameColor(props.color),
        }));
        const styles = computed(() => ({
            ...setTextCssColor(props.textColor),
            ...setBackgroundCssColor(props.color),
        }));
        const register = (item) => {
            !items.value.has(item) && items.value.set(item, item);
        };
        const unregister = (item) => {
            items.value.has(item) && items.value.delete(item);
        };
        const dispatchEvent = (val) => {
            isTrustedSelect = true;
            emit('update:value', val);
        };
        const setActiveItem = (item) => {
            mapToValArray(toRaw(items.value)).forEach((it) => {
                it.isActive.value = it === item;
            });
        };
        const toggleItem = (item) => {
            item.isActive.value = !item.isActive.value;
        };
        const prepareIndexes = () => {
            const values = mapToValArray(toRaw(items.value));
            const { multiple } = props;
            let val = multiple ? [] : 0;
            values.forEach((it, i) => {
                if (it.isActive.value) {
                    multiple && val.push(i);
                    !multiple && (val = i);
                }
            });
            return val;
        };
        const onClick = (item) => {
            if (!props.active)
                return;
            props.multiple && toggleItem(item);
            !props.multiple && setActiveItem(item);
            dispatchEvent(prepareIndexes());
        };
        const setItemState = (value) => {
            if (value === null)
                return setActiveItem(value);
            const values = mapToValArray(toRaw(items.value));
            if (values.length) {
                if (props.multiple) {
                    ;
                    value.forEach((ind) => toggleItem(values[ind]));
                }
                else {
                    setActiveItem(values[value]);
                }
            }
        };
        watch(() => props.value, (to) => {
            if (!isTrustedSelect)
                setItemState(to);
            isTrustedSelect && (isTrustedSelect = false);
        });
        const stop = watch(items, () => {
            setItemState(props.value);
            stop();
        }, { deep: true });
        onMounted(() => {
            setItemState(props.value);
        });
        provide('list', {
            add: register,
            remove: unregister,
            click: onClick,
            activeClass: props.activeClass,
        });
        return () => h('div', { class: classes.value, style: styles.value }, { default: () => slots.default?.() });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkxpc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WTGlzdC9WTGlzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZUFBZSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxNQUFNLEtBQUssQ0FBQTtBQUN6RixPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLDZCQUE2QixDQUFBO0FBQ25FLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFFN0MsZUFBZSxlQUFlLENBQUM7SUFDN0IsSUFBSSxFQUFFLFFBQVE7SUFDZCxLQUFLLEVBQUU7UUFDTCxLQUFLLEVBQUU7WUFDTCxJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDO1lBQ3JCLE9BQU8sRUFBRSxJQUFJO1NBQ2Q7UUFDRCxRQUFRLEVBQUUsT0FBTztRQUNqQixNQUFNLEVBQUU7WUFDTixJQUFJLEVBQUUsT0FBTztZQUNiLE9BQU8sRUFBRSxLQUFLO1NBQ2Y7UUFDRCxXQUFXLEVBQUU7WUFDWCxJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxTQUFTLEVBQUU7WUFDVCxJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxHQUFHLFVBQVUsRUFBRTtLQUNoQjtJQUNELEtBQUssRUFBRSxDQUFDLGNBQWMsQ0FBQztJQUN2QixLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRTtRQUMxQixNQUFNLEVBQ0oscUJBQXFCLEVBQ3JCLDJCQUEyQixFQUMzQixlQUFlLEVBQ2YscUJBQXFCLEdBQ3RCLEdBQUcsU0FBUyxFQUFFLENBQUE7UUFFZixNQUFNLEtBQUssR0FBRyxHQUFHLENBQWdCLElBQUksR0FB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Q0FBQTtRQUVsQixTQUFTLENBQUMsR0FBRyxFQUFFO1lBQ2IsWUFBWSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUMzQixDQUFDLENBQUMsQ0FBQTtRQUVGLE9BQU8sQ0FBQyxNQUFNLEVBQUU7WUFDZCxHQUFHLEVBQUUsUUFBUTtZQUNiLE1BQU0sRUFBRSxVQUFVO1lBQ2xCLEtBQUssRUFBRSxPQUFPO1lBQ2QsV0FBVyxFQUFFLEtBQUssQ0FBQyxXQUFXO1NBQy9CLENBQUMsQ0FBQTtRQUVGLE9BQU8sR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUNaLEtBQUssRUFDTCxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLEVBQzdDLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsRUFBRSxFQUFFLENBQ3JDLENBQUE7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVmaW5lQ29tcG9uZW50LCBoLCBwcm92aWRlLCB3YXRjaCwgcmVmLCB0b1JhdywgY29tcHV0ZWQsIG9uTW91bnRlZCB9IGZyb20gJ3Z1ZSdcbmltcG9ydCB7IHVzZUNvbG9ycywgY29sb3JQcm9wcyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLWNvbG9ycydcbmltcG9ydCB7IG1hcFRvVmFsQXJyYXkgfSBmcm9tICcuLi8uLi9oZWxwZXJzJ1xuXG5leHBvcnQgZGVmYXVsdCBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAndi1saXN0JyxcbiAgcHJvcHM6IHtcbiAgICB2YWx1ZToge1xuICAgICAgdHlwZTogW051bWJlciwgQXJyYXldLFxuICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICB9LFxuICAgIG11bHRpcGxlOiBCb29sZWFuLFxuICAgIGFjdGl2ZToge1xuICAgICAgdHlwZTogQm9vbGVhbixcbiAgICAgIGRlZmF1bHQ6IGZhbHNlLFxuICAgIH0sXG4gICAgYWN0aXZlQ2xhc3M6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcnLFxuICAgIH0sXG4gICAgdGV4dENvbG9yOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJyxcbiAgICB9LFxuICAgIC4uLmNvbG9yUHJvcHMoKSxcbiAgfSxcbiAgZW1pdHM6IFsndXBkYXRlOnZhbHVlJ10sXG4gIHNldHVwKHByb3BzLCB7IGVtaXQsIHNsb3RzIH0pIHtcbiAgICBjb25zdCB7XG4gICAgICBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IsXG4gICAgICBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IsXG4gICAgICBzZXRUZXh0Q3NzQ29sb3IsXG4gICAgICBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IsXG4gICAgfSA9IHVzZUNvbG9ycygpXG5cbiAgICBjb25zdCBpdGVtcyA9IHJlZjxNYXA8YW55LCBhbnk+PihuZXcgTWFwKCkpXG4gICAgbGV0IGlzVHJ1c3RlZFNlbGVjdCA9IGZhbHNlXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+ICh7XG4gICAgICAndi1saXN0JzogdHJ1ZSxcbiAgICAgICd2LWxpc3QtLWFjdGl2ZSc6IHByb3BzLmFjdGl2ZSxcbiAgICAgIC4uLnNldFRleHRDbGFzc05hbWVDb2xvcihwcm9wcy50ZXh0Q29sb3IpLFxuICAgICAgLi4uc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yKHByb3BzLmNvbG9yKSxcbiAgICB9KSlcblxuICAgIGNvbnN0IHN0eWxlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIHN0cmluZz4+KCgpID0+ICh7XG4gICAgICAuLi5zZXRUZXh0Q3NzQ29sb3IocHJvcHMudGV4dENvbG9yKSxcbiAgICAgIC4uLnNldEJhY2tncm91bmRDc3NDb2xvcihwcm9wcy5jb2xvciksXG4gICAgfSkpXG5cbiAgICBjb25zdCByZWdpc3RlciA9IChpdGVtKSA9PiB7XG4gICAgICAhaXRlbXMudmFsdWUuaGFzKGl0ZW0pICYmIGl0ZW1zLnZhbHVlLnNldChpdGVtLCBpdGVtKVxuICAgIH1cblxuICAgIGNvbnN0IHVucmVnaXN0ZXIgPSAoaXRlbSkgPT4ge1xuICAgICAgaXRlbXMudmFsdWUuaGFzKGl0ZW0pICYmIGl0ZW1zLnZhbHVlLmRlbGV0ZShpdGVtKVxuICAgIH1cblxuICAgIGNvbnN0IGRpc3BhdGNoRXZlbnQgPSAodmFsKSA9PiB7XG4gICAgICBpc1RydXN0ZWRTZWxlY3QgPSB0cnVlXG4gICAgICBlbWl0KCd1cGRhdGU6dmFsdWUnLCB2YWwpXG4gICAgfVxuXG4gICAgY29uc3Qgc2V0QWN0aXZlSXRlbSA9IChpdGVtKSA9PiB7XG4gICAgICBtYXBUb1ZhbEFycmF5KHRvUmF3KGl0ZW1zLnZhbHVlKSkuZm9yRWFjaCgoaXQpID0+IHtcbiAgICAgICAgaXQuaXNBY3RpdmUudmFsdWUgPSBpdCA9PT0gaXRlbVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25zdCB0b2dnbGVJdGVtID0gKGl0ZW0pID0+IHtcbiAgICAgIGl0ZW0uaXNBY3RpdmUudmFsdWUgPSAhaXRlbS5pc0FjdGl2ZS52YWx1ZVxuICAgIH1cblxuICAgIGNvbnN0IHByZXBhcmVJbmRleGVzID0gKCkgPT4ge1xuICAgICAgY29uc3QgdmFsdWVzID0gbWFwVG9WYWxBcnJheSh0b1JhdyhpdGVtcy52YWx1ZSkpXG4gICAgICBjb25zdCB7IG11bHRpcGxlIH0gPSBwcm9wc1xuXG4gICAgICBsZXQgdmFsID0gbXVsdGlwbGUgPyBbXSA6IDBcblxuICAgICAgdmFsdWVzLmZvckVhY2goKGl0LCBpKSA9PiB7XG4gICAgICAgIGlmIChpdC5pc0FjdGl2ZS52YWx1ZSkge1xuICAgICAgICAgIG11bHRpcGxlICYmICh2YWwgYXMgbnVtYmVyW10pLnB1c2goaSlcbiAgICAgICAgICAhbXVsdGlwbGUgJiYgKHZhbCA9IGkpXG4gICAgICAgIH1cbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB2YWxcbiAgICB9XG5cbiAgICBjb25zdCBvbkNsaWNrID0gKGl0ZW0pID0+IHtcbiAgICAgIGlmICghcHJvcHMuYWN0aXZlKSByZXR1cm5cblxuICAgICAgcHJvcHMubXVsdGlwbGUgJiYgdG9nZ2xlSXRlbShpdGVtKVxuICAgICAgIXByb3BzLm11bHRpcGxlICYmIHNldEFjdGl2ZUl0ZW0oaXRlbSlcblxuICAgICAgZGlzcGF0Y2hFdmVudChwcmVwYXJlSW5kZXhlcygpKVxuICAgIH1cblxuICAgIGNvbnN0IHNldEl0ZW1TdGF0ZSA9ICh2YWx1ZSkgPT4ge1xuICAgICAgaWYgKHZhbHVlID09PSBudWxsKSByZXR1cm4gc2V0QWN0aXZlSXRlbSh2YWx1ZSlcbiAgICAgIGNvbnN0IHZhbHVlcyA9IG1hcFRvVmFsQXJyYXkodG9SYXcoaXRlbXMudmFsdWUpKVxuXG4gICAgICBpZiAodmFsdWVzLmxlbmd0aCkge1xuICAgICAgICBpZiAocHJvcHMubXVsdGlwbGUpIHtcbiAgICAgICAgICA7KHZhbHVlIGFzIG51bWJlcltdKS5mb3JFYWNoKChpbmQpID0+IHRvZ2dsZUl0ZW0odmFsdWVzW2luZF0pKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNldEFjdGl2ZUl0ZW0odmFsdWVzW3ZhbHVlIGFzIG51bWJlcl0pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB3YXRjaCgoKSA9PiBwcm9wcy52YWx1ZSwgKHRvKSA9PiB7XG4gICAgICAgIGlmICghaXNUcnVzdGVkU2VsZWN0KSBzZXRJdGVtU3RhdGUodG8pXG4gICAgICAgIGlzVHJ1c3RlZFNlbGVjdCAmJiAoaXNUcnVzdGVkU2VsZWN0ID0gZmFsc2UpXG4gICAgICB9LFxuICAgIClcblxuICAgIC8vIHRoaXMgcGFydCBpcyBmb3IgZml4aW5nXG4gICAgLy8gYXN5bmMgY29tcG9uZW50cyBtb3VudGluZyBzZXF1ZW5jZVxuICAgIGNvbnN0IHN0b3AgPSB3YXRjaChpdGVtcywgKCkgPT4ge1xuICAgICAgc2V0SXRlbVN0YXRlKHByb3BzLnZhbHVlKVxuICAgICAgc3RvcCgpXG4gICAgfSwgeyBkZWVwOiB0cnVlIH0pXG5cbiAgICBvbk1vdW50ZWQoKCkgPT4ge1xuICAgICAgc2V0SXRlbVN0YXRlKHByb3BzLnZhbHVlKVxuICAgIH0pXG5cbiAgICBwcm92aWRlKCdsaXN0Jywge1xuICAgICAgYWRkOiByZWdpc3RlcixcbiAgICAgIHJlbW92ZTogdW5yZWdpc3RlcixcbiAgICAgIGNsaWNrOiBvbkNsaWNrLFxuICAgICAgYWN0aXZlQ2xhc3M6IHByb3BzLmFjdGl2ZUNsYXNzLFxuICAgIH0pXG5cbiAgICByZXR1cm4gKCkgPT4gaChcbiAgICAgICdkaXYnLFxuICAgICAgeyBjbGFzczogY2xhc3Nlcy52YWx1ZSwgc3R5bGU6IHN0eWxlcy52YWx1ZSB9LFxuICAgICAgeyBkZWZhdWx0OiAoKSA9PiBzbG90cy5kZWZhdWx0Py4oKSB9LFxuICAgIClcbiAgfSxcbn0pXG4iXX0=