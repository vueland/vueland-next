import { computed, defineComponent, h, ref } from 'vue';
import { useInputStates } from '../../composables/use-input-states';
import { getStringKeysValue } from '../../helpers';
import { VInput } from '../VInput';
import { VMenu } from '../VMenu';
import { VIcon } from '../VIcon';
import { VSelectList } from './VSelectList';
import { VProgressCircular } from '../VProgressCircular';
import { FaIcons } from '../../services/icons';
export default defineComponent({
    name: 'v-select',
    props: {
        modelValue: {
            type: [String, Number, Object],
            default: null,
        },
        items: {
            type: Array,
            default: null,
        },
        valueKey: {
            type: String,
            default: '',
        },
        activeClass: {
            type: String,
            default: 'primary white--text text--base',
        },
        loading: Boolean,
    },
    emits: ['click', 'focus', 'select', 'blur', 'change', 'update:modelValue'],
    setup(props, { attrs, emit }) {
        const { isDisabled, isReadonly, inputState, onBlur, onSelect, onFocus } = useInputStates(props, { attrs, emit });
        const activator = ref(null);
        const computedValue = computed(() => {
            if (!!props.modelValue && typeof props.modelValue === 'object') {
                return getStringKeysValue(props.valueKey, props.modelValue);
            }
            return props.modelValue;
        });
        const classes = computed(() => ({
            'v-select': true,
            'v-select--expanded': inputState.focused,
            'v-select--readonly': isReadonly.value,
            'v-select--disabled': isDisabled.value,
        }));
        const genInput = ({ textCssColor, textClassColor, disabled }) => {
            return h('input', {
                class: {
                    'v-select__input': true,
                    ...(disabled ? textClassColor : {}),
                },
                style: {
                    ...(!disabled ? textCssColor : {}),
                },
                disabled: isDisabled.value,
                type: attrs.type || 'text',
                placeholder: attrs.placeholder,
                value: computedValue.value,
                readonly: true,
            });
        };
        const genListPreloader = () => {
            return h('div', {
                class: 'v-select__preloader'
            }, h(VProgressCircular, {
                indeterminate: true,
                width: 2,
                size: 30,
                color: (attrs.color || 'primary')
            }));
        };
        const genSelectList = () => {
            return h(VMenu, {
                internalActivator: true,
                activator: activator.value,
                inputActivator: '.v-input__text-field',
                openOnClick: true,
                maxHeight: 240,
                zIndex: 12,
                onShow: onFocus,
                onHide: onBlur,
            }, {
                default: () => props.loading ? genListPreloader() : h(VSelectList, {
                    items: props.items,
                    selected: props.modelValue,
                    valueKey: props.valueKey,
                    activeClass: props.activeClass,
                    onSelect,
                }),
            });
        };
        const genExpandIcon = () => {
            return h(VIcon, {
                icon: FaIcons.$chevronDown,
                color: !isDisabled.value ? attrs.color : '',
                size: 16,
            });
        };
        const genSelect = ({ textCssColor, textClassColor, disabled }) => {
            return h('div', {
                class: classes.value,
            }, genInput({ textCssColor, textClassColor, disabled }));
        };
        return () => h(VInput, {
            ref: activator,
            value: computedValue.value,
            focused: inputState.focused,
        }, {
            ['text-field']: ({ textCssColor, textClassColor, disabled }) => {
                return genSelect({ textCssColor, textClassColor, disabled });
            },
            ['append-icon']: () => genExpandIcon(),
            select: () => activator.value ? genSelectList() : null,
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlNlbGVjdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZTZWxlY3QvVlNlbGVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLGVBQWUsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFTLE1BQU0sS0FBSyxDQUFBO0FBQzlELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQTtBQUNuRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFHbEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQTtBQUNsQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ2hDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDaEMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQUMzQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQTtBQUd4RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sc0JBQXNCLENBQUE7QUFHOUMsZUFBZSxlQUFlLENBQUM7SUFDN0IsSUFBSSxFQUFFLFVBQVU7SUFDaEIsS0FBSyxFQUFFO1FBQ0wsVUFBVSxFQUFFO1lBQ1YsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUM7WUFDOUIsT0FBTyxFQUFFLElBQUk7U0FDZDtRQUNELEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxLQUFLO1lBQ1gsT0FBTyxFQUFFLElBQUk7U0FDZDtRQUNELFFBQVEsRUFBRTtZQUNSLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELFdBQVcsRUFBRTtZQUNYLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLGdDQUFnQztTQUMxQztRQUNELE9BQU8sRUFBRSxPQUFPO0tBQ2pCO0lB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QUFjLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRTtnQkFDN0QsT0FBTyxTQUFTLENBQUMsRUFBRSxZQUFZLEVBQUUsY0FBYyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUE7WUFDOUQsQ0FBQztZQUNELENBQUMsYUFBYSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsYUFBYSxFQUFFO1lBQ3RDLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFBLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSTtTQUN0RCxDQUFDLENBQUE7SUFDSixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29tcHV0ZWQsIGRlZmluZUNvbXBvbmVudCwgaCwgcmVmLCBWTm9kZSB9IGZyb20gJ3Z1ZSdcbmltcG9ydCB7IHVzZUlucHV0U3RhdGVzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZXMvdXNlLWlucHV0LXN0YXRlcydcbmltcG9ydCB7IGdldFN0cmluZ0tleXNWYWx1ZSB9IGZyb20gJy4uLy4uL2hlbHBlcnMnXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCB7IFZJbnB1dCB9IGZyb20gJy4uL1ZJbnB1dCdcbmltcG9ydCB7IFZNZW51IH0gZnJvbSAnLi4vVk1lbnUnXG5pbXBvcnQgeyBWSWNvbiB9IGZyb20gJy4uL1ZJY29uJ1xuaW1wb3J0IHsgVlNlbGVjdExpc3QgfSBmcm9tICcuL1ZTZWxlY3RMaXN0J1xuaW1wb3J0IHsgVlByb2dyZXNzQ2lyY3VsYXIgfSBmcm9tICcuLi9WUHJvZ3Jlc3NDaXJjdWxhcidcblxuLy8gU2VydmljZXNcbmltcG9ydCB7IEZhSWNvbnMgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9pY29ucydcbmltcG9ydCB7IE1heWJlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvYmFzZSdcblxuZXhwb3J0IGRlZmF1bHQgZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3Ytc2VsZWN0JyxcbiAgcHJvcHM6IHtcbiAgICBtb2RlbFZhbHVlOiB7XG4gICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXIsIE9iamVjdF0sXG4gICAgICBkZWZhdWx0OiBudWxsLFxuICAgIH0sXG4gICAgaXRlbXM6IHtcbiAgICAgIHR5cGU6IEFycmF5LFxuICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICB9LFxuICAgIHZhbHVlS2V5OiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJyxcbiAgICB9LFxuICAgIGFjdGl2ZUNsYXNzOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAncHJpbWFyeSB3aGl0ZS0tdGV4dCB0ZXh0LS1iYXNlJyxcbiAgICB9LFxuICAgIGxvYWRpbmc6IEJvb2xlYW4sXG4gIH0sXG4gIGVtaXRzOiBbJ2NsaWNrJywgJ2ZvY3VzJywgJ3NlbGVjdCcsICdibHVyJywgJ2NoYW5nZScsICd1cGRhdGU6bW9kZWxWYWx1ZSddLFxuICBzZXR1cChwcm9wcywgeyBhdHRycywgZW1pdCB9KSB7XG4gICAgY29uc3QgeyBpc0Rpc2FibGVkLCBpc1JlYWRvbmx5LCBpbnB1dFN0YXRlLCBvbkJsdXIsIG9uU2VsZWN0LCBvbkZvY3VzIH0gPVxuICAgICAgdXNlSW5wdXRTdGF0ZXMocHJvcHMsIHsgYXR0cnMsIGVtaXQgfSlcblxuICAgIGNvbnN0IGFjdGl2YXRvciA9IHJlZjxNYXliZTxIVE1MRWxlbWVudD4+KG51bGwpXG5cbiAgICBjb25zdCBjb21wdXRlZFZhbHVlID0gY29tcHV0ZWQ8c3RyaW5nIHwgbnVtYmVyPigoKSA9PiB7XG4gICAgICBpZiAoISFwcm9wcy5tb2RlbFZhbHVlICYmIHR5cGVvZiBwcm9wcy5tb2RlbFZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgICAgICByZXR1cm4gZ2V0U3RyaW5nS2V5c1ZhbHVlKHByb3BzLnZhbHVlS2V5LCBwcm9wcy5tb2RlbFZhbHVlKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gcHJvcHMubW9kZWxWYWx1ZVxuICAgIH0pXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+ICh7XG4gICAgICAndi1zZWxlY3QnOiB0cnVlLFxuICAgICAgJ3Ytc2VsZWN0LS1leHBhbmRlZCc6IGlucHV0U3RhdGUuZm9jdXNlZCxcbiAgICAgICd2LXNlbGVjdC0tcmVhZG9ubHknOiBpc1JlYWRvbmx5LnZhbHVlLFxuICAgICAgJ3Ytc2VsZWN0LS1kaXNhYmxlZCc6IGlzRGlzYWJsZWQudmFsdWUsXG4gICAgfSkpXG5cbiAgICBjb25zdCBnZW5JbnB1dCA9ICh7IHRleHRDc3NDb2xvciwgdGV4dENsYXNzQ29sb3IsIGRpc2FibGVkIH0pID0+IHtcbiAgICAgIHJldHVybiBoKCdpbnB1dCcsIHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1zZWxlY3RfX2lucHV0JzogdHJ1ZSxcbiAgICAgICAgICAuLi4oZGlzYWJsZWQgPyB0ZXh0Q2xhc3NDb2xvciA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAuLi4oIWRpc2FibGVkID8gdGV4dENzc0NvbG9yIDoge30pLFxuICAgICAgICB9LFxuICAgICAgICBkaXNhYmxlZDogaXNEaXNhYmxlZC52YWx1ZSxcbiAgICAgICAgdHlwZTogYXR0cnMudHlwZSB8fCAndGV4dCcsXG4gICAgICAgIHBsYWNlaG9sZGVyOiBhdHRycy5wbGFjZWhvbGRlcixcbiAgICAgICAgdmFsdWU6IGNvbXB1dGVkVmFsdWUudmFsdWUsXG4gICAgICAgIHJlYWRvbmx5OiB0cnVlLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5MaXN0UHJlbG9hZGVyID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIGgoJ2RpdicsIHtcbiAgICAgICAgY2xhc3M6ICd2LXNlbGVjdF9fcHJlbG9hZGVyJ1xuICAgICAgfSwgaChWUHJvZ3Jlc3NDaXJjdWxhciwge1xuICAgICAgICBpbmRldGVybWluYXRlOiB0cnVlLFxuICAgICAgICB3aWR0aDogMixcbiAgICAgICAgc2l6ZTogMzAsXG4gICAgICAgIGNvbG9yOiAoYXR0cnMuY29sb3IgfHwgJ3ByaW1hcnknKSBhcyBzdHJpbmdcbiAgICAgIH0pKVxuICAgIH1cblxuICAgIGNvbnN0IGdlblNlbGVjdExpc3QgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoVk1lbnUsIHtcbiAgICAgICAgaW50ZXJuYWxBY3RpdmF0b3I6IHRydWUsXG4gICAgICAgIGFjdGl2YXRvcjogYWN0aXZhdG9yLnZhbHVlISxcbiAgICAgICAgaW5wdXRBY3RpdmF0b3I6ICcudi1pbnB1dF9fdGV4dC1maWVsZCcsXG4gICAgICAgIG9wZW5PbkNsaWNrOiB0cnVlLFxuICAgICAgICBtYXhIZWlnaHQ6IDI0MCxcbiAgICAgICAgekluZGV4OiAxMixcbiAgICAgICAgb25TaG93OiBvbkZvY3VzLFxuICAgICAgICBvbkhpZGU6IG9uQmx1cixcbiAgICAgIH0sIHtcbiAgICAgICAgZGVmYXVsdDogKCkgPT4gcHJvcHMubG9hZGluZyA/IGdlbkxpc3RQcmVsb2FkZXIoKSA6IGgoVlNlbGVjdExpc3QsIHtcbiAgICAgICAgICBpdGVtczogcHJvcHMuaXRlbXMsXG4gICAgICAgICAgc2VsZWN0ZWQ6IHByb3BzLm1vZGVsVmFsdWUsXG4gICAgICAgICAgdmFsdWVLZXk6IHByb3BzLnZhbHVlS2V5LFxuICAgICAgICAgIGFjdGl2ZUNsYXNzOiBwcm9wcy5hY3RpdmVDbGFzcyxcbiAgICAgICAgICBvblNlbGVjdCxcbiAgICAgICAgfSksXG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkV4cGFuZEljb24gPSAoKTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoVkljb24sIHtcbiAgICAgICAgaWNvbjogRmFJY29ucy4kY2hldnJvbkRvd24sXG4gICAgICAgIGNvbG9yOiAhaXNEaXNhYmxlZC52YWx1ZSA/IGF0dHJzLmNvbG9yIDogJycsXG4gICAgICAgIHNpemU6IDE2LFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5TZWxlY3QgPSAoeyB0ZXh0Q3NzQ29sb3IsIHRleHRDbGFzc0NvbG9yLCBkaXNhYmxlZCB9KSA9PiB7XG4gICAgICByZXR1cm4gaCgnZGl2Jywge1xuICAgICAgICBjbGFzczogY2xhc3Nlcy52YWx1ZSxcbiAgICAgIH0sIGdlbklucHV0KHsgdGV4dENzc0NvbG9yLCB0ZXh0Q2xhc3NDb2xvciwgZGlzYWJsZWQgfSkpXG4gICAgfVxuXG4gICAgcmV0dXJuICgpID0+IGgoVklucHV0LCB7XG4gICAgICByZWY6IGFjdGl2YXRvcixcbiAgICAgIHZhbHVlOiBjb21wdXRlZFZhbHVlLnZhbHVlLFxuICAgICAgZm9jdXNlZDogaW5wdXRTdGF0ZS5mb2N1c2VkLFxuICAgIH0sIHtcbiAgICAgIFsndGV4dC1maWVsZCddOiAoeyB0ZXh0Q3NzQ29sb3IsIHRleHRDbGFzc0NvbG9yLCBkaXNhYmxlZCB9KSA9PiB7XG4gICAgICAgIHJldHVybiBnZW5TZWxlY3QoeyB0ZXh0Q3NzQ29sb3IsIHRleHRDbGFzc0NvbG9yLCBkaXNhYmxlZCB9KVxuICAgICAgfSxcbiAgICAgIFsnYXBwZW5kLWljb24nXTogKCkgPT4gZ2VuRXhwYW5kSWNvbigpLFxuICAgICAgc2VsZWN0OiAoKSA9PiBhY3RpdmF0b3IudmFsdWU/IGdlblNlbGVjdExpc3QoKSA6IG51bGwsXG4gICAgfSlcbiAgfSxcbn0pXG4iXX0=