import { defineComponent, h, provide, watch, ref, toRaw, computed, onMounted } from 'vue';
import { useColors, colorProps } from '../../composables/use-colors';
import { mapToValArray } from '../../helpers';
export default defineComponent({
    name: 'v-list',
    props: {
        value: {
            type: [Number, Array],
            default: null,
        },
        multiple: Boolean,
        active: {
            type: Boolean,
            default: false,
        },
        activeClass: {
            type: String,
            default: '',
        },
        textColor: {
            type: String,
            default: '',
        },
        ...colorProps(),
    },
    emits: ['update:value'],
    setup(props, { emit, slots }) {
        const { setTextClassNameColor, setBackgroundClassNameColor, setTextCssColor, setBackgroundCssColor, } = useColors();
        const items = ref(new Map());
        let isTrustedSelect = false;
        const classes = computed(() => ({
            'v-list': true,
            'v-list--active': props.active,
            'v-list--themeable': !props.color,
            ...setTextClassNameColor(props.textColor),
            ...setBackgroundClassNameColor(props.color),
        }));
        const styles = computed(() => ({
            ...setTextCssColor(props.textColor),
            ...setBackgroundCssColor(props.color),
        }));
        const register = (item) => {
            !items.value.has(item) && items.value.set(item, item);
        };
        const unregister = (item) => {
            items.value.has(item) && items.value.delete(item);
        };
        const dispatchEvent = (val) => {
            isTrustedSelect = true;
            emit('update:value', val);
        };
        const setActiveItem = (item) => {
            mapToValArray(toRaw(items.value)).forEach((it) => {
                it.isActive.value = it === item;
            });
        };
        const toggleItem = (item) => {
            item.isActive.value = !item.isActive.value;
        };
        const prepareIndexes = () => {
            const values = mapToValArray(toRaw(items.value));
            const { multiple } = props;
            let val = multiple ? [] : 0;
            values.forEach((it, i) => {
                if (it.isActive.value) {
                    multiple ? val.push(i) : (val = i);
                }
            });
            return val;
        };
        const onClick = (item) => {
            if (!props.active)
                return;
            props.multiple ? toggleItem(item) : setActiveItem(item);
            dispatchEvent(prepareIndexes());
        };
        const setItemState = (value) => {
            if (value === null)
                return setActiveItem(value);
            const values = mapToValArray(toRaw(items.value));
            if (values.length) {
                if (props.multiple) {
                    ;
                    value.forEach((ind) => toggleItem(values[ind]));
                }
                else {
                    setActiveItem(values[value]);
                }
            }
        };
        watch(() => props.value, (to) => {
            if (!isTrustedSelect)
                setItemState(to);
            isTrustedSelect && (isTrustedSelect = false);
        });
        const stop = watch(items, () => {
            setItemState(props.value);
            stop();
        }, { deep: true });
        onMounted(() => setItemState(props.value));
        provide('$v_list', {
            add: register,
            remove: unregister,
            click: onClick,
            activeClass: props.activeClass,
        });
        return () => h('div', { class: classes.value, style: styles.value }, { default: () => slots.default?.() });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkxpc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WTGlzdC9WTGlzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZUFBZSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxNQUFNLEtBQUssQ0FBQTtBQUN6RixPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLDhCQUE4QixDQUFBO0FBQ3BFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFFN0MsZUFBZSxlQUFlLENBQUM7SUFDN0IsSUFBSSxFQUFFLFFBQVE7SUFDZCxLQUFLLEVBQUU7UUFDTCxLQUFLLEVBQUU7WUFDTCxJQUFJLEVBQUUsQ0FBRSxNQUFNLEVBQUUsS0FBSyxDQUFFO1lBQ3ZCLE9BQU8sRUFBRSxJQUFJO1NBQ2Q7UUFDRCxRQUFRLEVBQUUsT0FBTztRQUNqQixNQUFNLEVBQUU7WUFDTixJQUFJLEVBQUUsT0FBTztZQUNiLE9BQU8sRUFBRSxLQUFLO1NBQ2Y7UUFDRCxXQUFXLEVBQUU7WUFDWCxJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxTQUFTLEVBQUU7WUFDVCxJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxHQUFHLFVBQVUsRUFBRTtLQUNoQjtJQUNELEtBQUssRUFBRSxDQUFFLGNBQWMsQ0FBRTtJQUN6QixLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRTtRQUMxQixNQUFNLEVBQ0oscUJBQXFCLEVBQ3JCLDJCQUEyQixFQUMzQixlQUFlLEVBQ2YscUJBQXFCLEdBQ3RCLEdBQUcsU0FBUyxFQUFFLENBQUE7UUFFZixNQUFNLEtBQUssR0FBRyxHQUFHLENBQWdCLElBQUksR0FB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SUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7UUFFbEIsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQTtRQUUxQyxPQUFPLENBQUMsU0FBUyxFQUFFO1lBQ2pCLEdBQUcsRUFBRSxRQUFRO1lBQ2IsTUFBTSxFQUFFLFVBQVU7WUFDbEIsS0FBSyxFQUFFLE9BQU87WUFDZCxXQUFXLEVBQUUsS0FBSyxDQUFDLFdBQVc7U0FDL0IsQ0FBQyxDQUFBO1FBRUYsT0FBTyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQ1osS0FBSyxFQUNMLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFLLEVBQUUsRUFDN0MsRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxFQUFFLEVBQUUsQ0FDckMsQ0FBQTtJQUNILENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZWZpbmVDb21wb25lbnQsIGgsIHByb3ZpZGUsIHdhdGNoLCByZWYsIHRvUmF3LCBjb21wdXRlZCwgb25Nb3VudGVkIH0gZnJvbSAndnVlJ1xuaW1wb3J0IHsgdXNlQ29sb3JzLCBjb2xvclByb3BzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZXMvdXNlLWNvbG9ycydcbmltcG9ydCB7IG1hcFRvVmFsQXJyYXkgfSBmcm9tICcuLi8uLi9oZWxwZXJzJ1xuXG5leHBvcnQgZGVmYXVsdCBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAndi1saXN0JyxcbiAgcHJvcHM6IHtcbiAgICB2YWx1ZToge1xuICAgICAgdHlwZTogWyBOdW1iZXIsIEFycmF5IF0sXG4gICAgICBkZWZhdWx0OiBudWxsLFxuICAgIH0sXG4gICAgbXVsdGlwbGU6IEJvb2xlYW4sXG4gICAgYWN0aXZlOiB7XG4gICAgICB0eXBlOiBCb29sZWFuLFxuICAgICAgZGVmYXVsdDogZmFsc2UsXG4gICAgfSxcbiAgICBhY3RpdmVDbGFzczoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJycsXG4gICAgfSxcbiAgICB0ZXh0Q29sb3I6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcnLFxuICAgIH0sXG4gICAgLi4uY29sb3JQcm9wcygpLFxuICB9LFxuICBlbWl0czogWyAndXBkYXRlOnZhbHVlJyBdLFxuICBzZXR1cChwcm9wcywgeyBlbWl0LCBzbG90cyB9KSB7XG4gICAgY29uc3Qge1xuICAgICAgc2V0VGV4dENsYXNzTmFtZUNvbG9yLFxuICAgICAgc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yLFxuICAgICAgc2V0VGV4dENzc0NvbG9yLFxuICAgICAgc2V0QmFja2dyb3VuZENzc0NvbG9yLFxuICAgIH0gPSB1c2VDb2xvcnMoKVxuXG4gICAgY29uc3QgaXRlbXMgPSByZWY8TWFwPGFueSwgYW55Pj4obmV3IE1hcCgpKVxuICAgIGxldCBpc1RydXN0ZWRTZWxlY3QgPSBmYWxzZVxuXG4gICAgY29uc3QgY2xhc3NlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+PigoKSA9PiAoe1xuICAgICAgJ3YtbGlzdCc6IHRydWUsXG4gICAgICAndi1saXN0LS1hY3RpdmUnOiBwcm9wcy5hY3RpdmUsXG4gICAgICAndi1saXN0LS10aGVtZWFibGUnOiAhcHJvcHMuY29sb3IsXG4gICAgICAuLi5zZXRUZXh0Q2xhc3NOYW1lQ29sb3IocHJvcHMudGV4dENvbG9yKSxcbiAgICAgIC4uLnNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcihwcm9wcy5jb2xvciksXG4gICAgfSkpXG5cbiAgICBjb25zdCBzdHlsZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+PigoKSA9PiAoe1xuICAgICAgLi4uc2V0VGV4dENzc0NvbG9yKHByb3BzLnRleHRDb2xvciksXG4gICAgICAuLi5zZXRCYWNrZ3JvdW5kQ3NzQ29sb3IocHJvcHMuY29sb3IpLFxuICAgIH0pKVxuXG4gICAgY29uc3QgcmVnaXN0ZXIgPSAoaXRlbSkgPT4ge1xuICAgICAgIWl0ZW1zLnZhbHVlLmhhcyhpdGVtKSAmJiBpdGVtcy52YWx1ZS5zZXQoaXRlbSwgaXRlbSlcbiAgICB9XG5cbiAgICBjb25zdCB1bnJlZ2lzdGVyID0gKGl0ZW0pID0+IHtcbiAgICAgIGl0ZW1zLnZhbHVlLmhhcyhpdGVtKSAmJiBpdGVtcy52YWx1ZS5kZWxldGUoaXRlbSlcbiAgICB9XG5cbiAgICBjb25zdCBkaXNwYXRjaEV2ZW50ID0gKHZhbCkgPT4ge1xuICAgICAgaXNUcnVzdGVkU2VsZWN0ID0gdHJ1ZVxuICAgICAgZW1pdCgndXBkYXRlOnZhbHVlJywgdmFsKVxuICAgIH1cblxuICAgIGNvbnN0IHNldEFjdGl2ZUl0ZW0gPSAoaXRlbSkgPT4ge1xuICAgICAgbWFwVG9WYWxBcnJheSh0b1JhdyhpdGVtcy52YWx1ZSkpLmZvckVhY2goKGl0KSA9PiB7XG4gICAgICAgIGl0LmlzQWN0aXZlLnZhbHVlID0gaXQgPT09IGl0ZW1cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc3QgdG9nZ2xlSXRlbSA9IChpdGVtKSA9PiB7XG4gICAgICBpdGVtLmlzQWN0aXZlLnZhbHVlID0gIWl0ZW0uaXNBY3RpdmUudmFsdWVcbiAgICB9XG5cbiAgICBjb25zdCBwcmVwYXJlSW5kZXhlcyA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlcyA9IG1hcFRvVmFsQXJyYXkodG9SYXcoaXRlbXMudmFsdWUpKVxuICAgICAgY29uc3QgeyBtdWx0aXBsZSB9ID0gcHJvcHNcblxuICAgICAgbGV0IHZhbCA9IG11bHRpcGxlID8gW10gOiAwXG5cbiAgICAgIHZhbHVlcy5mb3JFYWNoKChpdCwgaSkgPT4ge1xuICAgICAgICBpZiAoaXQuaXNBY3RpdmUudmFsdWUpIHtcbiAgICAgICAgICBtdWx0aXBsZSA/ICh2YWwgYXMgbnVtYmVyW10pLnB1c2goaSkgOiAodmFsID0gaSlcbiAgICAgICAgfVxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHZhbFxuICAgIH1cblxuICAgIGNvbnN0IG9uQ2xpY2sgPSAoaXRlbSkgPT4ge1xuICAgICAgaWYgKCFwcm9wcy5hY3RpdmUpIHJldHVyblxuXG4gICAgICBwcm9wcy5tdWx0aXBsZSA/IHRvZ2dsZUl0ZW0oaXRlbSkgOiBzZXRBY3RpdmVJdGVtKGl0ZW0pXG4gICAgICAvLyAhcHJvcHMubXVsdGlwbGUgJiZcblxuICAgICAgZGlzcGF0Y2hFdmVudChwcmVwYXJlSW5kZXhlcygpKVxuICAgIH1cblxuICAgIGNvbnN0IHNldEl0ZW1TdGF0ZSA9ICh2YWx1ZSkgPT4ge1xuICAgICAgaWYgKHZhbHVlID09PSBudWxsKSByZXR1cm4gc2V0QWN0aXZlSXRlbSh2YWx1ZSlcblxuICAgICAgY29uc3QgdmFsdWVzID0gbWFwVG9WYWxBcnJheSh0b1JhdyhpdGVtcy52YWx1ZSkpXG5cbiAgICAgIGlmICh2YWx1ZXMubGVuZ3RoKSB7XG4gICAgICAgIGlmIChwcm9wcy5tdWx0aXBsZSkge1xuICAgICAgICAgIDsodmFsdWUgYXMgbnVtYmVyW10pLmZvckVhY2goKGluZCkgPT4gdG9nZ2xlSXRlbSh2YWx1ZXNbaW5kXSkpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2V0QWN0aXZlSXRlbSh2YWx1ZXNbdmFsdWUgYXMgbnVtYmVyXSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHdhdGNoKCgpID0+IHByb3BzLnZhbHVlLCAodG8pID0+IHtcbiAgICAgICAgaWYgKCFpc1RydXN0ZWRTZWxlY3QpIHNldEl0ZW1TdGF0ZSh0bylcbiAgICAgICAgaXNUcnVzdGVkU2VsZWN0ICYmIChpc1RydXN0ZWRTZWxlY3QgPSBmYWxzZSlcbiAgICAgIH0sXG4gICAgKVxuXG4gICAgLy8gdGhpcyBwYXJ0IGlzIGZvciBmaXhpbmdcbiAgICAvLyBhc3luYyBjb21wb25lbnRzIG1vdW50aW5nIHNlcXVlbmNlXG4gICAgY29uc3Qgc3RvcCA9IHdhdGNoKGl0ZW1zLCAoKSA9PiB7XG4gICAgICBzZXRJdGVtU3RhdGUocHJvcHMudmFsdWUpXG4gICAgICBzdG9wKClcbiAgICB9LCB7IGRlZXA6IHRydWUgfSlcblxuICAgIG9uTW91bnRlZCgoKSA9PiBzZXRJdGVtU3RhdGUocHJvcHMudmFsdWUpKVxuXG4gICAgcHJvdmlkZSgnJHZfbGlzdCcsIHtcbiAgICAgIGFkZDogcmVnaXN0ZXIsXG4gICAgICByZW1vdmU6IHVucmVnaXN0ZXIsXG4gICAgICBjbGljazogb25DbGljayxcbiAgICAgIGFjdGl2ZUNsYXNzOiBwcm9wcy5hY3RpdmVDbGFzcyxcbiAgICB9KVxuXG4gICAgcmV0dXJuICgpID0+IGgoXG4gICAgICAnZGl2JyxcbiAgICAgIHsgY2xhc3M6IGNsYXNzZXMudmFsdWUsIHN0eWxlOiBzdHlsZXMudmFsdWUgfSxcbiAgICAgIHsgZGVmYXVsdDogKCkgPT4gc2xvdHMuZGVmYXVsdD8uKCkgfSxcbiAgICApXG4gIH0sXG59KVxuIl19