import { h, ref, reactive, watch, computed, withDirectives, defineComponent, onMounted, vShow, } from 'vue';
import { useToggle } from '../../composable/use-toggle';
import { useColors } from '../../composable/use-colors';
import { useActivator } from '../../composable/use-activator';
import { useTransition } from '../../composable/use-transition';
import { elevationProps, useElevation } from '../../composable/use-elevation';
import { positionProps } from '../../composable/use-position';
import { convertToUnit } from '../../helpers';
import { transitions } from '../../services/transitions';
export default defineComponent({
    name: 'v-tooltip',
    props: {
        openOnHover: {
            type: Boolean,
            default: true,
        },
        color: {
            type: String,
            default: 'grey lighten-1',
        },
        zIndex: [Number, String],
        maxWidth: [Number, String],
        minWidth: [Number, String],
        modelValue: Boolean,
        offsetX: {
            type: [String, Number],
            default: 20,
        },
        offsetY: {
            type: [String, Number],
            default: 20,
        },
        ...elevationProps(),
        ...positionProps(),
    },
    setup(props, { slots }) {
        const tooltip = reactive({});
        const activator = reactive({});
        const tooltipRef = ref(null);
        const { isActive } = useToggle(props);
        const { elevationClasses } = useElevation(props);
        const { setBackgroundClassNameColor, setBackgroundCssColor } = useColors();
        const { activatorRef, getActivatorSizes, genActivatorListeners } = useActivator(props);
        const handlers = {
            mouseenter: () => (isActive.value = true),
            mouseleave: () => (isActive.value = false),
        };
        const listeners = genActivatorListeners(props, handlers);
        const classes = computed(() => ({
            'v-tooltip': true,
            'v-tooltip--top': props.top,
            'v-tooltip--right': props.right,
            'v-tooltip--left': props.left,
            'v-tooltip--bottom': props.bottom,
            ...elevationClasses.value,
            ...(props.color ? setBackgroundClassNameColor(props.color) : {}),
        }));
        const computeTopPosition = computed(() => {
            return ((props.top
                ? activator.top - tooltip.height
                : props.bottom
                    ? activator.top + activator.height
                    : activator.top + (activator.height - tooltip.height) / 2) +
                +props.offsetY);
        });
        const computeLeftPosition = computed(() => {
            return ((props.left
                ? activator.left - tooltip.width
                : props.right
                    ? activator.left + activator.width
                    : activator.left + (activator.width - tooltip.width) / 2) +
                +props.offsetX);
        });
        const styles = computed(() => ({
            top: tooltip.top ? convertToUnit(tooltip.top) : '',
            left: tooltip.top ? convertToUnit(tooltip.left) : '',
            maxWidth: !!props.maxWidth ? `${props.maxWidth}px` : '',
            minWidth: !!props.minWidth ? `${props.minWidth}px` : '',
            zIndex: props.zIndex,
            ...(props.color ? setBackgroundCssColor(props.color) : {}),
        }));
        function genActivator() {
            const slotContent = slots.activator &&
                slots.activator({
                    on: listeners,
                });
            return h(slotContent[0], { ref: activatorRef });
        }
        function genContent() {
            const propsData = {
                class: classes.value,
                style: styles.value,
                ref: tooltipRef,
            };
            return withDirectives(h('span', propsData, slots.default && slots.default()), [[vShow, isActive.value]]);
        }
        function setTooltipPosition() {
            if (tooltipRef.value) {
                tooltip.width = tooltipRef.value.offsetWidth;
                tooltip.height = tooltipRef.value.offsetHeight;
                tooltip.top = computeTopPosition.value;
                tooltip.left = computeLeftPosition.value;
            }
        }
        onMounted(() => {
            watch(() => isActive.value, (to) => {
                if (to) {
                    const { left, top, height, width } = getActivatorSizes();
                    activator.left = left;
                    activator.top = top;
                    activator.height = height;
                    activator.width = width;
                    tooltip.top = 0;
                    tooltip.left = 0;
                    requestAnimationFrame(setTooltipPosition);
                }
            }, { immediate: true });
        });
        return () => {
            const content = useTransition(genContent(), isActive.value ? transitions.SCALE_IN : transitions.FADE);
            return [content, genActivator()];
        };
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlRvb2x0aXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WVG9vbHRpcC9WVG9vbHRpcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0wsQ0FBQyxFQUNELEdBQUcsRUFDSCxRQUFRLEVBQ1IsS0FBSyxFQUNMLFFBQVEsRUFDUixjQUFjLEVBQ2QsZUFBZSxFQUNmLFNBQVMsRUFDVCxLQUFLLEdBQ04sTUFBTSxLQUFLLENBQUE7QUFHWixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sNkJBQTZCLENBQUE7QUFDdkQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDZCQUE2QixDQUFBO0FBQ3ZELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQTtBQUM3RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUNBQWlDLENBQUE7QUFDL0QsT0FBTyxFQUFFLGNBQWMsRUFBRSxZQUFZLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQTtBQUM3RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sK0JBQStCLENBQUE7QUFPN0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQUc3QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNEJBQTRCLENBQUE7QUFJeEQsZUFBZSxlQUFlLENBQUM7SUFDN0IsSUFBSSxFQUFFLFdBQVc7SUFFakIsS0FBSyxFQUFFO1FBQ0wsV0FBVyxFQUFFO1lBQ1gsSUFBSSxFQUFFLE9BQU87WUFDYixPQUFPLEVBQUUsSUFBSTtTQUNkO1FBQ0QsS0FBSyxFQUFFO1lBQ0wsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsZ0JBQWdCO1NBQzFCO1FBQ0QsTUFBTSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztRQUN4QixRQUFRLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1FBQzFCLFFBQVEsRUFBRSxDQUFDLE1BQU0sRUFBRSxN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QUMvQixTQUFTLENBQUMsR0FBRyxHQUFHLEdBQWEsQ0FBQTtvQkFDN0IsU0FBUyxDQUFDLE1BQU0sR0FBRyxNQUFnQixDQUFBO29CQUNuQyxTQUFTLENBQUMsS0FBSyxHQUFHLEtBQWUsQ0FBQTtvQkFFakMsT0FBTyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUE7b0JBQ2YsT0FBTyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUE7b0JBRWhCLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLENBQUE7aUJBQzFDO1lBQ0gsQ0FBQyxFQUNELEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUNwQixDQUFBO1FBQ0gsQ0FBQyxDQUFDLENBQUE7UUFFRixPQUFPLEdBQUcsRUFBRTtZQUNWLE1BQU0sT0FBTyxHQUFHLGFBQWEsQ0FDM0IsVUFBVSxFQUFXLEVBQ3JCLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQ3pELENBQUE7WUFFRCxPQUFPLENBQUMsT0FBTyxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUE7UUFDbEMsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7XG4gIGgsXG4gIHJlZixcbiAgcmVhY3RpdmUsXG4gIHdhdGNoLFxuICBjb21wdXRlZCxcbiAgd2l0aERpcmVjdGl2ZXMsXG4gIGRlZmluZUNvbXBvbmVudCxcbiAgb25Nb3VudGVkLFxuICB2U2hvdyxcbn0gZnJvbSAndnVlJ1xuXG4vLyBFZmZlY3RzXG5pbXBvcnQgeyB1c2VUb2dnbGUgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS10b2dnbGUnXG5pbXBvcnQgeyB1c2VDb2xvcnMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS1jb2xvcnMnXG5pbXBvcnQgeyB1c2VBY3RpdmF0b3IgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS1hY3RpdmF0b3InXG5pbXBvcnQgeyB1c2VUcmFuc2l0aW9uIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtdHJhbnNpdGlvbidcbmltcG9ydCB7IGVsZXZhdGlvblByb3BzLCB1c2VFbGV2YXRpb24gfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS1lbGV2YXRpb24nXG5pbXBvcnQgeyBwb3NpdGlvblByb3BzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtcG9zaXRpb24nXG5cbi8vIFR5cGVzXG5pbXBvcnQgeyBPZmZzZXRTaXplcyB9IGZyb20gJy4uLy4uLy4uL3R5cGVzJ1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5cbi8vIEhlbHBlcnNcbmltcG9ydCB7IGNvbnZlcnRUb1VuaXQgfSBmcm9tICcuLi8uLi9oZWxwZXJzJ1xuXG4vLyBTZXJ2aWNlc1xuaW1wb3J0IHsgdHJhbnNpdGlvbnMgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy90cmFuc2l0aW9ucydcblxuLy8gVE9ETyBmaXggYmVoYXZpb3Igb24gd2luZG93IHJlc2l6ZSBpZiB2LW1vZGVsIHVzZWQgb24gY29tcG9uZW50XG5cbmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LXRvb2x0aXAnLFxuXG4gIHByb3BzOiB7XG4gICAgb3Blbk9uSG92ZXI6IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiB0cnVlLFxuICAgIH0sXG4gICAgY29sb3I6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdncmV5IGxpZ2h0ZW4tMScsXG4gICAgfSxcbiAgICB6SW5kZXg6IFtOdW1iZXIsIFN0cmluZ10sXG4gICAgbWF4V2lkdGg6IFtOdW1iZXIsIFN0cmluZ10sXG4gICAgbWluV2lkdGg6IFtOdW1iZXIsIFN0cmluZ10sXG4gICAgbW9kZWxWYWx1ZTogQm9vbGVhbixcbiAgICBvZmZzZXRYOiB7XG4gICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXJdLFxuICAgICAgZGVmYXVsdDogMjAsXG4gICAgfSxcbiAgICBvZmZzZXRZOiB7XG4gICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXJdLFxuICAgICAgZGVmYXVsdDogMjAsXG4gICAgfSxcbiAgICAuLi5lbGV2YXRpb25Qcm9wcygpLFxuICAgIC4uLnBvc2l0aW9uUHJvcHMoKSxcbiAgfSBhcyBhbnksXG5cbiAgc2V0dXAocHJvcHMsIHsgc2xvdHMgfSkge1xuICAgIGNvbnN0IHRvb2x0aXAgPSByZWFjdGl2ZTxQYXJ0aWFsPE9mZnNldFNpemVzPj4oe30pXG4gICAgY29uc3QgYWN0aXZhdG9yID0gcmVhY3RpdmU8UGFydGlhbDxPZmZzZXRTaXplcz4+KHt9KVxuXG4gICAgY29uc3QgdG9vbHRpcFJlZiA9IHJlZjxIVE1MRWxlbWVudCB8IG51bGw+KG51bGwpXG5cbiAgICBjb25zdCB7IGlzQWN0aXZlIH0gPSB1c2VUb2dnbGUocHJvcHMpXG4gICAgY29uc3QgeyBlbGV2YXRpb25DbGFzc2VzIH0gPSB1c2VFbGV2YXRpb24ocHJvcHMpXG4gICAgY29uc3QgeyBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IsIHNldEJhY2tncm91bmRDc3NDb2xvciB9ID0gdXNlQ29sb3JzKClcbiAgICBjb25zdCB7IGFjdGl2YXRvclJlZiwgZ2V0QWN0aXZhdG9yU2l6ZXMsIGdlbkFjdGl2YXRvckxpc3RlbmVycyB9ID1cbiAgICAgIHVzZUFjdGl2YXRvcihwcm9wcylcblxuICAgIGNvbnN0IGhhbmRsZXJzID0ge1xuICAgICAgbW91c2VlbnRlcjogKCkgPT4gKGlzQWN0aXZlLnZhbHVlID0gdHJ1ZSksXG4gICAgICBtb3VzZWxlYXZlOiAoKSA9PiAoaXNBY3RpdmUudmFsdWUgPSBmYWxzZSksXG4gICAgfVxuXG4gICAgY29uc3QgbGlzdGVuZXJzID0gZ2VuQWN0aXZhdG9yTGlzdGVuZXJzKHByb3BzLCBoYW5kbGVycylcblxuICAgIGNvbnN0IGNsYXNzZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBib29sZWFuPj4oKCkgPT4gKHtcbiAgICAgICd2LXRvb2x0aXAnOiB0cnVlLFxuICAgICAgJ3YtdG9vbHRpcC0tdG9wJzogcHJvcHMudG9wLFxuICAgICAgJ3YtdG9vbHRpcC0tcmlnaHQnOiBwcm9wcy5yaWdodCxcbiAgICAgICd2LXRvb2x0aXAtLWxlZnQnOiBwcm9wcy5sZWZ0LFxuICAgICAgJ3YtdG9vbHRpcC0tYm90dG9tJzogcHJvcHMuYm90dG9tLFxuICAgICAgLi4uZWxldmF0aW9uQ2xhc3Nlcy52YWx1ZSxcbiAgICAgIC4uLihwcm9wcy5jb2xvciA/IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcihwcm9wcy5jb2xvcikgOiB7fSksXG4gICAgfSkpXG5cbiAgICBjb25zdCBjb21wdXRlVG9wUG9zaXRpb24gPSBjb21wdXRlZDxudW1iZXI+KCgpID0+IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIChwcm9wcy50b3BcbiAgICAgICAgICA/IGFjdGl2YXRvciEudG9wISAtIHRvb2x0aXAuaGVpZ2h0IVxuICAgICAgICAgIDogcHJvcHMuYm90dG9tXG4gICAgICAgICAgPyBhY3RpdmF0b3IudG9wISArIGFjdGl2YXRvci5oZWlnaHQhXG4gICAgICAgICAgOiBhY3RpdmF0b3IudG9wISArIChhY3RpdmF0b3IuaGVpZ2h0ISAtIHRvb2x0aXAuaGVpZ2h0ISkgLyAyKSArXG4gICAgICAgICtwcm9wcy5vZmZzZXRZXG4gICAgICApXG4gICAgfSlcblxuICAgIGNvbnN0IGNvbXB1dGVMZWZ0UG9zaXRpb24gPSBjb21wdXRlZDxudW1iZXI+KCgpID0+IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIChwcm9wcy5sZWZ0XG4gICAgICAgICAgPyBhY3RpdmF0b3IubGVmdCEgLSB0b29sdGlwLndpZHRoIVxuICAgICAgICAgIDogcHJvcHMucmlnaHRcbiAgICAgICAgICA/IGFjdGl2YXRvci5sZWZ0ISArIGFjdGl2YXRvci53aWR0aCFcbiAgICAgICAgICA6IGFjdGl2YXRvci5sZWZ0ISArIChhY3RpdmF0b3Iud2lkdGghIC0gdG9vbHRpcC53aWR0aCEpIC8gMikgK1xuICAgICAgICArcHJvcHMub2Zmc2V0WFxuICAgICAgKVxuICAgIH0pXG5cbiAgICBjb25zdCBzdHlsZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+PigoKSA9PiAoe1xuICAgICAgdG9wOiB0b29sdGlwLnRvcCA/IChjb252ZXJ0VG9Vbml0KHRvb2x0aXAudG9wKSBhcyBzdHJpbmcpIDogJycsXG4gICAgICBsZWZ0OiB0b29sdGlwLnRvcCA/IChjb252ZXJ0VG9Vbml0KHRvb2x0aXAubGVmdCEpIGFzIHN0cmluZykgOiAnJyxcbiAgICAgIG1heFdpZHRoOiAhIXByb3BzLm1heFdpZHRoID8gYCR7cHJvcHMubWF4V2lkdGh9cHhgIDogJycsXG4gICAgICBtaW5XaWR0aDogISFwcm9wcy5taW5XaWR0aCA/IGAke3Byb3BzLm1pbldpZHRofXB4YCA6ICcnLFxuICAgICAgekluZGV4OiBwcm9wcy56SW5kZXgsXG4gICAgICAuLi4ocHJvcHMuY29sb3IgPyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgIH0pKVxuXG4gICAgZnVuY3Rpb24gZ2VuQWN0aXZhdG9yKCk6IFZOb2RlIHwgbnVsbCB7XG4gICAgICBjb25zdCBzbG90Q29udGVudCA9XG4gICAgICAgIHNsb3RzLmFjdGl2YXRvciAmJlxuICAgICAgICBzbG90cy5hY3RpdmF0b3Ioe1xuICAgICAgICAgIG9uOiBsaXN0ZW5lcnMsXG4gICAgICAgIH0pXG5cbiAgICAgIHJldHVybiBoKHNsb3RDb250ZW50IVswXSwgeyByZWY6IGFjdGl2YXRvclJlZiB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlbkNvbnRlbnQoKTogVk5vZGUge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczogY2xhc3Nlcy52YWx1ZSxcbiAgICAgICAgc3R5bGU6IHN0eWxlcy52YWx1ZSxcbiAgICAgICAgcmVmOiB0b29sdGlwUmVmLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gd2l0aERpcmVjdGl2ZXMoXG4gICAgICAgIGgoJ3NwYW4nLCBwcm9wc0RhdGEsIHNsb3RzLmRlZmF1bHQgJiYgc2xvdHMuZGVmYXVsdCgpKSxcbiAgICAgICAgW1t2U2hvdywgaXNBY3RpdmUudmFsdWVdXVxuICAgICAgKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldFRvb2x0aXBQb3NpdGlvbigpIHtcbiAgICAgIGlmICh0b29sdGlwUmVmLnZhbHVlKSB7XG4gICAgICAgIHRvb2x0aXAud2lkdGggPSB0b29sdGlwUmVmLnZhbHVlIS5vZmZzZXRXaWR0aFxuICAgICAgICB0b29sdGlwLmhlaWdodCA9IHRvb2x0aXBSZWYudmFsdWUhLm9mZnNldEhlaWdodFxuICAgICAgICB0b29sdGlwLnRvcCA9IGNvbXB1dGVUb3BQb3NpdGlvbi52YWx1ZVxuICAgICAgICB0b29sdGlwLmxlZnQgPSBjb21wdXRlTGVmdFBvc2l0aW9uLnZhbHVlXG4gICAgICB9XG4gICAgfVxuXG4gICAgb25Nb3VudGVkKCgpID0+IHtcbiAgICAgIHdhdGNoKFxuICAgICAgICAoKSA9PiBpc0FjdGl2ZS52YWx1ZSxcbiAgICAgICAgKHRvKSA9PiB7XG4gICAgICAgICAgaWYgKHRvKSB7XG4gICAgICAgICAgICBjb25zdCB7IGxlZnQsIHRvcCwgaGVpZ2h0LCB3aWR0aCB9ID0gZ2V0QWN0aXZhdG9yU2l6ZXMoKVxuXG4gICAgICAgICAgICBhY3RpdmF0b3IubGVmdCA9IGxlZnQgYXMgbnVtYmVyXG4gICAgICAgICAgICBhY3RpdmF0b3IudG9wID0gdG9wIGFzIG51bWJlclxuICAgICAgICAgICAgYWN0aXZhdG9yLmhlaWdodCA9IGhlaWdodCBhcyBudW1iZXJcbiAgICAgICAgICAgIGFjdGl2YXRvci53aWR0aCA9IHdpZHRoIGFzIG51bWJlclxuXG4gICAgICAgICAgICB0b29sdGlwLnRvcCA9IDBcbiAgICAgICAgICAgIHRvb2x0aXAubGVmdCA9IDBcblxuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHNldFRvb2x0aXBQb3NpdGlvbilcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHsgaW1tZWRpYXRlOiB0cnVlIH1cbiAgICAgIClcbiAgICB9KVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSB1c2VUcmFuc2l0aW9uKFxuICAgICAgICBnZW5Db250ZW50KCkgYXMgVk5vZGUsXG4gICAgICAgIGlzQWN0aXZlLnZhbHVlID8gdHJhbnNpdGlvbnMuU0NBTEVfSU4gOiB0cmFuc2l0aW9ucy5GQURFXG4gICAgICApXG5cbiAgICAgIHJldHVybiBbY29udGVudCwgZ2VuQWN0aXZhdG9yKCldXG4gICAgfVxuICB9LFxufSlcbiJdfQ==