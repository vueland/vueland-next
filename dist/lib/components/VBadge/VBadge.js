import { vShow, h, computed, withDirectives, defineComponent } from 'vue';
import { positionProps } from '../../composable/use-position';
import { useColors } from '../../composable/use-colors';
import { useToggle } from '../../composable/use-toggle';
import { useElevation, elevationProps } from '../../composable/use-elevation';
import { useTransition } from '../../composable/use-transition';
export default defineComponent({
    name: 'v-badge',
    props: {
        dot: Boolean,
        avatar: Boolean,
        border: Boolean,
        toggle: Boolean,
        content: {
            required: false,
        },
        color: {
            type: String,
            default: 'primary',
        },
        transition: {
            type: String,
            default: 'scaleIn',
        },
        offsetY: {
            type: [String, Number],
            default: 0
        },
        offsetX: {
            type: [String, Number],
            default: 0
        },
        ...positionProps(),
        ...elevationProps(),
    },
    setup(props, { slots }) {
        const { elevationClasses } = useElevation(props);
        const { setBackgroundClassNameColor, setBackgroundCssColor } = useColors();
        const offset = computed(() => {
            return props.dot ? 4 : 12;
        });
        const calcPosition = (offsetVal = 0) => {
            const value = offset.value - Number(offsetVal);
            return `${value}px`;
        };
        const computedLeft = computed(() => {
            return props.left && calcPosition(props.offsetX);
        });
        const computedRight = computed(() => {
            return props.right && calcPosition(props.offsetX);
        });
        const computedTop = computed(() => {
            return props.top && calcPosition(props.offsetY);
        });
        const computedBottom = computed(() => {
            return props.bottom && calcPosition(props.offsetY);
        });
        const classes = computed(() => ({
            'v-badge': true,
            'v-badge--border': props.border,
            'v-badge--dot': props.dot,
            'v-badge--avatar': props.avatar,
        }));
        const badgeClasses = computed(() => ({
            'v-badge__badge': true,
            ...elevationClasses.value,
            ...(props.color ? setBackgroundClassNameColor(props.color) : {}),
        }));
        const styles = computed(() => ({
            top: computedTop.value,
            right: computedRight.value,
            bottom: computedBottom.value,
            left: computedLeft.value,
            ...(props.color ? setBackgroundCssColor(props.color) : {}),
        }));
        function addContent() {
            if (props.dot)
                return undefined;
            if (props.content)
                return String(props.content);
            return undefined;
        }
        function genBadgeSlot() {
            const propsData = {
                class: {
                    'v-badge__badge-slot': true,
                },
            };
            return slots.badge ? h('div', propsData, slots.badge()) : null;
        }
        function genContent() {
            const propsData = {
                class: {
                    'v-badge__content': true,
                },
            };
            return h('div', propsData, [addContent(), genBadgeSlot()]);
        }
        function genBadge() {
            return h('div', {
                class: badgeClasses.value,
                style: styles.value,
            }, genContent());
        }
        return () => {
            let badge = genBadge();
            if (props.toggle && !slots.badge) {
                const { isActive } = useToggle(props, 'content');
                badge = withDirectives(badge, [[vShow, isActive.value]]);
            }
            const propsData = {
                class: classes.value,
            };
            const children = [
                useTransition(badge, props.transition),
                slots.default && slots.default(),
            ];
            return h('div', propsData, children);
        };
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkJhZGdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVkJhZGdlL1ZCYWRnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsY0FBYyxFQUFFLGVBQWUsRUFBRSxNQUFNLEtBQUssQ0FBQTtBQUd6RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sK0JBQStCLENBQUE7QUFDN0QsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDZCQUE2QixDQUFBO0FBQ3ZELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUN2RCxPQUFPLEVBQUUsWUFBWSxFQUFFLGNBQWMsRUFBRSxNQUFNLGdDQUFnQyxDQUFBO0FBQzdFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQTtBQUsvRCxlQUFlLGVBQWUsQ0FBQztJQUM3QixJQUFJLEVBQUUsU0FBUztJQUVmLEtBQUssRUFBRTtRQUNMLEdBQUcsRUFBRSxPQUFPO1FBQ1osTUFBTSxFQUFFLE9BQU87UUFDZixNQUFNLEVBQUUsT0FBTztRQUNmLE1BQU0sRUFBRSxPQUFPO1FBQ2YsT0FBTyxFQUFFO1lBQ1AsUUFBUSxFQUFFLEtBQUs7U0FDaEI7UUFDRCxLQUFLLEVBQUU7WUFDTCxJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxTQUFTO1NBQ25CO1FBQ0QsVUFBVSxFQUFFO1lBQ1YsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsU0FBUztTQUNuQjtRQUNELE9BQU8sRUFBRTtZQUNQLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7WUFDdEIsT0FBTyxFQUFFLENBQUM7U0FDWDtRQUNELE9BQU8sRUFBRTtZQUNQLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7WUFDdEIsT0FBTyxFQUFFLENBQUM7U0FDWDtRQUNE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LENBQUMsQ0FBQyxDQUFBO2FBQ3pEO1lBRUQsTUFBTSxTQUFTLEdBQUc7Z0JBQ2hCLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSzthQUNyQixDQUFBO1lBRUQsTUFBTSxRQUFRLEdBQUc7Z0JBQ2YsYUFBYSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDO2dCQUN0QyxLQUFLLENBQUMsT0FBTyxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUU7YUFDakMsQ0FBQTtZQUVELE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsUUFBUSxDQUFDLENBQUE7UUFDdEMsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7IHZTaG93LCBoLCBjb21wdXRlZCwgd2l0aERpcmVjdGl2ZXMsIGRlZmluZUNvbXBvbmVudCB9IGZyb20gJ3Z1ZSdcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgcG9zaXRpb25Qcm9wcyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLXBvc2l0aW9uJ1xuaW1wb3J0IHsgdXNlQ29sb3JzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtY29sb3JzJ1xuaW1wb3J0IHsgdXNlVG9nZ2xlIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtdG9nZ2xlJ1xuaW1wb3J0IHsgdXNlRWxldmF0aW9uLCBlbGV2YXRpb25Qcm9wcyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLWVsZXZhdGlvbidcbmltcG9ydCB7IHVzZVRyYW5zaXRpb24gfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS10cmFuc2l0aW9uJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5cbmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LWJhZGdlJyxcblxuICBwcm9wczoge1xuICAgIGRvdDogQm9vbGVhbixcbiAgICBhdmF0YXI6IEJvb2xlYW4sXG4gICAgYm9yZGVyOiBCb29sZWFuLFxuICAgIHRvZ2dsZTogQm9vbGVhbixcbiAgICBjb250ZW50OiB7XG4gICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgfSxcbiAgICBjb2xvcjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ3ByaW1hcnknLFxuICAgIH0sXG4gICAgdHJhbnNpdGlvbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ3NjYWxlSW4nLFxuICAgIH0sXG4gICAgb2Zmc2V0WToge1xuICAgICAgdHlwZTogW1N0cmluZywgTnVtYmVyXSxcbiAgICAgIGRlZmF1bHQ6IDBcbiAgICB9LFxuICAgIG9mZnNldFg6IHtcbiAgICAgIHR5cGU6IFtTdHJpbmcsIE51bWJlcl0sXG4gICAgICBkZWZhdWx0OiAwXG4gICAgfSxcbiAgICAuLi5wb3NpdGlvblByb3BzKCksXG4gICAgLi4uZWxldmF0aW9uUHJvcHMoKSxcbiAgfSBhcyBhbnksXG5cbiAgc2V0dXAocHJvcHMsIHsgc2xvdHMgfSk6ICgpID0+IFZOb2RlIHtcbiAgICBjb25zdCB7IGVsZXZhdGlvbkNsYXNzZXMgfSA9IHVzZUVsZXZhdGlvbihwcm9wcylcbiAgICBjb25zdCB7IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvciwgc2V0QmFja2dyb3VuZENzc0NvbG9yIH0gPSB1c2VDb2xvcnMoKVxuXG4gICAgY29uc3Qgb2Zmc2V0ID0gY29tcHV0ZWQ8bnVtYmVyPigoKSA9PiB7XG4gICAgICByZXR1cm4gcHJvcHMuZG90ID8gNCA6IDEyXG4gICAgfSlcblxuICAgIGNvbnN0IGNhbGNQb3NpdGlvbiA9IChvZmZzZXRWYWw6IHN0cmluZyB8IG51bWJlciA9IDApOiBzdHJpbmcgPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSBvZmZzZXQudmFsdWUgLSBOdW1iZXIob2Zmc2V0VmFsKVxuICAgICAgcmV0dXJuIGAke3ZhbHVlfXB4YFxuICAgIH1cblxuICAgIGNvbnN0IGNvbXB1dGVkTGVmdCA9IGNvbXB1dGVkPHN0cmluZyB8IGJvb2xlYW4+KCgpID0+IHtcbiAgICAgIHJldHVybiBwcm9wcy5sZWZ0ICYmIGNhbGNQb3NpdGlvbihwcm9wcy5vZmZzZXRYKVxuICAgIH0pXG5cbiAgICBjb25zdCBjb21wdXRlZFJpZ2h0ID0gY29tcHV0ZWQ8c3RyaW5nIHwgYm9vbGVhbj4oKCkgPT4ge1xuICAgICAgcmV0dXJuIHByb3BzLnJpZ2h0ICYmIGNhbGNQb3NpdGlvbihwcm9wcy5vZmZzZXRYKVxuICAgIH0pXG5cbiAgICBjb25zdCBjb21wdXRlZFRvcCA9IGNvbXB1dGVkPHN0cmluZyB8IGJvb2xlYW4+KCgpID0+IHtcbiAgICAgIHJldHVybiBwcm9wcy50b3AgJiYgY2FsY1Bvc2l0aW9uKHByb3BzLm9mZnNldFkpXG4gICAgfSlcblxuICAgIGNvbnN0IGNvbXB1dGVkQm90dG9tID0gY29tcHV0ZWQ8c3RyaW5nIHwgYm9vbGVhbj4oKCkgPT4ge1xuICAgICAgcmV0dXJuIHByb3BzLmJvdHRvbSAmJiBjYWxjUG9zaXRpb24ocHJvcHMub2Zmc2V0WSlcbiAgICB9KVxuXG4gICAgY29uc3QgY2xhc3NlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+PigoKSA9PiAoe1xuICAgICAgJ3YtYmFkZ2UnOiB0cnVlLFxuICAgICAgJ3YtYmFkZ2UtLWJvcmRlcic6IHByb3BzLmJvcmRlcixcbiAgICAgICd2LWJhZGdlLS1kb3QnOiBwcm9wcy5kb3QsXG4gICAgICAndi1iYWRnZS0tYXZhdGFyJzogcHJvcHMuYXZhdGFyLFxuICAgIH0pKVxuXG4gICAgY29uc3QgYmFkZ2VDbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+ICh7XG4gICAgICAndi1iYWRnZV9fYmFkZ2UnOiB0cnVlLFxuICAgICAgLi4uZWxldmF0aW9uQ2xhc3Nlcy52YWx1ZSxcbiAgICAgIC4uLihwcm9wcy5jb2xvciA/IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcihwcm9wcy5jb2xvcikgOiB7fSksXG4gICAgfSkpXG5cbiAgICBjb25zdCBzdHlsZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBzdHJpbmcgfCBib29sZWFuPj4oKCkgPT4gKHtcbiAgICAgIHRvcDogY29tcHV0ZWRUb3AudmFsdWUsXG4gICAgICByaWdodDogY29tcHV0ZWRSaWdodC52YWx1ZSxcbiAgICAgIGJvdHRvbTogY29tcHV0ZWRCb3R0b20udmFsdWUsXG4gICAgICBsZWZ0OiBjb21wdXRlZExlZnQudmFsdWUsXG4gICAgICAuLi4ocHJvcHMuY29sb3IgPyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgIH0pKVxuXG4gICAgZnVuY3Rpb24gYWRkQ29udGVudCgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgICAgaWYgKHByb3BzLmRvdCkgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgaWYgKHByb3BzLmNvbnRlbnQpIHJldHVybiBTdHJpbmcocHJvcHMuY29udGVudClcblxuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlbkJhZGdlU2xvdCgpOiBWTm9kZSB8IG51bGwge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczoge1xuICAgICAgICAgICd2LWJhZGdlX19iYWRnZS1zbG90JzogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHNsb3RzLmJhZGdlID8gaCgnZGl2JywgcHJvcHNEYXRhLCBzbG90cy5iYWRnZSgpKSA6IG51bGxcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5Db250ZW50KCk6IFZOb2RlIHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1iYWRnZV9fY29udGVudCc6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCBwcm9wc0RhdGEsIFthZGRDb250ZW50KCksIGdlbkJhZGdlU2xvdCgpXSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5CYWRnZSgpOiBWTm9kZSB7XG4gICAgICByZXR1cm4gaChcbiAgICAgICAgJ2RpdicsXG4gICAgICAgIHtcbiAgICAgICAgICBjbGFzczogYmFkZ2VDbGFzc2VzLnZhbHVlLFxuICAgICAgICAgIHN0eWxlOiBzdHlsZXMudmFsdWUsXG4gICAgICAgIH0sXG4gICAgICAgIGdlbkNvbnRlbnQoKVxuICAgICAgKVxuICAgIH1cblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBsZXQgYmFkZ2UgPSBnZW5CYWRnZSgpXG5cbiAgICAgIGlmIChwcm9wcy50b2dnbGUgJiYgIXNsb3RzLmJhZGdlKSB7XG4gICAgICAgIGNvbnN0IHsgaXNBY3RpdmUgfSA9IHVzZVRvZ2dsZShwcm9wcywgJ2NvbnRlbnQnKVxuICAgICAgICBiYWRnZSA9IHdpdGhEaXJlY3RpdmVzKGJhZGdlLCBbW3ZTaG93LCBpc0FjdGl2ZS52YWx1ZV1dKVxuICAgICAgfVxuXG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiBjbGFzc2VzLnZhbHVlLFxuICAgICAgfVxuXG4gICAgICBjb25zdCBjaGlsZHJlbiA9IFtcbiAgICAgICAgdXNlVHJhbnNpdGlvbihiYWRnZSwgcHJvcHMudHJhbnNpdGlvbiksXG4gICAgICAgIHNsb3RzLmRlZmF1bHQgJiYgc2xvdHMuZGVmYXVsdCgpLFxuICAgICAgXVxuXG4gICAgICByZXR1cm4gaCgnZGl2JywgcHJvcHNEYXRhLCBjaGlsZHJlbilcbiAgICB9XG4gIH0sXG59KVxuIl19