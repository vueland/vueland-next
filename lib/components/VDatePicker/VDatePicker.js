import { computed, defineComponent, h, provide, reactive, ref } from 'vue';
import { useColors } from '../../composables/use-colors';
import { elevationProps, useElevation } from '../../composables/use-elevation';
import { useTransition } from '../../composables/use-transition';
import { VTextField } from '../VTextField';
import { VDatepickerHeader } from './VDatepickerHeader';
import { VDatePickerDates } from './VDatePickerDates';
import { VDatePickerYears } from './VDatePickerYears';
import { VDatePickerMonths } from './VDatePickerMonths';
import { VMenu } from '../VMenu';
import { parseDate } from './helpers';
import { addScopedSlot } from '../../helpers';
import { formatDate } from './utils';
import { locale } from '../../services/locale';
export default defineComponent({
    name: 'v-date-picker',
    props: {
        dark: Boolean,
        disabled: Boolean,
        clearable: Boolean,
        readonly: Boolean,
        typeable: Boolean,
        mondayFirst: Boolean,
        today: Boolean,
        useMls: Boolean,
        useUtc: Boolean,
        lang: {
            type: String,
            default: 'en',
        },
        label: String,
        prependIcon: String,
        format: {
            type: String,
            default: 'yyyy MM dd D',
        },
        rules: Array,
        value: [String, Date, Number],
        modelValue: [String, Date, Number],
        disabledDates: Object,
        highlighted: Object,
        contentColor: {
            type: String,
            default: 'primary',
        },
        color: {
            type: String,
            default: 'white',
        },
        ...elevationProps(),
    },
    emits: ['update:value', 'update:modelValue', 'selected'],
    setup(props, { emit, slots }) {
        const data = reactive({
            year: null,
            month: null,
            date: null,
            day: null,
            selected: null,
            tableMonth: null,
            tableYear: null,
            convertedDateString: null,
            isYears: false,
            isMonths: false,
            isDates: true,
            isActive: false,
        });
        const { setTextClassNameColor, setTextCssColor, setBackgroundClassNameColor, setBackgroundCssColor, } = useColors();
        const { elevationClasses } = useElevation(props);
        const localeMonths = locale[props.lang].monthsAbbr;
        const localeWeek = locale[props.lang].week;
        const contentColor = props.dark ? 'white' : props.contentColor;
        const handlers = ref({});
        const activator = ref(null);
        const closeConditional = ref(false);
        provide('handlers', handlers);
        const classes = computed(() => ({
            'v-date-picker': true,
            'v-date-picker--typeable': props.typeable,
            'v-date-picker--readonly': !props.typeable || props.readonly,
        }));
        const tableClasses = computed(() => ({
            'v-date-picker__table': true,
            ...elevationClasses.value,
            ...(props.color ? setBackgroundClassNameColor(props.color) : {}),
            ...(contentColor ? setTextClassNameColor(contentColor) : {}),
        }));
        const tableStyles = computed(() => ({
            ...(props.color ? setBackgroundCssColor(props.color) : {}),
            ...(contentColor ? setTextCssColor(contentColor) : {}),
        }));
        const headerValue = computed(() => {
            return data.isYears || data.isMonths
                ? `${data.tableYear}`
                : data.isDates
                    ? `${data.tableYear} ${localeMonths[data.tableMonth]}`
                    : '';
        });
        const displayDate = computed(() => {
            const { month, date, day } = data.selected;
            return `${localeMonths[month]} ${date} ${localeWeek[day]}`;
        });
        const computedValue = computed(() => {
            const { year, month, date } = data.selected;
            return new Date(year, month, date);
        });
        const setInitDate = () => {
            if (props.value)
                setParsedDate(props.value);
            else if (props.modelValue)
                setParsedDate(props.modelValue);
            else
                setParsedDate();
            if (props.today || props.value || props.modelValue) {
                data.convertedDateString = convertToFormat();
            }
        };
        const onTableChange = () => {
            if (data.isYears) {
                data.isYears = false;
                return (data.isMonths = true);
            }
            if (data.isMonths) {
                data.isMonths = false;
                return (data.isYears = true);
            }
            if (data.isDates) {
                data.isDates = false;
                return (data.isMonths = true);
            }
            return undefined;
        };
        const setDataDate = ({ year, month, date, day, }) => {
            data.tableMonth = month;
            data.tableYear = year;
            data.year = year;
            data.month = month;
            data.date = date;
            data.day = day;
        };
        const setParsedDate = (selectedDate = null) => {
            const dateForParsing = selectedDate || new Date();
            data.selected = parseDate(dateForParsing);
            !selectedDate && (data.selected.default = !selectedDate);
            setDataDate(data.selected);
        };
        const onYearUpdate = (year) => {
            data.tableYear = year;
            data.isMonths = true;
            data.isYears = false;
        };
        const onMonthUpdate = (month) => {
            data.tableMonth = month;
            data.isMonths = false;
            data.isYears = false;
            data.isDates = true;
        };
        const onDateUpdate = (date) => {
            if (!date)
                return;
            closeConditional.value = true;
            data.selected = date;
            data.tableMonth = date.month;
            data.tableYear = date.year;
            data.convertedDateString = convertToFormat();
            emit('update:value', computedValue.value);
            emit('update:modelValue', computedValue.value);
            emit('selected', computedValue.value);
            requestAnimationFrame(() => (closeConditional.value = false));
        };
        const onDateMonthUpdate = (dateObject) => {
            data.tableMonth = dateObject.month;
            if (dateObject.year)
                data.tableYear = dateObject.year;
        };
        const onDateInput = (date) => {
            onDateUpdate(stringToDate(date));
        };
        const stringToDate = (date) => {
            if (date.length === 10) {
                const dateArray = date.trim().split(/\W/);
                if (dateArray[0].length < 4) {
                    date = dateArray.reverse().join('.');
                }
                return parseDate(new Date(Date.parse(date)));
            }
            return null;
        };
        const convertToFormat = () => {
            if (!data.selected)
                return '';
            return formatDate(new Date(data.selected.year, data.selected.month, data.selected.date), props.format, locale[props.lang]);
        };
        const genDisplayValue = (value) => {
            const propsData = {
                class: 'v-date-picker__display-value',
            };
            return useTransition(h('span', propsData, value), 'scale-in-out', 'out-in');
        };
        const genDatepickerDisplayInner = () => {
            const propsData = {
                class: 'v-date-picker__display-inner',
            };
            return h('div', propsData, [
                genDisplayValue(data.selected?.year),
                genDisplayValue(displayDate.value),
            ]);
        };
        const genDatepickerDisplay = () => {
            const propsData = {
                class: {
                    'v-date-picker__display': true,
                    ...(contentColor ? setBackgroundClassNameColor(contentColor) : {}),
                    ...(props.color ? setTextClassNameColor(props.color) : {}),
                },
                style: {
                    ...(contentColor ? setBackgroundCssColor(contentColor) : {}),
                    ...(props.color ? setTextCssColor(props.color) : {}),
                },
            };
            return h('div', propsData, genDatepickerDisplayInner());
        };
        const genDatepickerHeader = () => {
            return h(VDatepickerHeader, {
                onNext: () => handlers.value.onNext(),
                onPrev: () => handlers.value.onPrev(),
                onTable: onTableChange,
            }, {
                default: () => headerValue.value,
            });
        };
        const genDatepickerYearsTable = () => {
            const propsData = {
                year: data.tableYear,
                ['onUpdate:year']: onYearUpdate,
            };
            return h(VDatePickerYears, propsData);
        };
        const genDatepickerMonthsTable = () => {
            return h(VDatePickerMonths, {
                lang: props.lang,
                month: data.tableMonth,
                year: data.tableYear,
                locale: localeMonths,
                ['onUpdate:month']: onMonthUpdate,
                ['onUpdate:year']: onYearUpdate,
            });
        };
        const genDatepickerDatesTable = () => {
            return h(VDatePickerDates, {
                locale: localeWeek,
                mondayFirst: props.mondayFirst,
                month: data.tableMonth,
                year: data.tableYear,
                value: data.selected,
                disabledDates: props.disabledDates,
                ['onUpdate:value']: onDateUpdate,
                ['onUpdate:month']: onDateMonthUpdate,
            }, {
                date: slots.date && addScopedSlot('date', slots),
            });
        };
        const genDatepickerBody = () => {
            const propsData = {
                class: {
                    'v-date-picker__body': true,
                },
            };
            return h('div', propsData, useTransition(((data.isYears && genDatepickerYearsTable()) ||
                (data.isMonths && genDatepickerMonthsTable()) ||
                (data.isDates && genDatepickerDatesTable())), 'slide-in-left', 'out-in'));
        };
        const genDatepickerInput = () => {
            return h(VTextField, {
                modelValue: data.convertedDateString,
                dark: props.dark,
                label: props.label,
                readonly: !props.typeable,
                disabled: props.disabled,
                prependIcon: props.prependIcon,
                rules: props.rules,
                clearable: props.clearable,
                ref: activator,
                onInput: onDateInput,
                onClear: () => {
                    data.convertedDateString = '';
                    emit('update:value', null);
                    emit('update:modelValue', null);
                    emit('selected', null);
                },
            });
        };
        const genDatepickerTable = () => {
            const propsData = {
                class: tableClasses.value,
                style: tableStyles.value,
            };
            return h('div', propsData, [
                genDatepickerDisplay(),
                genDatepickerHeader(),
                genDatepickerBody(),
            ]);
        };
        const genMenu = () => {
            return h(VMenu, {
                activator: activator.value,
                internalActivator: true,
                inputActivator: '.v-input__text-field',
                width: 'auto',
                maxHeight: 'auto',
                bottom: props.typeable,
                openOnClick: true,
                closeOnClick: closeConditional.value,
            }, {
                default: () => genDatepickerTable(),
            });
        };
        const genDatepicker = () => {
            const propsData = {
                class: classes.value,
            };
            return h('div', propsData, [
                genDatepickerInput(),
                activator.value && genMenu(),
            ]);
        };
        setInitDate();
        return () => genDatepicker();
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGVQaWNrZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy92dWVsYW5kL3NyYy9jb21wb25lbnRzL1ZEYXRlUGlja2VyL1ZEYXRlUGlja2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQUUsZUFBZSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxNQUFNLEtBQUssQ0FBQTtBQUcxRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sOEJBQThCLENBQUE7QUFDeEQsT0FBTyxFQUFFLGNBQWMsRUFBRSxZQUFZLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQTtBQUM5RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sa0NBQWtDLENBQUE7QUFHaEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQUMxQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQTtBQUN2RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUNyRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUNyRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQTtBQUN2RCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBR2hDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFDckMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQUc3QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sU0FBUyxDQUFBO0FBT3BDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQTtBQWlCOUMsZUFBZSxlQUFlLENBQUM7SUFDN0IsSUFBSSxFQUFFLGVBQWU7SUFDckIsS0FBSyxFQUFFO1FBQ0wsSUFBSSxFQUFFLE9B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LEVBQUUsS0FBSyxDQUFDLFFBQVE7Z0JBQ3RCLFdBQVcsRUFBRSxJQUFJO2dCQUNqQixZQUFZLEVBQUUsZ0JBQWdCLENBQUMsS0FBSzthQUNyQyxFQUNEO2dCQUNFLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxrQkFBa0IsRUFBRTthQUNwQyxDQUNGLENBQUE7UUFDSCxDQUFDLENBQUE7UUFFRCxNQUFNLGFBQWEsR0FBRyxHQUFVLEVBQUU7WUFDaEMsTUFBTSxTQUFTLEdBQUc7Z0JBQ2hCLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSzthQUNyQixDQUFBO1lBRUQsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRTtnQkFDekIsa0JBQWtCLEVBQUU7Z0JBQ3BCLFNBQVMsQ0FBQyxLQUFLLElBQUksT0FBTyxFQUFFO2FBQzdCLENBQUMsQ0FBQTtRQUNKLENBQUMsQ0FBQTtRQUVELFdBQVcsRUFBRSxDQUFBO1FBRWIsT0FBTyxHQUFHLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQTtJQUM5QixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVnVlIEFQSVxuaW1wb3J0IHsgY29tcHV0ZWQsIGRlZmluZUNvbXBvbmVudCwgaCwgcHJvdmlkZSwgcmVhY3RpdmUsIHJlZiB9IGZyb20gJ3Z1ZSdcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgdXNlQ29sb3JzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZXMvdXNlLWNvbG9ycydcbmltcG9ydCB7IGVsZXZhdGlvblByb3BzLCB1c2VFbGV2YXRpb24gfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlcy91c2UtZWxldmF0aW9uJ1xuaW1wb3J0IHsgdXNlVHJhbnNpdGlvbiB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGVzL3VzZS10cmFuc2l0aW9uJ1xuXG4vLyBDb21wb25lbnRzXG5pbXBvcnQgeyBWVGV4dEZpZWxkIH0gZnJvbSAnLi4vVlRleHRGaWVsZCdcbmltcG9ydCB7IFZEYXRlcGlja2VySGVhZGVyIH0gZnJvbSAnLi9WRGF0ZXBpY2tlckhlYWRlcidcbmltcG9ydCB7IFZEYXRlUGlja2VyRGF0ZXMgfSBmcm9tICcuL1ZEYXRlUGlja2VyRGF0ZXMnXG5pbXBvcnQgeyBWRGF0ZVBpY2tlclllYXJzIH0gZnJvbSAnLi9WRGF0ZVBpY2tlclllYXJzJ1xuaW1wb3J0IHsgVkRhdGVQaWNrZXJNb250aHMgfSBmcm9tICcuL1ZEYXRlUGlja2VyTW9udGhzJ1xuaW1wb3J0IHsgVk1lbnUgfSBmcm9tICcuLi9WTWVudSdcblxuLy8gSGVscGVyc1xuaW1wb3J0IHsgcGFyc2VEYXRlIH0gZnJvbSAnLi9oZWxwZXJzJ1xuaW1wb3J0IHsgYWRkU2NvcGVkU2xvdCB9IGZyb20gJy4uLy4uL2hlbHBlcnMnXG5cbi8vIFV0aWxzXG5pbXBvcnQgeyBmb3JtYXREYXRlIH0gZnJvbSAnLi91dGlscydcblxuLy8gVHlwZXNcbmltcG9ydCB7IFZOb2RlIH0gZnJvbSAndnVlJ1xuaW1wb3J0IHsgRGF0ZVBpY2tlckJ0bkhhbmRsZXJzLCBEYXRlUGlja2VyRGF0ZSB9IGZyb20gJy4uLy4uLy4uL3R5cGVzJ1xuXG4vLyBTZXJ2aWNlc1xuaW1wb3J0IHsgbG9jYWxlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvbG9jYWxlJ1xuXG50eXBlIERhdGVQaWNrZXJEYXRhID0ge1xuICB5ZWFyOiBudW1iZXIgfCBudWxsXG4gIG1vbnRoOiBudW1iZXIgfCBudWxsXG4gIGRhdGU6IG51bWJlciB8IG51bGxcbiAgZGF5OiBudW1iZXIgfCBudWxsXG4gIHNlbGVjdGVkOiBEYXRlUGlja2VyRGF0ZSB8IG51bGxcbiAgdGFibGVNb250aDogbnVtYmVyIHwgbnVsbFxuICB0YWJsZVllYXI6IG51bWJlciB8IG51bGxcbiAgY29udmVydGVkRGF0ZVN0cmluZzogc3RyaW5nIHwgbnVsbFxuICBpc1llYXJzOiBib29sZWFuXG4gIGlzTW9udGhzOiBib29sZWFuXG4gIGlzRGF0ZXM6IGJvb2xlYW5cbiAgaXNBY3RpdmU6IGJvb2xlYW5cbn1cblxuZXhwb3J0IGRlZmF1bHQgZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3YtZGF0ZS1waWNrZXInLFxuICBwcm9wczoge1xuICAgIGRhcms6IEJvb2xlYW4sXG4gICAgZGlzYWJsZWQ6IEJvb2xlYW4sXG4gICAgY2xlYXJhYmxlOiBCb29sZWFuLFxuICAgIHJlYWRvbmx5OiBCb29sZWFuLFxuICAgIHR5cGVhYmxlOiBCb29sZWFuLFxuICAgIG1vbmRheUZpcnN0OiBCb29sZWFuLFxuICAgIHRvZGF5OiBCb29sZWFuLFxuICAgIHVzZU1sczogQm9vbGVhbixcbiAgICB1c2VVdGM6IEJvb2xlYW4sXG4gICAgbGFuZzoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ2VuJyxcbiAgICB9LFxuICAgIGxhYmVsOiBTdHJpbmcsXG4gICAgcHJlcGVuZEljb246IFN0cmluZyxcbiAgICBmb3JtYXQ6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICd5eXl5IE1NIGRkIEQnLFxuICAgIH0sXG4gICAgcnVsZXM6IEFycmF5LFxuICAgIHZhbHVlOiBbU3RyaW5nLCBEYXRlLCBOdW1iZXJdLFxuICAgIG1vZGVsVmFsdWU6IFtTdHJpbmcsIERhdGUsIE51bWJlcl0sXG4gICAgZGlzYWJsZWREYXRlczogT2JqZWN0LFxuICAgIGhpZ2hsaWdodGVkOiBPYmplY3QsXG4gICAgY29udGVudENvbG9yOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAncHJpbWFyeScsXG4gICAgfSxcbiAgICBjb2xvcjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ3doaXRlJyxcbiAgICB9LFxuICAgIC4uLmVsZXZhdGlvblByb3BzKCksXG4gIH0gYXMgYW55LFxuXG4gIGVtaXRzOiBbJ3VwZGF0ZTp2YWx1ZScsICd1cGRhdGU6bW9kZWxWYWx1ZScsICdzZWxlY3RlZCddLFxuXG4gIHNldHVwKHByb3BzLCB7IGVtaXQsIHNsb3RzIH0pIHtcbiAgICBjb25zdCBkYXRhOiBEYXRlUGlja2VyRGF0YSA9IHJlYWN0aXZlKHtcbiAgICAgIHllYXI6IG51bGwsXG4gICAgICBtb250aDogbnVsbCxcbiAgICAgIGRhdGU6IG51bGwsXG4gICAgICBkYXk6IG51bGwsXG4gICAgICBzZWxlY3RlZDogbnVsbCxcbiAgICAgIHRhYmxlTW9udGg6IG51bGwsXG4gICAgICB0YWJsZVllYXI6IG51bGwsXG4gICAgICBjb252ZXJ0ZWREYXRlU3RyaW5nOiBudWxsLFxuICAgICAgaXNZZWFyczogZmFsc2UsXG4gICAgICBpc01vbnRoczogZmFsc2UsXG4gICAgICBpc0RhdGVzOiB0cnVlLFxuICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgIH0pXG5cbiAgICBjb25zdCB7XG4gICAgICBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IsXG4gICAgICBzZXRUZXh0Q3NzQ29sb3IsXG4gICAgICBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IsXG4gICAgICBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IsXG4gICAgfSA9IHVzZUNvbG9ycygpXG4gICAgY29uc3QgeyBlbGV2YXRpb25DbGFzc2VzIH0gPSB1c2VFbGV2YXRpb24ocHJvcHMpXG5cbiAgICBjb25zdCBsb2NhbGVNb250aHM6IHN0cmluZ1tdID0gbG9jYWxlW3Byb3BzLmxhbmddLm1vbnRoc0FiYnJcbiAgICBjb25zdCBsb2NhbGVXZWVrOiBzdHJpbmdbXSA9IGxvY2FsZVtwcm9wcy5sYW5nXS53ZWVrXG4gICAgY29uc3QgY29udGVudENvbG9yOiBzdHJpbmcgPSBwcm9wcy5kYXJrID8gJ3doaXRlJyA6IHByb3BzLmNvbnRlbnRDb2xvclxuXG4gICAgY29uc3QgaGFuZGxlcnMgPSByZWY8RGF0ZVBpY2tlckJ0bkhhbmRsZXJzPih7fSlcbiAgICBjb25zdCBhY3RpdmF0b3IgPSByZWY8TWF5YmU8Vk5vZGU+PihudWxsKVxuICAgIGNvbnN0IGNsb3NlQ29uZGl0aW9uYWwgPSByZWY8Ym9vbGVhbj4oZmFsc2UpXG5cbiAgICBwcm92aWRlKCdoYW5kbGVycycsIGhhbmRsZXJzKVxuXG4gICAgY29uc3QgY2xhc3NlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+PigoKSA9PiAoe1xuICAgICAgJ3YtZGF0ZS1waWNrZXInOiB0cnVlLFxuICAgICAgJ3YtZGF0ZS1waWNrZXItLXR5cGVhYmxlJzogcHJvcHMudHlwZWFibGUsXG4gICAgICAndi1kYXRlLXBpY2tlci0tcmVhZG9ubHknOiAhcHJvcHMudHlwZWFibGUgfHwgcHJvcHMucmVhZG9ubHksXG4gICAgfSkpXG5cbiAgICBjb25zdCB0YWJsZUNsYXNzZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBib29sZWFuPj4oKCkgPT4gKHtcbiAgICAgICd2LWRhdGUtcGlja2VyX190YWJsZSc6IHRydWUsXG4gICAgICAuLi5lbGV2YXRpb25DbGFzc2VzLnZhbHVlLFxuICAgICAgLi4uKHByb3BzLmNvbG9yID8gc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yKHByb3BzLmNvbG9yKSA6IHt9KSxcbiAgICAgIC4uLihjb250ZW50Q29sb3IgPyBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IoY29udGVudENvbG9yKSA6IHt9KSxcbiAgICB9KSlcblxuICAgIGNvbnN0IHRhYmxlU3R5bGVzID0gY29tcHV0ZWQoKCkgPT4gKHtcbiAgICAgIC4uLihwcm9wcy5jb2xvciA/IHNldEJhY2tncm91bmRDc3NDb2xvcihwcm9wcy5jb2xvcikgOiB7fSksXG4gICAgICAuLi4oY29udGVudENvbG9yID8gc2V0VGV4dENzc0NvbG9yKGNvbnRlbnRDb2xvcikgOiB7fSksXG4gICAgfSkpXG5cbiAgICBjb25zdCBoZWFkZXJWYWx1ZSA9IGNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuICAgICAgcmV0dXJuIGRhdGEuaXNZZWFycyB8fCBkYXRhLmlzTW9udGhzXG4gICAgICAgID8gYCR7IGRhdGEudGFibGVZZWFyIH1gXG4gICAgICAgIDogZGF0YS5pc0RhdGVzXG4gICAgICAgICAgPyBgJHsgZGF0YS50YWJsZVllYXIgfSAkeyBsb2NhbGVNb250aHNbZGF0YS50YWJsZU1vbnRoIV0gfWBcbiAgICAgICAgICA6ICcnXG4gICAgfSlcblxuICAgIGNvbnN0IGRpc3BsYXlEYXRlID0gY29tcHV0ZWQ8c3RyaW5nPigoKSA9PiB7XG4gICAgICBjb25zdCB7IG1vbnRoLCBkYXRlLCBkYXkgfSA9IGRhdGEuc2VsZWN0ZWQgYXMgRGF0ZVBpY2tlckRhdGVcbiAgICAgIHJldHVybiBgJHsgbG9jYWxlTW9udGhzW21vbnRoXSB9ICR7IGRhdGUgfSAkeyBsb2NhbGVXZWVrW2RheV0gfWBcbiAgICB9KVxuXG4gICAgY29uc3QgY29tcHV0ZWRWYWx1ZSA9IGNvbXB1dGVkPHN0cmluZyB8IG51bWJlciB8IERhdGU+KCgpID0+IHtcbiAgICAgIGNvbnN0IHsgeWVhciwgbW9udGgsIGRhdGUgfSA9IGRhdGEuc2VsZWN0ZWQgYXMgRGF0ZVBpY2tlckRhdGVcbiAgICAgIHJldHVybiBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgZGF0ZSBhcyBudW1iZXIpXG4gICAgfSlcblxuICAgIGNvbnN0IHNldEluaXREYXRlID0gKCkgPT4ge1xuICAgICAgaWYgKHByb3BzLnZhbHVlKSBzZXRQYXJzZWREYXRlKHByb3BzLnZhbHVlKVxuICAgICAgZWxzZSBpZiAocHJvcHMubW9kZWxWYWx1ZSkgc2V0UGFyc2VkRGF0ZShwcm9wcy5tb2RlbFZhbHVlKVxuICAgICAgZWxzZSBzZXRQYXJzZWREYXRlKClcblxuICAgICAgaWYgKHByb3BzLnRvZGF5IHx8IHByb3BzLnZhbHVlIHx8IHByb3BzLm1vZGVsVmFsdWUpIHtcbiAgICAgICAgZGF0YS5jb252ZXJ0ZWREYXRlU3RyaW5nID0gY29udmVydFRvRm9ybWF0KCkgYXMgc3RyaW5nXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3Qgb25UYWJsZUNoYW5nZSA9ICgpOiB1bmRlZmluZWQgfCBib29sZWFuID0+IHtcbiAgICAgIGlmIChkYXRhLmlzWWVhcnMpIHtcbiAgICAgICAgZGF0YS5pc1llYXJzID0gZmFsc2VcbiAgICAgICAgcmV0dXJuIChkYXRhLmlzTW9udGhzID0gdHJ1ZSlcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLmlzTW9udGhzKSB7XG4gICAgICAgIGRhdGEuaXNNb250aHMgPSBmYWxzZVxuICAgICAgICByZXR1cm4gKGRhdGEuaXNZZWFycyA9IHRydWUpXG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5pc0RhdGVzKSB7XG4gICAgICAgIGRhdGEuaXNEYXRlcyA9IGZhbHNlXG4gICAgICAgIHJldHVybiAoZGF0YS5pc01vbnRocyA9IHRydWUpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICB9XG5cbiAgICBjb25zdCBzZXREYXRhRGF0ZSA9IDxUIGV4dGVuZHMgRGF0ZVBpY2tlckRhdGU+KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeWVhcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9udGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH06IFQpID0+IHtcbiAgICAgIGRhdGEudGFibGVNb250aCA9IG1vbnRoXG4gICAgICBkYXRhLnRhYmxlWWVhciA9IHllYXJcblxuICAgICAgZGF0YS55ZWFyID0geWVhclxuICAgICAgZGF0YS5tb250aCA9IG1vbnRoXG4gICAgICBkYXRhLmRhdGUgPSBkYXRlXG4gICAgICBkYXRhLmRheSA9IGRheVxuICAgIH1cblxuICAgIGNvbnN0IHNldFBhcnNlZERhdGUgPSAoc2VsZWN0ZWREYXRlOiBzdHJpbmcgfCBudWxsID0gbnVsbCkgPT4ge1xuICAgICAgY29uc3QgZGF0ZUZvclBhcnNpbmcgPSBzZWxlY3RlZERhdGUgfHwgbmV3IERhdGUoKVxuXG4gICAgICBkYXRhLnNlbGVjdGVkID0gcGFyc2VEYXRlKGRhdGVGb3JQYXJzaW5nKVxuICAgICAgIXNlbGVjdGVkRGF0ZSAmJiAoZGF0YS5zZWxlY3RlZCEuZGVmYXVsdCA9ICFzZWxlY3RlZERhdGUpXG5cbiAgICAgIHNldERhdGFEYXRlKGRhdGEuc2VsZWN0ZWQhKVxuICAgIH1cblxuICAgIGNvbnN0IG9uWWVhclVwZGF0ZSA9ICh5ZWFyOiBudW1iZXIpID0+IHtcbiAgICAgIGRhdGEudGFibGVZZWFyID0geWVhclxuICAgICAgZGF0YS5pc01vbnRocyA9IHRydWVcbiAgICAgIGRhdGEuaXNZZWFycyA9IGZhbHNlXG4gICAgfVxuXG4gICAgY29uc3Qgb25Nb250aFVwZGF0ZSA9IChtb250aDogbnVtYmVyKSA9PiB7XG4gICAgICBkYXRhLnRhYmxlTW9udGggPSBtb250aFxuICAgICAgZGF0YS5pc01vbnRocyA9IGZhbHNlXG4gICAgICBkYXRhLmlzWWVhcnMgPSBmYWxzZVxuICAgICAgZGF0YS5pc0RhdGVzID0gdHJ1ZVxuICAgIH1cblxuICAgIGNvbnN0IG9uRGF0ZVVwZGF0ZSA9IChkYXRlOiBEYXRlUGlja2VyRGF0ZSkgPT4ge1xuICAgICAgaWYgKCFkYXRlKSByZXR1cm5cblxuICAgICAgY2xvc2VDb25kaXRpb25hbC52YWx1ZSA9IHRydWVcblxuICAgICAgZGF0YS5zZWxlY3RlZCA9IGRhdGVcbiAgICAgIGRhdGEudGFibGVNb250aCA9IGRhdGUubW9udGhcbiAgICAgIGRhdGEudGFibGVZZWFyID0gZGF0ZS55ZWFyXG5cbiAgICAgIGRhdGEuY29udmVydGVkRGF0ZVN0cmluZyA9IGNvbnZlcnRUb0Zvcm1hdCgpIGFzIHN0cmluZ1xuXG4gICAgICBlbWl0KCd1cGRhdGU6dmFsdWUnLCBjb21wdXRlZFZhbHVlLnZhbHVlKVxuICAgICAgZW1pdCgndXBkYXRlOm1vZGVsVmFsdWUnLCBjb21wdXRlZFZhbHVlLnZhbHVlKVxuICAgICAgZW1pdCgnc2VsZWN0ZWQnLCBjb21wdXRlZFZhbHVlLnZhbHVlKVxuXG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gKGNsb3NlQ29uZGl0aW9uYWwudmFsdWUgPSBmYWxzZSkpXG4gICAgfVxuXG4gICAgY29uc3Qgb25EYXRlTW9udGhVcGRhdGUgPSAoZGF0ZU9iamVjdCkgPT4ge1xuICAgICAgZGF0YS50YWJsZU1vbnRoID0gZGF0ZU9iamVjdC5tb250aFxuICAgICAgaWYgKGRhdGVPYmplY3QueWVhcikgZGF0YS50YWJsZVllYXIgPSBkYXRlT2JqZWN0LnllYXJcbiAgICB9XG5cbiAgICBjb25zdCBvbkRhdGVJbnB1dCA9IChkYXRlOiBzdHJpbmcpOiBhbnkgPT4ge1xuICAgICAgb25EYXRlVXBkYXRlKHN0cmluZ1RvRGF0ZShkYXRlKSEpXG4gICAgfVxuXG4gICAgY29uc3Qgc3RyaW5nVG9EYXRlID0gKGRhdGU6IHN0cmluZyk6IERhdGVQaWNrZXJEYXRlIHwgbnVsbCA9PiB7XG4gICAgICBpZiAoZGF0ZS5sZW5ndGggPT09IDEwKSB7XG4gICAgICAgIGNvbnN0IGRhdGVBcnJheSA9IGRhdGUudHJpbSgpLnNwbGl0KC9cXFcvKVxuXG4gICAgICAgIGlmIChkYXRlQXJyYXlbMF0ubGVuZ3RoIDwgNCkge1xuICAgICAgICAgIGRhdGUgPSBkYXRlQXJyYXkucmV2ZXJzZSgpLmpvaW4oJy4nKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHBhcnNlRGF0ZShuZXcgRGF0ZShEYXRlLnBhcnNlKGRhdGUpKSlcbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuXG4gICAgY29uc3QgY29udmVydFRvRm9ybWF0ID0gKCk6IHN0cmluZyA9PiB7XG4gICAgICBpZiAoIWRhdGEuc2VsZWN0ZWQpIHJldHVybiAnJ1xuICAgICAgcmV0dXJuIGZvcm1hdERhdGUoXG4gICAgICAgIG5ldyBEYXRlKFxuICAgICAgICAgIGRhdGEuc2VsZWN0ZWQhLnllYXIsXG4gICAgICAgICAgZGF0YS5zZWxlY3RlZCEubW9udGgsXG4gICAgICAgICAgZGF0YS5zZWxlY3RlZCEuZGF0ZSBhcyBudW1iZXIsXG4gICAgICAgICksXG4gICAgICAgIHByb3BzLmZvcm1hdCxcbiAgICAgICAgbG9jYWxlW3Byb3BzLmxhbmddLFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkRpc3BsYXlWYWx1ZSA9ICh2YWx1ZTogc3RyaW5nIHwgbnVtYmVyKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczogJ3YtZGF0ZS1waWNrZXJfX2Rpc3BsYXktdmFsdWUnLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdXNlVHJhbnNpdGlvbihcbiAgICAgICAgaCgnc3BhbicsIHByb3BzRGF0YSwgdmFsdWUpLFxuICAgICAgICAnc2NhbGUtaW4tb3V0JyxcbiAgICAgICAgJ291dC1pbicsXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuRGF0ZXBpY2tlckRpc3BsYXlJbm5lciA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiAndi1kYXRlLXBpY2tlcl9fZGlzcGxheS1pbm5lcicsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCBwcm9wc0RhdGEsIFtcbiAgICAgICAgZ2VuRGlzcGxheVZhbHVlKGRhdGEuc2VsZWN0ZWQ/LnllYXIgYXMgbnVtYmVyKSxcbiAgICAgICAgZ2VuRGlzcGxheVZhbHVlKGRpc3BsYXlEYXRlLnZhbHVlKSxcbiAgICAgIF0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuRGF0ZXBpY2tlckRpc3BsYXkgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczoge1xuICAgICAgICAgICd2LWRhdGUtcGlja2VyX19kaXNwbGF5JzogdHJ1ZSxcbiAgICAgICAgICAuLi4oY29udGVudENvbG9yID8gc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yKGNvbnRlbnRDb2xvcikgOiB7fSksXG4gICAgICAgICAgLi4uKHByb3BzLmNvbG9yID8gc2V0VGV4dENsYXNzTmFtZUNvbG9yKHByb3BzLmNvbG9yKSA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAuLi4oY29udGVudENvbG9yID8gc2V0QmFja2dyb3VuZENzc0NvbG9yKGNvbnRlbnRDb2xvcikgOiB7fSksXG4gICAgICAgICAgLi4uKHByb3BzLmNvbG9yID8gc2V0VGV4dENzc0NvbG9yKHByb3BzLmNvbG9yKSA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHByb3BzRGF0YSwgZ2VuRGF0ZXBpY2tlckRpc3BsYXlJbm5lcigpKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkRhdGVwaWNrZXJIZWFkZXIgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoXG4gICAgICAgIFZEYXRlcGlja2VySGVhZGVyLFxuICAgICAgICB7XG4gICAgICAgICAgb25OZXh0OiAoKSA9PiBoYW5kbGVycy52YWx1ZS5vbk5leHQhKCksXG4gICAgICAgICAgb25QcmV2OiAoKSA9PiBoYW5kbGVycy52YWx1ZS5vblByZXYhKCksXG4gICAgICAgICAgb25UYWJsZTogb25UYWJsZUNoYW5nZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRlZmF1bHQ6ICgpID0+IGhlYWRlclZhbHVlLnZhbHVlLFxuICAgICAgICB9LFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkRhdGVwaWNrZXJZZWFyc1RhYmxlID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgeWVhcjogZGF0YS50YWJsZVllYXIsXG4gICAgICAgIFsnb25VcGRhdGU6eWVhciddOiBvblllYXJVcGRhdGUsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKFZEYXRlUGlja2VyWWVhcnMsIHByb3BzRGF0YSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlcGlja2VyTW9udGhzVGFibGUgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoVkRhdGVQaWNrZXJNb250aHMsIHtcbiAgICAgICAgbGFuZzogcHJvcHMubGFuZyxcbiAgICAgICAgbW9udGg6IGRhdGEudGFibGVNb250aCxcbiAgICAgICAgeWVhcjogZGF0YS50YWJsZVllYXIsXG4gICAgICAgIGxvY2FsZTogbG9jYWxlTW9udGhzLFxuICAgICAgICBbJ29uVXBkYXRlOm1vbnRoJ106IG9uTW9udGhVcGRhdGUsXG4gICAgICAgIFsnb25VcGRhdGU6eWVhciddOiBvblllYXJVcGRhdGUsXG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkRhdGVwaWNrZXJEYXRlc1RhYmxlID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKFxuICAgICAgICBWRGF0ZVBpY2tlckRhdGVzLFxuICAgICAgICB7XG4gICAgICAgICAgbG9jYWxlOiBsb2NhbGVXZWVrLFxuICAgICAgICAgIG1vbmRheUZpcnN0OiBwcm9wcy5tb25kYXlGaXJzdCxcbiAgICAgICAgICBtb250aDogZGF0YS50YWJsZU1vbnRoLFxuICAgICAgICAgIHllYXI6IGRhdGEudGFibGVZZWFyLFxuICAgICAgICAgIHZhbHVlOiBkYXRhLnNlbGVjdGVkLFxuICAgICAgICAgIGRpc2FibGVkRGF0ZXM6IHByb3BzLmRpc2FibGVkRGF0ZXMsXG4gICAgICAgICAgWydvblVwZGF0ZTp2YWx1ZSddOiBvbkRhdGVVcGRhdGUsXG4gICAgICAgICAgWydvblVwZGF0ZTptb250aCddOiBvbkRhdGVNb250aFVwZGF0ZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRhdGU6IHNsb3RzLmRhdGUgJiYgYWRkU2NvcGVkU2xvdCgnZGF0ZScsIHNsb3RzKSxcbiAgICAgICAgfSxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlcGlja2VyQm9keSA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgJ3YtZGF0ZS1waWNrZXJfX2JvZHknOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChcbiAgICAgICAgJ2RpdicsXG4gICAgICAgIHByb3BzRGF0YSxcbiAgICAgICAgdXNlVHJhbnNpdGlvbihcbiAgICAgICAgICAoKGRhdGEuaXNZZWFycyAmJiBnZW5EYXRlcGlja2VyWWVhcnNUYWJsZSgpKSB8fFxuICAgICAgICAgICAgKGRhdGEuaXNNb250aHMgJiYgZ2VuRGF0ZXBpY2tlck1vbnRoc1RhYmxlKCkpIHx8XG4gICAgICAgICAgICAoZGF0YS5pc0RhdGVzICYmIGdlbkRhdGVwaWNrZXJEYXRlc1RhYmxlKCkpKSBhcyBWTm9kZSxcbiAgICAgICAgICAnc2xpZGUtaW4tbGVmdCcsXG4gICAgICAgICAgJ291dC1pbicsXG4gICAgICAgICksXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuRGF0ZXBpY2tlcklucHV0ID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKFZUZXh0RmllbGQsIHtcbiAgICAgICAgbW9kZWxWYWx1ZTogZGF0YS5jb252ZXJ0ZWREYXRlU3RyaW5nISxcbiAgICAgICAgZGFyazogcHJvcHMuZGFyayxcbiAgICAgICAgbGFiZWw6IHByb3BzLmxhYmVsLFxuICAgICAgICByZWFkb25seTogIXByb3BzLnR5cGVhYmxlLFxuICAgICAgICBkaXNhYmxlZDogcHJvcHMuZGlzYWJsZWQsXG4gICAgICAgIHByZXBlbmRJY29uOiBwcm9wcy5wcmVwZW5kSWNvbixcbiAgICAgICAgcnVsZXM6IHByb3BzLnJ1bGVzLFxuICAgICAgICBjbGVhcmFibGU6IHByb3BzLmNsZWFyYWJsZSxcbiAgICAgICAgcmVmOiBhY3RpdmF0b3IsXG4gICAgICAgIG9uSW5wdXQ6IG9uRGF0ZUlucHV0LFxuICAgICAgICBvbkNsZWFyOiAoKSA9PiB7XG4gICAgICAgICAgZGF0YS5jb252ZXJ0ZWREYXRlU3RyaW5nID0gJydcbiAgICAgICAgICBlbWl0KCd1cGRhdGU6dmFsdWUnLCBudWxsKVxuICAgICAgICAgIGVtaXQoJ3VwZGF0ZTptb2RlbFZhbHVlJywgbnVsbClcbiAgICAgICAgICBlbWl0KCdzZWxlY3RlZCcsIG51bGwpXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkRhdGVwaWNrZXJUYWJsZSA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiB0YWJsZUNsYXNzZXMudmFsdWUsXG4gICAgICAgIHN0eWxlOiB0YWJsZVN0eWxlcy52YWx1ZSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHByb3BzRGF0YSwgW1xuICAgICAgICBnZW5EYXRlcGlja2VyRGlzcGxheSgpLFxuICAgICAgICBnZW5EYXRlcGlja2VySGVhZGVyKCksXG4gICAgICAgIGdlbkRhdGVwaWNrZXJCb2R5KCksXG4gICAgICBdKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbk1lbnUgPSAoKSA9PiB7XG4gICAgICByZXR1cm4gaChcbiAgICAgICAgVk1lbnUsXG4gICAgICAgIHtcbiAgICAgICAgICBhY3RpdmF0b3I6IGFjdGl2YXRvci52YWx1ZSEsXG4gICAgICAgICAgaW50ZXJuYWxBY3RpdmF0b3I6IHRydWUsXG4gICAgICAgICAgaW5wdXRBY3RpdmF0b3I6ICcudi1pbnB1dF9fdGV4dC1maWVsZCcsXG4gICAgICAgICAgd2lkdGg6ICdhdXRvJyxcbiAgICAgICAgICBtYXhIZWlnaHQ6ICdhdXRvJyxcbiAgICAgICAgICBib3R0b206IHByb3BzLnR5cGVhYmxlLFxuICAgICAgICAgIG9wZW5PbkNsaWNrOiB0cnVlLFxuICAgICAgICAgIGNsb3NlT25DbGljazogY2xvc2VDb25kaXRpb25hbC52YWx1ZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRlZmF1bHQ6ICgpID0+IGdlbkRhdGVwaWNrZXJUYWJsZSgpLFxuICAgICAgICB9LFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkRhdGVwaWNrZXIgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczogY2xhc3Nlcy52YWx1ZSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHByb3BzRGF0YSwgW1xuICAgICAgICBnZW5EYXRlcGlja2VySW5wdXQoKSxcbiAgICAgICAgYWN0aXZhdG9yLnZhbHVlICYmIGdlbk1lbnUoKSxcbiAgICAgIF0pXG4gICAgfVxuXG4gICAgc2V0SW5pdERhdGUoKVxuXG4gICAgcmV0dXJuICgpID0+IGdlbkRhdGVwaWNrZXIoKVxuICB9LFxufSlcbiJdfQ==