import { h, ref, watch, defineComponent, inject, computed, onBeforeMount, onBeforeUnmount, } from 'vue';
import { useValidation } from '../../composable/use-validation';
import { useIcons } from '../../composable/use-icons';
import { VIcon } from '../VIcon';
import { VLabel } from '../VLabel';
import { warning } from '../../helpers';
export const VCheckbox = defineComponent({
    name: 'v-checkbox',
    props: {
        onIcon: {
            type: String,
        },
        offIcon: {
            type: String,
        },
        dark: Boolean,
        label: String,
        disabled: Boolean,
        validate: Boolean,
        modelValue: [Array, Boolean],
        value: {
            default: null,
        },
        color: {
            type: String,
            default: 'primary',
        },
    },
    emits: ['checked', 'update:modelValue'],
    setup(props, { emit }) {
        const isChecked = ref(false);
        const form = inject('form', null);
        const { validate } = useValidation(props);
        const { icons } = useIcons();
        const isArray = computed(() => Array.isArray(props.modelValue));
        const isValueSet = computed(() => props.value !== null);
        const classes = computed(() => ({
            'v-checkbox': true,
            'v-checkbox--disabled': props.disabled,
            'v-checkbox--checked': isChecked.value,
            'v-validatable': props.validate,
        }));
        watch(() => props.modelValue, () => {
            if (isArray.value) {
                if (isValueSet.value) {
                    isChecked.value = props.modelValue.includes(props.value);
                }
                else {
                    warning('v-checkbox: set the "value" prop');
                }
            }
            else {
                isChecked.value = !!props.modelValue;
            }
        }, { immediate: true });
        const validateValue = () => {
            return validate(isChecked.value);
        };
        const genLabel = () => {
            const propsData = {
                absolute: false,
                color: props.dark ? 'white' : '',
                disabled: props.disabled,
            };
            return h(VLabel, propsData, {
                default: () => props.label,
            });
        };
        const genLabelWrapper = () => {
            return h('div', {
                class: 'v-checkbox__label',
            }, genLabel());
        };
        const genIcon = () => {
            const onIcon = props.onIcon || icons.$checkOn;
            const offIcon = props.offIcon || icons.$checkOff;
            const icon = isChecked.value ? onIcon : offIcon;
            const propsData = {
                icon,
                color: props.color,
                disabled: props.disabled,
            };
            return h(VIcon, propsData);
        };
        const genCheckbox = () => {
            return h('div', {
                class: 'v-checkbox__square',
            }, genIcon());
        };
        const computeValue = () => {
            if (isArray.value) {
                let modelValue = [...props.modelValue];
                isChecked.value = !modelValue.includes(props.value);
                if (!isChecked.value) {
                    modelValue = modelValue.filter((it) => it !== props.value);
                }
                else {
                    modelValue.push(props.value);
                }
                return modelValue;
            }
            return (isChecked.value = !isChecked.value);
        };
        const onClick = () => {
            if (props.disabled)
                return;
            const value = computeValue();
            props.validate && validateValue();
            emit('update:modelValue', value);
            emit('checked', value);
        };
        onBeforeMount(() => {
            if (form)
                form.add(validateValue);
        });
        onBeforeUnmount(() => {
            form?.remove(validateValue);
        });
        return () => h('div', { class: classes.value, onClick }, [genCheckbox(), props.label && genLabelWrapper()]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkNoZWNrYm94LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVkNoZWNrYm94L1ZDaGVja2JveC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0wsQ0FBQyxFQUNELEdBQUcsRUFDSCxLQUFLLEVBQ0wsZUFBZSxFQUNmLE1BQU0sRUFDTixRQUFRLEVBQ1IsYUFBYSxFQUNiLGVBQWUsR0FDaEIsTUFBTSxLQUFLLENBQUE7QUFHWixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUNBQWlDLENBQUE7QUFDL0QsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDRCQUE0QixDQUFBO0FBR3JELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDaEMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQTtBQUdsQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sZUFBZSxDQUFBO0FBS3ZDLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxlQUFlLENBQUM7SUFDdkMsSUFBSSxFQUFFLFlBQVk7SUFDbEIsS0FBSyxFQUFFO1FBQ0wsTUFBTSxFQUFFO1lBQ04sSUFBSSxFQUFFLE1BQU07U0FDYjtRQUNELE9BQU8sRUFBRTtZQUNQLElBQUksRUFBRSxNQUFNO1NBQ2I7UUFDRCxJQUFJLEVBQUUsT0FBTztRQUNiLEtBQUssRUFBRSxNQUFNO1FBQ2IsUUFBUSxFQUFFLE9BQU87UUFDakIsUUFBUSxFQUFFLE9BQU87UUFDakIsVUFBVSxFQUFFLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQztRQUM1QixLQUFLLEVBQUU7WUFDTCxPQUFPLEVBQUUsSUFBSTtTQUNkO1FBQ0QsS0FBSyxFQUFFO1lBQ0wsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsU0FBUztTQUNuQjtLQUNLO0lBQ1IsS0FBSyxFQUFFLENBQUMsU0FBUyxFQUFFLG1CQUFtQixDQUFDO0lBQ3ZDLEtBQUssQ0FB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SUFBSSxDQUFDLG1CQUFtQixFQUFFLEtBQUssQ0FBQyxDQUFBO1lBQ2hDLElBQUksQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDeEIsQ0FBQyxDQUFBO1FBRUQsYUFBYSxDQUFDLEdBQUcsRUFBRTtZQUNqQixJQUFJLElBQUk7Z0JBQUUsSUFBSyxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQTtRQUNwQyxDQUFDLENBQUMsQ0FBQTtRQUVGLGVBQWUsQ0FBQyxHQUFHLEVBQUU7WUFDbkIsSUFBSSxFQUFFLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQTtRQUM3QixDQUFDLENBQUMsQ0FBQTtRQUVGLE9BQU8sR0FBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFDekIsRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsRUFDakMsQ0FBQyxXQUFXLEVBQUUsRUFBRSxLQUFLLENBQUMsS0FBSyxJQUFJLGVBQWUsRUFBRSxDQUFDLENBQ2xELENBQUE7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVnVlIEFQSVxuaW1wb3J0IHtcbiAgaCxcbiAgcmVmLFxuICB3YXRjaCxcbiAgZGVmaW5lQ29tcG9uZW50LFxuICBpbmplY3QsXG4gIGNvbXB1dGVkLFxuICBvbkJlZm9yZU1vdW50LFxuICBvbkJlZm9yZVVubW91bnQsXG59IGZyb20gJ3Z1ZSdcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgdXNlVmFsaWRhdGlvbiB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLXZhbGlkYXRpb24nXG5pbXBvcnQgeyB1c2VJY29ucyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLWljb25zJ1xuXG4vLyBDb21wb25lbnRzXG5pbXBvcnQgeyBWSWNvbiB9IGZyb20gJy4uL1ZJY29uJ1xuaW1wb3J0IHsgVkxhYmVsIH0gZnJvbSAnLi4vVkxhYmVsJ1xuXG4vLyBIZWxwZXJzXG5pbXBvcnQgeyB3YXJuaW5nIH0gZnJvbSAnLi4vLi4vaGVscGVycydcblxuLy8gVHlwZXNcbmltcG9ydCB7IFZOb2RlIH0gZnJvbSAndnVlJ1xuXG5leHBvcnQgY29uc3QgVkNoZWNrYm94ID0gZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3YtY2hlY2tib3gnLFxuICBwcm9wczoge1xuICAgIG9uSWNvbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgIH0sXG4gICAgb2ZmSWNvbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgIH0sXG4gICAgZGFyazogQm9vbGVhbixcbiAgICBsYWJlbDogU3RyaW5nLFxuICAgIGRpc2FibGVkOiBCb29sZWFuLFxuICAgIHZhbGlkYXRlOiBCb29sZWFuLFxuICAgIG1vZGVsVmFsdWU6IFtBcnJheSwgQm9vbGVhbl0sXG4gICAgdmFsdWU6IHtcbiAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgfSxcbiAgICBjb2xvcjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ3ByaW1hcnknLFxuICAgIH0sXG4gIH0gYXMgYW55LFxuICBlbWl0czogWydjaGVja2VkJywgJ3VwZGF0ZTptb2RlbFZhbHVlJ10sXG4gIHNldHVwKHByb3BzLCB7IGVtaXQgfSk6ICgpID0+IFZOb2RlIHtcbiAgICBjb25zdCBpc0NoZWNrZWQgPSByZWYoZmFsc2UpXG4gICAgY29uc3QgZm9ybTogYW55ID0gaW5qZWN0KCdmb3JtJywgbnVsbClcblxuICAgIGNvbnN0IHsgdmFsaWRhdGUgfSA9IHVzZVZhbGlkYXRpb24ocHJvcHMpXG4gICAgY29uc3QgeyBpY29ucyB9ID0gdXNlSWNvbnMoKVxuXG4gICAgY29uc3QgaXNBcnJheSA9IGNvbXB1dGVkPGJvb2xlYW4+KCgpID0+IEFycmF5LmlzQXJyYXkocHJvcHMubW9kZWxWYWx1ZSkpXG4gICAgY29uc3QgaXNWYWx1ZVNldCA9IGNvbXB1dGVkPGJvb2xlYW4+KCgpID0+IHByb3BzLnZhbHVlICE9PSBudWxsKVxuXG4gICAgY29uc3QgY2xhc3NlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+PigoKSA9PiAoe1xuICAgICAgJ3YtY2hlY2tib3gnOiB0cnVlLFxuICAgICAgJ3YtY2hlY2tib3gtLWRpc2FibGVkJzogcHJvcHMuZGlzYWJsZWQsXG4gICAgICAndi1jaGVja2JveC0tY2hlY2tlZCc6IGlzQ2hlY2tlZC52YWx1ZSxcbiAgICAgICd2LXZhbGlkYXRhYmxlJzogcHJvcHMudmFsaWRhdGUsXG4gICAgfSkpXG5cbiAgICB3YXRjaChcbiAgICAgICgpID0+IHByb3BzLm1vZGVsVmFsdWUsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIGlmIChpc0FycmF5LnZhbHVlKSB7XG4gICAgICAgICAgaWYgKGlzVmFsdWVTZXQudmFsdWUpIHtcbiAgICAgICAgICAgIGlzQ2hlY2tlZC52YWx1ZSA9IHByb3BzLm1vZGVsVmFsdWUuaW5jbHVkZXMocHJvcHMudmFsdWUpXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHdhcm5pbmcoJ3YtY2hlY2tib3g6IHNldCB0aGUgXCJ2YWx1ZVwiIHByb3AnKVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpc0NoZWNrZWQudmFsdWUgPSAhIXByb3BzLm1vZGVsVmFsdWVcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHsgaW1tZWRpYXRlOiB0cnVlIH0sXG4gICAgKVxuXG4gICAgY29uc3QgdmFsaWRhdGVWYWx1ZSA9ICgpOiBib29sZWFuIHwgdm9pZCA9PiB7XG4gICAgICByZXR1cm4gdmFsaWRhdGUoaXNDaGVja2VkLnZhbHVlKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkxhYmVsID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgYWJzb2x1dGU6IGZhbHNlLFxuICAgICAgICBjb2xvcjogcHJvcHMuZGFyayA/ICd3aGl0ZScgOiAnJyxcbiAgICAgICAgZGlzYWJsZWQ6IHByb3BzLmRpc2FibGVkLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWTGFiZWwsIHByb3BzRGF0YSwge1xuICAgICAgICBkZWZhdWx0OiAoKSA9PiBwcm9wcy5sYWJlbCxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuTGFiZWxXcmFwcGVyID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIGgoJ2RpdicsIHtcbiAgICAgICAgY2xhc3M6ICd2LWNoZWNrYm94X19sYWJlbCcsXG4gICAgICB9LCBnZW5MYWJlbCgpKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkljb24gPSAoKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3Qgb25JY29uID0gcHJvcHMub25JY29uIHx8IGljb25zLiRjaGVja09uXG4gICAgICBjb25zdCBvZmZJY29uID0gcHJvcHMub2ZmSWNvbiB8fCBpY29ucy4kY2hlY2tPZmZcbiAgICAgIGNvbnN0IGljb24gPSBpc0NoZWNrZWQudmFsdWUgPyBvbkljb24gOiBvZmZJY29uXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgaWNvbixcbiAgICAgICAgY29sb3I6IHByb3BzLmNvbG9yLFxuICAgICAgICBkaXNhYmxlZDogcHJvcHMuZGlzYWJsZWQsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKFZJY29uLCBwcm9wc0RhdGEpXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuQ2hlY2tib3ggPSAoKTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoJ2RpdicsIHtcbiAgICAgICAgY2xhc3M6ICd2LWNoZWNrYm94X19zcXVhcmUnLFxuICAgICAgfSwgZ2VuSWNvbigpKVxuICAgIH1cblxuICAgIGNvbnN0IGNvbXB1dGVWYWx1ZSA9ICgpOiBib29sZWFuIHwgYW55W10gPT4ge1xuICAgICAgaWYgKGlzQXJyYXkudmFsdWUpIHtcbiAgICAgICAgbGV0IG1vZGVsVmFsdWUgPSBbLi4ucHJvcHMubW9kZWxWYWx1ZV1cbiAgICAgICAgaXNDaGVja2VkLnZhbHVlID0gIW1vZGVsVmFsdWUuaW5jbHVkZXMocHJvcHMudmFsdWUpXG5cbiAgICAgICAgaWYgKCFpc0NoZWNrZWQudmFsdWUpIHtcbiAgICAgICAgICBtb2RlbFZhbHVlID0gbW9kZWxWYWx1ZS5maWx0ZXIoKGl0KSA9PiBpdCAhPT0gcHJvcHMudmFsdWUpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbW9kZWxWYWx1ZS5wdXNoKHByb3BzLnZhbHVlKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG1vZGVsVmFsdWVcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIChpc0NoZWNrZWQudmFsdWUgPSAhaXNDaGVja2VkLnZhbHVlKVxuICAgIH1cblxuICAgIGNvbnN0IG9uQ2xpY2sgPSAoKSA9PiB7XG4gICAgICBpZiAocHJvcHMuZGlzYWJsZWQpIHJldHVyblxuICAgICAgY29uc3QgdmFsdWUgPSBjb21wdXRlVmFsdWUoKVxuXG4gICAgICBwcm9wcy52YWxpZGF0ZSAmJiB2YWxpZGF0ZVZhbHVlKClcbiAgICAgIGVtaXQoJ3VwZGF0ZTptb2RlbFZhbHVlJywgdmFsdWUpXG4gICAgICBlbWl0KCdjaGVja2VkJywgdmFsdWUpXG4gICAgfVxuXG4gICAgb25CZWZvcmVNb3VudCgoKSA9PiB7XG4gICAgICBpZiAoZm9ybSkgZm9ybSEuYWRkKHZhbGlkYXRlVmFsdWUpXG4gICAgfSlcblxuICAgIG9uQmVmb3JlVW5tb3VudCgoKSA9PiB7XG4gICAgICBmb3JtPy5yZW1vdmUodmFsaWRhdGVWYWx1ZSlcbiAgICB9KVxuXG4gICAgcmV0dXJuICgpOiBWTm9kZSA9PiBoKCdkaXYnLFxuICAgICAgeyBjbGFzczogY2xhc3Nlcy52YWx1ZSwgb25DbGljayB9LFxuICAgICAgW2dlbkNoZWNrYm94KCksIHByb3BzLmxhYmVsICYmIGdlbkxhYmVsV3JhcHBlcigpXSxcbiAgICApXG4gIH0sXG59KVxuIl19