import { h, ref, watch, defineComponent, inject, toRaw, computed, onBeforeMount, onBeforeUnmount, } from 'vue';
import { useValidation } from '../../composables/use-validation';
import { useIcons } from '../../composables/use-icons';
import { colorProps } from '../../composables/use-colors';
import { VIcon } from '../VIcon';
import { VLabel } from '../VLabel';
import { sizes } from '../../services/sizes';
export default defineComponent({
    name: 'v-checkbox',
    props: {
        modelValue: {
            type: [Array, Boolean],
            default: null,
        },
        label: {
            type: String,
            default: '',
        },
        disabled: Boolean,
        validate: Boolean,
        value: {
            type: [Array, Object, String, Number],
            default: null,
        },
        ...colorProps(),
    },
    emits: ['change', 'update:modelValue'],
    setup(props, { emit }) {
        const isChecked = ref(false);
        const form = inject('form', null);
        const valuesMap = new Map();
        const { validate } = useValidation(props);
        const { icons } = useIcons();
        const classes = computed(() => ({
            'v-checkbox': true,
            'v-checkbox--disabled': props.disabled,
            'v-checkbox--checked': isChecked.value,
            'v-validatable': props.validate,
        }));
        watch(() => props.modelValue, to => {
            if (Array.isArray(to)) {
                valuesMap.clear();
                to.forEach(it => valuesMap.set(toRaw(it), toRaw(it)));
                isChecked.value = !!valuesMap.get(toRaw(props.value));
            }
            else {
                isChecked.value = !!props.modelValue;
            }
        }, { immediate: true });
        const validateValue = () => {
            return validate(isChecked.value);
        };
        const genLabel = () => {
            const propsData = {
                absolute: false,
                disabled: props.disabled,
            };
            return h(VLabel, propsData, { default: () => props.label });
        };
        const genLabelWrapper = () => {
            return h('div', { class: 'v-checkbox__label' }, genLabel());
        };
        const genIcon = () => {
            const icon = isChecked.value ? icons.$checkbox : icons.$box;
            const propsData = {
                icon,
                size: sizes.sm,
                color: props.color,
                disabled: props.disabled,
            };
            return h(VIcon, propsData);
        };
        const genCheckbox = () => {
            return h('div', { class: 'v-checkbox__square' }, genIcon());
        };
        const computeValue = () => {
            if (Array.isArray(props.modelValue)) {
                if (isChecked.value) {
                    valuesMap.delete(toRaw(props.value));
                }
                else {
                    valuesMap.set(toRaw(props.value), toRaw(props.value));
                }
                return Array.from(valuesMap.values());
            }
            return (isChecked.value = !isChecked.value);
        };
        const onClick = () => {
            if (props.disabled)
                return;
            const value = computeValue();
            props.validate && validateValue();
            emit('update:modelValue', value);
            emit('change', value);
        };
        onBeforeMount(() => {
            form?.add(validateValue);
        });
        onBeforeUnmount(() => {
            form?.remove(validateValue);
        });
        return () => h('div', { class: classes.value, onClick }, [genCheckbox(), props.label && genLabelWrapper()]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkNoZWNrYm94LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvdnVlbGFuZC9zcmMvY29tcG9uZW50cy9WQ2hlY2tib3gvVkNoZWNrYm94LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFDTCxDQUFDLEVBQ0QsR0FBRyxFQUNILEtBQUssRUFDTCxlQUFlLEVBQ2YsTUFBTSxFQUNOLEtBQUssRUFDTCxRQUFRLEVBQ1IsYUFBYSxFQUNiLGVBQWUsR0FDaEIsTUFBTSxLQUFLLENBQUE7QUFHWixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sa0NBQWtDLENBQUE7QUFDaEUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDZCQUE2QixDQUFBO0FBQ3RELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQTtBQUd6RCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ2hDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFHbEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHNCQUFzQixDQUFBO0FBVTVDLGVBQWUsZUFBZSxDQUFDO0lBQzdCLElBQUksRUFBRSxZQUFZO0lBQ2xCLEtBQUssRUFBRTtRQUNMLFVBQVUsRUFBRTtZQUNWLElBQUksRUFBRSxDQUFFLEtBQUssRUFBRSxPQUFPLENBQUU7WUFDeEIsT0FBTyxFQUFFLElBQUk7U0FDZDtRQUNELEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELFFBQVEsRUFBRSxPQUFPO1FBQ2pCLFFBQVEsRUFBRSxPQUFPO1FBQ2pCLEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxDQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBRTtZQUN2QyxPQUFPLEVBQUUsSUFBSTtTQUNkO1FBQ0QsR0FBRyxVQUFVLEVBQUU7S0FD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QUMsQ0FBQyxDQUFBO1FBRUYsZUFBZSxDQUFDLEdBQUcsRUFBRTtZQUNuQixJQUFJLEVBQUUsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFBO1FBQzdCLENBQUMsQ0FBQyxDQUFBO1FBRUYsT0FBTyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUNsQixFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxFQUNqQyxDQUFFLFdBQVcsRUFBRSxFQUFFLEtBQUssQ0FBQyxLQUFLLElBQUksZUFBZSxFQUFFLENBQUUsQ0FDcEQsQ0FBQTtJQUNILENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBWdWUgQVBJXG5pbXBvcnQge1xuICBoLFxuICByZWYsXG4gIHdhdGNoLFxuICBkZWZpbmVDb21wb25lbnQsXG4gIGluamVjdCxcbiAgdG9SYXcsXG4gIGNvbXB1dGVkLFxuICBvbkJlZm9yZU1vdW50LFxuICBvbkJlZm9yZVVubW91bnQsXG59IGZyb20gJ3Z1ZSdcblxuLy8gQ29tcG9zYWJsZXNcbmltcG9ydCB7IHVzZVZhbGlkYXRpb24gfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlcy91c2UtdmFsaWRhdGlvbidcbmltcG9ydCB7IHVzZUljb25zIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZXMvdXNlLWljb25zJ1xuaW1wb3J0IHsgY29sb3JQcm9wcyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGVzL3VzZS1jb2xvcnMnXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCB7IFZJY29uIH0gZnJvbSAnLi4vVkljb24nXG5pbXBvcnQgeyBWTGFiZWwgfSBmcm9tICcuLi9WTGFiZWwnXG5cbi8vIFNlcnZpY2VzXG5pbXBvcnQgeyBzaXplcyB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3NpemVzJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5cbnR5cGUgRm9ybSA9IHtcbiAgYWRkOiAoaXRlbSkgPT4gdm9pZFxuICByZW1vdmU6IChpdGVtKSA9PiB2b2lkXG59XG5cbmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LWNoZWNrYm94JyxcbiAgcHJvcHM6IHtcbiAgICBtb2RlbFZhbHVlOiB7XG4gICAgICB0eXBlOiBbIEFycmF5LCBCb29sZWFuIF0sXG4gICAgICBkZWZhdWx0OiBudWxsLFxuICAgIH0sXG4gICAgbGFiZWw6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcnLFxuICAgIH0sXG4gICAgZGlzYWJsZWQ6IEJvb2xlYW4sXG4gICAgdmFsaWRhdGU6IEJvb2xlYW4sXG4gICAgdmFsdWU6IHtcbiAgICAgIHR5cGU6IFsgQXJyYXksIE9iamVjdCwgU3RyaW5nLCBOdW1iZXIgXSxcbiAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgfSxcbiAgICAuLi5jb2xvclByb3BzKCksXG4gIH0sXG4gIGVtaXRzOiBbICdjaGFuZ2UnLCAndXBkYXRlOm1vZGVsVmFsdWUnIF0sXG4gIHNldHVwKHByb3BzLCB7IGVtaXQgfSk6ICgpID0+IFZOb2RlIHtcbiAgICBjb25zdCBpc0NoZWNrZWQgPSByZWYoZmFsc2UpXG4gICAgY29uc3QgZm9ybSA9IGluamVjdDxNYXliZTxGb3JtPj4oJ2Zvcm0nLCBudWxsKVxuICAgIGNvbnN0IHZhbHVlc01hcDogTWFwPGFueSwgYW55PiA9IG5ldyBNYXAoKVxuXG4gICAgY29uc3QgeyB2YWxpZGF0ZSB9ID0gdXNlVmFsaWRhdGlvbihwcm9wcylcbiAgICBjb25zdCB7IGljb25zIH0gPSB1c2VJY29ucygpXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+ICh7XG4gICAgICAndi1jaGVja2JveCc6IHRydWUsXG4gICAgICAndi1jaGVja2JveC0tZGlzYWJsZWQnOiBwcm9wcy5kaXNhYmxlZCxcbiAgICAgICd2LWNoZWNrYm94LS1jaGVja2VkJzogaXNDaGVja2VkLnZhbHVlLFxuICAgICAgJ3YtdmFsaWRhdGFibGUnOiBwcm9wcy52YWxpZGF0ZSxcbiAgICB9KSlcblxuICAgIHdhdGNoKCgpID0+IHByb3BzLm1vZGVsVmFsdWUsIHRvID0+IHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHRvKSkge1xuICAgICAgICB2YWx1ZXNNYXAuY2xlYXIoKVxuICAgICAgICB0by5mb3JFYWNoKGl0ID0+IHZhbHVlc01hcC5zZXQodG9SYXcoaXQpLCB0b1JhdyhpdCkpKVxuICAgICAgICBpc0NoZWNrZWQudmFsdWUgPSAhIXZhbHVlc01hcC5nZXQodG9SYXcocHJvcHMudmFsdWUpKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXNDaGVja2VkLnZhbHVlID0gISFwcm9wcy5tb2RlbFZhbHVlXG4gICAgICB9XG4gICAgfSwgeyBpbW1lZGlhdGU6IHRydWUgfSlcblxuICAgIGNvbnN0IHZhbGlkYXRlVmFsdWUgPSAoKTogYm9vbGVhbiB8IHZvaWQgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlKGlzQ2hlY2tlZC52YWx1ZSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5MYWJlbCA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGFic29sdXRlOiBmYWxzZSxcbiAgICAgICAgZGlzYWJsZWQ6IHByb3BzLmRpc2FibGVkLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWTGFiZWwsIHByb3BzRGF0YSwgeyBkZWZhdWx0OiAoKSA9PiBwcm9wcy5sYWJlbCB9KVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkxhYmVsV3JhcHBlciA9ICgpID0+IHtcbiAgICAgIHJldHVybiBoKCdkaXYnLCB7IGNsYXNzOiAndi1jaGVja2JveF9fbGFiZWwnIH0sIGdlbkxhYmVsKCkpXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuSWNvbiA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBpY29uID0gaXNDaGVja2VkLnZhbHVlID8gaWNvbnMuJGNoZWNrYm94IDogaWNvbnMuJGJveFxuXG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGljb24sXG4gICAgICAgIHNpemU6IHNpemVzLnNtLFxuICAgICAgICBjb2xvcjogcHJvcHMuY29sb3IsXG4gICAgICAgIGRpc2FibGVkOiBwcm9wcy5kaXNhYmxlZCxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoVkljb24sIHByb3BzRGF0YSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5DaGVja2JveCA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogJ3YtY2hlY2tib3hfX3NxdWFyZScgfSwgZ2VuSWNvbigpKVxuICAgIH1cblxuICAgIGNvbnN0IGNvbXB1dGVWYWx1ZSA9ICgpOiBhbnlbXSB8IGJvb2xlYW4gPT4ge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocHJvcHMubW9kZWxWYWx1ZSkpIHtcbiAgICAgICAgaWYgKGlzQ2hlY2tlZC52YWx1ZSkge1xuICAgICAgICAgIHZhbHVlc01hcC5kZWxldGUodG9SYXcocHJvcHMudmFsdWUpKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhbHVlc01hcC5zZXQodG9SYXcocHJvcHMudmFsdWUpLCB0b1Jhdyhwcm9wcy52YWx1ZSkpXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh2YWx1ZXNNYXAudmFsdWVzKCkpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoaXNDaGVja2VkLnZhbHVlID0gIWlzQ2hlY2tlZC52YWx1ZSlcbiAgICB9XG5cbiAgICBjb25zdCBvbkNsaWNrID0gKCkgPT4ge1xuICAgICAgaWYgKHByb3BzLmRpc2FibGVkKSByZXR1cm5cblxuICAgICAgY29uc3QgdmFsdWUgPSBjb21wdXRlVmFsdWUoKVxuXG4gICAgICBwcm9wcy52YWxpZGF0ZSAmJiB2YWxpZGF0ZVZhbHVlKClcbiAgICAgIGVtaXQoJ3VwZGF0ZTptb2RlbFZhbHVlJywgdmFsdWUpXG4gICAgICBlbWl0KCdjaGFuZ2UnLCB2YWx1ZSlcbiAgICB9XG5cbiAgICBvbkJlZm9yZU1vdW50KCgpID0+IHtcbiAgICAgIGZvcm0/LmFkZCh2YWxpZGF0ZVZhbHVlKVxuICAgIH0pXG5cbiAgICBvbkJlZm9yZVVubW91bnQoKCkgPT4ge1xuICAgICAgZm9ybT8ucmVtb3ZlKHZhbGlkYXRlVmFsdWUpXG4gICAgfSlcblxuICAgIHJldHVybiAoKSA9PiBoKCdkaXYnLFxuICAgICAgeyBjbGFzczogY2xhc3Nlcy52YWx1ZSwgb25DbGljayB9LFxuICAgICAgWyBnZW5DaGVja2JveCgpLCBwcm9wcy5sYWJlbCAmJiBnZW5MYWJlbFdyYXBwZXIoKSBdLFxuICAgIClcbiAgfSxcbn0pXG4iXX0=