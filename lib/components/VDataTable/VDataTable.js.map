{"version":3,"sources":["../../../../src/components/VDataTable/VDataTable.ts"],"names":[],"mappings":"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","sourcesContent":["// Styles\nimport './VDataTable.scss'\n\n// Vue API\nimport { h, watch, computed, defineComponent, reactive } from 'vue'\n\n// Effects\nimport { useColors } from '../../effects/use-colors'\n\n// Components\nimport { VDataTableHeader } from './VDataTableHeader'\nimport { VDataTableBody } from './VDataTableBody'\nimport { VDataTableFooter } from './VDataTableFooter'\n\n// Helpers\nimport { toComparableStringFormat } from './helpers'\n\n// Types\nimport { VNode } from 'vue'\nimport { Column, TableFilter } from '../../types'\n\ntype TableState = {\n  cols: Column[]\n  rows: { [key: string]: any }[]\n  checkedRows: { [key: string]: any }[]\n  rowsPerPage: number\n  page: number\n  isAllRowsChecked: boolean\n}\n\nexport const VDataTable = defineComponent({\n  name: 'v-data-table',\n  props: {\n    cols: {\n      type: Array,\n      default: () => [],\n    },\n    rows: {\n      type: Array,\n      default: () => [],\n    },\n    headerColor: String,\n    rowsOnTable: {\n      type: Array,\n      default: () => [10, 15, 20, 25],\n    },\n    dark: Boolean,\n    numbered: Boolean,\n    checkbox: Boolean,\n    stateOut: Boolean,\n    align: String,\n    color: {\n      type: String,\n      default: 'white',\n    },\n  } as any,\n\n  setup(props, { slots, emit }) {\n    const data = reactive<TableState>({\n      cols: [],\n      rows: [],\n      checkedRows: [],\n      rowsPerPage: 20,\n      page: 1,\n      isAllRowsChecked: false,\n    })\n    const filters = {}\n    const { setBackground } = useColors()\n\n    const classes = computed<Record<string, boolean>>(() => ({\n      'v-data-table': true,\n    }))\n\n    const pages = computed<number>(() => {\n      return Math.ceil(data.rows?.length / data.rowsPerPage)\n    })\n\n    watch(\n      () => props.cols,\n      to => (data.cols = to),\n      { immediate: true },\n    )\n\n    watch(\n      () => props.rows,\n      to => (data.rows = to),\n      { immediate: true },\n    )\n\n    function onCheckAll(value: boolean) {\n      data.isAllRowsChecked = value\n      data.rows.forEach(row => (row.checked = value))\n    }\n\n    function onCheck<T extends TableState['rows']>(rows: T) {\n      data.checkedRows = rows\n      emit('checked', data.checkedRows)\n    }\n\n    function onPrevTable(num: number) {\n      data.page = data.page > 1 ? data.page + num : data.page\n    }\n\n    function onNextTable(num: number) {\n      if (data.rows.length - data.page * data.rowsPerPage > 0) {\n        data.page += num\n      }\n    }\n\n    function onSort(col: Column) {\n      if (col.sorted) {\n        col.sorted = !col.sorted\n        return data.rows!.reverse()\n      }\n\n      data.cols.forEach(c => {\n        c.sorted = col.key === c.key\n      })\n\n      sortColumn(col)\n    }\n\n    function onFilter({ value, col }: TableFilter) {\n      if (!value && filters[col.key]) {\n        delete filters[col.key]\n      }\n\n      if (value) filters[col.key] = value\n\n      if (props.stateOut) emit('filter', filters)\n\n      if (!props.stateOut) {\n        if (!Object.keys(filters).length) {\n          return (data.rows = props.rows)\n        }\n        data.rows = filterRows(props.rows)\n      }\n\n      data.page = 1\n    }\n\n    function onSelectRowsCount(count: number) {\n      data.rowsPerPage = count\n    }\n\n    function sortColumn(col: Column): void {\n      data.rows!.sort((a, b) => {\n        if (col.format) {\n          return col.format(a) > col.format(b) ? 1 : -1\n        }\n\n        return (a[col.key] > b[col.key]) ? 1 : -1\n      })\n    }\n\n    function filterRows<T>(rows: T[]) {\n      const filterKeys = Object.keys(filters)\n\n      return rows.reduce((acc, row) => {\n        const rowResults: any[] = []\n\n        filterKeys.forEach(key => {\n          const { format } = data.cols.find(col => col.key === key) as Column\n          const value = format ? format(row) : row[key]\n\n          const rowKeyValue = toComparableStringFormat(value)\n          const filterValue = toComparableStringFormat(filters[key])\n\n          if (rowKeyValue.includes(filterValue)) {\n            rowResults.push(!!row[key])\n          }\n        })\n\n        if (\n          rowResults.length === filterKeys.length &&\n          rowResults.every(value => !!value)\n        ) {\n          acc.push(row)\n        }\n\n        return acc\n      }, [] as T[])\n    }\n\n    function genTableTools(): VNode {\n      return h('div', {\n          class: 'v-data-table__toolbar',\n        }, {\n          default: () => slots.toolbar && slots.toolbar(),\n        },\n      )\n    }\n\n    function genTableHeader(): VNode {\n      return h(VDataTableHeader, {\n        cols: data.cols,\n        color: props.headerColor || props.color,\n        checkbox: props.checkbox,\n        dark: props.dark,\n        align: props.align,\n        numbered: props.numbered,\n        onFilter,\n        onSort,\n        onCheckAll,\n      })\n    }\n\n    function genTableBody(): VNode {\n      return h(VDataTableBody, {\n          cols: data.cols,\n          rows: data.rows,\n          page: data.page,\n          rowsPerPage: data.rowsPerPage,\n          checkbox: props.checkbox,\n          checkAllRows: data.isAllRowsChecked,\n          align: props.align,\n          dark: props.dark,\n          color: props.color,\n          numbered: props.numbered,\n          onCheck,\n        },\n\n        props.cols.reduce((acc, col) => {\n          const slotContent = row => {\n            const scoped: any = { row }\n\n            if (col.format) {\n              scoped.format = col.format\n            }\n\n            return slots[col.key] && slots[col.key]!(scoped)\n          }\n\n          if (slots[col.key]) acc[col.key] = slotContent\n\n          return acc\n        }, {}),\n      )\n    }\n\n    function genTableFooter(): VNode {\n      return h(VDataTableFooter, {\n        pages: pages.value,\n        page: data.page,\n        counts: props.rowsOnTable,\n        tableRowsCount: data.rows?.length,\n        allRowsCount: props.rows.length,\n        rowsPerPage: data.rowsPerPage,\n        dark: props.dark,\n        color: props.color,\n        toolbar: props.toolbar,\n        onPrev: onPrevTable,\n        onNext: onNextTable,\n        onSelect: onSelectRowsCount,\n        onLastPage: val => emit('last-page', val),\n        onResetPage: val => (data.page += val),\n      })\n    }\n\n    function genTableInner(): VNode {\n      return h('div', {\n          class: {\n            'v-data-table__inner': true,\n          },\n        }, [\n          genTableHeader(),\n          genTableBody(),\n        ],\n      )\n    }\n\n    return () => {\n      const propsData = {\n        class: classes.value,\n      }\n\n      return h('div', setBackground(props.color, propsData), [\n        slots.toolbar && genTableTools(),\n        genTableInner(),\n        genTableFooter(),\n      ])\n    }\n  },\n})\n"],"sourceRoot":"","file":"VDataTable.js"}