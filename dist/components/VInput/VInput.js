import { defineComponent, h, watch, inject, computed, onBeforeMount, onBeforeUnmount, } from 'vue';
import { useValidation, validationProps } from '../../composable/use-validation';
import { useColors, colorProps } from '../../composable/use-colors';
import { useInputStates } from '../../composable/use-input-states';
import { useTransition } from '../../composable/use-transition';
import { VLabel } from '../VLabel';
import { VIcon } from '../VIcon';
export default defineComponent({
    name: 'v-input',
    components: {
        VLabel,
        VIcon,
    },
    inheritAttrs: false,
    props: {
        label: {
            type: String,
            default: '',
        },
        prependIcon: {
            type: String,
            default: '',
        },
        appendIcon: {
            type: String,
            default: '',
        },
        disabled: Boolean,
        focused: Boolean,
        readonly: Boolean,
        file: Boolean,
        hints: {
            type: Boolean,
            default: true,
        },
        hintMessage: {
            type: String,
            default: '',
        },
        textColor: {
            type: String,
            default: '',
        },
        ...validationProps(),
        ...colorProps(),
    },
    setup(props, { attrs, emit, slots }) {
        const { validate, errorState } = useValidation(props);
        const { setTextCssColor, setTextClassNameColor } = useColors();
        const { isDisabled, isReadonly } = useInputStates(props, { attrs, emit });
        const form = inject('form', null);
        const textClassColor = setTextClassNameColor(props.textColor);
        const textCssColor = setTextCssColor(props.textColor);
        const hasPrependIcon = computed(() => {
            return !!props.prependIcon || !!slots['prepend-icon'];
        });
        const hasAppendIcon = computed(() => {
            return !!props.appendIcon || !!slots['append-icon'];
        });
        const classes = computed(() => ({
            'v-input': true,
            'v-input--primary': !props.color,
            'v-input--focused': props.focused && !isReadonly.value,
            'v-input--disabled': isDisabled.value,
            'v-input--readonly': isReadonly.value,
            'v-input--file': props.file,
            'v-input--has-prepend-icon': hasPrependIcon.value,
            'v-input--has-append-icon': hasAppendIcon.value,
            'v-input--not-valid': !!errorState.innerError,
            ...(!props.disabled && !errorState.innerError
                ? setTextClassNameColor(props.color)
                : {}),
            ...attrs.class,
        }));
        const styles = computed(() => ({
            ...(!props.disabled && !errorState.innerError
                ? setTextCssColor(props.color)
                : {}),
            ...attrs.style,
        }));
        watch(() => props.focused, (to) => !to && validate());
        watch(() => props.value, () => validate());
        const genLabel = () => {
            const label = h(VLabel, {
                class: 'v-label--on-input',
                disabled: isDisabled.value,
                focused: props.focused,
                color: !errorState.innerError ? props.color : '',
            }, {
                default: () => props.label,
            });
            return h('div', { class: 'v-input__label' }, [label]);
        };
        const genIcon = (iconName, clickable = false) => {
            return h(VIcon, {
                icon: iconName,
                size: 16,
                disabled: props.disabled,
                clickable,
            });
        };
        const genPrependIcon = () => {
            let content;
            if (props.prependIcon) {
                content = genIcon(props.prependIcon);
            }
            else {
                content = slots['prepend-icon']?.();
            }
            return content ?
                h('div', { class: 'v-input__prepend-icon' }, content)
                : null;
        };
        const genAppendIcon = () => {
            let content;
            if (props.appendIcon) {
                content = genIcon(props.appendIcon);
            }
            else {
                content = slots['append-icon']?.();
            }
            return content ?
                h('div', { class: 'v-input__append-icon' }, content)
                : null;
        };
        const genTextFieldSlot = () => {
            const prependIconContent = genPrependIcon();
            const appendIconContent = genAppendIcon();
            const { disabled } = props;
            const textFieldContent = slots['text-field']?.({
                textCssColor,
                textClassColor,
                disabled,
            });
            return h('div', { class: 'v-input__text-field' }, [prependIconContent, textFieldContent, appendIconContent]);
        };
        const genHintMessage = () => {
            return !!errorState.innerErrorMessage ? h('span', { class: 'v-input__hints-message' }, [errorState.innerErrorMessage]) : null;
        };
        const genHints = () => {
            return h('div', { class: 'v-input__hints' }, useTransition(genHintMessage(), 'fade'));
        };
        const genSelectSlot = () => {
            return slots.select ?
                h('div', { class: 'v-input__selects' }, slots.select?.())
                : null;
        };
        onBeforeMount(() => {
            if (props.rules)
                form?.add(validate);
        });
        onBeforeUnmount(() => {
            form?.remove(validate);
        });
        return () => h('div', { class: classes.value, style: styles.value }, [
            genLabel(),
            genTextFieldSlot(),
            genHints(),
            genSelectSlot(),
        ]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVklucHV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVklucHV0L1ZJbnB1dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0wsZUFBZSxFQUNmLENBQUMsRUFDRCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFFBQVEsRUFDUixhQUFhLEVBQ2IsZUFBZSxHQUVoQixNQUFNLEtBQUssQ0FBQTtBQUdaLE9BQU8sRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFFLE1BQU0saUNBQWlDLENBQUE7QUFDaEYsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUNuRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sbUNBQW1DLENBQUE7QUFDbEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlDQUFpQyxDQUFBO0FBRy9ELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFDbEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQVNoQyxlQUFlLGVBQWUsQ0FBQztJQUM3QixJQUFJLEVBQUUsU0FBUztJQUNmLFVBQVUsRUFBRTtRQUNWLE1BQU07UUFDTixLQUFLO0tBQ047SUFDRCxZQUFZLEVBQUUsS0FBSztJQUNuQixLQUFLLEVBQUU7UUFDTCxLQUFLLEVBQUU7WUFDTCxJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxXQUFXLEVBQUU7WUFDWCxJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxVQUFVLEVBQUU7WUFDVixJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxRQUFRLEVBQUUsT0FBTztRQUNqQixPQUFPLEVBQUUsT0FBTztRQUNoQixRQUFRLEVBQUUsT0FBTztRQUNqQixJQUFJLEVBQUUsT0FBTztRQUNiLEtBQUssRUFBRTtZ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LEVBQUU7WUFDVixnQkFBZ0IsRUFBRTtZQUNsQixRQUFRLEVBQUU7WUFDVixhQUFhLEVBQUU7U0FDaEIsQ0FDRixDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7XG4gIGRlZmluZUNvbXBvbmVudCxcbiAgaCxcbiAgd2F0Y2gsXG4gIGluamVjdCxcbiAgY29tcHV0ZWQsXG4gIG9uQmVmb3JlTW91bnQsXG4gIG9uQmVmb3JlVW5tb3VudCxcbiAgVk5vZGUsXG59IGZyb20gJ3Z1ZSdcblxuLy8gQ29tcG9zYWJsZVxuaW1wb3J0IHsgdXNlVmFsaWRhdGlvbiwgdmFsaWRhdGlvblByb3BzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtdmFsaWRhdGlvbidcbmltcG9ydCB7IHVzZUNvbG9ycywgY29sb3JQcm9wcyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLWNvbG9ycydcbmltcG9ydCB7IHVzZUlucHV0U3RhdGVzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtaW5wdXQtc3RhdGVzJ1xuaW1wb3J0IHsgdXNlVHJhbnNpdGlvbiB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLXRyYW5zaXRpb24nXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCB7IFZMYWJlbCB9IGZyb20gJy4uL1ZMYWJlbCdcbmltcG9ydCB7IFZJY29uIH0gZnJvbSAnLi4vVkljb24nXG5cbmltcG9ydCB7IE1heWJlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvYmFzZSdcblxudHlwZSBGb3JtID0ge1xuICBhZGQ6IChpdGVtOiAodmFsPzogYW55KSA9PiBib29sZWFuIHwgdm9pZCkgPT4gdm9pZFxuICByZW1vdmU6IChpdGVtOiAodmFsPzogYW55KSA9PiBib29sZWFuIHwgdm9pZCkgPT4gdm9pZFxufVxuXG5leHBvcnQgZGVmYXVsdCBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAndi1pbnB1dCcsXG4gIGNvbXBvbmVudHM6IHtcbiAgICBWTGFiZWwsXG4gICAgVkljb24sXG4gIH0sXG4gIGluaGVyaXRBdHRyczogZmFsc2UsXG4gIHByb3BzOiB7XG4gICAgbGFiZWw6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcnLFxuICAgIH0sXG4gICAgcHJlcGVuZEljb246IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcnLFxuICAgIH0sXG4gICAgYXBwZW5kSWNvbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJycsXG4gICAgfSxcbiAgICBkaXNhYmxlZDogQm9vbGVhbixcbiAgICBmb2N1c2VkOiBCb29sZWFuLFxuICAgIHJlYWRvbmx5OiBCb29sZWFuLFxuICAgIGZpbGU6IEJvb2xlYW4sXG4gICAgaGludHM6IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiB0cnVlLFxuICAgIH0sXG4gICAgaGludE1lc3NhZ2U6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcnLFxuICAgIH0sXG4gICAgdGV4dENvbG9yOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJyxcbiAgICB9LFxuICAgIC4uLnZhbGlkYXRpb25Qcm9wcygpLFxuICAgIC4uLmNvbG9yUHJvcHMoKSxcbiAgfSxcblxuICBzZXR1cChwcm9wcywgeyBhdHRycywgZW1pdCwgc2xvdHMgfSkge1xuICAgIGNvbnN0IHsgdmFsaWRhdGUsIGVycm9yU3RhdGUgfSA9IHVzZVZhbGlkYXRpb24ocHJvcHMpXG4gICAgY29uc3QgeyBzZXRUZXh0Q3NzQ29sb3IsIHNldFRleHRDbGFzc05hbWVDb2xvciB9ID0gdXNlQ29sb3JzKClcbiAgICBjb25zdCB7IGlzRGlzYWJsZWQsIGlzUmVhZG9ubHkgfSA9IHVzZUlucHV0U3RhdGVzKHByb3BzLCB7IGF0dHJzLCBlbWl0IH0pXG5cbiAgICBjb25zdCBmb3JtOiBNYXliZTxGb3JtPiA9IGluamVjdCgnZm9ybScsIG51bGwgYXMgYW55KVxuXG4gICAgY29uc3QgdGV4dENsYXNzQ29sb3IgPSBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IocHJvcHMudGV4dENvbG9yKVxuICAgIGNvbnN0IHRleHRDc3NDb2xvciA9IHNldFRleHRDc3NDb2xvcihwcm9wcy50ZXh0Q29sb3IpXG5cbiAgICBjb25zdCBoYXNQcmVwZW5kSWNvbiA9IGNvbXB1dGVkPGJvb2xlYW4+KCgpID0+IHtcbiAgICAgIHJldHVybiAhIXByb3BzLnByZXBlbmRJY29uIHx8ICEhc2xvdHNbJ3ByZXBlbmQtaWNvbiddXG4gICAgfSlcblxuICAgIGNvbnN0IGhhc0FwcGVuZEljb24gPSBjb21wdXRlZDxib29sZWFuPigoKSA9PiB7XG4gICAgICByZXR1cm4gISFwcm9wcy5hcHBlbmRJY29uIHx8ICEhc2xvdHNbJ2FwcGVuZC1pY29uJ11cbiAgICB9KVxuXG4gICAgY29uc3QgY2xhc3NlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+PigoKSA9PiAoe1xuICAgICAgJ3YtaW5wdXQnOiB0cnVlLFxuICAgICAgJ3YtaW5wdXQtLXByaW1hcnknOiAhcHJvcHMuY29sb3IsXG4gICAgICAndi1pbnB1dC0tZm9jdXNlZCc6IHByb3BzLmZvY3VzZWQgJiYgIWlzUmVhZG9ubHkudmFsdWUsXG4gICAgICAndi1pbnB1dC0tZGlzYWJsZWQnOiBpc0Rpc2FibGVkLnZhbHVlLFxuICAgICAgJ3YtaW5wdXQtLXJlYWRvbmx5JzogaXNSZWFkb25seS52YWx1ZSxcbiAgICAgICd2LWlucHV0LS1maWxlJzogcHJvcHMuZmlsZSxcbiAgICAgICd2LWlucHV0LS1oYXMtcHJlcGVuZC1pY29uJzogaGFzUHJlcGVuZEljb24udmFsdWUsXG4gICAgICAndi1pbnB1dC0taGFzLWFwcGVuZC1pY29uJzogaGFzQXBwZW5kSWNvbi52YWx1ZSxcbiAgICAgICd2LWlucHV0LS1ub3QtdmFsaWQnOiAhIWVycm9yU3RhdGUuaW5uZXJFcnJvcixcbiAgICAgIC4uLighcHJvcHMuZGlzYWJsZWQgJiYgIWVycm9yU3RhdGUuaW5uZXJFcnJvclxuICAgICAgICA/IHNldFRleHRDbGFzc05hbWVDb2xvcihwcm9wcy5jb2xvcilcbiAgICAgICAgOiB7fSksXG4gICAgICAuLi4oYXR0cnMuY2xhc3MgYXMgb2JqZWN0KSxcbiAgICB9KSlcblxuICAgIGNvbnN0IHN0eWxlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIHN0cmluZz4+KCgpID0+ICh7XG4gICAgICAuLi4oIXByb3BzLmRpc2FibGVkICYmICFlcnJvclN0YXRlLmlubmVyRXJyb3JcbiAgICAgICAgPyBzZXRUZXh0Q3NzQ29sb3IocHJvcHMuY29sb3IpXG4gICAgICAgIDoge30pLFxuICAgICAgLi4uKGF0dHJzLnN0eWxlIGFzIG9iamVjdCksXG4gICAgfSkpXG5cbiAgICB3YXRjaChcbiAgICAgICgpID0+IHByb3BzLmZvY3VzZWQsXG4gICAgICAodG8pID0+ICF0byAmJiB2YWxpZGF0ZSgpLFxuICAgIClcblxuICAgIHdhdGNoKFxuICAgICAgKCkgPT4gcHJvcHMudmFsdWUsXG4gICAgICAoKSA9PiB2YWxpZGF0ZSgpLFxuICAgIClcblxuICAgIGNvbnN0IGdlbkxhYmVsID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IGxhYmVsID0gaChcbiAgICAgICAgVkxhYmVsLFxuICAgICAgICB7XG4gICAgICAgICAgY2xhc3M6ICd2LWxhYmVsLS1vbi1pbnB1dCcsXG4gICAgICAgICAgZGlzYWJsZWQ6IGlzRGlzYWJsZWQudmFsdWUsXG4gICAgICAgICAgZm9jdXNlZDogcHJvcHMuZm9jdXNlZCxcbiAgICAgICAgICBjb2xvcjogIWVycm9yU3RhdGUuaW5uZXJFcnJvciA/IHByb3BzLmNvbG9yIDogJycsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWZhdWx0OiAoKSA9PiBwcm9wcy5sYWJlbCxcbiAgICAgICAgfSxcbiAgICAgIClcblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWlucHV0X19sYWJlbCcgfSwgW2xhYmVsXSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5JY29uID0gKGljb25OYW1lLCBjbGlja2FibGUgPSBmYWxzZSk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKFZJY29uLCB7XG4gICAgICAgIGljb246IGljb25OYW1lLFxuICAgICAgICBzaXplOiAxNixcbiAgICAgICAgZGlzYWJsZWQ6IHByb3BzLmRpc2FibGVkLFxuICAgICAgICBjbGlja2FibGUsXG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGdlblByZXBlbmRJY29uID0gKCk6IE1heWJlPFZOb2RlPiA9PiB7XG4gICAgICBsZXQgY29udGVudFxuXG4gICAgICBpZiAocHJvcHMucHJlcGVuZEljb24pIHtcbiAgICAgICAgY29udGVudCA9IGdlbkljb24ocHJvcHMucHJlcGVuZEljb24pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250ZW50ID0gc2xvdHNbJ3ByZXBlbmQtaWNvbiddPy4oKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gY29udGVudCA/XG4gICAgICAgIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWlucHV0X19wcmVwZW5kLWljb24nIH0sIGNvbnRlbnQpXG4gICAgICAgIDogbnVsbFxuICAgIH1cblxuICAgIGNvbnN0IGdlbkFwcGVuZEljb24gPSAoKTogTWF5YmU8Vk5vZGU+ID0+IHtcbiAgICAgIGxldCBjb250ZW50XG5cbiAgICAgIGlmIChwcm9wcy5hcHBlbmRJY29uKSB7XG4gICAgICAgIGNvbnRlbnQgPSBnZW5JY29uKHByb3BzLmFwcGVuZEljb24pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250ZW50ID0gc2xvdHNbJ2FwcGVuZC1pY29uJ10/LigpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjb250ZW50ID9cbiAgICAgICAgaCgnZGl2JywgeyBjbGFzczogJ3YtaW5wdXRfX2FwcGVuZC1pY29uJyB9LCBjb250ZW50KVxuICAgICAgICA6IG51bGxcbiAgICB9XG5cbiAgICBjb25zdCBnZW5UZXh0RmllbGRTbG90ID0gKCkgPT4ge1xuICAgICAgY29uc3QgcHJlcGVuZEljb25Db250ZW50ID0gZ2VuUHJlcGVuZEljb24oKVxuICAgICAgY29uc3QgYXBwZW5kSWNvbkNvbnRlbnQgPSBnZW5BcHBlbmRJY29uKClcbiAgICAgIGNvbnN0IHsgZGlzYWJsZWQgfSA9IHByb3BzXG5cbiAgICAgIGNvbnN0IHRleHRGaWVsZENvbnRlbnQgPSBzbG90c1sndGV4dC1maWVsZCddPy4oe1xuICAgICAgICB0ZXh0Q3NzQ29sb3IsXG4gICAgICAgIHRleHRDbGFzc0NvbG9yLFxuICAgICAgICBkaXNhYmxlZCxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCB7IGNsYXNzOiAndi1pbnB1dF9fdGV4dC1maWVsZCcgfSxcbiAgICAgICAgW3ByZXBlbmRJY29uQ29udGVudCwgdGV4dEZpZWxkQ29udGVudCwgYXBwZW5kSWNvbkNvbnRlbnRdLFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkhpbnRNZXNzYWdlID0gKCk6IE1heWJlPFZOb2RlPiA9PiB7XG4gICAgICByZXR1cm4gISFlcnJvclN0YXRlLmlubmVyRXJyb3JNZXNzYWdlID8gaChcbiAgICAgICAgJ3NwYW4nLFxuICAgICAgICB7IGNsYXNzOiAndi1pbnB1dF9faGludHMtbWVzc2FnZScgfSxcbiAgICAgICAgW2Vycm9yU3RhdGUuaW5uZXJFcnJvck1lc3NhZ2VdLFxuICAgICAgKSA6IG51bGxcbiAgICB9XG5cbiAgICBjb25zdCBnZW5IaW50cyA9ICgpOiBNYXliZTxWTm9kZT4gPT4ge1xuICAgICAgcmV0dXJuIGgoXG4gICAgICAgICdkaXYnLFxuICAgICAgICB7IGNsYXNzOiAndi1pbnB1dF9faGludHMnIH0sXG4gICAgICAgIHVzZVRyYW5zaXRpb24oZ2VuSGludE1lc3NhZ2UoKSEsICdmYWRlJyksXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuU2VsZWN0U2xvdCA9ICgpOiBNYXliZTxWTm9kZT4gPT4ge1xuICAgICAgcmV0dXJuIHNsb3RzLnNlbGVjdCA/XG4gICAgICAgIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWlucHV0X19zZWxlY3RzJyB9LCBzbG90cy5zZWxlY3Q/LigpKVxuICAgICAgICA6IG51bGxcbiAgICB9XG5cbiAgICBvbkJlZm9yZU1vdW50KCgpID0+IHtcbiAgICAgIGlmIChwcm9wcy5ydWxlcykgZm9ybT8uYWRkKHZhbGlkYXRlKVxuICAgIH0pXG5cbiAgICBvbkJlZm9yZVVubW91bnQoKCkgPT4ge1xuICAgICAgZm9ybT8ucmVtb3ZlKHZhbGlkYXRlKVxuICAgIH0pXG5cbiAgICByZXR1cm4gKCkgPT4gaChcbiAgICAgICdkaXYnLFxuICAgICAgeyBjbGFzczogY2xhc3Nlcy52YWx1ZSwgc3R5bGU6IHN0eWxlcy52YWx1ZSB9LFxuICAgICAgW1xuICAgICAgICBnZW5MYWJlbCgpLFxuICAgICAgICBnZW5UZXh0RmllbGRTbG90KCksXG4gICAgICAgIGdlbkhpbnRzKCksXG4gICAgICAgIGdlblNlbGVjdFNsb3QoKSxcbiAgICAgIF0sXG4gICAgKVxuICB9LFxufSlcbiJdfQ==