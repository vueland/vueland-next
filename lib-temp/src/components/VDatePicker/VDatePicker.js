import { computed, defineComponent, h, provide, reactive, ref } from 'vue';
import { useColors } from '../../composable/use-colors';
import { elevationProps, useElevation } from '../../composable/use-elevation';
import { useTransition } from '../../composable/use-transition';
import { VTextField } from '../VTextField';
import { VDatepickerHeader } from './VDatepickerHeader';
import { VDatePickerDates } from './VDatePickerDates';
import { VDatePickerYears } from './VDatePickerYears';
import { VDatePickerMonths } from './VDatePickerMonths';
import { VMenu } from '../VMenu';
import { parseDate } from './helpers';
import { addScopedSlot } from '../../helpers';
import { formatDate } from './utils';
import { locale } from '../../services/locale';
export const VDatePicker = defineComponent({
    name: 'v-date-picker',
    props: {
        dark: Boolean,
        disabled: Boolean,
        clearable: Boolean,
        readonly: Boolean,
        typeable: Boolean,
        mondayFirst: Boolean,
        today: Boolean,
        useMls: Boolean,
        useUtc: Boolean,
        lang: {
            type: String,
            default: 'en',
        },
        label: String,
        prependIcon: String,
        format: {
            type: String,
            default: 'yyyy MM dd D',
        },
        rules: Array,
        value: [String, Date, Number],
        modelValue: [String, Date, Number],
        disabledDates: Object,
        highlighted: Object,
        contentColor: {
            type: String,
            default: 'primary',
        },
        color: {
            type: String,
            default: 'white',
        },
        ...elevationProps(),
    },
    emits: ['update:value', 'update:modelValue', 'selected'],
    setup(props, { emit, slots }) {
        const data = reactive({
            year: null,
            month: null,
            date: null,
            day: null,
            selected: null,
            tableMonth: null,
            tableYear: null,
            convertedDateString: null,
            isYears: false,
            isMonths: false,
            isDates: true,
            isActive: false,
        });
        const { setTextClassNameColor, setTextCssColor, setBackgroundClassNameColor, setBackgroundCssColor, } = useColors();
        const { elevationClasses } = useElevation(props);
        const localeMonths = locale[props.lang].monthsAbbr;
        const localeWeek = locale[props.lang].week;
        const contentColor = props.dark ? 'white' : props.contentColor;
        const handlers = ref({});
        const activator = ref(null);
        const closeConditional = ref(false);
        provide('handlers', handlers);
        const classes = computed(() => ({
            'v-date-picker': true,
            'v-date-picker--typeable': props.typeable,
            'v-date-picker--readonly': !props.typeable || props.readonly,
        }));
        const tableClasses = computed(() => ({
            'v-date-picker__table': true,
            ...elevationClasses.value,
            ...(props.color ? setBackgroundClassNameColor(props.color) : {}),
            ...(contentColor ? setTextClassNameColor(contentColor) : {}),
        }));
        const tableStyles = computed(() => ({
            ...(props.color ? setBackgroundCssColor(props.color) : {}),
            ...(contentColor ? setTextCssColor(contentColor) : {}),
        }));
        const headerValue = computed(() => {
            return data.isYears || data.isMonths
                ? `${data.tableYear}`
                : data.isDates
                    ? `${data.tableYear} ${localeMonths[data.tableMonth]}`
                    : '';
        });
        const displayDate = computed(() => {
            const { month, date, day } = data.selected;
            return `${localeMonths[month]} ${date} ${localeWeek[day]}`;
        });
        const computedValue = computed(() => {
            const { year, month, date } = data.selected;
            return new Date(year, month, date);
        });
        function setInitDate() {
            if (props.value)
                setParsedDate(props.value);
            else if (props.modelValue)
                setParsedDate(props.modelValue);
            else
                setParsedDate();
            if (props.today || props.value || props.modelValue) {
                data.convertedDateString = convertToFormat();
            }
        }
        function onTableChange() {
            if (data.isYears) {
                data.isYears = false;
                return (data.isMonths = true);
            }
            if (data.isMonths) {
                data.isMonths = false;
                return (data.isYears = true);
            }
            if (data.isDates) {
                data.isDates = false;
                return (data.isMonths = true);
            }
        }
        function setDataDate({ year, month, date, day, }) {
            data.tableMonth = month;
            data.tableYear = year;
            data.year = year;
            data.month = month;
            data.date = date;
            data.day = day;
        }
        function setParsedDate(selectedDate = null) {
            const dateForParsing = selectedDate || new Date();
            data.selected = parseDate(dateForParsing);
            !selectedDate && (data.selected.default = !selectedDate);
            setDataDate(data.selected);
        }
        function onYearUpdate(year) {
            data.tableYear = year;
            data.isMonths = true;
            data.isYears = false;
        }
        function onMonthUpdate(month) {
            data.tableMonth = month;
            data.isMonths = false;
            data.isYears = false;
            data.isDates = true;
        }
        function onDateUpdate(date) {
            if (!date)
                return;
            closeConditional.value = true;
            data.selected = date;
            data.tableMonth = date.month;
            data.tableYear = date.year;
            data.convertedDateString = convertToFormat();
            emit('update:value', computedValue.value);
            emit('update:modelValue', computedValue.value);
            emit('selected', computedValue.value);
            requestAnimationFrame(() => (closeConditional.value = false));
        }
        function onDateMonthUpdate(dateObject) {
            data.tableMonth = dateObject.month;
            if (dateObject.year)
                data.tableYear = dateObject.year;
        }
        function onDateInput(date) {
            onDateUpdate(stringToDate(date));
        }
        function stringToDate(date) {
            if (date.length === 10) {
                const dateArray = date.trim().split(/\W/);
                if (dateArray[0].length < 4) {
                    date = dateArray.reverse().join('.');
                }
                return parseDate(new Date(Date.parse(date)));
            }
            return null;
        }
        function convertToFormat() {
            if (!data.selected)
                return '';
            return formatDate(new Date(data.selected.year, data.selected.month, data.selected.date), props.format, locale[props.lang]);
        }
        function genDisplayValue(value) {
            const propsData = {
                class: 'v-date-picker__display-value',
            };
            return useTransition(h('span', propsData, value), 'scale-in-out', 'out-in');
        }
        function genDatepickerDisplayInner() {
            const propsData = {
                class: 'v-date-picker__display-inner',
            };
            return h('div', propsData, [
                genDisplayValue(data.selected?.year),
                genDisplayValue(displayDate.value),
            ]);
        }
        function genDatepickerDisplay() {
            const propsData = {
                class: {
                    'v-date-picker__display': true,
                    ...(contentColor ? setBackgroundClassNameColor(contentColor) : {}),
                    ...(props.color ? setTextClassNameColor(props.color) : {}),
                },
                style: {
                    ...(contentColor ? setBackgroundCssColor(contentColor) : {}),
                    ...(props.color ? setTextCssColor(props.color) : {}),
                },
            };
            return h('div', propsData, genDatepickerDisplayInner());
        }
        function genDatepickerHeader() {
            return h(VDatepickerHeader, {
                onNext: () => handlers.value.onNext(),
                onPrev: () => handlers.value.onPrev(),
                onTable: onTableChange,
            }, {
                default: () => headerValue.value,
            });
        }
        function genDatepickerYearsTable() {
            const propsData = {
                year: data.tableYear,
                ['onUpdate:year']: onYearUpdate,
            };
            return h(VDatePickerYears, propsData);
        }
        function genDatepickerMonthsTable() {
            return h(VDatePickerMonths, {
                lang: props.lang,
                month: data.tableMonth,
                year: data.tableYear,
                locale: localeMonths,
                ['onUpdate:month']: onMonthUpdate,
                ['onUpdate:year']: onYearUpdate,
            });
        }
        function genDatepickerDatesTable() {
            return h(VDatePickerDates, {
                locale: localeWeek,
                mondayFirst: props.mondayFirst,
                month: data.tableMonth,
                year: data.tableYear,
                value: data.selected,
                disabledDates: props.disabledDates,
                ['onUpdate:value']: onDateUpdate,
                ['onUpdate:month']: onDateMonthUpdate,
            }, {
                date: slots.date && addScopedSlot('date', slots),
            });
        }
        function genDatepickerBody() {
            const propsData = {
                class: {
                    'v-date-picker__body': true,
                },
            };
            return h('div', propsData, useTransition(((data.isYears && genDatepickerYearsTable()) ||
                (data.isMonths && genDatepickerMonthsTable()) ||
                (data.isDates && genDatepickerDatesTable())), 'slide-in-left', 'out-in'));
        }
        function genDatepickerInput() {
            return h(VTextField, {
                modelValue: data.convertedDateString,
                dark: props.dark,
                label: props.label,
                readonly: !props.typeable,
                disabled: props.disabled,
                prependIcon: props.prependIcon,
                rules: props.rules,
                clearable: props.clearable,
                ref: activator,
                onInput: onDateInput,
                onClear: () => {
                    data.convertedDateString = '';
                    emit('update:value', null);
                    emit('update:modelValue', null);
                    emit('selected', null);
                },
            });
        }
        function genDatepickerTable() {
            const propsData = {
                class: tableClasses.value,
                style: tableStyles.value,
            };
            return h('div', propsData, [
                genDatepickerDisplay(),
                genDatepickerHeader(),
                genDatepickerBody(),
            ]);
        }
        function genMenu() {
            return h(VMenu, {
                activator: activator.value,
                internalActivator: true,
                inputActivator: '.v-input__text-field',
                width: 'auto',
                maxHeight: 'auto',
                bottom: props.typeable,
                openOnClick: true,
                closeOnClick: closeConditional.value,
            }, {
                default: () => genDatepickerTable(),
            });
        }
        function genDatepicker() {
            const propsData = {
                class: classes.value,
            };
            return h('div', propsData, [
                genDatepickerInput(),
                activator.value && genMenu(),
            ]);
        }
        setInitDate();
        return () => genDatepicker();
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGVQaWNrZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WRGF0ZVBpY2tlci9WRGF0ZVBpY2tlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsUUFBUSxFQUFFLGVBQWUsRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsTUFBTSxLQUFLLENBQUE7QUFHMUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDZCQUE2QixDQUFBO0FBQ3ZELE9BQU8sRUFBRSxjQUFjLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0NBQWdDLENBQUE7QUFDN0UsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlDQUFpQyxDQUFBO0FBRy9ELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFDMUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUE7QUFDdkQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFDckQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFDckQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUE7QUFDdkQsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUdoQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBQ3JDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFHN0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLFNBQVMsQ0FBQTtBQVFwQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sdUJBQXVCLENBQUE7QUFpQjlDLE1BQU0sQ0FBQyxNQUFNLFdBQVcsR0FBRyxlQUFlLENBQUM7SUFDekMsSUFBSSxFQUFFLGVBQWU7SUFDckIsS0FBSyxFQUFFO1FBQ0wsSUFBSSxFQUFFLE9BQU87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WyIvLyBWdWUgQVBJXG5pbXBvcnQgeyBjb21wdXRlZCwgZGVmaW5lQ29tcG9uZW50LCBoLCBwcm92aWRlLCByZWFjdGl2ZSwgcmVmIH0gZnJvbSAndnVlJ1xuXG4vLyBFZmZlY3RzXG5pbXBvcnQgeyB1c2VDb2xvcnMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS1jb2xvcnMnXG5pbXBvcnQgeyBlbGV2YXRpb25Qcm9wcywgdXNlRWxldmF0aW9uIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtZWxldmF0aW9uJ1xuaW1wb3J0IHsgdXNlVHJhbnNpdGlvbiB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLXRyYW5zaXRpb24nXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCB7IFZUZXh0RmllbGQgfSBmcm9tICcuLi9WVGV4dEZpZWxkJ1xuaW1wb3J0IHsgVkRhdGVwaWNrZXJIZWFkZXIgfSBmcm9tICcuL1ZEYXRlcGlja2VySGVhZGVyJ1xuaW1wb3J0IHsgVkRhdGVQaWNrZXJEYXRlcyB9IGZyb20gJy4vVkRhdGVQaWNrZXJEYXRlcydcbmltcG9ydCB7IFZEYXRlUGlja2VyWWVhcnMgfSBmcm9tICcuL1ZEYXRlUGlja2VyWWVhcnMnXG5pbXBvcnQgeyBWRGF0ZVBpY2tlck1vbnRocyB9IGZyb20gJy4vVkRhdGVQaWNrZXJNb250aHMnXG5pbXBvcnQgeyBWTWVudSB9IGZyb20gJy4uL1ZNZW51J1xuXG4vLyBIZWxwZXJzXG5pbXBvcnQgeyBwYXJzZURhdGUgfSBmcm9tICcuL2hlbHBlcnMnXG5pbXBvcnQgeyBhZGRTY29wZWRTbG90IH0gZnJvbSAnLi4vLi4vaGVscGVycydcblxuLy8gVXRpbHNcbmltcG9ydCB7IGZvcm1hdERhdGUgfSBmcm9tICcuL3V0aWxzJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5pbXBvcnQgeyBEYXRlUGlja2VyQnRuSGFuZGxlcnMsIERhdGVQaWNrZXJEYXRlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMnXG5pbXBvcnQgeyBNYXliZSB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL2Jhc2UnXG5cbi8vIFNlcnZpY2VzXG5pbXBvcnQgeyBsb2NhbGUgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9sb2NhbGUnXG5cbnR5cGUgRGF0ZVBpY2tlckRhdGEgPSB7XG4gIHllYXI6IG51bWJlciB8IG51bGxcbiAgbW9udGg6IG51bWJlciB8IG51bGxcbiAgZGF0ZTogbnVtYmVyIHwgbnVsbFxuICBkYXk6IG51bWJlciB8IG51bGxcbiAgc2VsZWN0ZWQ6IERhdGVQaWNrZXJEYXRlIHwgbnVsbFxuICB0YWJsZU1vbnRoOiBudW1iZXIgfCBudWxsXG4gIHRhYmxlWWVhcjogbnVtYmVyIHwgbnVsbFxuICBjb252ZXJ0ZWREYXRlU3RyaW5nOiBzdHJpbmcgfCBudWxsXG4gIGlzWWVhcnM6IGJvb2xlYW5cbiAgaXNNb250aHM6IGJvb2xlYW5cbiAgaXNEYXRlczogYm9vbGVhblxuICBpc0FjdGl2ZTogYm9vbGVhblxufVxuXG5leHBvcnQgY29uc3QgVkRhdGVQaWNrZXIgPSBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAndi1kYXRlLXBpY2tlcicsXG4gIHByb3BzOiB7XG4gICAgZGFyazogQm9vbGVhbixcbiAgICBkaXNhYmxlZDogQm9vbGVhbixcbiAgICBjbGVhcmFibGU6IEJvb2xlYW4sXG4gICAgcmVhZG9ubHk6IEJvb2xlYW4sXG4gICAgdHlwZWFibGU6IEJvb2xlYW4sXG4gICAgbW9uZGF5Rmlyc3Q6IEJvb2xlYW4sXG4gICAgdG9kYXk6IEJvb2xlYW4sXG4gICAgdXNlTWxzOiBCb29sZWFuLFxuICAgIHVzZVV0YzogQm9vbGVhbixcbiAgICBsYW5nOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnZW4nLFxuICAgIH0sXG4gICAgbGFiZWw6IFN0cmluZyxcbiAgICBwcmVwZW5kSWNvbjogU3RyaW5nLFxuICAgIGZvcm1hdDoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ3l5eXkgTU0gZGQgRCcsXG4gICAgfSxcbiAgICBydWxlczogQXJyYXksXG4gICAgdmFsdWU6IFtTdHJpbmcsIERhdGUsIE51bWJlcl0sXG4gICAgbW9kZWxWYWx1ZTogW1N0cmluZywgRGF0ZSwgTnVtYmVyXSxcbiAgICBkaXNhYmxlZERhdGVzOiBPYmplY3QsXG4gICAgaGlnaGxpZ2h0ZWQ6IE9iamVjdCxcbiAgICBjb250ZW50Q29sb3I6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdwcmltYXJ5JyxcbiAgICB9LFxuICAgIGNvbG9yOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnd2hpdGUnLFxuICAgIH0sXG4gICAgLi4uZWxldmF0aW9uUHJvcHMoKSxcbiAgfSBhcyBhbnksXG5cbiAgZW1pdHM6IFsndXBkYXRlOnZhbHVlJywgJ3VwZGF0ZTptb2RlbFZhbHVlJywgJ3NlbGVjdGVkJ10sXG5cbiAgc2V0dXAocHJvcHMsIHsgZW1pdCwgc2xvdHMgfSkge1xuICAgIGNvbnN0IGRhdGE6IERhdGVQaWNrZXJEYXRhID0gcmVhY3RpdmUoe1xuICAgICAgeWVhcjogbnVsbCxcbiAgICAgIG1vbnRoOiBudWxsLFxuICAgICAgZGF0ZTogbnVsbCxcbiAgICAgIGRheTogbnVsbCxcbiAgICAgIHNlbGVjdGVkOiBudWxsLFxuICAgICAgdGFibGVNb250aDogbnVsbCxcbiAgICAgIHRhYmxlWWVhcjogbnVsbCxcbiAgICAgIGNvbnZlcnRlZERhdGVTdHJpbmc6IG51bGwsXG4gICAgICBpc1llYXJzOiBmYWxzZSxcbiAgICAgIGlzTW9udGhzOiBmYWxzZSxcbiAgICAgIGlzRGF0ZXM6IHRydWUsXG4gICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgfSlcblxuICAgIGNvbnN0IHtcbiAgICAgIHNldFRleHRDbGFzc05hbWVDb2xvcixcbiAgICAgIHNldFRleHRDc3NDb2xvcixcbiAgICAgIHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcixcbiAgICAgIHNldEJhY2tncm91bmRDc3NDb2xvcixcbiAgICB9ID0gdXNlQ29sb3JzKClcbiAgICBjb25zdCB7IGVsZXZhdGlvbkNsYXNzZXMgfSA9IHVzZUVsZXZhdGlvbihwcm9wcylcblxuICAgIGNvbnN0IGxvY2FsZU1vbnRoczogc3RyaW5nW10gPSBsb2NhbGVbcHJvcHMubGFuZ10ubW9udGhzQWJiclxuICAgIGNvbnN0IGxvY2FsZVdlZWs6IHN0cmluZ1tdID0gbG9jYWxlW3Byb3BzLmxhbmddLndlZWtcbiAgICBjb25zdCBjb250ZW50Q29sb3I6IHN0cmluZyA9IHByb3BzLmRhcmsgPyAnd2hpdGUnIDogcHJvcHMuY29udGVudENvbG9yXG5cbiAgICBjb25zdCBoYW5kbGVycyA9IHJlZjxEYXRlUGlja2VyQnRuSGFuZGxlcnM+KHt9KVxuICAgIGNvbnN0IGFjdGl2YXRvciA9IHJlZjxNYXliZTxWTm9kZT4+KG51bGwpXG4gICAgY29uc3QgY2xvc2VDb25kaXRpb25hbCA9IHJlZjxib29sZWFuPihmYWxzZSlcblxuICAgIHByb3ZpZGUoJ2hhbmRsZXJzJywgaGFuZGxlcnMpXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+ICh7XG4gICAgICAndi1kYXRlLXBpY2tlcic6IHRydWUsXG4gICAgICAndi1kYXRlLXBpY2tlci0tdHlwZWFibGUnOiBwcm9wcy50eXBlYWJsZSxcbiAgICAgICd2LWRhdGUtcGlja2VyLS1yZWFkb25seSc6ICFwcm9wcy50eXBlYWJsZSB8fCBwcm9wcy5yZWFkb25seSxcbiAgICB9KSlcblxuICAgIGNvbnN0IHRhYmxlQ2xhc3NlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+PigoKSA9PiAoe1xuICAgICAgJ3YtZGF0ZS1waWNrZXJfX3RhYmxlJzogdHJ1ZSxcbiAgICAgIC4uLmVsZXZhdGlvbkNsYXNzZXMudmFsdWUsXG4gICAgICAuLi4ocHJvcHMuY29sb3IgPyBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgICAgLi4uKGNvbnRlbnRDb2xvciA/IHNldFRleHRDbGFzc05hbWVDb2xvcihjb250ZW50Q29sb3IpIDoge30pLFxuICAgIH0pKVxuXG4gICAgY29uc3QgdGFibGVTdHlsZXMgPSBjb21wdXRlZCgoKSA9PiAoe1xuICAgICAgLi4uKHByb3BzLmNvbG9yID8gc2V0QmFja2dyb3VuZENzc0NvbG9yKHByb3BzLmNvbG9yKSA6IHt9KSxcbiAgICAgIC4uLihjb250ZW50Q29sb3IgPyBzZXRUZXh0Q3NzQ29sb3IoY29udGVudENvbG9yKSA6IHt9KSxcbiAgICB9KSlcblxuICAgIGNvbnN0IGhlYWRlclZhbHVlID0gY29tcHV0ZWQ8c3RyaW5nPigoKSA9PiB7XG4gICAgICByZXR1cm4gZGF0YS5pc1llYXJzIHx8IGRhdGEuaXNNb250aHNcbiAgICAgICAgPyBgJHtkYXRhLnRhYmxlWWVhcn1gXG4gICAgICAgIDogZGF0YS5pc0RhdGVzXG4gICAgICAgID8gYCR7ZGF0YS50YWJsZVllYXJ9ICR7bG9jYWxlTW9udGhzW2RhdGEudGFibGVNb250aCFdfWBcbiAgICAgICAgOiAnJ1xuICAgIH0pXG5cbiAgICBjb25zdCBkaXNwbGF5RGF0ZSA9IGNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuICAgICAgY29uc3QgeyBtb250aCwgZGF0ZSwgZGF5IH0gPSBkYXRhLnNlbGVjdGVkIGFzIERhdGVQaWNrZXJEYXRlXG4gICAgICByZXR1cm4gYCR7bG9jYWxlTW9udGhzW21vbnRoXX0gJHtkYXRlfSAke2xvY2FsZVdlZWtbZGF5XX1gXG4gICAgfSlcblxuICAgIGNvbnN0IGNvbXB1dGVkVmFsdWUgPSBjb21wdXRlZDxzdHJpbmcgfCBudW1iZXIgfCBEYXRlPigoKSA9PiB7XG4gICAgICBjb25zdCB7IHllYXIsIG1vbnRoLCBkYXRlIH0gPSBkYXRhLnNlbGVjdGVkIGFzIERhdGVQaWNrZXJEYXRlXG4gICAgICByZXR1cm4gbmV3IERhdGUoeWVhciwgbW9udGgsIGRhdGUgYXMgbnVtYmVyKVxuICAgIH0pXG5cbiAgICBmdW5jdGlvbiBzZXRJbml0RGF0ZSgpIHtcbiAgICAgIGlmIChwcm9wcy52YWx1ZSkgc2V0UGFyc2VkRGF0ZShwcm9wcy52YWx1ZSlcbiAgICAgIGVsc2UgaWYgKHByb3BzLm1vZGVsVmFsdWUpIHNldFBhcnNlZERhdGUocHJvcHMubW9kZWxWYWx1ZSlcbiAgICAgIGVsc2Ugc2V0UGFyc2VkRGF0ZSgpXG5cbiAgICAgIGlmIChwcm9wcy50b2RheSB8fCBwcm9wcy52YWx1ZSB8fCBwcm9wcy5tb2RlbFZhbHVlKSB7XG4gICAgICAgIGRhdGEuY29udmVydGVkRGF0ZVN0cmluZyA9IGNvbnZlcnRUb0Zvcm1hdCgpIGFzIHN0cmluZ1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uVGFibGVDaGFuZ2UoKTogdm9pZCB8IGJvb2xlYW4ge1xuICAgICAgaWYgKGRhdGEuaXNZZWFycykge1xuICAgICAgICBkYXRhLmlzWWVhcnMgPSBmYWxzZVxuICAgICAgICByZXR1cm4gKGRhdGEuaXNNb250aHMgPSB0cnVlKVxuICAgICAgfVxuICAgICAgaWYgKGRhdGEuaXNNb250aHMpIHtcbiAgICAgICAgZGF0YS5pc01vbnRocyA9IGZhbHNlXG4gICAgICAgIHJldHVybiAoZGF0YS5pc1llYXJzID0gdHJ1ZSlcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLmlzRGF0ZXMpIHtcbiAgICAgICAgZGF0YS5pc0RhdGVzID0gZmFsc2VcbiAgICAgICAgcmV0dXJuIChkYXRhLmlzTW9udGhzID0gdHJ1ZSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXREYXRhRGF0ZTxUIGV4dGVuZHMgRGF0ZVBpY2tlckRhdGU+KHtcbiAgICAgIHllYXIsXG4gICAgICBtb250aCxcbiAgICAgIGRhdGUsXG4gICAgICBkYXksXG4gICAgfTogVCkge1xuICAgICAgZGF0YS50YWJsZU1vbnRoID0gbW9udGhcbiAgICAgIGRhdGEudGFibGVZZWFyID0geWVhclxuXG4gICAgICBkYXRhLnllYXIgPSB5ZWFyXG4gICAgICBkYXRhLm1vbnRoID0gbW9udGhcbiAgICAgIGRhdGEuZGF0ZSA9IGRhdGVcbiAgICAgIGRhdGEuZGF5ID0gZGF5XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0UGFyc2VkRGF0ZShzZWxlY3RlZERhdGU6IHN0cmluZyB8IG51bGwgPSBudWxsKSB7XG4gICAgICBjb25zdCBkYXRlRm9yUGFyc2luZyA9IHNlbGVjdGVkRGF0ZSB8fCBuZXcgRGF0ZSgpXG5cbiAgICAgIGRhdGEuc2VsZWN0ZWQgPSBwYXJzZURhdGUoZGF0ZUZvclBhcnNpbmcpXG4gICAgICAhc2VsZWN0ZWREYXRlICYmIChkYXRhLnNlbGVjdGVkIS5kZWZhdWx0ID0gIXNlbGVjdGVkRGF0ZSlcblxuICAgICAgc2V0RGF0YURhdGUoZGF0YS5zZWxlY3RlZCEpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gb25ZZWFyVXBkYXRlKHllYXI6IG51bWJlcikge1xuICAgICAgZGF0YS50YWJsZVllYXIgPSB5ZWFyXG4gICAgICBkYXRhLmlzTW9udGhzID0gdHJ1ZVxuICAgICAgZGF0YS5pc1llYXJzID0gZmFsc2VcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbk1vbnRoVXBkYXRlKG1vbnRoOiBudW1iZXIpIHtcbiAgICAgIGRhdGEudGFibGVNb250aCA9IG1vbnRoXG4gICAgICBkYXRhLmlzTW9udGhzID0gZmFsc2VcbiAgICAgIGRhdGEuaXNZZWFycyA9IGZhbHNlXG4gICAgICBkYXRhLmlzRGF0ZXMgPSB0cnVlXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gb25EYXRlVXBkYXRlKGRhdGU6IERhdGVQaWNrZXJEYXRlKSB7XG4gICAgICBpZiAoIWRhdGUpIHJldHVyblxuXG4gICAgICBjbG9zZUNvbmRpdGlvbmFsLnZhbHVlID0gdHJ1ZVxuXG4gICAgICBkYXRhLnNlbGVjdGVkID0gZGF0ZVxuICAgICAgZGF0YS50YWJsZU1vbnRoID0gZGF0ZS5tb250aFxuICAgICAgZGF0YS50YWJsZVllYXIgPSBkYXRlLnllYXJcblxuICAgICAgZGF0YS5jb252ZXJ0ZWREYXRlU3RyaW5nID0gY29udmVydFRvRm9ybWF0KCkgYXMgc3RyaW5nXG5cbiAgICAgIGVtaXQoJ3VwZGF0ZTp2YWx1ZScsIGNvbXB1dGVkVmFsdWUudmFsdWUpXG4gICAgICBlbWl0KCd1cGRhdGU6bW9kZWxWYWx1ZScsIGNvbXB1dGVkVmFsdWUudmFsdWUpXG4gICAgICBlbWl0KCdzZWxlY3RlZCcsIGNvbXB1dGVkVmFsdWUudmFsdWUpXG5cbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiAoY2xvc2VDb25kaXRpb25hbC52YWx1ZSA9IGZhbHNlKSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbkRhdGVNb250aFVwZGF0ZShkYXRlT2JqZWN0KSB7XG4gICAgICBkYXRhLnRhYmxlTW9udGggPSBkYXRlT2JqZWN0Lm1vbnRoXG4gICAgICBpZiAoZGF0ZU9iamVjdC55ZWFyKSBkYXRhLnRhYmxlWWVhciA9IGRhdGVPYmplY3QueWVhclxuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uRGF0ZUlucHV0KGRhdGU6IHN0cmluZyk6IGFueSB7XG4gICAgICBvbkRhdGVVcGRhdGUoc3RyaW5nVG9EYXRlKGRhdGUpISlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdHJpbmdUb0RhdGUoZGF0ZTogc3RyaW5nKTogRGF0ZVBpY2tlckRhdGUgfCBudWxsIHtcbiAgICAgIGlmIChkYXRlLmxlbmd0aCA9PT0gMTApIHtcbiAgICAgICAgY29uc3QgZGF0ZUFycmF5ID0gZGF0ZS50cmltKCkuc3BsaXQoL1xcVy8pXG5cbiAgICAgICAgaWYgKGRhdGVBcnJheVswXS5sZW5ndGggPCA0KSB7XG4gICAgICAgICAgZGF0ZSA9IGRhdGVBcnJheS5yZXZlcnNlKCkuam9pbignLicpXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcGFyc2VEYXRlKG5ldyBEYXRlKERhdGUucGFyc2UoZGF0ZSkpKVxuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjb252ZXJ0VG9Gb3JtYXQoKTogc3RyaW5nIHtcbiAgICAgIGlmICghZGF0YS5zZWxlY3RlZCkgcmV0dXJuICcnXG4gICAgICByZXR1cm4gZm9ybWF0RGF0ZShcbiAgICAgICAgbmV3IERhdGUoXG4gICAgICAgICAgZGF0YS5zZWxlY3RlZCEueWVhcixcbiAgICAgICAgICBkYXRhLnNlbGVjdGVkIS5tb250aCxcbiAgICAgICAgICBkYXRhLnNlbGVjdGVkIS5kYXRlIGFzIG51bWJlclxuICAgICAgICApLFxuICAgICAgICBwcm9wcy5mb3JtYXQsXG4gICAgICAgIGxvY2FsZVtwcm9wcy5sYW5nXVxuICAgICAgKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlbkRpc3BsYXlWYWx1ZSh2YWx1ZTogc3RyaW5nIHwgbnVtYmVyKTogVk5vZGUge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczogJ3YtZGF0ZS1waWNrZXJfX2Rpc3BsYXktdmFsdWUnLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdXNlVHJhbnNpdGlvbihcbiAgICAgICAgaCgnc3BhbicsIHByb3BzRGF0YSwgdmFsdWUpLFxuICAgICAgICAnc2NhbGUtaW4tb3V0JyxcbiAgICAgICAgJ291dC1pbidcbiAgICAgIClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5EYXRlcGlja2VyRGlzcGxheUlubmVyKCk6IFZOb2RlIHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6ICd2LWRhdGUtcGlja2VyX19kaXNwbGF5LWlubmVyJyxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHByb3BzRGF0YSwgW1xuICAgICAgICBnZW5EaXNwbGF5VmFsdWUoZGF0YS5zZWxlY3RlZD8ueWVhciBhcyBudW1iZXIpLFxuICAgICAgICBnZW5EaXNwbGF5VmFsdWUoZGlzcGxheURhdGUudmFsdWUpLFxuICAgICAgXSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5EYXRlcGlja2VyRGlzcGxheSgpOiBWTm9kZSB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgJ3YtZGF0ZS1waWNrZXJfX2Rpc3BsYXknOiB0cnVlLFxuICAgICAgICAgIC4uLihjb250ZW50Q29sb3IgPyBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IoY29udGVudENvbG9yKSA6IHt9KSxcbiAgICAgICAgICAuLi4ocHJvcHMuY29sb3IgPyBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgICAgICB9LFxuICAgICAgICBzdHlsZToge1xuICAgICAgICAgIC4uLihjb250ZW50Q29sb3IgPyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IoY29udGVudENvbG9yKSA6IHt9KSxcbiAgICAgICAgICAuLi4ocHJvcHMuY29sb3IgPyBzZXRUZXh0Q3NzQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgICAgICB9LFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaCgnZGl2JywgcHJvcHNEYXRhLCBnZW5EYXRlcGlja2VyRGlzcGxheUlubmVyKCkpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuRGF0ZXBpY2tlckhlYWRlcigpOiBWTm9kZSB7XG4gICAgICByZXR1cm4gaChcbiAgICAgICAgVkRhdGVwaWNrZXJIZWFkZXIsXG4gICAgICAgIHtcbiAgICAgICAgICBvbk5leHQ6ICgpID0+IGhhbmRsZXJzLnZhbHVlLm9uTmV4dCEoKSxcbiAgICAgICAgICBvblByZXY6ICgpID0+IGhhbmRsZXJzLnZhbHVlLm9uUHJldiEoKSxcbiAgICAgICAgICBvblRhYmxlOiBvblRhYmxlQ2hhbmdlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgZGVmYXVsdDogKCkgPT4gaGVhZGVyVmFsdWUudmFsdWUsXG4gICAgICAgIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5EYXRlcGlja2VyWWVhcnNUYWJsZSgpOiBWTm9kZSB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIHllYXI6IGRhdGEudGFibGVZZWFyLFxuICAgICAgICBbJ29uVXBkYXRlOnllYXInXTogb25ZZWFyVXBkYXRlLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWRGF0ZVBpY2tlclllYXJzLCBwcm9wc0RhdGEpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuRGF0ZXBpY2tlck1vbnRoc1RhYmxlKCk6IFZOb2RlIHtcbiAgICAgIHJldHVybiBoKFZEYXRlUGlja2VyTW9udGhzLCB7XG4gICAgICAgIGxhbmc6IHByb3BzLmxhbmcsXG4gICAgICAgIG1vbnRoOiBkYXRhLnRhYmxlTW9udGgsXG4gICAgICAgIHllYXI6IGRhdGEudGFibGVZZWFyLFxuICAgICAgICBsb2NhbGU6IGxvY2FsZU1vbnRocyxcbiAgICAgICAgWydvblVwZGF0ZTptb250aCddOiBvbk1vbnRoVXBkYXRlLFxuICAgICAgICBbJ29uVXBkYXRlOnllYXInXTogb25ZZWFyVXBkYXRlLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5EYXRlcGlja2VyRGF0ZXNUYWJsZSgpOiBWTm9kZSB7XG4gICAgICByZXR1cm4gaChcbiAgICAgICAgVkRhdGVQaWNrZXJEYXRlcyxcbiAgICAgICAge1xuICAgICAgICAgIGxvY2FsZTogbG9jYWxlV2VlayxcbiAgICAgICAgICBtb25kYXlGaXJzdDogcHJvcHMubW9uZGF5Rmlyc3QsXG4gICAgICAgICAgbW9udGg6IGRhdGEudGFibGVNb250aCxcbiAgICAgICAgICB5ZWFyOiBkYXRhLnRhYmxlWWVhcixcbiAgICAgICAgICB2YWx1ZTogZGF0YS5zZWxlY3RlZCxcbiAgICAgICAgICBkaXNhYmxlZERhdGVzOiBwcm9wcy5kaXNhYmxlZERhdGVzLFxuICAgICAgICAgIFsnb25VcGRhdGU6dmFsdWUnXTogb25EYXRlVXBkYXRlLFxuICAgICAgICAgIFsnb25VcGRhdGU6bW9udGgnXTogb25EYXRlTW9udGhVcGRhdGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkYXRlOiBzbG90cy5kYXRlICYmIGFkZFNjb3BlZFNsb3QoJ2RhdGUnLCBzbG90cyksXG4gICAgICAgIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5EYXRlcGlja2VyQm9keSgpOiBWTm9kZSB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgJ3YtZGF0ZS1waWNrZXJfX2JvZHknOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChcbiAgICAgICAgJ2RpdicsXG4gICAgICAgIHByb3BzRGF0YSxcbiAgICAgICAgdXNlVHJhbnNpdGlvbihcbiAgICAgICAgICAoKGRhdGEuaXNZZWFycyAmJiBnZW5EYXRlcGlja2VyWWVhcnNUYWJsZSgpKSB8fFxuICAgICAgICAgICAgKGRhdGEuaXNNb250aHMgJiYgZ2VuRGF0ZXBpY2tlck1vbnRoc1RhYmxlKCkpIHx8XG4gICAgICAgICAgICAoZGF0YS5pc0RhdGVzICYmIGdlbkRhdGVwaWNrZXJEYXRlc1RhYmxlKCkpKSBhcyBWTm9kZSxcbiAgICAgICAgICAnc2xpZGUtaW4tbGVmdCcsXG4gICAgICAgICAgJ291dC1pbidcbiAgICAgICAgKVxuICAgICAgKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlbkRhdGVwaWNrZXJJbnB1dCgpOiBWTm9kZSB7XG4gICAgICByZXR1cm4gaChWVGV4dEZpZWxkLCB7XG4gICAgICAgIG1vZGVsVmFsdWU6IGRhdGEuY29udmVydGVkRGF0ZVN0cmluZyEsXG4gICAgICAgIGRhcms6IHByb3BzLmRhcmssXG4gICAgICAgIGxhYmVsOiBwcm9wcy5sYWJlbCxcbiAgICAgICAgcmVhZG9ubHk6ICFwcm9wcy50eXBlYWJsZSxcbiAgICAgICAgZGlzYWJsZWQ6IHByb3BzLmRpc2FibGVkLFxuICAgICAgICBwcmVwZW5kSWNvbjogcHJvcHMucHJlcGVuZEljb24sXG4gICAgICAgIHJ1bGVzOiBwcm9wcy5ydWxlcyxcbiAgICAgICAgY2xlYXJhYmxlOiBwcm9wcy5jbGVhcmFibGUsXG4gICAgICAgIHJlZjogYWN0aXZhdG9yLFxuICAgICAgICBvbklucHV0OiBvbkRhdGVJbnB1dCxcbiAgICAgICAgb25DbGVhcjogKCkgPT4ge1xuICAgICAgICAgIGRhdGEuY29udmVydGVkRGF0ZVN0cmluZyA9ICcnXG4gICAgICAgICAgZW1pdCgndXBkYXRlOnZhbHVlJywgbnVsbClcbiAgICAgICAgICBlbWl0KCd1cGRhdGU6bW9kZWxWYWx1ZScsIG51bGwpXG4gICAgICAgICAgZW1pdCgnc2VsZWN0ZWQnLCBudWxsKVxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5EYXRlcGlja2VyVGFibGUoKTogVk5vZGUge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczogdGFibGVDbGFzc2VzLnZhbHVlLFxuICAgICAgICBzdHlsZTogdGFibGVTdHlsZXMudmFsdWUsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCBwcm9wc0RhdGEsIFtcbiAgICAgICAgZ2VuRGF0ZXBpY2tlckRpc3BsYXkoKSxcbiAgICAgICAgZ2VuRGF0ZXBpY2tlckhlYWRlcigpLFxuICAgICAgICBnZW5EYXRlcGlja2VyQm9keSgpLFxuICAgICAgXSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5NZW51KCkge1xuICAgICAgcmV0dXJuIGgoXG4gICAgICAgIFZNZW51LFxuICAgICAgICB7XG4gICAgICAgICAgYWN0aXZhdG9yOiBhY3RpdmF0b3IudmFsdWUhLFxuICAgICAgICAgIGludGVybmFsQWN0aXZhdG9yOiB0cnVlLFxuICAgICAgICAgIGlucHV0QWN0aXZhdG9yOiAnLnYtaW5wdXRfX3RleHQtZmllbGQnLFxuICAgICAgICAgIHdpZHRoOiAnYXV0bycsXG4gICAgICAgICAgbWF4SGVpZ2h0OiAnYXV0bycsXG4gICAgICAgICAgYm90dG9tOiBwcm9wcy50eXBlYWJsZSxcbiAgICAgICAgICBvcGVuT25DbGljazogdHJ1ZSxcbiAgICAgICAgICBjbG9zZU9uQ2xpY2s6IGNsb3NlQ29uZGl0aW9uYWwudmFsdWUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWZhdWx0OiAoKSA9PiBnZW5EYXRlcGlja2VyVGFibGUoKSxcbiAgICAgICAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlbkRhdGVwaWNrZXIoKTogVk5vZGUge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczogY2xhc3Nlcy52YWx1ZSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHByb3BzRGF0YSwgW1xuICAgICAgICBnZW5EYXRlcGlja2VySW5wdXQoKSxcbiAgICAgICAgYWN0aXZhdG9yLnZhbHVlICYmIGdlbk1lbnUoKSxcbiAgICAgIF0pXG4gICAgfVxuXG4gICAgc2V0SW5pdERhdGUoKVxuXG4gICAgcmV0dXJuICgpID0+IGdlbkRhdGVwaWNrZXIoKVxuICB9LFxufSlcbiJdfQ==