import './VTextField.scss';
import { h, inject, watch, computed, reactive, defineComponent, onBeforeUnmount, } from 'vue';
import { useValidate, validateProps } from '../../effects/use-validate';
import { useColors, colorProps } from '../../effects/use-colors';
import { VInput } from '../VInput';
export const VTextField = defineComponent({
    name: 'v-text-field',
    emits: [
        'input',
        'focus',
        'blur',
        'change',
        'update:value',
        'update:modelValue',
    ],
    props: {
        dark: Boolean,
        disabled: Boolean,
        readonly: Boolean,
        label: String,
        isDirty: Boolean,
        type: {
            type: String,
            default: 'text',
        },
        modelValue: [String, Number, Date],
        tag: {
            type: String,
            default: 'input',
        },
        ...validateProps(),
        ...colorProps(),
    },
    setup(props, { emit, attrs }) {
        const state = reactive({
            value: '',
            focused: false,
        });
        state.value = props.modelValue || props.value;
        const fields = props.rules && inject('fields');
        const { setTextColor } = useColors();
        const { validate, dirty, update, errorState, validateClasses, validationState, } = useValidate(props);
        watch(() => (props.modelValue || props.value), value => {
            state.value = value;
            validateValue();
        });
        const classes = computed(() => ({
            'v-text-field': true,
            'v-text-field--disabled': props.disabled,
            'v-text-field--dirty': errorState.isDirty,
            'v-text-field--valid': errorState.isDirty && !errorState.innerError,
            'v-text-field--not-valid': errorState.isDirty && !!errorState.innerError,
            ...validateClasses.value,
        }));
        function validateValue() {
            return props.rules?.length && validate(state.value);
        }
        if (fields?.value && props.rules?.length) {
            fields.value.push(validateValue);
        }
        onBeforeUnmount(() => {
            if (fields?.value) {
                fields.value = fields.value.filter(v => v !== validateValue);
            }
        });
        function focusHandler() {
            dirty();
            update(errorState.innerError);
            state.focused = true;
            emit('focus');
        }
        function blurHandler() {
            state.focused = false;
            emit('blur');
            validateValue();
        }
        function changeHandler() {
            emit('change', state.value);
        }
        function inputHandler(e) {
            state.value = e.target.value;
            emit('update:modelValue', state.value);
            emit('update:value', state.value);
            emit('input', state.value);
        }
        function genInput() {
            const propsData = {
                disabled: props.disabled,
                readonly: props.readonly,
                value: state.value,
                autocomplete: attrs.autocomplete,
                class: {
                    'v-text-field__input': true,
                },
                onFocus: focusHandler,
                onBlur: blurHandler,
                onInput: inputHandler,
                onChange: changeHandler,
            };
            if (props.tag === 'input') {
                propsData.type = props.type;
            }
            return h(props.tag, props.dark
                ? setTextColor('white', propsData)
                : propsData);
        }
        function genTextField() {
            return h('div', {
                class: classes.value,
            }, genInput());
        }
        return () => {
            const propsData = {
                label: props.label,
                focused: state.focused,
                hasState: !!state.value,
                hasError: errorState.innerError,
                dark: props.dark,
                color: validationState.value,
                isDirty: errorState.isDirty,
                disabled: props.disabled,
                message: errorState.innerErrorMessage,
            };
            return h(VInput, propsData, {
                textField: () => genTextField(),
            });
        };
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlRleHRGaWVsZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZUZXh0RmllbGQvVlRleHRGaWVsZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLG1CQUFtQixDQUFBO0FBRzFCLE9BQU8sRUFDTCxDQUFDLEVBQ0QsTUFBTSxFQUNOLEtBQUssRUFDTCxRQUFRLEVBQ1IsUUFBUSxFQUNSLGVBQWUsRUFDZixlQUFlLEdBQ2hCLE1BQU0sS0FBSyxDQUFBO0FBR1osT0FBTyxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQTtBQUN2RSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLDBCQUEwQixDQUFBO0FBR2hFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFVbEMsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLGVBQWUsQ0FBQztJQUN4QyxJQUFJLEVBQUUsY0FBYztJQUNwQixLQUFLLEVBQUU7UUFDTCxPQUFPO1FBQ1AsT0FBTztRQUNQLE1BQU07UUFDTixRQUFRO1FBQ1IsY0FBYztRQUNkLG1CQUFtQjtLQUNwQjtJQUNELEtBQUssRUFBRTtRQUNMLElBQUksRUFBRSxPQUFPO1FBQ2IsUUFBUSxFQUFFLE9BQU87UUFDakIsUUFBUSxFQUFFLE9BQU87UUFDakIsS0FBSyxFQUFFLE1BQU07UUFDYixPQUFPLEVBQUUsT0FBTztRQUNoQixJQUFJLEVBQUU7WUFDSixJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxNQUFNO1NBQ2hCO1FBQ0QsVUFBVSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUM7UUFDbEMsR0FBRyxFQUFFO1lBQ0gsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsT0FBTztTQUNqQjtRQUNELEdBQUcsYUFBYSxFQUFFO1FBQ2xCLEdBQUcsVUFBVSxFQUFFO0tBQ1Q7SUFFUixL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Z0JBQ3ZCLFFBQVEsRUFBRSxVQUFVLENBQUMsVUFBVTtnQkFDL0IsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJO2dCQUNoQixLQUFLLEVBQUUsZUFBZSxDQUFDLEtBQUs7Z0JBQzVCLE9BQU8sRUFBRSxVQUFVLENBQUMsT0FBTztnQkFDM0IsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRO2dCQUN4QixPQUFPLEVBQUUsVUFBVSxDQUFDLGlCQUFpQjthQUN0QyxDQUFBO1lBRUQsT0FBTyxDQUFDLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRTtnQkFDeEIsU0FBUyxFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVksRUFBRTthQUNoQyxDQUNGLENBQUE7UUFDSCxDQUFDLENBQUE7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gU3R5bGVzXG5pbXBvcnQgJy4vVlRleHRGaWVsZC5zY3NzJ1xuXG4vLyBWdWUgQVBJXG5pbXBvcnQge1xuICBoLFxuICBpbmplY3QsXG4gIHdhdGNoLFxuICBjb21wdXRlZCxcbiAgcmVhY3RpdmUsXG4gIGRlZmluZUNvbXBvbmVudCxcbiAgb25CZWZvcmVVbm1vdW50LFxufSBmcm9tICd2dWUnXG5cbi8vIEVmZmVjdHNcbmltcG9ydCB7IHVzZVZhbGlkYXRlLCB2YWxpZGF0ZVByb3BzIH0gZnJvbSAnLi4vLi4vZWZmZWN0cy91c2UtdmFsaWRhdGUnXG5pbXBvcnQgeyB1c2VDb2xvcnMsIGNvbG9yUHJvcHMgfSBmcm9tICcuLi8uLi9lZmZlY3RzL3VzZS1jb2xvcnMnXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCB7IFZJbnB1dCB9IGZyb20gJy4uL1ZJbnB1dCdcblxuLy8gVHlwZXNcbmltcG9ydCB7IFZOb2RlLCBSZWYgfSBmcm9tICd2dWUnXG5cbnR5cGUgVGV4dEZpZWxkU3RhdGUgPSB7XG4gIHZhbHVlOiBzdHJpbmcgfCBudW1iZXJcbiAgZm9jdXNlZDogYm9vbGVhblxufVxuXG5leHBvcnQgY29uc3QgVlRleHRGaWVsZCA9IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LXRleHQtZmllbGQnLFxuICBlbWl0czogW1xuICAgICdpbnB1dCcsXG4gICAgJ2ZvY3VzJyxcbiAgICAnYmx1cicsXG4gICAgJ2NoYW5nZScsXG4gICAgJ3VwZGF0ZTp2YWx1ZScsXG4gICAgJ3VwZGF0ZTptb2RlbFZhbHVlJyxcbiAgXSxcbiAgcHJvcHM6IHtcbiAgICBkYXJrOiBCb29sZWFuLFxuICAgIGRpc2FibGVkOiBCb29sZWFuLFxuICAgIHJlYWRvbmx5OiBCb29sZWFuLFxuICAgIGxhYmVsOiBTdHJpbmcsXG4gICAgaXNEaXJ0eTogQm9vbGVhbixcbiAgICB0eXBlOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAndGV4dCcsXG4gICAgfSxcbiAgICBtb2RlbFZhbHVlOiBbU3RyaW5nLCBOdW1iZXIsIERhdGVdLFxuICAgIHRhZzoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ2lucHV0JyxcbiAgICB9LFxuICAgIC4uLnZhbGlkYXRlUHJvcHMoKSxcbiAgICAuLi5jb2xvclByb3BzKCksXG4gIH0gYXMgYW55LFxuXG4gIHNldHVwKHByb3BzLCB7IGVtaXQsIGF0dHJzIH0pOiAoKSA9PiBWTm9kZSB7XG4gICAgY29uc3Qgc3RhdGU6IFRleHRGaWVsZFN0YXRlID0gcmVhY3RpdmUoe1xuICAgICAgdmFsdWU6ICcnLFxuICAgICAgZm9jdXNlZDogZmFsc2UsXG4gICAgfSlcblxuICAgIHN0YXRlLnZhbHVlID0gcHJvcHMubW9kZWxWYWx1ZSB8fCBwcm9wcy52YWx1ZVxuXG4gICAgY29uc3QgZmllbGRzOiBSZWY8YW55W10+IHwgdW5kZWZpbmVkID0gcHJvcHMucnVsZXMgJiYgaW5qZWN0KCdmaWVsZHMnKVxuXG4gICAgY29uc3QgeyBzZXRUZXh0Q29sb3IgfSA9IHVzZUNvbG9ycygpXG5cbiAgICBjb25zdCB7XG4gICAgICB2YWxpZGF0ZSxcbiAgICAgIGRpcnR5LFxuICAgICAgdXBkYXRlLFxuICAgICAgZXJyb3JTdGF0ZSxcbiAgICAgIHZhbGlkYXRlQ2xhc3NlcyxcbiAgICAgIHZhbGlkYXRpb25TdGF0ZSxcbiAgICB9ID0gdXNlVmFsaWRhdGUocHJvcHMpXG5cbiAgICB3YXRjaCgoKSA9PiAocHJvcHMubW9kZWxWYWx1ZSB8fCBwcm9wcy52YWx1ZSksIHZhbHVlID0+IHtcbiAgICAgICAgc3RhdGUudmFsdWUgPSB2YWx1ZVxuICAgICAgICB2YWxpZGF0ZVZhbHVlKClcbiAgICAgIH0sXG4gICAgKVxuXG4gICAgY29uc3QgY2xhc3NlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+PigoKSA9PiAoe1xuICAgICAgICAndi10ZXh0LWZpZWxkJzogdHJ1ZSxcbiAgICAgICAgJ3YtdGV4dC1maWVsZC0tZGlzYWJsZWQnOiBwcm9wcy5kaXNhYmxlZCxcbiAgICAgICAgJ3YtdGV4dC1maWVsZC0tZGlydHknOiBlcnJvclN0YXRlLmlzRGlydHksXG4gICAgICAgICd2LXRleHQtZmllbGQtLXZhbGlkJzogZXJyb3JTdGF0ZS5pc0RpcnR5ICYmICFlcnJvclN0YXRlLmlubmVyRXJyb3IsXG4gICAgICAgICd2LXRleHQtZmllbGQtLW5vdC12YWxpZCc6IGVycm9yU3RhdGUuaXNEaXJ0eSAmJiAhIWVycm9yU3RhdGUuaW5uZXJFcnJvcixcbiAgICAgICAgLi4udmFsaWRhdGVDbGFzc2VzLnZhbHVlLFxuICAgICAgfSksXG4gICAgKVxuXG4gICAgZnVuY3Rpb24gdmFsaWRhdGVWYWx1ZSgpOiBib29sZWFuIHwgdm9pZCB7XG4gICAgICByZXR1cm4gcHJvcHMucnVsZXM/Lmxlbmd0aCAmJiB2YWxpZGF0ZShzdGF0ZS52YWx1ZSlcbiAgICB9XG5cbiAgICBpZiAoZmllbGRzPy52YWx1ZSAmJiBwcm9wcy5ydWxlcz8ubGVuZ3RoKSB7XG4gICAgICBmaWVsZHMhLnZhbHVlLnB1c2godmFsaWRhdGVWYWx1ZSlcbiAgICB9XG5cbiAgICBvbkJlZm9yZVVubW91bnQoKCkgPT4ge1xuICAgICAgaWYgKGZpZWxkcz8udmFsdWUpIHtcbiAgICAgICAgZmllbGRzLnZhbHVlID0gZmllbGRzLnZhbHVlLmZpbHRlcih2ID0+IHYgIT09IHZhbGlkYXRlVmFsdWUpXG4gICAgICB9XG4gICAgfSlcblxuICAgIGZ1bmN0aW9uIGZvY3VzSGFuZGxlcigpIHtcbiAgICAgIGRpcnR5KClcbiAgICAgIHVwZGF0ZShlcnJvclN0YXRlLmlubmVyRXJyb3IpXG4gICAgICBzdGF0ZS5mb2N1c2VkID0gdHJ1ZVxuICAgICAgZW1pdCgnZm9jdXMnKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJsdXJIYW5kbGVyKCkge1xuICAgICAgc3RhdGUuZm9jdXNlZCA9IGZhbHNlXG4gICAgICBlbWl0KCdibHVyJylcbiAgICAgIHZhbGlkYXRlVmFsdWUoKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNoYW5nZUhhbmRsZXIoKSB7XG4gICAgICBlbWl0KCdjaGFuZ2UnLCBzdGF0ZS52YWx1ZSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbnB1dEhhbmRsZXIoZSkge1xuICAgICAgc3RhdGUudmFsdWUgPSBlLnRhcmdldC52YWx1ZVxuICAgICAgZW1pdCgndXBkYXRlOm1vZGVsVmFsdWUnLCBzdGF0ZS52YWx1ZSlcbiAgICAgIGVtaXQoJ3VwZGF0ZTp2YWx1ZScsIHN0YXRlLnZhbHVlKVxuICAgICAgZW1pdCgnaW5wdXQnLCBzdGF0ZS52YWx1ZSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5JbnB1dCgpOiBWTm9kZSB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGRpc2FibGVkOiBwcm9wcy5kaXNhYmxlZCxcbiAgICAgICAgcmVhZG9ubHk6IHByb3BzLnJlYWRvbmx5LFxuICAgICAgICB2YWx1ZTogc3RhdGUudmFsdWUsXG4gICAgICAgIGF1dG9jb21wbGV0ZTogYXR0cnMuYXV0b2NvbXBsZXRlLFxuICAgICAgICBjbGFzczoge1xuICAgICAgICAgICd2LXRleHQtZmllbGRfX2lucHV0JzogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgb25Gb2N1czogZm9jdXNIYW5kbGVyLFxuICAgICAgICBvbkJsdXI6IGJsdXJIYW5kbGVyLFxuICAgICAgICBvbklucHV0OiBpbnB1dEhhbmRsZXIsXG4gICAgICAgIG9uQ2hhbmdlOiBjaGFuZ2VIYW5kbGVyLFxuICAgICAgfVxuXG4gICAgICBpZiAocHJvcHMudGFnID09PSAnaW5wdXQnKSB7XG4gICAgICAgIChwcm9wc0RhdGEgYXMgYW55KS50eXBlID0gcHJvcHMudHlwZVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChwcm9wcy50YWcsXG4gICAgICAgIHByb3BzLmRhcmtcbiAgICAgICAgICA/IHNldFRleHRDb2xvcignd2hpdGUnLCBwcm9wc0RhdGEpXG4gICAgICAgICAgOiBwcm9wc0RhdGEsXG4gICAgICApXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuVGV4dEZpZWxkKCk6IFZOb2RlIHtcbiAgICAgIHJldHVybiBoKCdkaXYnLCB7XG4gICAgICAgICAgY2xhc3M6IGNsYXNzZXMudmFsdWUsXG4gICAgICAgIH0sIGdlbklucHV0KCksXG4gICAgICApXG4gICAgfVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgbGFiZWw6IHByb3BzLmxhYmVsLFxuICAgICAgICBmb2N1c2VkOiBzdGF0ZS5mb2N1c2VkLFxuICAgICAgICBoYXNTdGF0ZTogISFzdGF0ZS52YWx1ZSxcbiAgICAgICAgaGFzRXJyb3I6IGVycm9yU3RhdGUuaW5uZXJFcnJvcixcbiAgICAgICAgZGFyazogcHJvcHMuZGFyayxcbiAgICAgICAgY29sb3I6IHZhbGlkYXRpb25TdGF0ZS52YWx1ZSxcbiAgICAgICAgaXNEaXJ0eTogZXJyb3JTdGF0ZS5pc0RpcnR5LFxuICAgICAgICBkaXNhYmxlZDogcHJvcHMuZGlzYWJsZWQsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yU3RhdGUuaW5uZXJFcnJvck1lc3NhZ2UsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKFZJbnB1dCwgcHJvcHNEYXRhLCB7XG4gICAgICAgICAgdGV4dEZpZWxkOiAoKSA9PiBnZW5UZXh0RmllbGQoKSxcbiAgICAgICAgfSxcbiAgICAgIClcbiAgICB9XG4gIH0sXG59KVxuIl19