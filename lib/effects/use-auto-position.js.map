{"version":3,"sources":["../../../src/effects/use-auto-position.ts"],"names":[],"mappings":"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","sourcesContent":["import { ref, reactive } from 'vue'\nimport { Dimensions } from '../../types'\n\ntype MainDimensions = {\n  activator: Dimensions\n  content: Dimensions\n  pageYOffset: number\n  pageWidth: number\n}\n\nexport function useAutoPosition(props) {\n  const dimensions = reactive<MainDimensions>({\n    activator: {\n      top: 0,\n      left: 0,\n      bottom: 0,\n      right: 0,\n      width: 0,\n      height: 0,\n    },\n    content: {\n      top: 0,\n      left: 0,\n      bottom: 0,\n      right: 0,\n      width: 0,\n      height: 0,\n    },\n    pageYOffset: 0,\n    pageWidth: 0,\n  })\n\n  const contentRef = ref<HTMLElement | any | null>(null)\n  const offset: number = +props.offsetY || 10\n\n  let activator: HTMLElement\n  let content: HTMLElement\n  let activatorRect: Dimensions\n  let diff: number\n  let minDiff: number\n\n  function getBoundedClientRect(el) {\n    const rect = el.getBoundingClientRect()\n\n    return {\n      top: rect.top,\n      left: rect.left,\n      bottom: rect.bottom,\n      right: rect.right,\n      width: rect.width,\n      height: rect.height,\n    }\n  }\n\n  function getInnerHeight(): number {\n    if (!window) return 0\n\n    return innerHeight || document.documentElement.clientHeight\n  }\n\n  function getOffsetTop(): number {\n    if (!window) return 0\n\n    return pageYOffset || document.documentElement.scrollTop\n  }\n\n  function calcDiffs() {\n    const scrollHeight = getOffsetTop() + getInnerHeight()\n    const contentFull = dimensions.content.height + dimensions.activator.top\n\n    diff = scrollHeight - contentFull\n    minDiff = (dimensions.content.height / 100) * 10\n  }\n\n  function calcTopPosition() {\n    calcDiffs()\n\n    if (props.bottom) {\n      if (diff <= minDiff)\n        return dimensions.activator.top - dimensions.content.height\n\n      return dimensions.activator.top + dimensions.activator.height\n    }\n\n    if (diff <= minDiff) return dimensions.activator.top + diff\n\n    return dimensions.activator.top\n  }\n\n  function snapShot(cb) {\n    requestAnimationFrame(() => {\n      if (!content || content.style.display !== 'none') return cb()\n      content.style.display = 'inline-block'\n      cb()\n      content.style.display = 'none'\n    })\n  }\n\n  function updateDimensions(): Promise<void> {\n    return new Promise((resolve) => {\n      snapShot(() => {\n        dimensions.activator.height = activator.offsetHeight\n        dimensions.content.height = content.offsetHeight\n\n        activatorRect = getBoundedClientRect(activator)\n\n        setActivatorDimensions()\n        setContentDimensions()\n        resolve()\n      })\n    })\n  }\n\n  function setActivatorDimensions() {\n    dimensions.activator.width = activatorRect.width\n    dimensions.activator.top = activatorRect.top + pageYOffset\n    dimensions.activator.left = activatorRect.left\n  }\n\n  function setContentDimensions() {\n    dimensions.content.top =\n      calcTopPosition() - ((!props.bottom && offset) || 0)\n\n    dimensions.content.left = dimensions.activator.left\n    dimensions.content.width = dimensions.activator.width\n  }\n\n  function setDimensions(activatorEl) {\n    if (!activator) {\n      activator = activatorEl\n      content = contentRef.value\n    }\n\n    return updateDimensions()\n  }\n\n  return {\n    dimensions,\n    contentRef,\n    setDimensions,\n    updateDimensions,\n  }\n}\n"],"sourceRoot":"","file":"use-auto-position.js"}