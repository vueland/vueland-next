{"version":3,"sources":["../../../src/effects/use-auto-position.ts"],"names":[],"mappings":"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","sourcesContent":["import { ref, reactive, computed } from 'vue'\nimport { Dimensions } from '../../types'\n\ntype MainDimensions = {\n  activator: Dimensions\n  content: Dimensions\n  pageYOffset: number\n  pageWidth: number\n}\n\nexport function autoPositionProps() {\n  return {\n    positionX: {\n      type: Number,\n      default: 0,\n    },\n    positionY: {\n      type: Number,\n      default: 0,\n    },\n  }\n}\n\nexport function useAutoPosition(props) {\n  const dimensions = reactive<MainDimensions>({\n    activator: {\n      top: 0,\n      left: 0,\n      bottom: 0,\n      right: 0,\n      width: 0,\n      height: 0,\n    },\n    content: {\n      top: 0,\n      left: 0,\n      bottom: 0,\n      right: 0,\n      width: 0,\n      height: 0,\n    },\n    pageYOffset: 0,\n    pageWidth: 0,\n  })\n\n  const contentRef = ref<HTMLElement | any | null>(null)\n  const offset: number = +props.offsetY || 10\n\n  let activator: HTMLElement\n  let content: HTMLElement\n  let diff: number\n  let minDiff: number\n\n  function getBoundedClientRect(el) {\n    const rect = el.getBoundingClientRect()\n\n    return {\n      top: rect.top,\n      left: rect.left,\n      bottom: rect.bottom,\n      right: rect.right,\n      width: rect.width,\n      height: rect.height,\n    }\n  }\n\n  const isAbsolutePositioned = computed(() => {\n    return props.positionY || props.positionX\n  })\n\n  function getInnerHeight(): number {\n    if (!window) return 0\n\n    return innerHeight || document.documentElement.clientHeight\n  }\n\n  function getOffsetTop(): number {\n    if (!window) return 0\n\n    return pageYOffset || document.documentElement.scrollTop\n  }\n\n  function getOffsetLeft(): number {\n    if (!window) return 0\n\n    return pageXOffset || document.documentElement.scrollLeft\n  }\n\n  function getContentAbsoluteBottom() {\n    return dimensions.content.height + props.positionY + getOffsetTop()\n  }\n\n  function getContentBottom() {\n    return dimensions.content.height + dimensions.activator.top\n  }\n\n  function calcDiffs() {\n    const pageHeight = getOffsetTop() + getInnerHeight() - offset\n\n    const contentBottom = isAbsolutePositioned.value\n      ? getContentAbsoluteBottom()\n      : getContentBottom()\n\n    minDiff = (dimensions.content.height / 100) * 10\n\n    return pageHeight - contentBottom\n  }\n\n  function calcLeftPosition(): number {\n    if (props.positionX) return props.positionX + getOffsetLeft()\n\n    return dimensions.activator.left\n  }\n\n  function calcTopPosition(): number {\n    diff = calcDiffs()\n\n    if (props.positionY) {\n      if (diff <= minDiff) return props.positionY + getOffsetTop() + diff\n\n      return props.positionY + getOffsetTop()\n    }\n\n    if (props.bottom) {\n      if (diff <= minDiff)\n        return dimensions.activator.top - dimensions.content.height\n\n      return dimensions.activator.top + dimensions.activator.height\n    }\n\n    if (diff <= minDiff) return dimensions.activator.top + diff\n\n    return dimensions.activator.top\n  }\n\n  function snapShot(cb) {\n    requestAnimationFrame(() => {\n      if (!content || content.style.display !== 'none') return cb()\n      content.style.display = 'inline-block'\n      cb()\n      content.style.display = 'none'\n    })\n  }\n\n  function updateDimensions(): Promise<void> {\n    return new Promise((resolve) => {\n      snapShot(() => {\n        activator && setActivatorDimensions()\n        content && setContentDimensions()\n        resolve()\n      })\n    })\n  }\n\n  function setActivatorDimensions() {\n    dimensions.activator = getBoundedClientRect(activator)\n\n    dimensions.activator.height = activator.offsetHeight\n    dimensions.activator.top = dimensions.activator.top + getOffsetTop()\n    dimensions.activator.left = dimensions.activator.left + getOffsetLeft()\n  }\n\n  function setContentDimensions() {\n    const rect = activator\n      ? dimensions.activator\n      : getBoundedClientRect(content)\n\n    dimensions.content.height = content.offsetHeight\n    dimensions.content.top = calcTopPosition()\n    dimensions.content.left = calcLeftPosition()\n    dimensions.content.width = rect.width\n  }\n\n  function setDimensions(activatorEl) {\n    if (!activator && !content) {\n      activator = activatorEl\n      content = contentRef.value\n    }\n\n    return updateDimensions()\n  }\n\n  return {\n    dimensions,\n    contentRef,\n    setDimensions,\n    updateDimensions,\n  }\n}\n"],"sourceRoot":"","file":"use-auto-position.js"}