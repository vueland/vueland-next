import { defineComponent, h, provide, watch, ref, toRaw, computed, onMounted } from 'vue';
import { useColors, colorProps } from '../../composables/use-colors';
import { mapToValArray } from '../../helpers';
export default defineComponent({
    name: 'v-list',
    props: {
        value: {
            type: [Number, Array],
            default: null,
        },
        multiple: Boolean,
        active: {
            type: Boolean,
            default: false,
        },
        activeClass: {
            type: String,
            default: '',
        },
        textColor: {
            type: String,
            default: '',
        },
        ...colorProps(),
    },
    emits: ['update:value'],
    setup(props, { emit, slots }) {
        const { setTextClassNameColor, setBackgroundClassNameColor, setTextCssColor, setBackgroundCssColor, } = useColors();
        const items = ref(new Map());
        let isTrustedSelect = false;
        const classes = computed(() => ({
            'v-list': true,
            'v-list--active': props.active,
            'v-list--themeable': !props.color,
            'v-list--base': !props.color,
            ...setTextClassNameColor(props.textColor),
            ...setBackgroundClassNameColor(props.color),
        }));
        const styles = computed(() => ({
            ...setTextCssColor(props.textColor),
            ...setBackgroundCssColor(props.color),
        }));
        const register = (item) => {
            !items.value.has(item) && items.value.set(item, item);
        };
        const unregister = (item) => {
            items.value.has(item) && items.value.delete(item);
        };
        const dispatchEvent = (val) => {
            isTrustedSelect = true;
            emit('update:value', val);
        };
        const setActiveItem = (item) => {
            mapToValArray(toRaw(items.value)).forEach((it) => {
                it.isActive.value = it === item;
            });
        };
        const toggleItem = (item) => {
            item.isActive.value = !item.isActive.value;
        };
        const prepareIndexes = () => {
            const values = mapToValArray(toRaw(items.value));
            const { multiple } = props;
            let val = multiple ? [] : 0;
            values.forEach((it, i) => {
                if (it.isActive.value) {
                    multiple ? val.push(i) : (val = i);
                }
            });
            return val;
        };
        const onClick = (item) => {
            if (!props.active)
                return;
            props.multiple ? toggleItem(item) : setActiveItem(item);
            dispatchEvent(prepareIndexes());
        };
        const setItemState = (value) => {
            if (value === null)
                return setActiveItem(value);
            const values = mapToValArray(toRaw(items.value));
            if (values.length) {
                if (props.multiple) {
                    ;
                    value.forEach((ind) => toggleItem(values[ind]));
                }
                else {
                    setActiveItem(values[value]);
                }
            }
        };
        watch(() => props.value, (to) => {
            if (!isTrustedSelect)
                setItemState(to);
            isTrustedSelect && (isTrustedSelect = false);
        });
        const stop = watch(items, () => {
            setItemState(props.value);
            stop();
        }, { deep: true });
        onMounted(() => setItemState(props.value));
        provide('$v_list', {
            add: register,
            remove: unregister,
            click: onClick,
            activeClass: props.activeClass,
        });
        return () => h('div', { class: classes.value, style: styles.value }, { default: () => slots.default?.() });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkxpc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy92dWVsYW5kL3NyYy9jb21wb25lbnRzL1ZMaXN0L1ZMaXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxlQUFlLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sS0FBSyxDQUFBO0FBQ3pGLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sOEJBQThCLENBQUE7QUFDcEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQUU3QyxlQUFlLGVBQWUsQ0FBQztJQUM3QixJQUFJLEVBQUUsUUFBUTtJQUNkLEtBQUssRUFBRTtRQUNMLEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxDQUFFLE1BQU0sRUFBRSxLQUFLLENBQUU7WUFDdkIsT0FBTyxFQUFFLElBQUk7U0FDZDtRQUNELFFBQVEsRUFBRSxPQUFPO1FBQ2pCLE1BQU0sRUFBRTtZQUNOLElBQUksRUFBRSxPQUFPO1lBQ2IsT0FBTyxFQUFFLEtBQUs7U0FDZjtRQUNELFdBQVcsRUFBRTtZQUNYLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELFNBQVMsRUFBRTtZQUNULElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELEdBQUcsVUFBVSxFQUFFO0tBQ2hCO0lBQ0QsS0FBSyxFQUFFLENBQUUsY0FBYyxDQUFFO0lBQ3pCLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFO1FBQzFCLE1BQU0sRUFDSixxQkFBcUIsRUFDckIsMkJBQTJCLEVBQzNCLGVBQWUsRUFDZixxQkFBcUIsR0FDdEIsR0FBRyxTQUFTLEVBQUUsQ0FBQTtRQUVmLE1BQU0sS0FBSyxH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QUMsS0FBSyxDQUFDLENBQUE7WUFDekIsSUFBSSxFQUFFLENBQUE7UUFDUixDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQTtRQUVsQixTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO1FBRTFDLE9BQU8sQ0FBQyxTQUFTLEVBQUU7WUFDakIsR0FBRyxFQUFFLFFBQVE7WUFDYixNQUFNLEVBQUUsVUFBVTtZQUNsQixLQUFLLEVBQUUsT0FBTztZQUNkLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztTQUMvQixDQUFDLENBQUE7UUFFRixPQUFPLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FDWixLQUFLLEVBQ0wsRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUssRUFBRSxFQUM3QyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEVBQUUsRUFBRSxDQUNyQyxDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlZmluZUNvbXBvbmVudCwgaCwgcHJvdmlkZSwgd2F0Y2gsIHJlZiwgdG9SYXcsIGNvbXB1dGVkLCBvbk1vdW50ZWQgfSBmcm9tICd2dWUnXG5pbXBvcnQgeyB1c2VDb2xvcnMsIGNvbG9yUHJvcHMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlcy91c2UtY29sb3JzJ1xuaW1wb3J0IHsgbWFwVG9WYWxBcnJheSB9IGZyb20gJy4uLy4uL2hlbHBlcnMnXG5cbmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LWxpc3QnLFxuICBwcm9wczoge1xuICAgIHZhbHVlOiB7XG4gICAgICB0eXBlOiBbIE51bWJlciwgQXJyYXkgXSxcbiAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgfSxcbiAgICBtdWx0aXBsZTogQm9vbGVhbixcbiAgICBhY3RpdmU6IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiBmYWxzZSxcbiAgICB9LFxuICAgIGFjdGl2ZUNsYXNzOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJyxcbiAgICB9LFxuICAgIHRleHRDb2xvcjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJycsXG4gICAgfSxcbiAgICAuLi5jb2xvclByb3BzKCksXG4gIH0sXG4gIGVtaXRzOiBbICd1cGRhdGU6dmFsdWUnIF0sXG4gIHNldHVwKHByb3BzLCB7IGVtaXQsIHNsb3RzIH0pIHtcbiAgICBjb25zdCB7XG4gICAgICBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IsXG4gICAgICBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IsXG4gICAgICBzZXRUZXh0Q3NzQ29sb3IsXG4gICAgICBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IsXG4gICAgfSA9IHVzZUNvbG9ycygpXG5cbiAgICBjb25zdCBpdGVtcyA9IHJlZjxNYXA8YW55LCBhbnk+PihuZXcgTWFwKCkpXG4gICAgbGV0IGlzVHJ1c3RlZFNlbGVjdCA9IGZhbHNlXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+ICh7XG4gICAgICAndi1saXN0JzogdHJ1ZSxcbiAgICAgICd2LWxpc3QtLWFjdGl2ZSc6IHByb3BzLmFjdGl2ZSxcbiAgICAgICd2LWxpc3QtLXRoZW1lYWJsZSc6ICFwcm9wcy5jb2xvcixcbiAgICAgICd2LWxpc3QtLWJhc2UnOiAhcHJvcHMuY29sb3IsXG4gICAgICAuLi5zZXRUZXh0Q2xhc3NOYW1lQ29sb3IocHJvcHMudGV4dENvbG9yKSxcbiAgICAgIC4uLnNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcihwcm9wcy5jb2xvciksXG4gICAgfSkpXG5cbiAgICBjb25zdCBzdHlsZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+PigoKSA9PiAoe1xuICAgICAgLi4uc2V0VGV4dENzc0NvbG9yKHByb3BzLnRleHRDb2xvciksXG4gICAgICAuLi5zZXRCYWNrZ3JvdW5kQ3NzQ29sb3IocHJvcHMuY29sb3IpLFxuICAgIH0pKVxuXG4gICAgY29uc3QgcmVnaXN0ZXIgPSAoaXRlbSkgPT4ge1xuICAgICAgIWl0ZW1zLnZhbHVlLmhhcyhpdGVtKSAmJiBpdGVtcy52YWx1ZS5zZXQoaXRlbSwgaXRlbSlcbiAgICB9XG5cbiAgICBjb25zdCB1bnJlZ2lzdGVyID0gKGl0ZW0pID0+IHtcbiAgICAgIGl0ZW1zLnZhbHVlLmhhcyhpdGVtKSAmJiBpdGVtcy52YWx1ZS5kZWxldGUoaXRlbSlcbiAgICB9XG5cbiAgICBjb25zdCBkaXNwYXRjaEV2ZW50ID0gKHZhbCkgPT4ge1xuICAgICAgaXNUcnVzdGVkU2VsZWN0ID0gdHJ1ZVxuICAgICAgZW1pdCgndXBkYXRlOnZhbHVlJywgdmFsKVxuICAgIH1cblxuICAgIGNvbnN0IHNldEFjdGl2ZUl0ZW0gPSAoaXRlbSkgPT4ge1xuICAgICAgbWFwVG9WYWxBcnJheSh0b1JhdyhpdGVtcy52YWx1ZSkpLmZvckVhY2goKGl0KSA9PiB7XG4gICAgICAgIGl0LmlzQWN0aXZlLnZhbHVlID0gaXQgPT09IGl0ZW1cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc3QgdG9nZ2xlSXRlbSA9IChpdGVtKSA9PiB7XG4gICAgICBpdGVtLmlzQWN0aXZlLnZhbHVlID0gIWl0ZW0uaXNBY3RpdmUudmFsdWVcbiAgICB9XG5cbiAgICBjb25zdCBwcmVwYXJlSW5kZXhlcyA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlcyA9IG1hcFRvVmFsQXJyYXkodG9SYXcoaXRlbXMudmFsdWUpKVxuICAgICAgY29uc3QgeyBtdWx0aXBsZSB9ID0gcHJvcHNcblxuICAgICAgbGV0IHZhbCA9IG11bHRpcGxlID8gW10gOiAwXG5cbiAgICAgIHZhbHVlcy5mb3JFYWNoKChpdCwgaSkgPT4ge1xuICAgICAgICBpZiAoaXQuaXNBY3RpdmUudmFsdWUpIHtcbiAgICAgICAgICBtdWx0aXBsZSA/ICh2YWwgYXMgbnVtYmVyW10pLnB1c2goaSkgOiAodmFsID0gaSlcbiAgICAgICAgfVxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHZhbFxuICAgIH1cblxuICAgIGNvbnN0IG9uQ2xpY2sgPSAoaXRlbSkgPT4ge1xuICAgICAgaWYgKCFwcm9wcy5hY3RpdmUpIHJldHVyblxuXG4gICAgICBwcm9wcy5tdWx0aXBsZSA/IHRvZ2dsZUl0ZW0oaXRlbSkgOiBzZXRBY3RpdmVJdGVtKGl0ZW0pXG4gICAgICAvLyAhcHJvcHMubXVsdGlwbGUgJiZcblxuICAgICAgZGlzcGF0Y2hFdmVudChwcmVwYXJlSW5kZXhlcygpKVxuICAgIH1cblxuICAgIGNvbnN0IHNldEl0ZW1TdGF0ZSA9ICh2YWx1ZSkgPT4ge1xuICAgICAgaWYgKHZhbHVlID09PSBudWxsKSByZXR1cm4gc2V0QWN0aXZlSXRlbSh2YWx1ZSlcblxuICAgICAgY29uc3QgdmFsdWVzID0gbWFwVG9WYWxBcnJheSh0b1JhdyhpdGVtcy52YWx1ZSkpXG5cbiAgICAgIGlmICh2YWx1ZXMubGVuZ3RoKSB7XG4gICAgICAgIGlmIChwcm9wcy5tdWx0aXBsZSkge1xuICAgICAgICAgIDsodmFsdWUgYXMgbnVtYmVyW10pLmZvckVhY2goKGluZCkgPT4gdG9nZ2xlSXRlbSh2YWx1ZXNbaW5kXSkpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2V0QWN0aXZlSXRlbSh2YWx1ZXNbdmFsdWUgYXMgbnVtYmVyXSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHdhdGNoKCgpID0+IHByb3BzLnZhbHVlLCAodG8pID0+IHtcbiAgICAgICAgaWYgKCFpc1RydXN0ZWRTZWxlY3QpIHNldEl0ZW1TdGF0ZSh0bylcbiAgICAgICAgaXNUcnVzdGVkU2VsZWN0ICYmIChpc1RydXN0ZWRTZWxlY3QgPSBmYWxzZSlcbiAgICAgIH0sXG4gICAgKVxuXG4gICAgLy8gdGhpcyBwYXJ0IGlzIGZvciBmaXhpbmdcbiAgICAvLyBhc3luYyBjb21wb25lbnRzIG1vdW50aW5nIHNlcXVlbmNlXG4gICAgY29uc3Qgc3RvcCA9IHdhdGNoKGl0ZW1zLCAoKSA9PiB7XG4gICAgICBzZXRJdGVtU3RhdGUocHJvcHMudmFsdWUpXG4gICAgICBzdG9wKClcbiAgICB9LCB7IGRlZXA6IHRydWUgfSlcblxuICAgIG9uTW91bnRlZCgoKSA9PiBzZXRJdGVtU3RhdGUocHJvcHMudmFsdWUpKVxuXG4gICAgcHJvdmlkZSgnJHZfbGlzdCcsIHtcbiAgICAgIGFkZDogcmVnaXN0ZXIsXG4gICAgICByZW1vdmU6IHVucmVnaXN0ZXIsXG4gICAgICBjbGljazogb25DbGljayxcbiAgICAgIGFjdGl2ZUNsYXNzOiBwcm9wcy5hY3RpdmVDbGFzcyxcbiAgICB9KVxuXG4gICAgcmV0dXJuICgpID0+IGgoXG4gICAgICAnZGl2JyxcbiAgICAgIHsgY2xhc3M6IGNsYXNzZXMudmFsdWUsIHN0eWxlOiBzdHlsZXMudmFsdWUgfSxcbiAgICAgIHsgZGVmYXVsdDogKCkgPT4gc2xvdHMuZGVmYXVsdD8uKCkgfSxcbiAgICApXG4gIH0sXG59KVxuIl19