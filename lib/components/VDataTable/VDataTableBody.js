import { h, ref, watch, computed, defineComponent } from 'vue';
import { colorProps, useColors } from '../../composables/use-colors';
import { VDataTableCell } from './VDataTableCell';
import { VCheckbox } from '../VCheckbox';
export const VDataTableBody = defineComponent({
    name: 'v-data-table-body',
    props: {
        cols: Array,
        rows: Array,
        dark: Boolean,
        showSequence: Boolean,
        showCheckbox: Boolean,
        checkAllRows: Boolean,
        align: String,
        colWidth: {
            type: [String, Number],
            default: 125,
        },
        page: Number,
        rowsOnPage: Number,
        ...colorProps(),
    },
    emits: ['select', 'click:row', 'dblclick:row', 'contextmenu:row'],
    setup(props, { slots, emit }) {
        const checkedRows = ref([]);
        const { setBackgroundCssColor, setBackgroundClassNameColor } = useColors();
        const classes = computed(() => ({
            'v-data-table__body': true,
            ...(props.color ? setBackgroundClassNameColor(props.color) : {}),
        }));
        const styles = computed(() => ({
            ...(props.color ? setBackgroundCssColor(props.color) : {}),
        }));
        const rowsOnTable = computed(() => {
            return props.rows?.slice((props.page - 1) * props.rowsOnPage, props.page * props.rowsOnPage);
        });
        watch(() => props.checkAllRows, (to) => {
            if (to)
                onSelectRows(props.rows);
            else
                onSelectRows([]);
        });
        const onSelectRows = (rows) => {
            checkedRows.value = rows;
            emit('select', checkedRows.value);
        };
        const genNumberCell = (count) => {
            return h(VDataTableCell, {
                width: 50,
                align: 'center',
                dark: props.dark,
                color: props.color,
                class: 'v-data-table__row-number',
            }, {
                default: () => count + 1,
            });
        };
        const genCheckboxCell = (row) => {
            return h(VDataTableCell, {
                width: 50,
                align: 'center',
                dark: props.dark,
                color: props.color,
                class: 'v-data-table__row-checkbox',
            }, {
                default: () => h(VCheckbox, {
                    modelValue: checkedRows.value,
                    value: row,
                    onChange: onSelectRows,
                }),
            });
        };
        const genRowCell = (col, row) => {
            const { format } = col;
            const slotContent = slots[col.key] &&
                slots[col.key]({
                    row,
                    format,
                });
            return h(VDataTableCell, {
                width: col.width,
                align: col.align || props.align,
                dark: props.dark,
            }, {
                default: () => slotContent
                    ? slotContent
                    : format
                        ? format(row)
                        : String(row[col.key]),
            });
        };
        const genTableRow = (row, rowCount) => {
            const rowCells = [];
            props.showSequence && rowCells.push(genNumberCell(rowCount));
            props.showCheckbox && rowCells.push(genCheckboxCell(row));
            props.cols.forEach((col) => {
                col.show && rowCells.push(genRowCell(col, row));
            });
            return h('div', {
                class: { 'v-data-table__row': true },
                onClick: () => emit('click:row', row),
                onDblclick: () => emit('dblclick:row', row),
                onContextmenu: (e) => {
                    e.preventDefault();
                    emit('contextmenu:row', row);
                },
            }, rowCells);
        };
        const genTableRows = () => {
            const tableRows = [];
            const rowsLength = rowsOnTable.value?.length;
            const count = (props.page - 1) * props.rowsOnPage;
            for (let i = 0; i < rowsLength; i += 1) {
                tableRows.push(genTableRow(rowsOnTable.value[i], count + i));
            }
            return tableRows;
        };
        return () => h('div', {
            class: classes.value,
            style: styles.value,
        }, genTableRows());
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGFUYWJsZUJvZHkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy92dWVsYW5kL3NyYy9jb21wb25lbnRzL1ZEYXRhVGFibGUvVkRhdGFUYWJsZUJvZHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxlQUFlLEVBQUUsTUFBTSxLQUFLLENBQUE7QUFHOUQsT0FBTyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQTtBQUdwRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFDakQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQTtBQUt4QyxNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsZUFBZSxDQUFDO0lBQzVDLElBQUksRUFBRSxtQkFBbUI7SUFFekIsS0FBSyxFQUFFO1FBQ0wsSUFBSSxFQUFFLEtBQUs7UUFDWCxJQUFJLEVBQUUsS0FBSztRQUNYLElBQUksRUFBRSxPQUFPO1FBQ2IsWUFBWSxFQUFFLE9BQU87UUFDckIsWUFBWSxFQUFFLE9BQU87UUFDckIsWUFBWSxFQUFFLE9BQU87UUFDckIsS0FBSyxFQUFFLE1BQU07UUFDYixRQUFRLEVBQUU7WUFDUixJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1lBQ3RCLE9BQU8sRUFBRSxHQUFHO1NBQ2I7UUFDRCxJQUFJLEVBQUUsTUFBTTtRQUNaLFVBQVUsRUFBRSxNQUFNO1FBQ2xCLEdBQUcsVUFBVSxFQUFFO0tBQ1Q7SUFFUixLQUFLLEVBQUUsQ0FBQyxRQUFRLEVBQUUsV0FBVyxFQUFFLGNBQWMsRUFBRSxpQkFBaUIsQ0FBQztJQUVqRSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtRQUMxQixNQUFNLFdBQVcsR0FBRyxHQUFHLENB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SVxuaW1wb3J0IHsgaCwgcmVmLCB3YXRjaCwgY29tcHV0ZWQsIGRlZmluZUNvbXBvbmVudCB9IGZyb20gJ3Z1ZSdcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgY29sb3JQcm9wcywgdXNlQ29sb3JzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZXMvdXNlLWNvbG9ycydcblxuLy8gQ29tcG9uZW50c1xuaW1wb3J0IHsgVkRhdGFUYWJsZUNlbGwgfSBmcm9tICcuL1ZEYXRhVGFibGVDZWxsJ1xuaW1wb3J0IHsgVkNoZWNrYm94IH0gZnJvbSAnLi4vVkNoZWNrYm94J1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5cbmV4cG9ydCBjb25zdCBWRGF0YVRhYmxlQm9keSA9IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LWRhdGEtdGFibGUtYm9keScsXG5cbiAgcHJvcHM6IHtcbiAgICBjb2xzOiBBcnJheSxcbiAgICByb3dzOiBBcnJheSxcbiAgICBkYXJrOiBCb29sZWFuLFxuICAgIHNob3dTZXF1ZW5jZTogQm9vbGVhbixcbiAgICBzaG93Q2hlY2tib3g6IEJvb2xlYW4sXG4gICAgY2hlY2tBbGxSb3dzOiBCb29sZWFuLFxuICAgIGFsaWduOiBTdHJpbmcsXG4gICAgY29sV2lkdGg6IHtcbiAgICAgIHR5cGU6IFtTdHJpbmcsIE51bWJlcl0sXG4gICAgICBkZWZhdWx0OiAxMjUsXG4gICAgfSxcbiAgICBwYWdlOiBOdW1iZXIsXG4gICAgcm93c09uUGFnZTogTnVtYmVyLFxuICAgIC4uLmNvbG9yUHJvcHMoKSxcbiAgfSBhcyBhbnksXG5cbiAgZW1pdHM6IFsnc2VsZWN0JywgJ2NsaWNrOnJvdycsICdkYmxjbGljazpyb3cnLCAnY29udGV4dG1lbnU6cm93J10sXG5cbiAgc2V0dXAocHJvcHMsIHsgc2xvdHMsIGVtaXQgfSk6ICgpID0+IFZOb2RlIHtcbiAgICBjb25zdCBjaGVja2VkUm93cyA9IHJlZihbXSlcblxuICAgIGNvbnN0IHsgc2V0QmFja2dyb3VuZENzc0NvbG9yLCBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IgfSA9IHVzZUNvbG9ycygpXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+ICh7XG4gICAgICAndi1kYXRhLXRhYmxlX19ib2R5JzogdHJ1ZSxcbiAgICAgIC4uLihwcm9wcy5jb2xvciA/IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcihwcm9wcy5jb2xvcikgOiB7fSksXG4gICAgfSkpXG5cbiAgICBjb25zdCBzdHlsZXMgPSBjb21wdXRlZCgoKSA9PiAoe1xuICAgICAgLi4uKHByb3BzLmNvbG9yID8gc2V0QmFja2dyb3VuZENzc0NvbG9yKHByb3BzLmNvbG9yKSA6IHt9KSxcbiAgICB9KSlcblxuICAgIGNvbnN0IHJvd3NPblRhYmxlID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYW55PltdPigoKSA9PiB7XG4gICAgICByZXR1cm4gcHJvcHMucm93cz8uc2xpY2UoXG4gICAgICAgIChwcm9wcy5wYWdlIC0gMSkgKiBwcm9wcy5yb3dzT25QYWdlLFxuICAgICAgICBwcm9wcy5wYWdlICogcHJvcHMucm93c09uUGFnZSxcbiAgICAgIClcbiAgICB9KVxuXG4gICAgd2F0Y2goXG4gICAgICAoKSA9PiBwcm9wcy5jaGVja0FsbFJvd3MsXG4gICAgICAodG8pID0+IHtcbiAgICAgICAgaWYgKHRvKSBvblNlbGVjdFJvd3MocHJvcHMucm93cylcbiAgICAgICAgZWxzZSBvblNlbGVjdFJvd3MoW10pXG4gICAgICB9LFxuICAgIClcblxuICAgIGNvbnN0IG9uU2VsZWN0Um93cyA9IChyb3dzKSA9PiB7XG4gICAgICBjaGVja2VkUm93cy52YWx1ZSA9IHJvd3NcbiAgICAgIGVtaXQoJ3NlbGVjdCcsIGNoZWNrZWRSb3dzLnZhbHVlKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbk51bWJlckNlbGwgPSAoY291bnQpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaChcbiAgICAgICAgVkRhdGFUYWJsZUNlbGwsXG4gICAgICAgIHtcbiAgICAgICAgICB3aWR0aDogNTAsXG4gICAgICAgICAgYWxpZ246ICdjZW50ZXInLFxuICAgICAgICAgIGRhcms6IHByb3BzLmRhcmssXG4gICAgICAgICAgY29sb3I6IHByb3BzLmNvbG9yLFxuICAgICAgICAgIGNsYXNzOiAndi1kYXRhLXRhYmxlX19yb3ctbnVtYmVyJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRlZmF1bHQ6ICgpID0+IGNvdW50ICsgMSxcbiAgICAgICAgfSxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5DaGVja2JveENlbGwgPSAocm93KTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoXG4gICAgICAgIFZEYXRhVGFibGVDZWxsLFxuICAgICAgICB7XG4gICAgICAgICAgd2lkdGg6IDUwLFxuICAgICAgICAgIGFsaWduOiAnY2VudGVyJyxcbiAgICAgICAgICBkYXJrOiBwcm9wcy5kYXJrLFxuICAgICAgICAgIGNvbG9yOiBwcm9wcy5jb2xvcixcbiAgICAgICAgICBjbGFzczogJ3YtZGF0YS10YWJsZV9fcm93LWNoZWNrYm94JyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRlZmF1bHQ6ICgpID0+XG4gICAgICAgICAgICBoKFZDaGVja2JveCwge1xuICAgICAgICAgICAgICBtb2RlbFZhbHVlOiBjaGVja2VkUm93cy52YWx1ZSxcbiAgICAgICAgICAgICAgdmFsdWU6IHJvdyxcbiAgICAgICAgICAgICAgb25DaGFuZ2U6IG9uU2VsZWN0Um93cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlblJvd0NlbGwgPSAoY29sLCByb3cpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCB7IGZvcm1hdCB9ID0gY29sXG4gICAgICBjb25zdCBzbG90Q29udGVudCA9XG4gICAgICAgIHNsb3RzW2NvbC5rZXldICYmXG4gICAgICAgIHNsb3RzW2NvbC5rZXldISh7XG4gICAgICAgICAgcm93LFxuICAgICAgICAgIGZvcm1hdCxcbiAgICAgICAgfSlcblxuICAgICAgcmV0dXJuIGgoXG4gICAgICAgIFZEYXRhVGFibGVDZWxsLFxuICAgICAgICB7XG4gICAgICAgICAgd2lkdGg6IGNvbC53aWR0aCxcbiAgICAgICAgICBhbGlnbjogY29sLmFsaWduIHx8IHByb3BzLmFsaWduLFxuICAgICAgICAgIGRhcms6IHByb3BzLmRhcmssXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWZhdWx0OiAoKSA9PlxuICAgICAgICAgICAgc2xvdENvbnRlbnRcbiAgICAgICAgICAgICAgPyBzbG90Q29udGVudFxuICAgICAgICAgICAgICA6IGZvcm1hdFxuICAgICAgICAgICAgICA/IGZvcm1hdChyb3cpXG4gICAgICAgICAgICAgIDogU3RyaW5nKHJvd1tjb2wua2V5XSksXG4gICAgICAgIH0sXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuVGFibGVSb3cgPSAocm93LCByb3dDb3VudDogbnVtYmVyKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3Qgcm93Q2VsbHM6IFZOb2RlW10gPSBbXVxuXG4gICAgICBwcm9wcy5zaG93U2VxdWVuY2UgJiYgcm93Q2VsbHMucHVzaChnZW5OdW1iZXJDZWxsKHJvd0NvdW50KSlcbiAgICAgIHByb3BzLnNob3dDaGVja2JveCAmJiByb3dDZWxscy5wdXNoKGdlbkNoZWNrYm94Q2VsbChyb3cpKVxuXG4gICAgICBwcm9wcy5jb2xzLmZvckVhY2goKGNvbCkgPT4ge1xuICAgICAgICBjb2wuc2hvdyAmJiByb3dDZWxscy5wdXNoKGdlblJvd0NlbGwoY29sLCByb3cpKVxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIGgoXG4gICAgICAgICdkaXYnLFxuICAgICAgICB7XG4gICAgICAgICAgY2xhc3M6IHsgJ3YtZGF0YS10YWJsZV9fcm93JzogdHJ1ZSB9LFxuICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IGVtaXQoJ2NsaWNrOnJvdycsIHJvdyksXG4gICAgICAgICAgb25EYmxjbGljazogKCkgPT4gZW1pdCgnZGJsY2xpY2s6cm93Jywgcm93KSxcbiAgICAgICAgICBvbkNvbnRleHRtZW51OiAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICBlbWl0KCdjb250ZXh0bWVudTpyb3cnLCByb3cpXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcm93Q2VsbHMsXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuVGFibGVSb3dzID0gKCk6IFZOb2RlW10gPT4ge1xuICAgICAgY29uc3QgdGFibGVSb3dzOiBWTm9kZVtdID0gW11cbiAgICAgIGNvbnN0IHJvd3NMZW5ndGggPSByb3dzT25UYWJsZS52YWx1ZT8ubGVuZ3RoXG4gICAgICBjb25zdCBjb3VudCA9IChwcm9wcy5wYWdlIC0gMSkgKiBwcm9wcy5yb3dzT25QYWdlXG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm93c0xlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIHRhYmxlUm93cy5wdXNoKGdlblRhYmxlUm93KHJvd3NPblRhYmxlLnZhbHVlW2ldLCBjb3VudCArIGkpKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGFibGVSb3dzXG4gICAgfVxuXG4gICAgcmV0dXJuICgpID0+IGgoJ2RpdicsIHtcbiAgICAgIGNsYXNzOiBjbGFzc2VzLnZhbHVlLFxuICAgICAgc3R5bGU6IHN0eWxlcy52YWx1ZSxcbiAgICB9LCBnZW5UYWJsZVJvd3MoKSlcbiAgfSxcbn0pXG4iXX0=