import { defineComponent, h, watch, inject, computed, onBeforeMount, onBeforeUnmount, } from 'vue';
import { validationProps } from '../../composable/use-validation';
import { useColors, colorProps } from '../../composable/use-colors';
import { useInputStates } from '../../composable/use-input-states';
import { useTransition } from '../../composable/use-transition';
import { VLabel } from '../VLabel';
import { VIcon } from '../VIcon';
export default defineComponent({
    name: 'v-input',
    components: {
        VLabel,
        VIcon,
    },
    inheritAttrs: false,
    props: {
        label: {
            type: String,
            default: '',
        },
        prependIcon: {
            type: String,
            default: '',
        },
        appendIcon: {
            type: String,
            default: '',
        },
        disabled: Boolean,
        focused: Boolean,
        readonly: Boolean,
        file: Boolean,
        hints: {
            type: Boolean,
            default: true,
        },
        hintMessage: {
            type: String,
            default: '',
        },
        textColor: {
            type: String,
            default: '',
        },
        ...validationProps(),
        ...colorProps(),
    },
    setup(props, { attrs, emit, slots, expose }) {
        const { setTextCssColor, setTextClassNameColor } = useColors();
        const { inputState, errorState, isDisabled, isReadonly, stateClasses, validate, onFocus, onBlur } = useInputStates(props, { attrs, emit });
        const form = inject('form', null);
        const textClassColor = setTextClassNameColor(props.textColor);
        const textCssColor = setTextCssColor(props.textColor);
        const hasPrependIcon = computed(() => {
            return !!props.prependIcon || !!slots['prepend-icon'];
        });
        const hasAppendIcon = computed(() => {
            return !!props.appendIcon || !!slots['append-icon'];
        });
        const classes = computed(() => ({
            'v-input': true,
            'v-input--focused': inputState.focused && !isReadonly.value,
            'v-input--disabled': isDisabled.value,
            'v-input--readonly': isReadonly.value,
            'v-input--file': props.file,
            'v-input--has-prepend-icon': hasPrependIcon.value,
            'v-input--has-append-icon': hasAppendIcon.value,
            'v-input--not-valid': !!errorState.innerError,
            ...stateClasses.value,
            ...(!props.disabled && !errorState.innerError ? setTextClassNameColor(props.color) : {}),
            ...attrs.class,
        }));
        const styles = computed(() => ({
            ...(!props.disabled && !errorState.innerError ? setTextCssColor(props.color) : {}),
            ...attrs.style,
        }));
        watch(() => props.value, (to) => inputState.value = to);
        const genLabel = () => {
            const label = h(VLabel, {
                class: 'v-label--on-input',
                disabled: isDisabled.value,
                focused: inputState.focused,
                color: !errorState.innerError ? props.color : '',
            }, {
                default: () => props.label,
            });
            return h('div', { class: 'v-input__label' }, [label]);
        };
        const genIcon = (iconName, clickable = false) => {
            return h(VIcon, {
                icon: iconName,
                size: 16,
                disabled: props.disabled,
                clickable,
            });
        };
        const genPrependIcon = () => {
            let content;
            if (props.prependIcon) {
                content = genIcon(props.prependIcon);
            }
            else {
                content = slots['prepend-icon']?.();
            }
            return content ?
                h('div', { class: 'v-input__prepend-icon' }, content)
                : null;
        };
        const genAppendIcon = () => {
            let content;
            if (props.appendIcon) {
                content = genIcon(props.appendIcon);
            }
            else {
                content = slots['append-icon']?.();
            }
            return content ?
                h('div', { class: 'v-input__append-icon' }, content)
                : null;
        };
        const genTextFieldSlot = () => {
            const prependIconContent = genPrependIcon();
            const appendIconContent = genAppendIcon();
            const { disabled } = props;
            const textFieldContent = slots['text-field']?.({
                textCssColor,
                textClassColor,
                disabled,
            });
            return h('div', { class: 'v-input__text-field' }, [prependIconContent, textFieldContent, appendIconContent]);
        };
        const genHintMessage = () => {
            return !!errorState.innerErrorMessage ? h('span', { class: 'v-input__hints-message' }, [errorState.innerErrorMessage]) : null;
        };
        const genHints = () => {
            return h('div', { class: 'v-input__hints' }, useTransition(genHintMessage(), 'fade'));
        };
        const genSelectSlot = () => {
            return slots.select ?
                h('div', { class: 'v-input__selects' }, slots.select?.())
                : null;
        };
        onBeforeMount(() => {
            if (props.rules)
                form?.add(validate);
        });
        onBeforeUnmount(() => {
            form?.remove(validate);
        });
        expose({
            onFocus,
            onBlur,
        });
        return () => h('div', { class: classes.value, style: styles.value }, [
            genLabel(),
            genTextFieldSlot(),
            genHints(),
            genSelectSlot(),
        ]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVklucHV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVklucHV0L1ZJbnB1dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0wsZUFBZSxFQUNmLENBQUMsRUFDRCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFFBQVEsRUFDUixhQUFhLEVBQ2IsZUFBZSxHQUVoQixNQUFNLEtBQUssQ0FBQTtBQUdaLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQTtBQUNqRSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLDZCQUE2QixDQUFBO0FBQ25FLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQTtBQUNsRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUNBQWlDLENBQUE7QUFHL0QsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQTtBQUNsQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBU2hDLGVBQWUsZUFBZSxDQUFDO0lBQzdCLElBQUksRUFBRSxTQUFTO0lBQ2YsVUFBVSxFQUFFO1FBQ1YsTUFBTTtRQUNOLEtBQUs7S0FDTjtJQUNELFlBQVksRUFBRSxLQUFLO0lBQ25CLEtBQUssRUFBRTtRQUNMLEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELFdBQVcsRUFBRTtZQUNYLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELFVBQVUsRUFBRTtZQUNWLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELFFBQVEsRUFBRSxPQUFPO1FBQ2pCLE9BQU8sRUFBRSxPQUFPO1FBQ2hCLFFBQVEsRUFBRSxPQUFPO1FBQ2pCLElBQUksRUFBRSxPQUFPO1FBQ2IsS0FBSyxFQUFFO1lBQ0wsSUFBSSxF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Q0FDRixDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7XG4gIGRlZmluZUNvbXBvbmVudCxcbiAgaCxcbiAgd2F0Y2gsXG4gIGluamVjdCxcbiAgY29tcHV0ZWQsXG4gIG9uQmVmb3JlTW91bnQsXG4gIG9uQmVmb3JlVW5tb3VudCxcbiAgVk5vZGUsXG59IGZyb20gJ3Z1ZSdcblxuLy8gQ29tcG9zYWJsZVxuaW1wb3J0IHsgdmFsaWRhdGlvblByb3BzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtdmFsaWRhdGlvbidcbmltcG9ydCB7IHVzZUNvbG9ycywgY29sb3JQcm9wcyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLWNvbG9ycydcbmltcG9ydCB7IHVzZUlucHV0U3RhdGVzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtaW5wdXQtc3RhdGVzJ1xuaW1wb3J0IHsgdXNlVHJhbnNpdGlvbiB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLXRyYW5zaXRpb24nXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCB7IFZMYWJlbCB9IGZyb20gJy4uL1ZMYWJlbCdcbmltcG9ydCB7IFZJY29uIH0gZnJvbSAnLi4vVkljb24nXG5cbmltcG9ydCB7IE1heWJlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvYmFzZSdcblxudHlwZSBGb3JtID0ge1xuICBhZGQ6IChpdGVtOiAodmFsPzogYW55KSA9PiBib29sZWFuIHwgdm9pZCkgPT4gdm9pZFxuICByZW1vdmU6IChpdGVtOiAodmFsPzogYW55KSA9PiBib29sZWFuIHwgdm9pZCkgPT4gdm9pZFxufVxuXG5leHBvcnQgZGVmYXVsdCBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAndi1pbnB1dCcsXG4gIGNvbXBvbmVudHM6IHtcbiAgICBWTGFiZWwsXG4gICAgVkljb24sXG4gIH0sXG4gIGluaGVyaXRBdHRyczogZmFsc2UsXG4gIHByb3BzOiB7XG4gICAgbGFiZWw6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcnLFxuICAgIH0sXG4gICAgcHJlcGVuZEljb246IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcnLFxuICAgIH0sXG4gICAgYXBwZW5kSWNvbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJycsXG4gICAgfSxcbiAgICBkaXNhYmxlZDogQm9vbGVhbixcbiAgICBmb2N1c2VkOiBCb29sZWFuLFxuICAgIHJlYWRvbmx5OiBCb29sZWFuLFxuICAgIGZpbGU6IEJvb2xlYW4sXG4gICAgaGludHM6IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiB0cnVlLFxuICAgIH0sXG4gICAgaGludE1lc3NhZ2U6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcnLFxuICAgIH0sXG4gICAgdGV4dENvbG9yOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJyxcbiAgICB9LFxuICAgIC4uLnZhbGlkYXRpb25Qcm9wcygpLFxuICAgIC4uLmNvbG9yUHJvcHMoKSxcbiAgfSxcblxuICBzZXR1cChwcm9wcywgeyBhdHRycywgZW1pdCwgc2xvdHMsIGV4cG9zZSB9KSB7XG4gICAgY29uc3QgeyBzZXRUZXh0Q3NzQ29sb3IsIHNldFRleHRDbGFzc05hbWVDb2xvciB9ID0gdXNlQ29sb3JzKClcbiAgICBjb25zdCB7XG4gICAgICBpbnB1dFN0YXRlLFxuICAgICAgZXJyb3JTdGF0ZSxcbiAgICAgIGlzRGlzYWJsZWQsXG4gICAgICBpc1JlYWRvbmx5LFxuICAgICAgc3RhdGVDbGFzc2VzLFxuICAgICAgdmFsaWRhdGUsXG4gICAgICBvbkZvY3VzLFxuICAgICAgb25CbHVyXG4gICAgfSA9IHVzZUlucHV0U3RhdGVzKHByb3BzLCB7IGF0dHJzLCBlbWl0IH0pXG5cbiAgICBjb25zdCBmb3JtOiBNYXliZTxGb3JtPiA9IGluamVjdCgnZm9ybScsIG51bGwgYXMgYW55KVxuXG4gICAgY29uc3QgdGV4dENsYXNzQ29sb3IgPSBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IocHJvcHMudGV4dENvbG9yKVxuICAgIGNvbnN0IHRleHRDc3NDb2xvciA9IHNldFRleHRDc3NDb2xvcihwcm9wcy50ZXh0Q29sb3IpXG5cbiAgICBjb25zdCBoYXNQcmVwZW5kSWNvbiA9IGNvbXB1dGVkPGJvb2xlYW4+KCgpID0+IHtcbiAgICAgIHJldHVybiAhIXByb3BzLnByZXBlbmRJY29uIHx8ICEhc2xvdHNbJ3ByZXBlbmQtaWNvbiddXG4gICAgfSlcblxuICAgIGNvbnN0IGhhc0FwcGVuZEljb24gPSBjb21wdXRlZDxib29sZWFuPigoKSA9PiB7XG4gICAgICByZXR1cm4gISFwcm9wcy5hcHBlbmRJY29uIHx8ICEhc2xvdHNbJ2FwcGVuZC1pY29uJ11cbiAgICB9KVxuXG4gICAgY29uc3QgY2xhc3NlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+PigoKSA9PiAoe1xuICAgICAgJ3YtaW5wdXQnOiB0cnVlLFxuICAgICAgJ3YtaW5wdXQtLWZvY3VzZWQnOiBpbnB1dFN0YXRlLmZvY3VzZWQgJiYgIWlzUmVhZG9ubHkudmFsdWUsXG4gICAgICAndi1pbnB1dC0tZGlzYWJsZWQnOiBpc0Rpc2FibGVkLnZhbHVlLFxuICAgICAgJ3YtaW5wdXQtLXJlYWRvbmx5JzogaXNSZWFkb25seS52YWx1ZSxcbiAgICAgICd2LWlucHV0LS1maWxlJzogcHJvcHMuZmlsZSxcbiAgICAgICd2LWlucHV0LS1oYXMtcHJlcGVuZC1pY29uJzogaGFzUHJlcGVuZEljb24udmFsdWUsXG4gICAgICAndi1pbnB1dC0taGFzLWFwcGVuZC1pY29uJzogaGFzQXBwZW5kSWNvbi52YWx1ZSxcbiAgICAgICd2LWlucHV0LS1ub3QtdmFsaWQnOiAhIWVycm9yU3RhdGUuaW5uZXJFcnJvcixcbiAgICAgIC4uLnN0YXRlQ2xhc3Nlcy52YWx1ZSxcbiAgICAgIC4uLighcHJvcHMuZGlzYWJsZWQgJiYgIWVycm9yU3RhdGUuaW5uZXJFcnJvciA/IHNldFRleHRDbGFzc05hbWVDb2xvcihwcm9wcy5jb2xvcikgOiB7fSksXG4gICAgICAuLi4oYXR0cnMuY2xhc3MgYXMgb2JqZWN0KSxcbiAgICB9KSlcblxuICAgIGNvbnN0IHN0eWxlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIHN0cmluZz4+KCgpID0+ICh7XG4gICAgICAuLi4oIXByb3BzLmRpc2FibGVkICYmICFlcnJvclN0YXRlLmlubmVyRXJyb3IgPyBzZXRUZXh0Q3NzQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgICAgLi4uKGF0dHJzLnN0eWxlIGFzIG9iamVjdCksXG4gICAgfSkpXG5cbiAgICB3YXRjaChcbiAgICAgICgpID0+IHByb3BzLnZhbHVlLFxuICAgICAgKHRvKSA9PiBpbnB1dFN0YXRlLnZhbHVlID0gdG8gYXMgc3RyaW5nLFxuICAgIClcblxuICAgIGNvbnN0IGdlbkxhYmVsID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IGxhYmVsID0gaChWTGFiZWwsIHtcbiAgICAgICAgICBjbGFzczogJ3YtbGFiZWwtLW9uLWlucHV0JyxcbiAgICAgICAgICBkaXNhYmxlZDogaXNEaXNhYmxlZC52YWx1ZSxcbiAgICAgICAgICBmb2N1c2VkOiBpbnB1dFN0YXRlLmZvY3VzZWQsXG4gICAgICAgICAgY29sb3I6ICFlcnJvclN0YXRlLmlubmVyRXJyb3IgPyBwcm9wcy5jb2xvciA6ICcnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgZGVmYXVsdDogKCkgPT4gcHJvcHMubGFiZWwsXG4gICAgICAgIH0sXG4gICAgICApXG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCB7IGNsYXNzOiAndi1pbnB1dF9fbGFiZWwnIH0sIFtsYWJlbF0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuSWNvbiA9IChpY29uTmFtZSwgY2xpY2thYmxlID0gZmFsc2UpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaChWSWNvbiwge1xuICAgICAgICBpY29uOiBpY29uTmFtZSxcbiAgICAgICAgc2l6ZTogMTYsXG4gICAgICAgIGRpc2FibGVkOiBwcm9wcy5kaXNhYmxlZCxcbiAgICAgICAgY2xpY2thYmxlLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5QcmVwZW5kSWNvbiA9ICgpOiBNYXliZTxWTm9kZT4gPT4ge1xuICAgICAgbGV0IGNvbnRlbnRcblxuICAgICAgaWYgKHByb3BzLnByZXBlbmRJY29uKSB7XG4gICAgICAgIGNvbnRlbnQgPSBnZW5JY29uKHByb3BzLnByZXBlbmRJY29uKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udGVudCA9IHNsb3RzWydwcmVwZW5kLWljb24nXT8uKClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNvbnRlbnQgP1xuICAgICAgICBoKCdkaXYnLCB7IGNsYXNzOiAndi1pbnB1dF9fcHJlcGVuZC1pY29uJyB9LCBjb250ZW50KVxuICAgICAgICA6IG51bGxcbiAgICB9XG5cbiAgICBjb25zdCBnZW5BcHBlbmRJY29uID0gKCk6IE1heWJlPFZOb2RlPiA9PiB7XG4gICAgICBsZXQgY29udGVudFxuXG4gICAgICBpZiAocHJvcHMuYXBwZW5kSWNvbikge1xuICAgICAgICBjb250ZW50ID0gZ2VuSWNvbihwcm9wcy5hcHBlbmRJY29uKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udGVudCA9IHNsb3RzWydhcHBlbmQtaWNvbiddPy4oKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gY29udGVudCA/XG4gICAgICAgIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWlucHV0X19hcHBlbmQtaWNvbicgfSwgY29udGVudClcbiAgICAgICAgOiBudWxsXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuVGV4dEZpZWxkU2xvdCA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHByZXBlbmRJY29uQ29udGVudCA9IGdlblByZXBlbmRJY29uKClcbiAgICAgIGNvbnN0IGFwcGVuZEljb25Db250ZW50ID0gZ2VuQXBwZW5kSWNvbigpXG4gICAgICBjb25zdCB7IGRpc2FibGVkIH0gPSBwcm9wc1xuXG4gICAgICBjb25zdCB0ZXh0RmllbGRDb250ZW50ID0gc2xvdHNbJ3RleHQtZmllbGQnXT8uKHtcbiAgICAgICAgdGV4dENzc0NvbG9yLFxuICAgICAgICB0ZXh0Q2xhc3NDb2xvcixcbiAgICAgICAgZGlzYWJsZWQsXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogJ3YtaW5wdXRfX3RleHQtZmllbGQnIH0sXG4gICAgICAgIFtwcmVwZW5kSWNvbkNvbnRlbnQsIHRleHRGaWVsZENvbnRlbnQsIGFwcGVuZEljb25Db250ZW50XSxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5IaW50TWVzc2FnZSA9ICgpOiBNYXliZTxWTm9kZT4gPT4ge1xuICAgICAgcmV0dXJuICEhZXJyb3JTdGF0ZS5pbm5lckVycm9yTWVzc2FnZSA/IGgoXG4gICAgICAgICdzcGFuJyxcbiAgICAgICAgeyBjbGFzczogJ3YtaW5wdXRfX2hpbnRzLW1lc3NhZ2UnIH0sXG4gICAgICAgIFtlcnJvclN0YXRlLmlubmVyRXJyb3JNZXNzYWdlXSxcbiAgICAgICkgOiBudWxsXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuSGludHMgPSAoKTogTWF5YmU8Vk5vZGU+ID0+IHtcbiAgICAgIHJldHVybiBoKFxuICAgICAgICAnZGl2JyxcbiAgICAgICAgeyBjbGFzczogJ3YtaW5wdXRfX2hpbnRzJyB9LFxuICAgICAgICB1c2VUcmFuc2l0aW9uKGdlbkhpbnRNZXNzYWdlKCkhLCAnZmFkZScpLFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlblNlbGVjdFNsb3QgPSAoKTogTWF5YmU8Vk5vZGU+ID0+IHtcbiAgICAgIHJldHVybiBzbG90cy5zZWxlY3QgP1xuICAgICAgICBoKCdkaXYnLCB7IGNsYXNzOiAndi1pbnB1dF9fc2VsZWN0cycgfSwgc2xvdHMuc2VsZWN0Py4oKSlcbiAgICAgICAgOiBudWxsXG4gICAgfVxuXG4gICAgb25CZWZvcmVNb3VudCgoKSA9PiB7XG4gICAgICBpZiAocHJvcHMucnVsZXMpIGZvcm0/LmFkZCh2YWxpZGF0ZSlcbiAgICB9KVxuXG4gICAgb25CZWZvcmVVbm1vdW50KCgpID0+IHtcbiAgICAgIGZvcm0/LnJlbW92ZSh2YWxpZGF0ZSlcbiAgICB9KVxuXG4gICAgZXhwb3NlKHtcbiAgICAgIG9uRm9jdXMsXG4gICAgICBvbkJsdXIsXG4gICAgfSlcblxuICAgIHJldHVybiAoKSA9PiBoKCdkaXYnLCB7IGNsYXNzOiBjbGFzc2VzLnZhbHVlLCBzdHlsZTogc3R5bGVzLnZhbHVlIH0sXG4gICAgICBbXG4gICAgICAgIGdlbkxhYmVsKCksXG4gICAgICAgIGdlblRleHRGaWVsZFNsb3QoKSxcbiAgICAgICAgZ2VuSGludHMoKSxcbiAgICAgICAgZ2VuU2VsZWN0U2xvdCgpLFxuICAgICAgXSxcbiAgICApXG4gIH0sXG59KVxuIl19