import { h, defineComponent, ref, computed } from 'vue';
import { VInput } from '../VInput';
import { VChip } from '../VChip';
import { useIcons } from '../../composables/use-icons';
import { useInputStates } from '../../composables/use-input-states';
import { uniqueArray } from '../../helpers';
export default defineComponent({
    name: 'v-file-input',
    props: {
        disabled: Boolean,
        multiple: Boolean,
        chipColor: {
            type: String,
            default: 'primary',
        },
        value: {
            type: Array,
            default: () => [],
        },
    },
    emits: ['update:value', 'delete'],
    setup(props, { emit, attrs }) {
        const { icons } = useIcons();
        const { isDisabled, isReadonly } = useInputStates(props, { emit, attrs });
        const inputRef = ref(null);
        const srcRef = ref(null);
        const classes = computed(() => ({
            'v-file-input': true,
            'v-file-input--disabled': isDisabled.value,
            'v-file-input--readonly': isReadonly.value,
            'v-file-input--multiple': props.multiple,
        }));
        const onChange = (event) => {
            let files = Array.from(event.target.files);
            if (props.multiple) {
                files = uniqueArray(props.value.concat(files));
            }
            event.target.value = '';
            emit('update:value', files);
        };
        const onClose = (file) => {
            const files = props.value.filter(it => {
                return file.name !== it.name;
            });
            emit('update:value', files);
            emit('delete', file);
        };
        const onClick = ({ srcElement }) => {
            if (srcElement !== srcRef.value)
                return;
            inputRef.value.click();
        };
        const genFileInput = () => {
            return h('input', {
                class: 'v-file-input__field',
                type: 'file',
                multiple: props.multiple,
                ref: inputRef,
                style: {
                    position: 'absolute',
                    visibility: 'hidden',
                },
                onChange,
            });
        };
        const genChips = () => {
            return uniqueArray(props.value)
                .map(file => h(VChip, {
                title: file.name,
                class: 'ma-1',
                color: props.chipColor,
                onClose: () => onClose(file),
            }));
        };
        const genChipsContainer = () => {
            return h('div', {
                class: 'v-file-input__container',
                ref: srcRef,
            }, genChips());
        };
        const genComponent = () => h('div', {
            class: classes.value,
            onClick,
        }, [
            genFileInput(),
            genChipsContainer(),
        ]);
        return () => h(VInput, {
            prependIcon: icons.$paperclip,
            file: true,
            disabled: isDisabled.value,
        }, {
            'text-field': () => genComponent(),
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkZpbGVJbnB1dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZGaWxlSW5wdXQvVkZpbGVJbnB1dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsQ0FBQyxFQUFFLGVBQWUsRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFZLE1BQU0sS0FBSyxDQUFBO0FBRWpFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFDbEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUVoQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sNkJBQTZCLENBQUE7QUFDdEQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9DQUFvQyxDQUFBO0FBRW5FLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFJM0MsZUFBZSxlQUFlLENBQUM7SUFDN0IsSUFBSSxFQUFFLGNBQWM7SUFDcEIsS0FBSyxFQUFFO1FBQ0wsUUFBUSxFQUFFLE9BQU87UUFDakIsUUFBUSxFQUFFLE9BQU87UUFDakIsU0FBUyxFQUFFO1lBQ1QsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsU0FBUztTQUNuQjtRQUNELEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxLQUE4QjtZQUNwQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRTtTQUNsQjtLQUNGO0lBQ0QsS0FBSyxFQUFFLENBQUMsY0FBYyxFQUFFLFFBQVEsQ0FBQztJQUNqQyxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRTtRQUMxQixNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsUUFBUSxFQUFFLENBQUE7UUFDNUIsTUFBTSxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsR0FBRyxjQUFjLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUE7UUFF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QyxDQUFDLENBQUMsS0FBSyxFQUFFO1lBQ2xDLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSztZQUNwQixPQUFPO1NBQ1IsRUFBRTtZQUNELFlBQVksRUFBRTtZQUNkLGlCQUFpQixFQUFFO1NBQ3BCLENBQUMsQ0FBQTtRQUVGLE9BQU8sR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRTtZQUNyQixXQUFXLEVBQUUsS0FBSyxDQUFDLFVBQVU7WUFDN0IsSUFBSSxFQUFFLElBQUk7WUFDVixRQUFRLEVBQUUsVUFBVSxDQUFDLEtBQUs7U0FDM0IsRUFBRTtZQUNELFlBQVksRUFBRSxHQUFHLEVBQUUsQ0FBQyxZQUFZLEVBQUU7U0FDbkMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7IGgsIGRlZmluZUNvbXBvbmVudCwgcmVmLCBjb21wdXRlZCwgUHJvcFR5cGUgfSBmcm9tICd2dWUnXG4vLyBDb21wb25lbnRzXG5pbXBvcnQgeyBWSW5wdXQgfSBmcm9tICcuLi9WSW5wdXQnXG5pbXBvcnQgeyBWQ2hpcCB9IGZyb20gJy4uL1ZDaGlwJ1xuLy8gQ29tcG9zYWJsZXNcbmltcG9ydCB7IHVzZUljb25zIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZXMvdXNlLWljb25zJ1xuaW1wb3J0IHsgdXNlSW5wdXRTdGF0ZXMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlcy91c2UtaW5wdXQtc3RhdGVzJ1xuLy8gSGVscGVyc1xuaW1wb3J0IHsgdW5pcXVlQXJyYXkgfSBmcm9tICcuLi8uLi9oZWxwZXJzJ1xuLy8gVHlwZXNcbmltcG9ydCB7IE1heWJlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvYmFzZSdcblxuZXhwb3J0IGRlZmF1bHQgZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3YtZmlsZS1pbnB1dCcsXG4gIHByb3BzOiB7XG4gICAgZGlzYWJsZWQ6IEJvb2xlYW4sXG4gICAgbXVsdGlwbGU6IEJvb2xlYW4sXG4gICAgY2hpcENvbG9yOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAncHJpbWFyeScsXG4gICAgfSxcbiAgICB2YWx1ZToge1xuICAgICAgdHlwZTogQXJyYXkgYXMgUHJvcFR5cGU8QXJyYXk8RmlsZT4+LFxuICAgICAgZGVmYXVsdDogKCkgPT4gW10sXG4gICAgfSxcbiAgfSxcbiAgZW1pdHM6IFsndXBkYXRlOnZhbHVlJywgJ2RlbGV0ZSddLFxuICBzZXR1cChwcm9wcywgeyBlbWl0LCBhdHRycyB9KSB7XG4gICAgY29uc3QgeyBpY29ucyB9ID0gdXNlSWNvbnMoKVxuICAgIGNvbnN0IHsgaXNEaXNhYmxlZCwgaXNSZWFkb25seSB9ID0gdXNlSW5wdXRTdGF0ZXMocHJvcHMsIHsgZW1pdCwgYXR0cnMgfSlcblxuICAgIGNvbnN0IGlucHV0UmVmID0gcmVmPE1heWJlPEhUTUxJbnB1dEVsZW1lbnQ+PihudWxsKVxuICAgIGNvbnN0IHNyY1JlZiA9IHJlZjxNYXliZTxIVE1MRWxlbWVudD4+KG51bGwpXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQoKCkgPT4gKHtcbiAgICAgICd2LWZpbGUtaW5wdXQnOiB0cnVlLFxuICAgICAgJ3YtZmlsZS1pbnB1dC0tZGlzYWJsZWQnOiBpc0Rpc2FibGVkLnZhbHVlLFxuICAgICAgJ3YtZmlsZS1pbnB1dC0tcmVhZG9ubHknOiBpc1JlYWRvbmx5LnZhbHVlLFxuICAgICAgJ3YtZmlsZS1pbnB1dC0tbXVsdGlwbGUnOiBwcm9wcy5tdWx0aXBsZSxcbiAgICB9KSlcblxuICAgIGNvbnN0IG9uQ2hhbmdlID0gKGV2ZW50KSA9PiB7XG4gICAgICBsZXQgZmlsZXMgPSBBcnJheS5mcm9tKGV2ZW50LnRhcmdldC5maWxlcykgYXMgRmlsZVtdXG5cbiAgICAgIGlmIChwcm9wcy5tdWx0aXBsZSkge1xuICAgICAgICBmaWxlcyA9IHVuaXF1ZUFycmF5PEZpbGU+KHByb3BzLnZhbHVlLmNvbmNhdChmaWxlcykpXG4gICAgICB9XG5cbiAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9ICcnXG4gICAgICBlbWl0KCd1cGRhdGU6dmFsdWUnLCBmaWxlcylcbiAgICB9XG5cbiAgICBjb25zdCBvbkNsb3NlID0gKGZpbGUpID0+IHtcbiAgICAgIGNvbnN0IGZpbGVzID0gcHJvcHMudmFsdWUuZmlsdGVyKGl0ID0+IHtcbiAgICAgICAgcmV0dXJuIGZpbGUubmFtZSAhPT0gaXQubmFtZVxuICAgICAgfSlcblxuICAgICAgZW1pdCgndXBkYXRlOnZhbHVlJywgZmlsZXMpXG4gICAgICBlbWl0KCdkZWxldGUnLCBmaWxlKVxuICAgIH1cblxuICAgIGNvbnN0IG9uQ2xpY2sgPSAoeyBzcmNFbGVtZW50IH0pID0+IHtcbiAgICAgIGlmIChzcmNFbGVtZW50ICE9PSBzcmNSZWYudmFsdWUpIHJldHVyblxuICAgICAgaW5wdXRSZWYudmFsdWUhLmNsaWNrKClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5GaWxlSW5wdXQgPSAoKSA9PiB7XG4gICAgICByZXR1cm4gaCgnaW5wdXQnLCB7XG4gICAgICAgIGNsYXNzOiAndi1maWxlLWlucHV0X19maWVsZCcsXG4gICAgICAgIHR5cGU6ICdmaWxlJyxcbiAgICAgICAgbXVsdGlwbGU6IHByb3BzLm11bHRpcGxlLFxuICAgICAgICByZWY6IGlucHV0UmVmLFxuICAgICAgICBzdHlsZToge1xuICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nLFxuICAgICAgICB9LFxuICAgICAgICBvbkNoYW5nZSxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuQ2hpcHMgPSAoKSA9PiB7XG4gICAgICByZXR1cm4gdW5pcXVlQXJyYXk8RmlsZT4ocHJvcHMudmFsdWUpXG4gICAgICAgIC5tYXAoZmlsZSA9PiBoKFZDaGlwLCB7XG4gICAgICAgICAgICB0aXRsZTogZmlsZS5uYW1lLFxuICAgICAgICAgICAgY2xhc3M6ICdtYS0xJyxcbiAgICAgICAgICAgIGNvbG9yOiBwcm9wcy5jaGlwQ29sb3IsXG4gICAgICAgICAgICBvbkNsb3NlOiAoKSA9PiBvbkNsb3NlKGZpbGUpLFxuICAgICAgICAgIH0pLFxuICAgICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuQ2hpcHNDb250YWluZXIgPSAoKSA9PiB7XG4gICAgICByZXR1cm4gaCgnZGl2Jywge1xuICAgICAgICBjbGFzczogJ3YtZmlsZS1pbnB1dF9fY29udGFpbmVyJyxcbiAgICAgICAgcmVmOiBzcmNSZWYsXG4gICAgICB9LCBnZW5DaGlwcygpKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkNvbXBvbmVudCA9ICgpID0+IGgoJ2RpdicsIHtcbiAgICAgIGNsYXNzOiBjbGFzc2VzLnZhbHVlLFxuICAgICAgb25DbGljayxcbiAgICB9LCBbXG4gICAgICBnZW5GaWxlSW5wdXQoKSxcbiAgICAgIGdlbkNoaXBzQ29udGFpbmVyKCksXG4gICAgXSlcblxuICAgIHJldHVybiAoKSA9PiBoKFZJbnB1dCwge1xuICAgICAgcHJlcGVuZEljb246IGljb25zLiRwYXBlcmNsaXAsXG4gICAgICBmaWxlOiB0cnVlLFxuICAgICAgZGlzYWJsZWQ6IGlzRGlzYWJsZWQudmFsdWUsXG4gICAgfSwge1xuICAgICAgJ3RleHQtZmllbGQnOiAoKSA9PiBnZW5Db21wb25lbnQoKSxcbiAgICB9KVxuICB9LFxufSlcbiJdfQ==