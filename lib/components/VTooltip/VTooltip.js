import { h, shallowRef, reactive, watch, withDirectives, defineComponent, computed, onMounted, vShow, } from 'vue';
import { useToggle } from '../../composable/use-toggle';
import { useColors } from '../../composable/use-colors';
import { useActivator } from '../../composable/use-activator';
import { useTransition } from '../../composable/use-transition';
import { elevationProps, useElevation } from '../../composable/use-elevation';
import { positionProps } from '../../composable/use-position';
import { convertToUnit } from '../../helpers';
import { transitions } from '../../services/transitions';
export default defineComponent({
    name: 'v-tooltip',
    props: {
        openOnHover: {
            type: Boolean,
            default: true,
        },
        color: {
            type: String,
            default: 'grey lighten-1',
        },
        zIndex: [Number, String],
        maxWidth: [Number, String],
        minWidth: [Number, String],
        modelValue: Boolean,
        offsetX: {
            type: [String, Number],
            default: 20,
        },
        offsetY: {
            type: [String, Number],
            default: 20,
        },
        ...elevationProps(),
        ...positionProps(),
    },
    setup(props, { slots }) {
        const tooltip = reactive({});
        const activator = reactive({});
        const tooltipRef = shallowRef(null);
        const { isActive } = useToggle(props);
        const { elevationClasses } = useElevation(props);
        const { setBackgroundClassNameColor, setBackgroundCssColor } = useColors();
        const { activatorRef, getActivatorSizes, genActivatorListeners } = useActivator(props);
        const handlers = {
            mouseenter: () => (isActive.value = true),
            mouseleave: () => (isActive.value = false),
        };
        const listeners = genActivatorListeners(props, handlers);
        const classes = computed(() => ({
            'v-tooltip': true,
            'v-tooltip--top': props.top,
            'v-tooltip--right': props.right,
            'v-tooltip--left': props.left,
            'v-tooltip--bottom': props.bottom,
            ...elevationClasses.value,
            ...(props.color ? setBackgroundClassNameColor(props.color) : {}),
        }));
        const computeTopPosition = computed(() => {
            return ((props.top
                ? activator.top - tooltip.height
                : props.bottom
                    ? activator.top + activator.height
                    : activator.top + (activator.height - tooltip.height) / 2) +
                +props.offsetY);
        });
        const computeLeftPosition = computed(() => {
            return ((props.left
                ? activator.left - tooltip.width
                : props.right
                    ? activator.left + activator.width
                    : activator.left + (activator.width - tooltip.width) / 2) +
                +props.offsetX);
        });
        const styles = computed(() => ({
            top: tooltip.top ? convertToUnit(tooltip.top) : '',
            left: tooltip.top ? convertToUnit(tooltip.left) : '',
            maxWidth: !!props.maxWidth ? `${props.maxWidth}px` : '',
            minWidth: !!props.minWidth ? `${props.minWidth}px` : '',
            zIndex: props.zIndex,
            ...(props.color ? setBackgroundCssColor(props.color) : {}),
        }));
        function genActivator() {
            const slotContent = slots.activator &&
                slots.activator({
                    on: listeners,
                });
            return h(slotContent[0], { ref: activatorRef });
        }
        function genContent() {
            const propsData = {
                class: classes.value,
                style: styles.value,
                ref: tooltipRef,
            };
            return withDirectives(h('span', propsData, slots.default && slots.default()), [[vShow, isActive.value]]);
        }
        function setTooltipPosition() {
            if (tooltipRef.value) {
                tooltip.width = tooltipRef.value.offsetWidth;
                tooltip.height = tooltipRef.value.offsetHeight;
                tooltip.top = computeTopPosition.value;
                tooltip.left = computeLeftPosition.value;
            }
        }
        onMounted(() => {
            watch(() => isActive.value, (to) => {
                if (to) {
                    const { left, top, height, width } = getActivatorSizes();
                    activator.left = left;
                    activator.top = top;
                    activator.height = height;
                    activator.width = width;
                    tooltip.top = 0;
                    tooltip.left = 0;
                    requestAnimationFrame(setTooltipPosition);
                }
            }, { immediate: true });
        });
        return () => {
            const content = useTransition(genContent(), isActive.value ? transitions.SCALE_IN : transitions.FADE);
            return [content, genActivator()];
        };
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlRvb2x0aXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WVG9vbHRpcC9WVG9vbHRpcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0wsQ0FBQyxFQUNELFVBQVUsRUFDVixRQUFRLEVBQ1IsS0FBSyxFQUNMLGNBQWMsRUFDZCxlQUFlLEVBQ2YsUUFBUSxFQUNSLFNBQVMsRUFDVCxLQUFLLEdBQ04sTUFBTSxLQUFLLENBQUE7QUFHWixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sNkJBQTZCLENBQUE7QUFDdkQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDZCQUE2QixDQUFBO0FBQ3ZELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQTtBQUM3RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUNBQWlDLENBQUE7QUFDL0QsT0FBTyxFQUFFLGNBQWMsRUFBRSxZQUFZLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQTtBQUM3RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sK0JBQStCLENBQUE7QUFPN0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQUc3QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNEJBQTRCLENBQUE7QUFJeEQsZUFBZSxlQUFlLENBQUM7SUFDN0IsSUFBSSxFQUFFLFdBQVc7SUFFakIsS0FBSyxFQUFFO1FBQ0wsV0FBVyxFQUFFO1lBQ1gsSUFBSSxFQUFFLE9BQU87WUFDYixPQUFPLEVBQUUsSUFBSTtTQUNkO1FBQ0QsS0FBSyxFQUFFO1lBQ0wsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsZ0JBQWdCO1NBQzFCO1FBQ0QsTUFBTSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztRQUN4QixRQUFRLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1FBQzFCLFFBQVEsRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7UUFDMUIsVUFBVSxFQUFFLE9BQU87UUFDbkIsT0FBTyxFQUFFO1lBQ1AsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztZQUN0QixPQUFPLEVBQUUsRUFBRTtTQUNaO1FBQ0QsT0FBTyxFQUFFO1lBQ1AsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztZQUN0QixPQUFPLEVBQUUsRUFBRTtTQUNaO1FBQ0QsR0FBRyxjQUFjLEVBQUU7UUFDbkIsR0FBRyxhQUFhLEVBQUU7S0FDWjtJQUVSLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUU7UUFDcEIsTUFBTSxPQUFPLEdBQUcsUUFBUSxDQUF1QixFQUFFLENBQUMsQ0FBQTtRQUNsRCxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQXVCLEVBQUUsQ0FBQyxDQUFBO1FBRXBELE1BQU0sVUFBVSxHQUFHLFVBQVUsQ0FBcUIsSUFBSSxDQUFDLENBQUE7UUFFdkQsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNyQyxNQUFNLEVBQUUsZ0JBQWdCLEVBQUUsR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDaEQsTUFBTSxFQUFFLDJCQUEyQixFQUFFLHFCQUFxQixFQUFFLEdBQUcsU0FBUyxFQUFFLENBQUE7UUFDMUUsTUFBTSxFQUFFLFlBQVksRUFBRSxpQkFBaUIsRUFBRSxxQkFBcUIsRUFBRSxHQUM5RCxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUE7UUFFckIsTUFBTSxRQUFRLEdBQUc7WUFDZixVQUFVLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztZQUN6QyxVQUFVLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztTQUMzQyxDQUFBO1FBRUQsTUFBTSxTQUFTLEdBQUcscUJBQXFCLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFBO1FBRXhELE1BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBMEIsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUN2RCxXQUFXLEVBQUUsSUFBSTtZQUNqQixnQkFBZ0IsRUFBRSxLQUFLLENBQUMsR0FBRztZQUMzQixrQkFBa0IsRUFBRSxLQUFLLENBQUMsS0FBSztZQUMvQixpQkFBaUIsRUFBRSxLQUFLLENBQUMsSUFBSTtZQUM3QixtQkFBbUIsRUFBRSxLQUFLLENBQUMsTUFBTTtZQUNqQyxHQUFHLGdCQUFnQixDQUFDLEtBQUs7WUFDekIsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLDJCQUEyQixDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1NBQ2pFLENBQUMsQ0FBQyxDQUFBO1FBRUgsTUFBTSxrQkFBa0IsR0FBRyxRQUFRLENBQVMsR0FBRyxFQUFFO1lBQy9DLE9BQU8sQ0FDTCxDQUFDLEtBQUssQ0FBQyxHQUFHO2dCQUNSLENBQUMsQ0FBQyxTQUFVLENBQUMsR0FBSSxHQUFHLE9BQU8sQ0FBQyxNQUFPO2dCQUNuQyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU07b0JBQ2QsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFJLEdBQUcsU0FBUyxDQUFDLE1BQU87b0JBQ3BDLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBSSxHQUFHLENBQUMsU0FBUyxDQUFDLE1BQU8sR0FBRyxPQUFPLENBQUMsTUFBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUMvRCxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQ2YsQ0FBQTtRQUNILENBQUMsQ0FBQyxDQUFBO1FBRUYsTUFBTSxtQkFBbUIsR0FBRyxRQUFRLENBQVMsR0FBRyxFQUFFO1lBQ2hELE9BQU8sQ0FDTCxDQUFDLEtBQUssQ0FBQyxJQUFJO2dCQUNULENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSyxHQUFHLE9BQU8sQ0FBQyxLQUFNO2dCQUNsQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUs7b0JBQ2IsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFLLEdBQUcsU0FBUyxDQUFDLEtBQU07b0JBQ3BDLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSyxHQUFHLENBQUMsU0FBUyxDQUFDLEtBQU0sR0FBRyxPQUFPLENBQUMsS0FBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUM5RCxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQ2YsQ0FBQTtRQUNILENBQUMsQ0FBQyxDQUFBO1FBRUYsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUF5QixHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQ3JELEdBQUcsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBRSxhQUFhLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBWSxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQzlELElBQUksRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBRSxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUssQ0FBWSxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ2pFLFFBQVEsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsUUFBUSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDdkQsUUFBUSxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUN2RCxNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU07WUFDcEIsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1NBQzNELENBQUMsQ0FBQyxDQUFBO1FBRUgsU0FBUyxZQUFZO1lBQ25CLE1BQU0sV0FBVyxHQUNmLEtBQUssQ0FBQyxTQUFTO2dCQUNmLEtBQUssQ0FBQyxTQUFTLENBQUM7b0JBQ2QsRUFBRSxFQUFFLFNBQVM7aUJBQ2QsQ0FBQyxDQUFBO1lBRUosT0FBTyxDQUFDLENBQUMsV0FBWSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsR0FBRyxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUE7UUFDbEQsQ0FBQztRQUVELFNBQVMsVUFBVTtZQUNqQixNQUFNLFNBQVMsR0FBRztnQkFDaEIsS0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFLO2dCQUNwQixLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUs7Z0JBQ25CLEdBQUcsRUFBRSxVQUFVO2FBQ2hCLENBQUE7WUFFRCxPQUFPLGNBQWMsQ0FDbkIsQ0FBQyxDQUFDLE1BQU0sRUFBRSxTQUFTLEVBQUUsS0FBSyxDQUFDLE9BQU8sSUFBSSxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsRUFDdEQsQ0FBQyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FDMUIsQ0FBQTtRQUNILENBQUM7UUFFRCxTQUFTLGtCQUFrQjtZQUN6QixJQUFJLFVBQVUsQ0FBQyxLQUFLLEVBQUU7Z0JBQ3BCLE9BQU8sQ0FBQyxLQUFLLEdBQUcsVUFBVSxDQUFDLEtBQU0sQ0FBQyxXQUFXLENBQUE7Z0JBQzdDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDLEtBQU0sQ0FBQyxZQUFZLENBQUE7Z0JBQy9DLE9BQU8sQ0FBQyxHQUFHLEdBQUcsa0JBQWtCLENBQUMsS0FBSyxDQUFBO2dCQUN0QyxPQUFPLENBQUMsSUFBSSxHQUFHLG1CQUFtQixDQUFDLEtBQUssQ0FBQTthQUN6QztRQUNILENBQUM7UUFFRCxTQUFTLENBQUMsR0FBRyxFQUFFO1lBQ2IsS0FBSyxDQUNILEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQ3BCLENBQUMsRUFBRSxFQUFFLEVBQUU7Z0JBQ0wsSUFBSSxFQUFFLEVBQUU7b0JBQ04sTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLGlCQUFpQixFQUFFLENBQUE7b0JBRXhELFNBQVMsQ0FBQyxJQUFJLEdBQUcsSUFBYyxDQUFBO29CQUMvQixTQUFTLENBQUMsR0FBRyxHQUFHLEdBQWEsQ0FBQTtvQkFDN0IsU0FBUyxDQUFDLE1BQU0sR0FBRyxNQUFnQixDQUFBO29CQUNuQyxTQUFTLENBQUMsS0FBSyxHQUFHLEtBQWUsQ0FBQTtvQkFFakMsT0FBTyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUE7b0JBQ2YsT0FBTyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUE7b0JBRWhCLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLENBQUE7aUJBQzFDO1lBQ0gsQ0FBQyxFQUNELEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUNwQixDQUFBO1FBQ0gsQ0FBQyxDQUFDLENBQUE7UUFFRixPQUFPLEdBQUcsRUFBRTtZQUNWLE1BQU0sT0FBTyxHQUFHLGFBQWEsQ0FDM0IsVUFBVSxFQUFXLEVBQ3JCLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQ3pELENBQUE7WUFFRCxPQUFPLENBQUMsT0FBTyxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUE7UUFDbEMsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7XG4gIGgsXG4gIHNoYWxsb3dSZWYsXG4gIHJlYWN0aXZlLFxuICB3YXRjaCxcbiAgd2l0aERpcmVjdGl2ZXMsXG4gIGRlZmluZUNvbXBvbmVudCxcbiAgY29tcHV0ZWQsXG4gIG9uTW91bnRlZCxcbiAgdlNob3csXG59IGZyb20gJ3Z1ZSdcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgdXNlVG9nZ2xlIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtdG9nZ2xlJ1xuaW1wb3J0IHsgdXNlQ29sb3JzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtY29sb3JzJ1xuaW1wb3J0IHsgdXNlQWN0aXZhdG9yIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtYWN0aXZhdG9yJ1xuaW1wb3J0IHsgdXNlVHJhbnNpdGlvbiB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLXRyYW5zaXRpb24nXG5pbXBvcnQgeyBlbGV2YXRpb25Qcm9wcywgdXNlRWxldmF0aW9uIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtZWxldmF0aW9uJ1xuaW1wb3J0IHsgcG9zaXRpb25Qcm9wcyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLXBvc2l0aW9uJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgT2Zmc2V0U2l6ZXMgfSBmcm9tICcuLi8uLi8uLi90eXBlcydcbmltcG9ydCB7IFZOb2RlIH0gZnJvbSAndnVlJ1xuXG4vLyBIZWxwZXJzXG5pbXBvcnQgeyBjb252ZXJ0VG9Vbml0IH0gZnJvbSAnLi4vLi4vaGVscGVycydcblxuLy8gU2VydmljZXNcbmltcG9ydCB7IHRyYW5zaXRpb25zIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvdHJhbnNpdGlvbnMnXG5cbi8vIFRPRE8gZml4IGJlaGF2aW9yIG9uIHdpbmRvdyByZXNpemUgaWYgdi1tb2RlbCB1c2VkIG9uIGNvbXBvbmVudFxuXG5leHBvcnQgZGVmYXVsdCBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAndi10b29sdGlwJyxcblxuICBwcm9wczoge1xuICAgIG9wZW5PbkhvdmVyOiB7XG4gICAgICB0eXBlOiBCb29sZWFuLFxuICAgICAgZGVmYXVsdDogdHJ1ZSxcbiAgICB9LFxuICAgIGNvbG9yOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnZ3JleSBsaWdodGVuLTEnLFxuICAgIH0sXG4gICAgekluZGV4OiBbTnVtYmVyLCBTdHJpbmddLFxuICAgIG1heFdpZHRoOiBbTnVtYmVyLCBTdHJpbmddLFxuICAgIG1pbldpZHRoOiBbTnVtYmVyLCBTdHJpbmddLFxuICAgIG1vZGVsVmFsdWU6IEJvb2xlYW4sXG4gICAgb2Zmc2V0WDoge1xuICAgICAgdHlwZTogW1N0cmluZywgTnVtYmVyXSxcbiAgICAgIGRlZmF1bHQ6IDIwLFxuICAgIH0sXG4gICAgb2Zmc2V0WToge1xuICAgICAgdHlwZTogW1N0cmluZywgTnVtYmVyXSxcbiAgICAgIGRlZmF1bHQ6IDIwLFxuICAgIH0sXG4gICAgLi4uZWxldmF0aW9uUHJvcHMoKSxcbiAgICAuLi5wb3NpdGlvblByb3BzKCksXG4gIH0gYXMgYW55LFxuXG4gIHNldHVwKHByb3BzLCB7IHNsb3RzIH0pIHtcbiAgICBjb25zdCB0b29sdGlwID0gcmVhY3RpdmU8UGFydGlhbDxPZmZzZXRTaXplcz4+KHt9KVxuICAgIGNvbnN0IGFjdGl2YXRvciA9IHJlYWN0aXZlPFBhcnRpYWw8T2Zmc2V0U2l6ZXM+Pih7fSlcblxuICAgIGNvbnN0IHRvb2x0aXBSZWYgPSBzaGFsbG93UmVmPEhUTUxFbGVtZW50IHwgbnVsbD4obnVsbClcblxuICAgIGNvbnN0IHsgaXNBY3RpdmUgfSA9IHVzZVRvZ2dsZShwcm9wcylcbiAgICBjb25zdCB7IGVsZXZhdGlvbkNsYXNzZXMgfSA9IHVzZUVsZXZhdGlvbihwcm9wcylcbiAgICBjb25zdCB7IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvciwgc2V0QmFja2dyb3VuZENzc0NvbG9yIH0gPSB1c2VDb2xvcnMoKVxuICAgIGNvbnN0IHsgYWN0aXZhdG9yUmVmLCBnZXRBY3RpdmF0b3JTaXplcywgZ2VuQWN0aXZhdG9yTGlzdGVuZXJzIH0gPVxuICAgICAgdXNlQWN0aXZhdG9yKHByb3BzKVxuXG4gICAgY29uc3QgaGFuZGxlcnMgPSB7XG4gICAgICBtb3VzZWVudGVyOiAoKSA9PiAoaXNBY3RpdmUudmFsdWUgPSB0cnVlKSxcbiAgICAgIG1vdXNlbGVhdmU6ICgpID0+IChpc0FjdGl2ZS52YWx1ZSA9IGZhbHNlKSxcbiAgICB9XG5cbiAgICBjb25zdCBsaXN0ZW5lcnMgPSBnZW5BY3RpdmF0b3JMaXN0ZW5lcnMocHJvcHMsIGhhbmRsZXJzKVxuXG4gICAgY29uc3QgY2xhc3NlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+PigoKSA9PiAoe1xuICAgICAgJ3YtdG9vbHRpcCc6IHRydWUsXG4gICAgICAndi10b29sdGlwLS10b3AnOiBwcm9wcy50b3AsXG4gICAgICAndi10b29sdGlwLS1yaWdodCc6IHByb3BzLnJpZ2h0LFxuICAgICAgJ3YtdG9vbHRpcC0tbGVmdCc6IHByb3BzLmxlZnQsXG4gICAgICAndi10b29sdGlwLS1ib3R0b20nOiBwcm9wcy5ib3R0b20sXG4gICAgICAuLi5lbGV2YXRpb25DbGFzc2VzLnZhbHVlLFxuICAgICAgLi4uKHByb3BzLmNvbG9yID8gc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yKHByb3BzLmNvbG9yKSA6IHt9KSxcbiAgICB9KSlcblxuICAgIGNvbnN0IGNvbXB1dGVUb3BQb3NpdGlvbiA9IGNvbXB1dGVkPG51bWJlcj4oKCkgPT4ge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgKHByb3BzLnRvcFxuICAgICAgICAgID8gYWN0aXZhdG9yIS50b3AhIC0gdG9vbHRpcC5oZWlnaHQhXG4gICAgICAgICAgOiBwcm9wcy5ib3R0b21cbiAgICAgICAgICA/IGFjdGl2YXRvci50b3AhICsgYWN0aXZhdG9yLmhlaWdodCFcbiAgICAgICAgICA6IGFjdGl2YXRvci50b3AhICsgKGFjdGl2YXRvci5oZWlnaHQhIC0gdG9vbHRpcC5oZWlnaHQhKSAvIDIpICtcbiAgICAgICAgK3Byb3BzLm9mZnNldFlcbiAgICAgIClcbiAgICB9KVxuXG4gICAgY29uc3QgY29tcHV0ZUxlZnRQb3NpdGlvbiA9IGNvbXB1dGVkPG51bWJlcj4oKCkgPT4ge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgKHByb3BzLmxlZnRcbiAgICAgICAgICA/IGFjdGl2YXRvci5sZWZ0ISAtIHRvb2x0aXAud2lkdGghXG4gICAgICAgICAgOiBwcm9wcy5yaWdodFxuICAgICAgICAgID8gYWN0aXZhdG9yLmxlZnQhICsgYWN0aXZhdG9yLndpZHRoIVxuICAgICAgICAgIDogYWN0aXZhdG9yLmxlZnQhICsgKGFjdGl2YXRvci53aWR0aCEgLSB0b29sdGlwLndpZHRoISkgLyAyKSArXG4gICAgICAgICtwcm9wcy5vZmZzZXRYXG4gICAgICApXG4gICAgfSlcblxuICAgIGNvbnN0IHN0eWxlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIHN0cmluZz4+KCgpID0+ICh7XG4gICAgICB0b3A6IHRvb2x0aXAudG9wID8gKGNvbnZlcnRUb1VuaXQodG9vbHRpcC50b3ApIGFzIHN0cmluZykgOiAnJyxcbiAgICAgIGxlZnQ6IHRvb2x0aXAudG9wID8gKGNvbnZlcnRUb1VuaXQodG9vbHRpcC5sZWZ0ISkgYXMgc3RyaW5nKSA6ICcnLFxuICAgICAgbWF4V2lkdGg6ICEhcHJvcHMubWF4V2lkdGggPyBgJHtwcm9wcy5tYXhXaWR0aH1weGAgOiAnJyxcbiAgICAgIG1pbldpZHRoOiAhIXByb3BzLm1pbldpZHRoID8gYCR7cHJvcHMubWluV2lkdGh9cHhgIDogJycsXG4gICAgICB6SW5kZXg6IHByb3BzLnpJbmRleCxcbiAgICAgIC4uLihwcm9wcy5jb2xvciA/IHNldEJhY2tncm91bmRDc3NDb2xvcihwcm9wcy5jb2xvcikgOiB7fSksXG4gICAgfSkpXG5cbiAgICBmdW5jdGlvbiBnZW5BY3RpdmF0b3IoKTogVk5vZGUgfCBudWxsIHtcbiAgICAgIGNvbnN0IHNsb3RDb250ZW50ID1cbiAgICAgICAgc2xvdHMuYWN0aXZhdG9yICYmXG4gICAgICAgIHNsb3RzLmFjdGl2YXRvcih7XG4gICAgICAgICAgb246IGxpc3RlbmVycyxcbiAgICAgICAgfSlcblxuICAgICAgcmV0dXJuIGgoc2xvdENvbnRlbnQhWzBdLCB7IHJlZjogYWN0aXZhdG9yUmVmIH0pXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuQ29udGVudCgpOiBWTm9kZSB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiBjbGFzc2VzLnZhbHVlLFxuICAgICAgICBzdHlsZTogc3R5bGVzLnZhbHVlLFxuICAgICAgICByZWY6IHRvb2x0aXBSZWYsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB3aXRoRGlyZWN0aXZlcyhcbiAgICAgICAgaCgnc3BhbicsIHByb3BzRGF0YSwgc2xvdHMuZGVmYXVsdCAmJiBzbG90cy5kZWZhdWx0KCkpLFxuICAgICAgICBbW3ZTaG93LCBpc0FjdGl2ZS52YWx1ZV1dXG4gICAgICApXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0VG9vbHRpcFBvc2l0aW9uKCkge1xuICAgICAgaWYgKHRvb2x0aXBSZWYudmFsdWUpIHtcbiAgICAgICAgdG9vbHRpcC53aWR0aCA9IHRvb2x0aXBSZWYudmFsdWUhLm9mZnNldFdpZHRoXG4gICAgICAgIHRvb2x0aXAuaGVpZ2h0ID0gdG9vbHRpcFJlZi52YWx1ZSEub2Zmc2V0SGVpZ2h0XG4gICAgICAgIHRvb2x0aXAudG9wID0gY29tcHV0ZVRvcFBvc2l0aW9uLnZhbHVlXG4gICAgICAgIHRvb2x0aXAubGVmdCA9IGNvbXB1dGVMZWZ0UG9zaXRpb24udmFsdWVcbiAgICAgIH1cbiAgICB9XG5cbiAgICBvbk1vdW50ZWQoKCkgPT4ge1xuICAgICAgd2F0Y2goXG4gICAgICAgICgpID0+IGlzQWN0aXZlLnZhbHVlLFxuICAgICAgICAodG8pID0+IHtcbiAgICAgICAgICBpZiAodG8pIHtcbiAgICAgICAgICAgIGNvbnN0IHsgbGVmdCwgdG9wLCBoZWlnaHQsIHdpZHRoIH0gPSBnZXRBY3RpdmF0b3JTaXplcygpXG5cbiAgICAgICAgICAgIGFjdGl2YXRvci5sZWZ0ID0gbGVmdCBhcyBudW1iZXJcbiAgICAgICAgICAgIGFjdGl2YXRvci50b3AgPSB0b3AgYXMgbnVtYmVyXG4gICAgICAgICAgICBhY3RpdmF0b3IuaGVpZ2h0ID0gaGVpZ2h0IGFzIG51bWJlclxuICAgICAgICAgICAgYWN0aXZhdG9yLndpZHRoID0gd2lkdGggYXMgbnVtYmVyXG5cbiAgICAgICAgICAgIHRvb2x0aXAudG9wID0gMFxuICAgICAgICAgICAgdG9vbHRpcC5sZWZ0ID0gMFxuXG4gICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc2V0VG9vbHRpcFBvc2l0aW9uKVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgeyBpbW1lZGlhdGU6IHRydWUgfVxuICAgICAgKVxuICAgIH0pXG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgY29uc3QgY29udGVudCA9IHVzZVRyYW5zaXRpb24oXG4gICAgICAgIGdlbkNvbnRlbnQoKSBhcyBWTm9kZSxcbiAgICAgICAgaXNBY3RpdmUudmFsdWUgPyB0cmFuc2l0aW9ucy5TQ0FMRV9JTiA6IHRyYW5zaXRpb25zLkZBREVcbiAgICAgIClcblxuICAgICAgcmV0dXJuIFtjb250ZW50LCBnZW5BY3RpdmF0b3IoKV1cbiAgICB9XG4gIH0sXG59KVxuIl19