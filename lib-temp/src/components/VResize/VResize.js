import { h, ref, computed, reactive, defineComponent, onMounted, onBeforeUnmount, } from 'vue';
import { positionProps } from '../../composable/use-position';
import { useColors } from '../../composable/use-colors';
export const VResize = defineComponent({
    name: 'v-resize',
    props: {
        emit: {
            type: Boolean,
            default: false,
        },
        customClass: {
            type: String,
        },
        minSize: {
            type: [String, Number],
            default: 50,
        },
        color: {
            type: String,
            default: 'grey lighten-2',
        },
        ...positionProps(),
    },
    emits: ['resize'],
    setup(props, { emit }) {
        const data = reactive({
            parentNode: null,
            startOffset: null,
            offsetTop: 0,
            offsetLeft: 0,
            parentHeight: 0,
            parentWidth: 0,
            marginLeft: 0,
            marginTop: 0,
            left: 0,
            top: 0,
            isActive: false,
        });
        const resizeRef = ref(null);
        const { setBackgroundClassNameColor, setBackgroundCssColor } = useColors();
        const classes = computed(() => {
            return {
                'v-resize': true,
                'v-resize--active': data.isActive,
                'v-resize--top': props.top,
                'v-resize--bottom': props.bottom,
                'v-resize--right': props.right,
                'v-resize--left': props.left,
                [props.customClass]: !!props.customClass,
                ...(props.color ? setBackgroundClassNameColor(props.color) : {}),
            };
        });
        const styles = computed(() => ({
            ...(props.color ? setBackgroundCssColor(props.color) : {}),
        }));
        const isDirectY = computed(() => {
            return props.top || props.bottom;
        });
        const isNeedReverse = computed(() => {
            return props.top || props.left;
        });
        const currentSize = computed(() => {
            return isDirectY.value ? data.parentHeight : data.parentWidth;
        });
        const sizeProp = computed(() => {
            return isDirectY.value ? 'height' : 'width';
        });
        const reverseDirection = computed(() => {
            return props.top ? 'top' : 'left';
        });
        const reverseOffsetKey = computed(() => {
            const side = reverseDirection.value;
            return 'offset' + side[0].toUpperCase() + side.slice(1);
        });
        const offset = computed(() => {
            return isDirectY.value ? data.offsetTop : data.offsetLeft;
        });
        const direction = computed(() => {
            return isDirectY.value ? 'clientY' : 'clientX';
        });
        function moveReverse(size) {
            const { parentNode, left, top } = data;
            const reverseTo = reverseDirection.value;
            const value = !isDirectY.value
                ? currentSize.value - size + left
                : currentSize.value - size + top;
            parentNode.style[reverseTo] = `${value}px`;
        }
        function setOrEmitSize(size) {
            if (props.emit)
                return emit('resize', size);
            data.parentNode.style[sizeProp.value] = `${size}px`;
            isNeedReverse.value && moveReverse(size);
        }
        function resize(e) {
            let size;
            if (isNeedReverse.value) {
                size =
                    currentSize.value -
                        (e[direction.value] - offset.value) +
                        data.startOffset;
            }
            else {
                size =
                    currentSize.value +
                        (e[direction.value] -
                            currentSize.value -
                            offset.value -
                            data.startOffset);
            }
            size > props.minSize && setOrEmitSize(size);
        }
        function resetMinMaxStyles() {
            if (isDirectY.value) {
                data.parentNode.style.maxHeight = '';
                data.parentNode.style.minHeight = '';
            }
            else {
                data.parentNode.style.maxWidth = '';
                data.parentNode.style.minWidth = '';
            }
        }
        function setParent() {
            const parent = resizeRef.value.parentNode;
            data.parentNode = parent;
        }
        function computeSizes() {
            const { top, left, height, width, marginLeft, marginTop } = getComputedStyle(data.parentNode);
            data.offsetTop = data.parentNode.offsetTop;
            data.offsetLeft = data.parentNode.offsetLeft;
            data.marginLeft = parseFloat(marginLeft);
            data.marginTop = parseFloat(marginTop);
            data.parentHeight = parseFloat(height);
            data.parentWidth = parseFloat(width);
            data.top = parseFloat(top);
            data.left = parseFloat(left);
        }
        function setStartPositions() {
            const side = reverseDirection.value;
            const offset = reverseOffsetKey.value;
            if (data[side] === data[offset]) {
                data.parentNode.style[side] = `${data[offset]}px`;
            }
        }
        function disableSelection(e) {
            e.preventDefault();
        }
        function initResize(e) {
            if (!data.isActive) {
                data.isActive = true;
                computeSizes();
                resetMinMaxStyles();
                setStartPositions();
                setStartOffset(e);
            }
            requestAnimationFrame(() => resize(e));
        }
        function setStartOffset(e) {
            if (isNeedReverse.value)
                data.startOffset = e[direction.value];
            else
                data.startOffset = e[direction.value] - currentSize.value;
            data.startOffset -= offset.value;
        }
        function reset() {
            data.isActive = false;
            resetMinMaxStyles();
        }
        function onMouseup() {
            reset();
            removeHandlers();
        }
        function onMousedown() {
            document.addEventListener('mousemove', initResize);
            document.addEventListener('mouseup', onMouseup);
            document.addEventListener('selectstart', disableSelection);
        }
        function removeHandlers() {
            document.removeEventListener('mousemove', initResize);
            document.removeEventListener('mouseup', onMouseup);
            document.removeEventListener('selectstart', disableSelection);
        }
        onMounted(() => {
            setParent();
        });
        onBeforeUnmount(() => {
            document.removeEventListener('mousedown', onMousedown);
        });
        return () => {
            const propsData = {
                class: classes.value,
                style: styles.value,
                key: 'resize',
                ref: resizeRef,
                onMousedown,
            };
            return h('div', propsData);
        };
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlJlc2l6ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZSZXNpemUvVlJlc2l6ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0wsQ0FBQyxFQUNELEdBQUcsRUFDSCxRQUFRLEVBQ1IsUUFBUSxFQUNSLGVBQWUsRUFDZixTQUFTLEVBQ1QsZUFBZSxHQUNoQixNQUFNLEtBQUssQ0FBQTtBQUdaLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQTtBQUM3RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sNkJBQTZCLENBQUE7QUFtQnZELE1BQU0sQ0FBQyxNQUFNLE9BQU8sR0FBRyxlQUFlLENBQUM7SUFDckMsSUFBSSxFQUFFLFVBQVU7SUFFaEIsS0FBSyxFQUFFO1FBQ0wsSUFBSSxFQUFFO1lBQ0osSUFBSSxFQUFFLE9BQU87WUFDYixPQUFPLEVBQUUsS0FBSztTQUNmO1FBRUQsV0FBVyxFQUFFO1lBQ1gsSUFBSSxFQUFFLE1BQU07U0FDYjtRQUVELE9BQU8sRUFBRTtZQUNQLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7WUFDdEIsT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLGdCQUFnQjtTQUMxQjtRQUNELEdBQUcsYUFBYSxFQUFFO0tBQ1o7SUFFUixLQUFLLEVBQUUsQ0FBQyxRQUFRLENBQUM7SUFFakIsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRTtRQUNuQixNQUFNLElBQUksR0FBZSxRQUFRLENBQUM7WUFDaEMsVUFBVSxFQUFFLElBQUk7WUFDaEIsV0FBVyxFQUFFLElBQUk7WUFDakIsU0FBUyxFQUFFLENBQUM7WUFDWixVQUFVLEVBQUUsQ0FBQztZQUNiLFlBQVksRUFBRSxDQUFDO1lBQ2YsV0FBVyxFQUFFLENBQUM7WUFDZCxVQUFV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O1FBQ2IsQ0FBQyxDQUFDLENBQUE7UUFFRixlQUFlLENBQUMsR0FBRyxFQUFFO1lBQ25CLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUE7UUFDeEQsQ0FBQyxDQUFDLENBQUE7UUFFRixPQUFPLEdBQUcsRUFBRTtZQUNWLE1BQU0sU0FBUyxHQUFHO2dCQUNoQixLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7Z0JBQ3BCLEtBQUssRUFBRSxNQUFNLENBQUMsS0FBSztnQkFDbkIsR0FBRyxFQUFFLFFBQVE7Z0JBQ2IsR0FBRyxFQUFFLFNBQVM7Z0JBQ2QsV0FBVzthQUNaLENBQUE7WUFDRCxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUE7UUFDNUIsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7XG4gIGgsXG4gIHJlZixcbiAgY29tcHV0ZWQsXG4gIHJlYWN0aXZlLFxuICBkZWZpbmVDb21wb25lbnQsXG4gIG9uTW91bnRlZCxcbiAgb25CZWZvcmVVbm1vdW50LFxufSBmcm9tICd2dWUnXG5cbi8vIEVmZmVjdHNcbmltcG9ydCB7IHBvc2l0aW9uUHJvcHMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS1wb3NpdGlvbidcbmltcG9ydCB7IHVzZUNvbG9ycyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLWNvbG9ycydcblxuLy8gVHlwZXNcbmltcG9ydCB7IFZOb2RlIH0gZnJvbSAndnVlJ1xuXG50eXBlIFJlc2l6ZURhdGEgPSB7XG4gIHBhcmVudE5vZGU6IEhUTUxFbGVtZW50IHwgbnVsbFxuICBzdGFydE9mZnNldDogbnVtYmVyIHwgbnVsbFxuICBvZmZzZXRUb3A6IG51bWJlclxuICBvZmZzZXRMZWZ0OiBudW1iZXJcbiAgcGFyZW50SGVpZ2h0OiBudW1iZXJcbiAgcGFyZW50V2lkdGg6IG51bWJlclxuICBtYXJnaW5MZWZ0OiBudW1iZXJcbiAgbWFyZ2luVG9wOiBudW1iZXJcbiAgbGVmdDogbnVtYmVyXG4gIHRvcDogbnVtYmVyXG4gIGlzQWN0aXZlOiBib29sZWFuXG59XG5cbmV4cG9ydCBjb25zdCBWUmVzaXplID0gZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3YtcmVzaXplJyxcblxuICBwcm9wczoge1xuICAgIGVtaXQ6IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiBmYWxzZSxcbiAgICB9LFxuXG4gICAgY3VzdG9tQ2xhc3M6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICB9LFxuXG4gICAgbWluU2l6ZToge1xuICAgICAgdHlwZTogW1N0cmluZywgTnVtYmVyXSxcbiAgICAgIGRlZmF1bHQ6IDUwLFxuICAgIH0sXG4gICAgY29sb3I6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdncmV5IGxpZ2h0ZW4tMicsXG4gICAgfSxcbiAgICAuLi5wb3NpdGlvblByb3BzKCksXG4gIH0gYXMgYW55LFxuXG4gIGVtaXRzOiBbJ3Jlc2l6ZSddLFxuXG4gIHNldHVwKHByb3BzLCB7IGVtaXQgfSk6ICgpID0+IFZOb2RlIHtcbiAgICBjb25zdCBkYXRhOiBSZXNpemVEYXRhID0gcmVhY3RpdmUoe1xuICAgICAgcGFyZW50Tm9kZTogbnVsbCxcbiAgICAgIHN0YXJ0T2Zmc2V0OiBudWxsLFxuICAgICAgb2Zmc2V0VG9wOiAwLFxuICAgICAgb2Zmc2V0TGVmdDogMCxcbiAgICAgIHBhcmVudEhlaWdodDogMCxcbiAgICAgIHBhcmVudFdpZHRoOiAwLFxuICAgICAgbWFyZ2luTGVmdDogMCxcbiAgICAgIG1hcmdpblRvcDogMCxcbiAgICAgIGxlZnQ6IDAsXG4gICAgICB0b3A6IDAsXG4gICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgfSlcblxuICAgIGNvbnN0IHJlc2l6ZVJlZiA9IHJlZjxIVE1MRWxlbWVudCB8IG51bGw+KG51bGwpXG5cbiAgICBjb25zdCB7IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvciwgc2V0QmFja2dyb3VuZENzc0NvbG9yIH0gPSB1c2VDb2xvcnMoKVxuXG4gICAgY29uc3QgY2xhc3NlcyA9IGNvbXB1dGVkPFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+PigoKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAndi1yZXNpemUnOiB0cnVlLFxuICAgICAgICAndi1yZXNpemUtLWFjdGl2ZSc6IGRhdGEuaXNBY3RpdmUsXG4gICAgICAgICd2LXJlc2l6ZS0tdG9wJzogcHJvcHMudG9wLFxuICAgICAgICAndi1yZXNpemUtLWJvdHRvbSc6IHByb3BzLmJvdHRvbSxcbiAgICAgICAgJ3YtcmVzaXplLS1yaWdodCc6IHByb3BzLnJpZ2h0LFxuICAgICAgICAndi1yZXNpemUtLWxlZnQnOiBwcm9wcy5sZWZ0LFxuICAgICAgICBbcHJvcHMuY3VzdG9tQ2xhc3NdOiAhIXByb3BzLmN1c3RvbUNsYXNzLFxuICAgICAgICAuLi4ocHJvcHMuY29sb3IgPyBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBzdHlsZXMgPSBjb21wdXRlZCgoKSA9PiAoe1xuICAgICAgLi4uKHByb3BzLmNvbG9yID8gc2V0QmFja2dyb3VuZENzc0NvbG9yKHByb3BzLmNvbG9yKSA6IHt9KSxcbiAgICB9KSlcblxuICAgIGNvbnN0IGlzRGlyZWN0WSA9IGNvbXB1dGVkPGJvb2xlYW4+KCgpID0+IHtcbiAgICAgIHJldHVybiBwcm9wcy50b3AgfHwgcHJvcHMuYm90dG9tXG4gICAgfSlcblxuICAgIGNvbnN0IGlzTmVlZFJldmVyc2UgPSBjb21wdXRlZDxib29sZWFuPigoKSA9PiB7XG4gICAgICByZXR1cm4gcHJvcHMudG9wIHx8IHByb3BzLmxlZnRcbiAgICB9KVxuXG4gICAgY29uc3QgY3VycmVudFNpemUgPSBjb21wdXRlZDxudW1iZXI+KCgpID0+IHtcbiAgICAgIHJldHVybiBpc0RpcmVjdFkudmFsdWUgPyBkYXRhLnBhcmVudEhlaWdodCEgOiBkYXRhLnBhcmVudFdpZHRoIVxuICAgIH0pXG5cbiAgICBjb25zdCBzaXplUHJvcCA9IGNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuICAgICAgcmV0dXJuIGlzRGlyZWN0WS52YWx1ZSA/ICdoZWlnaHQnIDogJ3dpZHRoJ1xuICAgIH0pXG5cbiAgICBjb25zdCByZXZlcnNlRGlyZWN0aW9uID0gY29tcHV0ZWQ8c3RyaW5nPigoKSA9PiB7XG4gICAgICByZXR1cm4gcHJvcHMudG9wID8gJ3RvcCcgOiAnbGVmdCdcbiAgICB9KVxuXG4gICAgY29uc3QgcmV2ZXJzZU9mZnNldEtleSA9IGNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuICAgICAgY29uc3Qgc2lkZSA9IHJldmVyc2VEaXJlY3Rpb24udmFsdWVcbiAgICAgIHJldHVybiAnb2Zmc2V0JyArIHNpZGVbMF0udG9VcHBlckNhc2UoKSArIHNpZGUuc2xpY2UoMSlcbiAgICB9KVxuXG4gICAgY29uc3Qgb2Zmc2V0ID0gY29tcHV0ZWQ8bnVtYmVyPigoKSA9PiB7XG4gICAgICByZXR1cm4gaXNEaXJlY3RZLnZhbHVlID8gZGF0YS5vZmZzZXRUb3AhIDogZGF0YS5vZmZzZXRMZWZ0IVxuICAgIH0pXG5cbiAgICBjb25zdCBkaXJlY3Rpb24gPSBjb21wdXRlZDxzdHJpbmc+KCgpID0+IHtcbiAgICAgIHJldHVybiBpc0RpcmVjdFkudmFsdWUgPyAnY2xpZW50WScgOiAnY2xpZW50WCdcbiAgICB9KVxuXG4gICAgZnVuY3Rpb24gbW92ZVJldmVyc2Uoc2l6ZSkge1xuICAgICAgY29uc3QgeyBwYXJlbnROb2RlLCBsZWZ0LCB0b3AgfSA9IGRhdGFcbiAgICAgIGNvbnN0IHJldmVyc2VUbyA9IHJldmVyc2VEaXJlY3Rpb24udmFsdWVcblxuICAgICAgY29uc3QgdmFsdWUgPSAhaXNEaXJlY3RZLnZhbHVlXG4gICAgICAgID8gY3VycmVudFNpemUudmFsdWUgLSBzaXplICsgbGVmdFxuICAgICAgICA6IGN1cnJlbnRTaXplLnZhbHVlIC0gc2l6ZSArIHRvcFxuXG4gICAgICBwYXJlbnROb2RlIS5zdHlsZVtyZXZlcnNlVG9dID0gYCR7dmFsdWV9cHhgXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0T3JFbWl0U2l6ZShzaXplKSB7XG4gICAgICBpZiAocHJvcHMuZW1pdCkgcmV0dXJuIGVtaXQoJ3Jlc2l6ZScsIHNpemUpXG5cbiAgICAgIGRhdGEucGFyZW50Tm9kZSEuc3R5bGVbc2l6ZVByb3AudmFsdWVdID0gYCR7c2l6ZX1weGBcblxuICAgICAgaXNOZWVkUmV2ZXJzZS52YWx1ZSAmJiBtb3ZlUmV2ZXJzZShzaXplKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlc2l6ZShlKSB7XG4gICAgICBsZXQgc2l6ZVxuXG4gICAgICBpZiAoaXNOZWVkUmV2ZXJzZS52YWx1ZSkge1xuICAgICAgICBzaXplID1cbiAgICAgICAgICBjdXJyZW50U2l6ZS52YWx1ZSAtXG4gICAgICAgICAgKGVbZGlyZWN0aW9uLnZhbHVlXSAtIG9mZnNldC52YWx1ZSkgK1xuICAgICAgICAgIGRhdGEuc3RhcnRPZmZzZXQhXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzaXplID1cbiAgICAgICAgICBjdXJyZW50U2l6ZS52YWx1ZSArXG4gICAgICAgICAgKGVbZGlyZWN0aW9uLnZhbHVlXSAtXG4gICAgICAgICAgICBjdXJyZW50U2l6ZS52YWx1ZSAtXG4gICAgICAgICAgICBvZmZzZXQudmFsdWUgLVxuICAgICAgICAgICAgZGF0YS5zdGFydE9mZnNldCEpXG4gICAgICB9XG5cbiAgICAgIHNpemUgPiBwcm9wcy5taW5TaXplICYmIHNldE9yRW1pdFNpemUoc2l6ZSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZXNldE1pbk1heFN0eWxlcygpIHtcbiAgICAgIGlmIChpc0RpcmVjdFkudmFsdWUpIHtcbiAgICAgICAgZGF0YS5wYXJlbnROb2RlIS5zdHlsZS5tYXhIZWlnaHQgPSAnJ1xuICAgICAgICBkYXRhLnBhcmVudE5vZGUhLnN0eWxlLm1pbkhlaWdodCA9ICcnXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkYXRhLnBhcmVudE5vZGUhLnN0eWxlLm1heFdpZHRoID0gJydcbiAgICAgICAgZGF0YS5wYXJlbnROb2RlIS5zdHlsZS5taW5XaWR0aCA9ICcnXG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0UGFyZW50KCkge1xuICAgICAgY29uc3QgcGFyZW50ID0gcmVzaXplUmVmLnZhbHVlIS5wYXJlbnROb2RlXG4gICAgICBkYXRhLnBhcmVudE5vZGUgPSBwYXJlbnQgYXMgSFRNTEVsZW1lbnRcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjb21wdXRlU2l6ZXMoKSB7XG4gICAgICBjb25zdCB7IHRvcCwgbGVmdCwgaGVpZ2h0LCB3aWR0aCwgbWFyZ2luTGVmdCwgbWFyZ2luVG9wIH0gPVxuICAgICAgICBnZXRDb21wdXRlZFN0eWxlKGRhdGEucGFyZW50Tm9kZSEpXG5cbiAgICAgIGRhdGEub2Zmc2V0VG9wID0gZGF0YS5wYXJlbnROb2RlIS5vZmZzZXRUb3BcbiAgICAgIGRhdGEub2Zmc2V0TGVmdCA9IGRhdGEucGFyZW50Tm9kZSEub2Zmc2V0TGVmdFxuICAgICAgZGF0YS5tYXJnaW5MZWZ0ID0gcGFyc2VGbG9hdChtYXJnaW5MZWZ0KVxuICAgICAgZGF0YS5tYXJnaW5Ub3AgPSBwYXJzZUZsb2F0KG1hcmdpblRvcClcbiAgICAgIGRhdGEucGFyZW50SGVpZ2h0ID0gcGFyc2VGbG9hdChoZWlnaHQpXG4gICAgICBkYXRhLnBhcmVudFdpZHRoID0gcGFyc2VGbG9hdCh3aWR0aClcbiAgICAgIGRhdGEudG9wID0gcGFyc2VGbG9hdCh0b3ApXG4gICAgICBkYXRhLmxlZnQgPSBwYXJzZUZsb2F0KGxlZnQpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0U3RhcnRQb3NpdGlvbnMoKSB7XG4gICAgICBjb25zdCBzaWRlID0gcmV2ZXJzZURpcmVjdGlvbi52YWx1ZVxuICAgICAgY29uc3Qgb2Zmc2V0ID0gcmV2ZXJzZU9mZnNldEtleS52YWx1ZVxuXG4gICAgICBpZiAoZGF0YVtzaWRlXSA9PT0gZGF0YVtvZmZzZXRdKSB7XG4gICAgICAgIGRhdGEucGFyZW50Tm9kZSEuc3R5bGVbc2lkZV0gPSBgJHtkYXRhW29mZnNldF19cHhgXG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGlzYWJsZVNlbGVjdGlvbihlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0UmVzaXplKGUpIHtcbiAgICAgIGlmICghZGF0YS5pc0FjdGl2ZSkge1xuICAgICAgICBkYXRhLmlzQWN0aXZlID0gdHJ1ZVxuICAgICAgICBjb21wdXRlU2l6ZXMoKVxuICAgICAgICByZXNldE1pbk1heFN0eWxlcygpXG4gICAgICAgIHNldFN0YXJ0UG9zaXRpb25zKClcbiAgICAgICAgc2V0U3RhcnRPZmZzZXQoZSlcbiAgICAgIH1cblxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHJlc2l6ZShlKSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRTdGFydE9mZnNldChlKSB7XG4gICAgICBpZiAoaXNOZWVkUmV2ZXJzZS52YWx1ZSkgZGF0YS5zdGFydE9mZnNldCA9IGVbZGlyZWN0aW9uLnZhbHVlXVxuICAgICAgZWxzZSBkYXRhLnN0YXJ0T2Zmc2V0ID0gZVtkaXJlY3Rpb24udmFsdWVdIC0gY3VycmVudFNpemUudmFsdWVcblxuICAgICAgZGF0YS5zdGFydE9mZnNldCEgLT0gb2Zmc2V0LnZhbHVlXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICBkYXRhLmlzQWN0aXZlID0gZmFsc2VcbiAgICAgIHJlc2V0TWluTWF4U3R5bGVzKClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbk1vdXNldXAoKSB7XG4gICAgICByZXNldCgpXG4gICAgICByZW1vdmVIYW5kbGVycygpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gb25Nb3VzZWRvd24oKSB7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBpbml0UmVzaXplKVxuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIG9uTW91c2V1cClcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3NlbGVjdHN0YXJ0JywgZGlzYWJsZVNlbGVjdGlvbilcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZW1vdmVIYW5kbGVycygpIHtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGluaXRSZXNpemUpXG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgb25Nb3VzZXVwKVxuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2VsZWN0c3RhcnQnLCBkaXNhYmxlU2VsZWN0aW9uKVxuICAgIH1cblxuICAgIG9uTW91bnRlZCgoKSA9PiB7XG4gICAgICBzZXRQYXJlbnQoKVxuICAgIH0pXG5cbiAgICBvbkJlZm9yZVVubW91bnQoKCkgPT4ge1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgb25Nb3VzZWRvd24pXG4gICAgfSlcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiBjbGFzc2VzLnZhbHVlLFxuICAgICAgICBzdHlsZTogc3R5bGVzLnZhbHVlLFxuICAgICAgICBrZXk6ICdyZXNpemUnLFxuICAgICAgICByZWY6IHJlc2l6ZVJlZixcbiAgICAgICAgb25Nb3VzZWRvd24sXG4gICAgICB9XG4gICAgICByZXR1cm4gaCgnZGl2JywgcHJvcHNEYXRhKVxuICAgIH1cbiAgfSxcbn0pXG4iXX0=