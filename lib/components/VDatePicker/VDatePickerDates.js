import { h, ref, inject, computed, watch, defineComponent } from 'vue';
import { genTableRows, parseDate, toDateString } from './helpers';
import { useTransition } from '../../composables/use-transition';
export const VDatePickerDates = defineComponent({
    name: 'v-date-picker-dates',
    props: {
        locale: Array,
        year: [String, Number],
        month: [String, Number],
        date: [String, Number],
        value: Object,
        mondayFirst: Boolean,
        disabledDates: Object,
    },
    emits: ['update:month', 'update:value'],
    setup(props, { emit, slots }) {
        const FIRST_MONTH = 0;
        const LAST_MONTH = 11;
        const DAYS = [0, 1, 2, 3, 4, 5, 6];
        const ANIMATION_TIMEOUT = 0;
        const dates = ref([]);
        const isDatesChanged = ref(false);
        const today = parseDate(new Date());
        const handlers = inject('handlers');
        handlers.value = {
            onNext: () => updateMonth(true),
            onPrev: () => updateMonth(false),
        };
        if (props.mondayFirst) {
            DAYS.push(DAYS.splice(0, 1)[0]);
        }
        const daysInMonth = computed(() => {
            return new Date(props.year, props.month + 1, 0).getDate();
        });
        const updateMonth = (isNext) => {
            const params = {};
            params.month = props.month + (isNext ? 1 : -1);
            if (!isNext && params.month < FIRST_MONTH)
                params.month = LAST_MONTH;
            if (isNext && params.month > LAST_MONTH)
                params.month = FIRST_MONTH;
            if (isNext && !params.month)
                params.year = props.year + 1;
            if (!isNext && params.month === LAST_MONTH)
                params.year = props.year - 1;
            isDatesChanged.value = true;
            emit('update:month', params);
        };
        const genWeekDays = () => {
            const propsData = {
                class: 'v-date-picker-dates__day',
            };
            return DAYS.map((day) => h('span', propsData, props.locale[day]));
        };
        const genDateObject = (date) => {
            const { year, month } = props;
            return parseDate(new Date(year, month, date));
        };
        const setEmptiesBeforeFirstDate = (dateObject) => {
            const firstDay = DAYS[0];
            const startDay = firstDay && !dateObject.day ? dateObject.day : firstDay;
            const tillDay = firstDay && !dateObject.day ? DAYS.length - 1 : dateObject.day;
            for (let i = startDay; i <= tillDay; i += 1) {
                dates.value[i] = { date: null };
            }
            dates.value[tillDay] = dateObject;
        };
        const genTableDates = () => {
            dates.value = [];
            for (let i = 1; i <= daysInMonth.value; i += 1) {
                const dateObject = genDateObject(i);
                if (i === 1) {
                    setEmptiesBeforeFirstDate(dateObject);
                }
                else {
                    dates.value[dates.value.length] = dateObject;
                }
            }
        };
        const compareDates = (date1, date2) => {
            return (date1.date === date2.date &&
                date1.month === date2.month &&
                date1.year === date2.year);
        };
        const setDisabled = (date) => {
            if (!date.date)
                return false;
            if (!props.disabledDates)
                return !!date.isHoliday;
            const { disabledDates } = props;
            return ((disabledDates.daysOfMonth && disableDaysOfMonth(date)) ||
                (disabledDates.from && disableFromTo(date, disabledDates)) ||
                (disabledDates.dates && disableDates(date)) ||
                (disabledDates.days && disableDays(date)) ||
                (disabledDates.ranges && disableRanges(date)) ||
                (disabledDates.custom && disabledDates.custom(date)));
        };
        const disableFromTo = (date, { from, to }) => {
            const dateFrom = parseDate(from);
            const dateTo = parseDate(to);
            return date.mls >= dateFrom.mls && date.mls <= dateTo.mls;
        };
        const disableDaysOfMonth = (date) => {
            return props.disabledDates.daysOfMonth.some((it) => it === date.date);
        };
        const disableDates = (date) => {
            return props.disabledDates.dates.find((d) => {
                return String(d) === String(toDateString(date));
            });
        };
        const disableDays = (date) => {
            return props.disabledDates.days.find((d) => d === date.day) >= 0;
        };
        const disableRanges = (date) => {
            const { ranges } = props.disabledDates;
            for (let i = 0; i < ranges.length; i += 1) {
                if (disableFromTo(date, ranges[i]))
                    return true;
            }
        };
        const genDateCell = (date) => {
            const isSelected = compareDates(date, props.value);
            const isToday = compareDates(date, today);
            date.isHoliday = setDisabled(date);
            const propsData = {
                class: {
                    'v-date-picker-dates__cell': !!date.date,
                    'v-date-picker-dates__cell--empty': !date.date,
                    'v-date-picker-dates__cell--selected': isSelected && !props.value.default,
                    'v-date-picker-dates__cell--current-date': isToday,
                    'v-date-picker-dates__cell--holiday': date.date && date.isHoliday,
                },
                onClick: () => date.date && emit('update:value', date),
            };
            return h('div', propsData, [
                (date.date && slots.date && slots.date(date)) || date.date,
            ]);
        };
        const genDateCells = () => {
            return dates.value.reduce((acc, dateObject) => {
                acc.push(genDateCell(dateObject));
                return acc;
            }, []);
        };
        const genDateRows = () => {
            const datesVNodes = genDateCells();
            return genTableRows(datesVNodes, 'v-date-picker-dates__row', DAYS.length);
        };
        const genDates = () => {
            return ((!isDatesChanged.value &&
                h('div', { class: 'v-date-picker-dates__dates' }, genDateRows())) ||
                null);
        };
        const genWeek = () => {
            return h('div', { class: 'v-date-picker-dates__week' }, genWeekDays());
        };
        watch(() => props.month, () => genTableDates(), { immediate: true });
        watch(() => isDatesChanged.value, () => setTimeout(() => (isDatesChanged.value = false), ANIMATION_TIMEOUT));
        return () => h('div', { class: 'v-date-picker-dates' }, [
            genWeek(),
            useTransition(genDates(), 'fade'),
        ]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGVQaWNrZXJEYXRlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL3Z1ZWxhbmQvc3JjL2NvbXBvbmVudHMvVkRhdGVQaWNrZXIvVkRhdGVQaWNrZXJEYXRlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxlQUFlLEVBQUUsTUFBTSxLQUFLLENBQUE7QUFHdEUsT0FBTyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBR2pFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQTtBQVdoRSxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBRyxlQUFlLENBQUM7SUFDOUMsSUFBSSxFQUFFLHFCQUFxQjtJQUUzQixLQUFLLEVBQUU7UUFDTCxNQUFNLEVBQUUsS0FBSztRQUNiLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7UUFDdEIsS0FBSyxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztRQUN2QixJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1FBQ3RCLEtBQUssRUFBRSxNQUFNO1FBQ2IsV0FBVyxFQUFFLE9BQU87UUFDcEIsYUFBYSxFQUFFLE1BQU07S0FDZjtJQUVSLEtBQUssRUFBRSxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUM7SUFFdkMsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUU7UUFDMUIsTUFBTSxXQUFXLEdBQUcsQ0FBQyxDQUFBO1FBQ3JCLE1BQU0sVUFBVSxHQUFHLEVBQUUsQ0FBQTtRQUNyQixNQUFNLElBQUksR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFF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Q0FDMUUsQ0FBQTtRQUVELE9BQU8sR0FBRyxFQUFFLENBQ1YsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxxQkFBcUIsRUFBRSxFQUFFO1lBQ3pDLE9BQU8sRUFBRTtZQUNULGFBQWEsQ0FBQyxRQUFRLEVBQVMsRUFBRSxNQUFNLENBQUM7U0FDekMsQ0FBQyxDQUFBO0lBQ04sQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7IGgsIHJlZiwgaW5qZWN0LCBjb21wdXRlZCwgd2F0Y2gsIGRlZmluZUNvbXBvbmVudCB9IGZyb20gJ3Z1ZSdcblxuLy8gSGVscGVyc1xuaW1wb3J0IHsgZ2VuVGFibGVSb3dzLCBwYXJzZURhdGUsIHRvRGF0ZVN0cmluZyB9IGZyb20gJy4vaGVscGVycydcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgdXNlVHJhbnNpdGlvbiB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGVzL3VzZS10cmFuc2l0aW9uJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUsIFJlZiB9IGZyb20gJ3Z1ZSdcbmltcG9ydCB7IERhdGVQaWNrZXJCdG5IYW5kbGVycywgRGF0ZVBpY2tlckRhdGUgfSBmcm9tICcuLi8uLi8uLi90eXBlcydcblxudHlwZSBVcGRhdGVQYXJhbXMgPSB7XG4gIG1vbnRoPzogbnVtYmVyXG4gIHllYXI/OiBudW1iZXJcbn1cblxuZXhwb3J0IGNvbnN0IFZEYXRlUGlja2VyRGF0ZXMgPSBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAndi1kYXRlLXBpY2tlci1kYXRlcycsXG5cbiAgcHJvcHM6IHtcbiAgICBsb2NhbGU6IEFycmF5LFxuICAgIHllYXI6IFtTdHJpbmcsIE51bWJlcl0sXG4gICAgbW9udGg6IFtTdHJpbmcsIE51bWJlcl0sXG4gICAgZGF0ZTogW1N0cmluZywgTnVtYmVyXSxcbiAgICB2YWx1ZTogT2JqZWN0LFxuICAgIG1vbmRheUZpcnN0OiBCb29sZWFuLFxuICAgIGRpc2FibGVkRGF0ZXM6IE9iamVjdCxcbiAgfSBhcyBhbnksXG5cbiAgZW1pdHM6IFsndXBkYXRlOm1vbnRoJywgJ3VwZGF0ZTp2YWx1ZSddLFxuXG4gIHNldHVwKHByb3BzLCB7IGVtaXQsIHNsb3RzIH0pOiAoKSA9PiBWTm9kZSB7XG4gICAgY29uc3QgRklSU1RfTU9OVEggPSAwXG4gICAgY29uc3QgTEFTVF9NT05USCA9IDExXG4gICAgY29uc3QgREFZUyA9IFswLCAxLCAyLCAzLCA0LCA1LCA2XVxuICAgIGNvbnN0IEFOSU1BVElPTl9USU1FT1VUID0gMFxuXG4gICAgY29uc3QgZGF0ZXMgPSByZWY8KERhdGVQaWNrZXJEYXRlIHwgbnVsbClbXT4oW10pXG4gICAgY29uc3QgaXNEYXRlc0NoYW5nZWQgPSByZWY8Ym9vbGVhbj4oZmFsc2UpXG4gICAgY29uc3QgdG9kYXkgPSBwYXJzZURhdGUobmV3IERhdGUoKSlcblxuICAgIGNvbnN0IGhhbmRsZXJzID0gaW5qZWN0KCdoYW5kbGVycycpIGFzIFJlZjxEYXRlUGlja2VyQnRuSGFuZGxlcnM+XG5cbiAgICBoYW5kbGVycy52YWx1ZSA9IHtcbiAgICAgIG9uTmV4dDogKCkgPT4gdXBkYXRlTW9udGgodHJ1ZSksXG4gICAgICBvblByZXY6ICgpID0+IHVwZGF0ZU1vbnRoKGZhbHNlKSxcbiAgICB9XG5cbiAgICBpZiAocHJvcHMubW9uZGF5Rmlyc3QpIHtcbiAgICAgIERBWVMucHVzaChEQVlTLnNwbGljZSgwLCAxKVswXSlcbiAgICB9XG5cbiAgICBjb25zdCBkYXlzSW5Nb250aCA9IGNvbXB1dGVkPG51bWJlcj4oKCkgPT4ge1xuICAgICAgcmV0dXJuIG5ldyBEYXRlKHByb3BzLnllYXIsIHByb3BzLm1vbnRoICsgMSwgMCkuZ2V0RGF0ZSgpXG4gICAgfSlcblxuICAgIGNvbnN0IHVwZGF0ZU1vbnRoID0gKGlzTmV4dDogYm9vbGVhbikgPT4ge1xuICAgICAgY29uc3QgcGFyYW1zOiBVcGRhdGVQYXJhbXMgPSB7fVxuXG4gICAgICBwYXJhbXMubW9udGggPSBwcm9wcy5tb250aCArIChpc05leHQgPyAxIDogLTEpXG5cbiAgICAgIGlmICghaXNOZXh0ICYmIHBhcmFtcy5tb250aCEgPCBGSVJTVF9NT05USCkgcGFyYW1zLm1vbnRoID0gTEFTVF9NT05USFxuICAgICAgaWYgKGlzTmV4dCAmJiBwYXJhbXMubW9udGghID4gTEFTVF9NT05USCkgcGFyYW1zLm1vbnRoID0gRklSU1RfTU9OVEhcbiAgICAgIGlmIChpc05leHQgJiYgIXBhcmFtcy5tb250aCkgcGFyYW1zLnllYXIgPSBwcm9wcy55ZWFyICsgMVxuICAgICAgaWYgKCFpc05leHQgJiYgcGFyYW1zLm1vbnRoID09PSBMQVNUX01PTlRIKSBwYXJhbXMueWVhciA9IHByb3BzLnllYXIgLSAxXG5cbiAgICAgIGlzRGF0ZXNDaGFuZ2VkLnZhbHVlID0gdHJ1ZVxuICAgICAgZW1pdCgndXBkYXRlOm1vbnRoJywgcGFyYW1zKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbldlZWtEYXlzID0gKCk6IFZOb2RlW10gPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczogJ3YtZGF0ZS1waWNrZXItZGF0ZXNfX2RheScsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBEQVlTLm1hcCgoZGF5KSA9PlxuICAgICAgICBoKCdzcGFuJywgcHJvcHNEYXRhLCBwcm9wcy5sb2NhbGUhW2RheV0gYXMgc3RyaW5nKSxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlT2JqZWN0ID0gKGRhdGUpOiBEYXRlUGlja2VyRGF0ZSA9PiB7XG4gICAgICBjb25zdCB7IHllYXIsIG1vbnRoIH0gPSBwcm9wc1xuICAgICAgcmV0dXJuIHBhcnNlRGF0ZShuZXcgRGF0ZSh5ZWFyLCBtb250aCwgZGF0ZSkpXG4gICAgfVxuXG4gICAgY29uc3Qgc2V0RW1wdGllc0JlZm9yZUZpcnN0RGF0ZSA9IChkYXRlT2JqZWN0KSA9PiB7XG4gICAgICBjb25zdCBmaXJzdERheSA9IERBWVNbMF1cbiAgICAgIGNvbnN0IHN0YXJ0RGF5ID0gZmlyc3REYXkgJiYgIWRhdGVPYmplY3QuZGF5ID8gZGF0ZU9iamVjdC5kYXkgOiBmaXJzdERheVxuICAgICAgY29uc3QgdGlsbERheSA9XG4gICAgICAgIGZpcnN0RGF5ICYmICFkYXRlT2JqZWN0LmRheSA/IERBWVMubGVuZ3RoIC0gMSA6IGRhdGVPYmplY3QuZGF5XG5cbiAgICAgIGZvciAobGV0IGkgPSBzdGFydERheTsgaSA8PSB0aWxsRGF5OyBpICs9IDEpIHtcbiAgICAgICAgZGF0ZXMudmFsdWVbaV0gPSB7IGRhdGU6IG51bGwgfSBhcyBhbnlcbiAgICAgIH1cblxuICAgICAgZGF0ZXMudmFsdWVbdGlsbERheV0gPSBkYXRlT2JqZWN0XG4gICAgfVxuXG4gICAgY29uc3QgZ2VuVGFibGVEYXRlcyA9ICgpID0+IHtcbiAgICAgIGRhdGVzLnZhbHVlID0gW11cbiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IGRheXNJbk1vbnRoLnZhbHVlOyBpICs9IDEpIHtcbiAgICAgICAgY29uc3QgZGF0ZU9iamVjdCA9IGdlbkRhdGVPYmplY3QoaSlcblxuICAgICAgICBpZiAoaSA9PT0gMSkge1xuICAgICAgICAgIHNldEVtcHRpZXNCZWZvcmVGaXJzdERhdGUoZGF0ZU9iamVjdClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkYXRlcy52YWx1ZVtkYXRlcy52YWx1ZS5sZW5ndGhdID0gZGF0ZU9iamVjdCBhcyBhbnlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGNvbXBhcmVEYXRlcyA9IChkYXRlMSwgZGF0ZTIpID0+IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGRhdGUxLmRhdGUgPT09IGRhdGUyLmRhdGUgJiZcbiAgICAgICAgZGF0ZTEubW9udGggPT09IGRhdGUyLm1vbnRoICYmXG4gICAgICAgIGRhdGUxLnllYXIgPT09IGRhdGUyLnllYXJcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBzZXREaXNhYmxlZCA9IChkYXRlOiBEYXRlUGlja2VyRGF0ZSk6IGJvb2xlYW4gPT4ge1xuICAgICAgaWYgKCFkYXRlLmRhdGUpIHJldHVybiBmYWxzZVxuICAgICAgaWYgKCFwcm9wcy5kaXNhYmxlZERhdGVzKSByZXR1cm4gISFkYXRlLmlzSG9saWRheVxuXG4gICAgICBjb25zdCB7IGRpc2FibGVkRGF0ZXMgfSA9IHByb3BzXG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIChkaXNhYmxlZERhdGVzLmRheXNPZk1vbnRoICYmIGRpc2FibGVEYXlzT2ZNb250aChkYXRlKSkgfHxcbiAgICAgICAgKGRpc2FibGVkRGF0ZXMuZnJvbSAmJiBkaXNhYmxlRnJvbVRvKGRhdGUsIGRpc2FibGVkRGF0ZXMpKSB8fFxuICAgICAgICAoZGlzYWJsZWREYXRlcy5kYXRlcyAmJiBkaXNhYmxlRGF0ZXMoZGF0ZSkpIHx8XG4gICAgICAgIChkaXNhYmxlZERhdGVzLmRheXMgJiYgZGlzYWJsZURheXMoZGF0ZSkpIHx8XG4gICAgICAgIChkaXNhYmxlZERhdGVzLnJhbmdlcyAmJiBkaXNhYmxlUmFuZ2VzKGRhdGUpKSB8fFxuICAgICAgICAoZGlzYWJsZWREYXRlcy5jdXN0b20gJiYgZGlzYWJsZWREYXRlcy5jdXN0b20oZGF0ZSkpXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZGlzYWJsZUZyb21UbyA9IChkYXRlOiBEYXRlUGlja2VyRGF0ZSwgeyBmcm9tLCB0byB9KTogYm9vbGVhbiA9PiB7XG4gICAgICBjb25zdCBkYXRlRnJvbTogRGF0ZVBpY2tlckRhdGUgPSBwYXJzZURhdGUoZnJvbSlcbiAgICAgIGNvbnN0IGRhdGVUbzogRGF0ZVBpY2tlckRhdGUgPSBwYXJzZURhdGUodG8pXG5cbiAgICAgIHJldHVybiBkYXRlLm1scyA+PSBkYXRlRnJvbS5tbHMgJiYgZGF0ZS5tbHMgPD0gZGF0ZVRvLm1sc1xuICAgIH1cblxuICAgIGNvbnN0IGRpc2FibGVEYXlzT2ZNb250aCA9IChkYXRlOiBEYXRlUGlja2VyRGF0ZSk6IGJvb2xlYW4gPT4ge1xuICAgICAgcmV0dXJuIHByb3BzLmRpc2FibGVkRGF0ZXMuZGF5c09mTW9udGguc29tZSgoaXQpID0+IGl0ID09PSBkYXRlLmRhdGUpXG4gICAgfVxuXG4gICAgY29uc3QgZGlzYWJsZURhdGVzID0gKGRhdGU6IERhdGVQaWNrZXJEYXRlKTogYm9vbGVhbiA9PiB7XG4gICAgICByZXR1cm4gcHJvcHMuZGlzYWJsZWREYXRlcy5kYXRlcy5maW5kKChkKSA9PiB7XG4gICAgICAgIHJldHVybiBTdHJpbmcoZCkgPT09IFN0cmluZyh0b0RhdGVTdHJpbmcoZGF0ZSkpXG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGRpc2FibGVEYXlzID0gKGRhdGU6IERhdGVQaWNrZXJEYXRlKTogYm9vbGVhbiA9PiB7XG4gICAgICByZXR1cm4gcHJvcHMuZGlzYWJsZWREYXRlcy5kYXlzLmZpbmQoKGQpID0+IGQgPT09IGRhdGUuZGF5KSA+PSAwXG4gICAgfVxuXG4gICAgY29uc3QgZGlzYWJsZVJhbmdlcyA9IChkYXRlOiBEYXRlUGlja2VyRGF0ZSkgPT4ge1xuICAgICAgY29uc3QgeyByYW5nZXMgfSA9IHByb3BzLmRpc2FibGVkRGF0ZXNcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgaWYgKGRpc2FibGVGcm9tVG8oZGF0ZSwgcmFuZ2VzW2ldKSkgcmV0dXJuIHRydWVcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlQ2VsbCA9IChkYXRlOiBEYXRlUGlja2VyRGF0ZSk6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IGlzU2VsZWN0ZWQ6IGJvb2xlYW4gPSBjb21wYXJlRGF0ZXMoZGF0ZSwgcHJvcHMudmFsdWUpXG4gICAgICBjb25zdCBpc1RvZGF5OiBib29sZWFuID0gY29tcGFyZURhdGVzKGRhdGUsIHRvZGF5KVxuXG4gICAgICBkYXRlLmlzSG9saWRheSA9IHNldERpc2FibGVkKGRhdGUpXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1kYXRlLXBpY2tlci1kYXRlc19fY2VsbCc6ICEhZGF0ZS5kYXRlLFxuICAgICAgICAgICd2LWRhdGUtcGlja2VyLWRhdGVzX19jZWxsLS1lbXB0eSc6ICFkYXRlLmRhdGUsXG4gICAgICAgICAgJ3YtZGF0ZS1waWNrZXItZGF0ZXNfX2NlbGwtLXNlbGVjdGVkJzpcbiAgICAgICAgICAgIGlzU2VsZWN0ZWQgJiYgIXByb3BzLnZhbHVlLmRlZmF1bHQsXG4gICAgICAgICAgJ3YtZGF0ZS1waWNrZXItZGF0ZXNfX2NlbGwtLWN1cnJlbnQtZGF0ZSc6IGlzVG9kYXksXG4gICAgICAgICAgJ3YtZGF0ZS1waWNrZXItZGF0ZXNfX2NlbGwtLWhvbGlkYXknOiBkYXRlLmRhdGUgJiYgZGF0ZS5pc0hvbGlkYXksXG4gICAgICAgIH0sXG4gICAgICAgIG9uQ2xpY2s6ICgpID0+IGRhdGUuZGF0ZSAmJiBlbWl0KCd1cGRhdGU6dmFsdWUnLCBkYXRlKSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHByb3BzRGF0YSwgW1xuICAgICAgICAoZGF0ZS5kYXRlICYmIHNsb3RzLmRhdGUgJiYgc2xvdHMuZGF0ZShkYXRlKSkgfHwgZGF0ZS5kYXRlLFxuICAgICAgXSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlQ2VsbHMgPSAoKTogVk5vZGVbXSA9PiB7XG4gICAgICByZXR1cm4gZGF0ZXMudmFsdWUucmVkdWNlKChhY2MsIGRhdGVPYmplY3QpID0+IHtcbiAgICAgICAgYWNjLnB1c2goZ2VuRGF0ZUNlbGwoZGF0ZU9iamVjdCEpKVxuICAgICAgICByZXR1cm4gYWNjXG4gICAgICB9LCBbXSBhcyBWTm9kZVtdKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkRhdGVSb3dzID0gKCk6IFZOb2RlW10gPT4ge1xuICAgICAgY29uc3QgZGF0ZXNWTm9kZXMgPSBnZW5EYXRlQ2VsbHMoKVxuXG4gICAgICByZXR1cm4gZ2VuVGFibGVSb3dzKGRhdGVzVk5vZGVzLCAndi1kYXRlLXBpY2tlci1kYXRlc19fcm93JywgREFZUy5sZW5ndGgpXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuRGF0ZXMgPSAoKTogTWF5YmU8Vk5vZGU+ID0+IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgICghaXNEYXRlc0NoYW5nZWQudmFsdWUgJiZcbiAgICAgICAgICBoKCdkaXYnLCB7IGNsYXNzOiAndi1kYXRlLXBpY2tlci1kYXRlc19fZGF0ZXMnIH0sIGdlbkRhdGVSb3dzKCkpKSB8fFxuICAgICAgICBudWxsXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuV2VlayA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogJ3YtZGF0ZS1waWNrZXItZGF0ZXNfX3dlZWsnIH0sIGdlbldlZWtEYXlzKCkpXG4gICAgfVxuXG4gICAgd2F0Y2goXG4gICAgICAoKSA9PiBwcm9wcy5tb250aCxcbiAgICAgICgpID0+IGdlblRhYmxlRGF0ZXMoKSxcbiAgICAgIHsgaW1tZWRpYXRlOiB0cnVlIH0sXG4gICAgKVxuXG4gICAgd2F0Y2goXG4gICAgICAoKSA9PiBpc0RhdGVzQ2hhbmdlZC52YWx1ZSxcbiAgICAgICgpID0+IHNldFRpbWVvdXQoKCkgPT4gKGlzRGF0ZXNDaGFuZ2VkLnZhbHVlID0gZmFsc2UpLCBBTklNQVRJT05fVElNRU9VVCksXG4gICAgKVxuXG4gICAgcmV0dXJuICgpID0+XG4gICAgICBoKCdkaXYnLCB7IGNsYXNzOiAndi1kYXRlLXBpY2tlci1kYXRlcycgfSwgW1xuICAgICAgICBnZW5XZWVrKCksXG4gICAgICAgIHVzZVRyYW5zaXRpb24oZ2VuRGF0ZXMoKSBhcyBhbnksICdmYWRlJyksXG4gICAgICBdKVxuICB9LFxufSlcbiJdfQ==