import { h, defineComponent, ref, computed } from 'vue';
import { VInput } from '../VInput';
import { VChip } from '../VChip';
import { useIcons } from '../../composable/use-icons';
import { useInputStates } from '../../composable/use-input-states';
import { uniqueArray } from '../../helpers';
export default defineComponent({
    name: 'v-file-input',
    props: {
        disabled: Boolean,
        multiple: Boolean,
        chipColor: {
            type: String,
            default: 'primary',
        },
        value: {
            type: Array,
            default: () => [],
        },
    },
    emits: ['update:value', 'delete'],
    setup(props, { emit, attrs }) {
        const { icons } = useIcons();
        const { isDisabled, isReadonly } = useInputStates(props, { emit, attrs });
        const inputRef = ref(null);
        const srcRef = ref(null);
        const classes = computed(() => ({
            'v-file-input': true,
            'v-file-input--disabled': isDisabled.value,
            'v-file-input--readonly': isReadonly.value,
            'v-file-input--multiple': props.multiple,
        }));
        const onChange = (event) => {
            let files = Array.from(event.target.files);
            if (props.multiple) {
                files = uniqueArray(props.value.concat(files));
            }
            event.target.value = '';
            emit('update:value', files);
        };
        const onClose = (file) => {
            const files = props.value.filter(it => {
                return file.name !== it.name;
            });
            emit('update:value', files);
            emit('delete', file);
        };
        const onClick = ({ srcElement }) => {
            if (srcElement !== srcRef.value)
                return;
            inputRef.value.click();
        };
        const genFileInput = () => {
            return h('input', {
                class: 'v-file-input__field',
                type: 'file',
                multiple: props.multiple,
                ref: inputRef,
                style: {
                    position: 'absolute',
                    visibility: 'hidden',
                },
                onChange,
            });
        };
        const genChips = () => {
            return uniqueArray(props.value)
                .map(file => h(VChip, {
                title: file.name,
                class: 'ma-1',
                color: props.chipColor,
                onClose: () => onClose(file),
            }));
        };
        const genChipsContainer = () => {
            return h('div', {
                class: 'v-file-input__container',
                ref: srcRef,
            }, genChips());
        };
        const genComponent = () => h('div', {
            class: classes.value,
            onClick,
        }, [
            genFileInput(),
            genChipsContainer(),
        ]);
        return () => h(VInput, {
            prependIcon: icons.$paperclip,
            file: true,
            disabled: isDisabled.value,
        }, {
            'text-field': () => genComponent(),
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkZpbGVJbnB1dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZGaWxlSW5wdXQvVkZpbGVJbnB1dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsQ0FBQyxFQUFFLGVBQWUsRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFZLE1BQU0sS0FBSyxDQUFBO0FBRWpFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFDbEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUVoQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sNEJBQTRCLENBQUE7QUFDckQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG1DQUFtQyxDQUFBO0FBRWxFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFJM0MsZUFBZSxlQUFlLENBQUM7SUFDN0IsSUFBSSxFQUFFLGNBQWM7SUFDcEIsS0FBSyxFQUFFO1FBQ0wsUUFBUSxFQUFFLE9BQU87UUFDakIsUUFBUSxFQUFFLE9BQU87UUFDakIsU0FBUyxFQUFFO1lBQ1QsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsU0FBUztTQUNuQjtRQUNELEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxLQUE4QjtZQUNwQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRTtTQUNsQjtLQUNGO0lBQ0QsS0FBSyxFQUFFLENBQUMsY0FBYyxFQUFFLFFBQVEsQ0FBQztJQUNqQyxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRTtRQUMxQixNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsUUFBUSxFQUFFLENBQUE7UUFDNUIsTUFBTSxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsR0FBRyxjQUFjLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUE7UUFF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QyxDQUFDLENBQUMsS0FBSyxFQUFFO1lBQ2xDLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSztZQUNwQixPQUFPO1NBQ1IsRUFBRTtZQUNELFlBQVksRUFBRTtZQUNkLGlCQUFpQixFQUFFO1NBQ3BCLENBQUMsQ0FBQTtRQUVGLE9BQU8sR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRTtZQUNyQixXQUFXLEVBQUUsS0FBSyxDQUFDLFVBQVU7WUFDN0IsSUFBSSxFQUFFLElBQUk7WUFDVixRQUFRLEVBQUUsVUFBVSxDQUFDLEtBQUs7U0FDM0IsRUFBRTtZQUNELFlBQVksRUFBRSxHQUFHLEVBQUUsQ0FBQyxZQUFZLEVBQUU7U0FDbkMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7IGgsIGRlZmluZUNvbXBvbmVudCwgcmVmLCBjb21wdXRlZCwgUHJvcFR5cGUgfSBmcm9tICd2dWUnXG4vLyBDb21wb25lbnRzXG5pbXBvcnQgeyBWSW5wdXQgfSBmcm9tICcuLi9WSW5wdXQnXG5pbXBvcnQgeyBWQ2hpcCB9IGZyb20gJy4uL1ZDaGlwJ1xuLy8gQ29tcG9zYWJsZXNcbmltcG9ydCB7IHVzZUljb25zIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtaWNvbnMnXG5pbXBvcnQgeyB1c2VJbnB1dFN0YXRlcyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLWlucHV0LXN0YXRlcydcbi8vIEhlbHBlcnNcbmltcG9ydCB7IHVuaXF1ZUFycmF5IH0gZnJvbSAnLi4vLi4vaGVscGVycydcbi8vIFR5cGVzXG5pbXBvcnQgeyBNYXliZSB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL2Jhc2UnXG5cbmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LWZpbGUtaW5wdXQnLFxuICBwcm9wczoge1xuICAgIGRpc2FibGVkOiBCb29sZWFuLFxuICAgIG11bHRpcGxlOiBCb29sZWFuLFxuICAgIGNoaXBDb2xvcjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ3ByaW1hcnknLFxuICAgIH0sXG4gICAgdmFsdWU6IHtcbiAgICAgIHR5cGU6IEFycmF5IGFzIFByb3BUeXBlPEFycmF5PEZpbGU+PixcbiAgICAgIGRlZmF1bHQ6ICgpID0+IFtdLFxuICAgIH0sXG4gIH0sXG4gIGVtaXRzOiBbJ3VwZGF0ZTp2YWx1ZScsICdkZWxldGUnXSxcbiAgc2V0dXAocHJvcHMsIHsgZW1pdCwgYXR0cnMgfSkge1xuICAgIGNvbnN0IHsgaWNvbnMgfSA9IHVzZUljb25zKClcbiAgICBjb25zdCB7IGlzRGlzYWJsZWQsIGlzUmVhZG9ubHkgfSA9IHVzZUlucHV0U3RhdGVzKHByb3BzLCB7IGVtaXQsIGF0dHJzIH0pXG5cbiAgICBjb25zdCBpbnB1dFJlZiA9IHJlZjxNYXliZTxIVE1MSW5wdXRFbGVtZW50Pj4obnVsbClcbiAgICBjb25zdCBzcmNSZWYgPSByZWY8TWF5YmU8SFRNTEVsZW1lbnQ+PihudWxsKVxuXG4gICAgY29uc3QgY2xhc3NlcyA9IGNvbXB1dGVkKCgpID0+ICh7XG4gICAgICAndi1maWxlLWlucHV0JzogdHJ1ZSxcbiAgICAgICd2LWZpbGUtaW5wdXQtLWRpc2FibGVkJzogaXNEaXNhYmxlZC52YWx1ZSxcbiAgICAgICd2LWZpbGUtaW5wdXQtLXJlYWRvbmx5JzogaXNSZWFkb25seS52YWx1ZSxcbiAgICAgICd2LWZpbGUtaW5wdXQtLW11bHRpcGxlJzogcHJvcHMubXVsdGlwbGUsXG4gICAgfSkpXG5cbiAgICBjb25zdCBvbkNoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgbGV0IGZpbGVzID0gQXJyYXkuZnJvbShldmVudC50YXJnZXQuZmlsZXMpIGFzIEZpbGVbXVxuXG4gICAgICBpZiAocHJvcHMubXVsdGlwbGUpIHtcbiAgICAgICAgZmlsZXMgPSB1bmlxdWVBcnJheTxGaWxlPihwcm9wcy52YWx1ZS5jb25jYXQoZmlsZXMpKVxuICAgICAgfVxuXG4gICAgICBldmVudC50YXJnZXQudmFsdWUgPSAnJ1xuICAgICAgZW1pdCgndXBkYXRlOnZhbHVlJywgZmlsZXMpXG4gICAgfVxuXG4gICAgY29uc3Qgb25DbG9zZSA9IChmaWxlKSA9PiB7XG4gICAgICBjb25zdCBmaWxlcyA9IHByb3BzLnZhbHVlLmZpbHRlcihpdCA9PiB7XG4gICAgICAgIHJldHVybiBmaWxlLm5hbWUgIT09IGl0Lm5hbWVcbiAgICAgIH0pXG5cbiAgICAgIGVtaXQoJ3VwZGF0ZTp2YWx1ZScsIGZpbGVzKVxuICAgICAgZW1pdCgnZGVsZXRlJywgZmlsZSlcbiAgICB9XG5cbiAgICBjb25zdCBvbkNsaWNrID0gKHsgc3JjRWxlbWVudCB9KSA9PiB7XG4gICAgICBpZiAoc3JjRWxlbWVudCAhPT0gc3JjUmVmLnZhbHVlKSByZXR1cm5cbiAgICAgIGlucHV0UmVmLnZhbHVlIS5jbGljaygpXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuRmlsZUlucHV0ID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIGgoJ2lucHV0Jywge1xuICAgICAgICBjbGFzczogJ3YtZmlsZS1pbnB1dF9fZmllbGQnLFxuICAgICAgICB0eXBlOiAnZmlsZScsXG4gICAgICAgIG11bHRpcGxlOiBwcm9wcy5tdWx0aXBsZSxcbiAgICAgICAgcmVmOiBpbnB1dFJlZixcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICB2aXNpYmlsaXR5OiAnaGlkZGVuJyxcbiAgICAgICAgfSxcbiAgICAgICAgb25DaGFuZ2UsXG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkNoaXBzID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIHVuaXF1ZUFycmF5PEZpbGU+KHByb3BzLnZhbHVlKVxuICAgICAgICAubWFwKGZpbGUgPT4gaChWQ2hpcCwge1xuICAgICAgICAgICAgdGl0bGU6IGZpbGUubmFtZSxcbiAgICAgICAgICAgIGNsYXNzOiAnbWEtMScsXG4gICAgICAgICAgICBjb2xvcjogcHJvcHMuY2hpcENvbG9yLFxuICAgICAgICAgICAgb25DbG9zZTogKCkgPT4gb25DbG9zZShmaWxlKSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkNoaXBzQ29udGFpbmVyID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIGgoJ2RpdicsIHtcbiAgICAgICAgY2xhc3M6ICd2LWZpbGUtaW5wdXRfX2NvbnRhaW5lcicsXG4gICAgICAgIHJlZjogc3JjUmVmLFxuICAgICAgfSwgZ2VuQ2hpcHMoKSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5Db21wb25lbnQgPSAoKSA9PiBoKCdkaXYnLCB7XG4gICAgICBjbGFzczogY2xhc3Nlcy52YWx1ZSxcbiAgICAgIG9uQ2xpY2ssXG4gICAgfSwgW1xuICAgICAgZ2VuRmlsZUlucHV0KCksXG4gICAgICBnZW5DaGlwc0NvbnRhaW5lcigpLFxuICAgIF0pXG5cbiAgICByZXR1cm4gKCkgPT4gaChWSW5wdXQsIHtcbiAgICAgIHByZXBlbmRJY29uOiBpY29ucy4kcGFwZXJjbGlwLFxuICAgICAgZmlsZTogdHJ1ZSxcbiAgICAgIGRpc2FibGVkOiBpc0Rpc2FibGVkLnZhbHVlLFxuICAgIH0sIHtcbiAgICAgICd0ZXh0LWZpZWxkJzogKCkgPT4gZ2VuQ29tcG9uZW50KCksXG4gICAgfSlcbiAgfSxcbn0pXG4iXX0=