import './VResize.scss';
import { h, ref, computed, reactive, defineComponent, onMounted, onBeforeUnmount, } from 'vue';
import { positionProps } from '../../effects/use-position';
export const VResize = defineComponent({
    name: 'v-resize',
    props: {
        emit: {
            type: Boolean,
            default: false,
        },
        customClass: {
            type: String,
        },
        minSize: {
            type: [String, Number],
            default: 50,
        },
        ...positionProps(),
    },
    setup(props, { emit }) {
        const data = reactive({
            parentNode: null,
            startOffset: null,
            offsetTop: 0,
            offsetLeft: 0,
            parentHeight: 0,
            parentWidth: 0,
            marginLeft: 0,
            marginTop: 0,
            left: 0,
            top: 0,
            isActive: false,
        });
        const resRef = ref(null);
        const classes = computed(() => {
            return {
                'v-resize': true,
                'v-resize--active': data.isActive,
                'v-resize--top': props.top,
                'v-resize--bottom': props.bottom,
                'v-resize--right': props.right,
                'v-resize--left': props.left,
                [props.customClass]: !!props.customClass,
            };
        });
        const isDirectY = computed(() => {
            return props.top || props.bottom;
        });
        const isNeedReverse = computed(() => {
            return props.top || props.left;
        });
        const currentSize = computed(() => {
            return isDirectY.value ? data.parentHeight : data.parentWidth;
        });
        const sizeProp = computed(() => {
            return isDirectY.value ? 'height' : 'width';
        });
        const reverseDirection = computed(() => {
            return props.top ? 'top' : 'left';
        });
        const reverseOffsetKey = computed(() => {
            const side = reverseDirection.value;
            return 'offset' + side[0].toUpperCase() + side.slice(1);
        });
        const offset = computed(() => {
            return isDirectY.value ? data.offsetTop : data.offsetLeft;
        });
        const direction = computed(() => {
            return isDirectY.value ? 'clientY' : 'clientX';
        });
        function moveReverse(size) {
            const { parentNode, left, top } = data;
            const reverseTo = reverseDirection.value;
            const value = !isDirectY.value
                ? currentSize.value - size + left
                : currentSize.value - size + top;
            parentNode.style[reverseTo] = `${value}px`;
        }
        function setOrEmitSize(size) {
            if (props.emit)
                return emit('size', size);
            data.parentNode.style[sizeProp.value] = `${size}px`;
            isNeedReverse.value && moveReverse(size);
        }
        function resize(e) {
            let size;
            if (isNeedReverse.value) {
                size = currentSize.value - (e[direction.value] - offset.value) +
                    data.startOffset;
            }
            else {
                size = currentSize.value + (e[direction.value] - currentSize.value -
                    offset.value - data.startOffset);
            }
            size > props.minSize && setOrEmitSize(size);
        }
        function resetMinMaxStyles() {
            if (isDirectY.value) {
                data.parentNode.style.maxHeight = '';
                data.parentNode.style.minHeight = '';
            }
            else {
                data.parentNode.style.maxWidth = '';
                data.parentNode.style.minWidth = '';
            }
        }
        function setParent() {
            const parent = resRef.value.parentNode;
            data.parentNode = parent;
        }
        function computeSizes() {
            const { top, left, height, width, marginLeft, marginTop, } = getComputedStyle(data.parentNode);
            data.offsetTop = data.parentNode.offsetTop;
            data.offsetLeft = data.parentNode.offsetLeft;
            data.marginLeft = parseFloat(marginLeft);
            data.marginTop = parseFloat(marginTop);
            data.parentHeight = parseFloat(height);
            data.parentWidth = parseFloat(width);
            data.top = parseFloat(top);
            data.left = parseFloat(left);
        }
        function setStartPositions() {
            const side = reverseDirection.value;
            const offset = reverseOffsetKey.value;
            if (data[side] === data[offset]) {
                data.parentNode.style[side] = `${data[offset]}px`;
            }
        }
        function disableSelection(e) {
            e.preventDefault();
        }
        function initResize(e) {
            if (!data.isActive) {
                data.isActive = true;
                computeSizes();
                resetMinMaxStyles();
                setStartPositions();
                setStartOffset(e);
            }
            requestAnimationFrame(() => resize(e));
        }
        function setStartOffset(e) {
            if (isNeedReverse.value)
                data.startOffset = e[direction.value];
            else
                data.startOffset = e[direction.value] - currentSize.value;
            data.startOffset -= offset.value;
        }
        function reset() {
            data.isActive = false;
            resetMinMaxStyles();
        }
        function onMouseup() {
            reset();
            removeHandlers();
        }
        function onMousedown() {
            document.addEventListener('mousemove', initResize);
            document.addEventListener('mouseup', onMouseup);
            document.addEventListener('selectstart', disableSelection);
        }
        function removeHandlers() {
            document.removeEventListener('mousemove', initResize);
            document.removeEventListener('mouseup', onMouseup);
            document.removeEventListener('selectstart', disableSelection);
        }
        onMounted(() => {
            setParent();
        });
        onBeforeUnmount(() => {
            document.removeEventListener('mousedown', onMousedown);
        });
        return () => h('div', {
            class: {
                ...classes.value,
            },
            key: 'resize',
            ref: resRef,
            onMousedown,
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlJlc2l6ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZSZXNpemUvVlJlc2l6ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLGdCQUFnQixDQUFBO0FBR3ZCLE9BQU8sRUFDTCxDQUFDLEVBQ0QsR0FBRyxFQUNILFFBQVEsRUFDUixRQUFRLEVBQ1IsZUFBZSxFQUNmLFNBQVMsRUFDVCxlQUFlLEdBQ2hCLE1BQU0sS0FBSyxDQUFBO0FBR1osT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDRCQUE0QixDQUFBO0FBbUIxRCxNQUFNLENBQUMsTUFBTSxPQUFPLEdBQUcsZUFBZSxDQUFDO0lBQ3JDLElBQUksRUFBRSxVQUFVO0lBRWhCLEtBQUssRUFBRTtRQUNMLElBQUksRUFBRTtZQUNKLElBQUksRUFBRSxPQUFPO1lBQ2IsT0FBTyxFQUFFLEtBQUs7U0FDZjtRQUVELFdBQVcsRUFBRTtZQUNYLElBQUksRUFBRSxNQUFNO1NBQ2I7UUFFRCxPQUFPLEVBQUU7WUFDUCxJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1lBQ3RCLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxHQUFHLGFBQWEsRUFBRTtLQUNaO0lBRVIsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRTtRQUNuQixNQUFNLElBQUksR0FBZSxRQUFRLENBQUM7WUFDaEMsVUFBVSxFQUFFLElBQUk7WUFDaEIsV0FBVyxFQUFFLElBQUk7WUFDakIsU0FBUyxFQUFFLENBQUM7WUFDWixVQUFVLEVBQUUsQ0FBQztZQUNiLFlBQVksRUFBRSxDQUFDO1lBQ2YsV0FBVyxFQUFFLENBQUM7WUFDZCxVQUFVLEVBQUUsQ0FBQztZQUNiLFNBQVMsRUFBRSxDQUFDO1lBQ1osSUFBSSxFQUFFLENBQUM7WUFDUCxHQUFHLEVBQUUsQ0FBQztZQUNOLFFBQVEsRUFBRSxLQUFLO1NBQ2hCLENBQUMsQ0FBQTtRQUVGLE1B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QUFFLENBQUE7UUFDbEIsQ0FBQztRQUVELFNBQVMsV0FBVztZQUNsQixRQUFRLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFBO1lBQ2xELFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUE7WUFDL0MsUUFBUSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFBO1FBQzVELENBQUM7UUFFRCxTQUFTLGNBQWM7WUFDckIsUUFBUSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQTtZQUNyRCxRQUFRLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFBO1lBQ2xELFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQTtRQUMvRCxDQUFDO1FBRUQsU0FBUyxDQUFDLEdBQUcsRUFBRTtZQUNiLFNBQVMsRUFBRSxDQUFBO1FBQ2IsQ0FBQyxDQUFDLENBQUE7UUFFRixlQUFlLENBQUMsR0FBRyxFQUFFO1lBQ25CLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUE7UUFDeEQsQ0FBQyxDQUFDLENBQUE7UUFFRixPQUFPLEdBQUcsRUFBRSxDQUNWLENBQUMsQ0FBQyxLQUFLLEVBQUU7WUFDUCxLQUFLLEVBQUU7Z0JBQ0wsR0FBRyxPQUFPLENBQUMsS0FBSzthQUNqQjtZQUNELEdBQUcsRUFBRSxRQUFRO1lBQ2IsR0FBRyxFQUFFLE1BQU07WUFDWCxXQUFXO1NBQ1osQ0FBQyxDQUFBO0lBQ04sQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFN0eWxlc1xuaW1wb3J0ICcuL1ZSZXNpemUuc2NzcydcblxuLy8gVnVlIEFQSVxuaW1wb3J0IHtcbiAgaCxcbiAgcmVmLFxuICBjb21wdXRlZCxcbiAgcmVhY3RpdmUsXG4gIGRlZmluZUNvbXBvbmVudCxcbiAgb25Nb3VudGVkLFxuICBvbkJlZm9yZVVubW91bnQsXG59IGZyb20gJ3Z1ZSdcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgcG9zaXRpb25Qcm9wcyB9IGZyb20gJy4uLy4uL2VmZmVjdHMvdXNlLXBvc2l0aW9uJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5cbnR5cGUgUmVzaXplRGF0YSA9IHtcbiAgcGFyZW50Tm9kZTogSFRNTEVsZW1lbnQgfCBudWxsXG4gIHN0YXJ0T2Zmc2V0OiBudW1iZXIgfCBudWxsXG4gIG9mZnNldFRvcDogbnVtYmVyXG4gIG9mZnNldExlZnQ6IG51bWJlclxuICBwYXJlbnRIZWlnaHQ6IG51bWJlclxuICBwYXJlbnRXaWR0aDogbnVtYmVyXG4gIG1hcmdpbkxlZnQ6IG51bWJlclxuICBtYXJnaW5Ub3A6IG51bWJlclxuICBsZWZ0OiBudW1iZXJcbiAgdG9wOiBudW1iZXJcbiAgaXNBY3RpdmU6IGJvb2xlYW5cbn1cblxuZXhwb3J0IGNvbnN0IFZSZXNpemUgPSBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAndi1yZXNpemUnLFxuXG4gIHByb3BzOiB7XG4gICAgZW1pdDoge1xuICAgICAgdHlwZTogQm9vbGVhbixcbiAgICAgIGRlZmF1bHQ6IGZhbHNlLFxuICAgIH0sXG5cbiAgICBjdXN0b21DbGFzczoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgIH0sXG5cbiAgICBtaW5TaXplOiB7XG4gICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXJdLFxuICAgICAgZGVmYXVsdDogNTAsXG4gICAgfSxcbiAgICAuLi5wb3NpdGlvblByb3BzKCksXG4gIH0gYXMgYW55LFxuXG4gIHNldHVwKHByb3BzLCB7IGVtaXQgfSk6ICgpID0+IFZOb2RlIHtcbiAgICBjb25zdCBkYXRhOiBSZXNpemVEYXRhID0gcmVhY3RpdmUoe1xuICAgICAgcGFyZW50Tm9kZTogbnVsbCxcbiAgICAgIHN0YXJ0T2Zmc2V0OiBudWxsLFxuICAgICAgb2Zmc2V0VG9wOiAwLFxuICAgICAgb2Zmc2V0TGVmdDogMCxcbiAgICAgIHBhcmVudEhlaWdodDogMCxcbiAgICAgIHBhcmVudFdpZHRoOiAwLFxuICAgICAgbWFyZ2luTGVmdDogMCxcbiAgICAgIG1hcmdpblRvcDogMCxcbiAgICAgIGxlZnQ6IDAsXG4gICAgICB0b3A6IDAsXG4gICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgfSlcblxuICAgIGNvbnN0IHJlc1JlZiA9IHJlZjxIVE1MRWxlbWVudCB8IG51bGw+KG51bGwpXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICd2LXJlc2l6ZSc6IHRydWUsXG4gICAgICAgICd2LXJlc2l6ZS0tYWN0aXZlJzogZGF0YS5pc0FjdGl2ZSxcbiAgICAgICAgJ3YtcmVzaXplLS10b3AnOiBwcm9wcy50b3AsXG4gICAgICAgICd2LXJlc2l6ZS0tYm90dG9tJzogcHJvcHMuYm90dG9tLFxuICAgICAgICAndi1yZXNpemUtLXJpZ2h0JzogcHJvcHMucmlnaHQsXG4gICAgICAgICd2LXJlc2l6ZS0tbGVmdCc6IHByb3BzLmxlZnQsXG4gICAgICAgIFtwcm9wcy5jdXN0b21DbGFzc106ICEhcHJvcHMuY3VzdG9tQ2xhc3MsXG4gICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IGlzRGlyZWN0WSA9IGNvbXB1dGVkPGJvb2xlYW4+KCgpID0+IHtcbiAgICAgIHJldHVybiBwcm9wcy50b3AgfHwgcHJvcHMuYm90dG9tXG4gICAgfSlcblxuICAgIGNvbnN0IGlzTmVlZFJldmVyc2UgPSBjb21wdXRlZDxib29sZWFuPigoKSA9PiB7XG4gICAgICByZXR1cm4gcHJvcHMudG9wIHx8IHByb3BzLmxlZnRcbiAgICB9KVxuXG4gICAgY29uc3QgY3VycmVudFNpemUgPSBjb21wdXRlZDxudW1iZXI+KCgpID0+IHtcbiAgICAgIHJldHVybiBpc0RpcmVjdFkudmFsdWUgPyBkYXRhLnBhcmVudEhlaWdodCEgOiBkYXRhLnBhcmVudFdpZHRoIVxuICAgIH0pXG5cbiAgICBjb25zdCBzaXplUHJvcCA9IGNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuICAgICAgcmV0dXJuIGlzRGlyZWN0WS52YWx1ZSA/ICdoZWlnaHQnIDogJ3dpZHRoJ1xuICAgIH0pXG5cbiAgICBjb25zdCByZXZlcnNlRGlyZWN0aW9uID0gY29tcHV0ZWQ8c3RyaW5nPigoKSA9PiB7XG4gICAgICByZXR1cm4gcHJvcHMudG9wID8gJ3RvcCcgOiAnbGVmdCdcbiAgICB9KVxuXG4gICAgY29uc3QgcmV2ZXJzZU9mZnNldEtleSA9IGNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuICAgICAgY29uc3Qgc2lkZSA9IHJldmVyc2VEaXJlY3Rpb24udmFsdWVcbiAgICAgIHJldHVybiAnb2Zmc2V0JyArIHNpZGVbMF0udG9VcHBlckNhc2UoKSArIHNpZGUuc2xpY2UoMSlcbiAgICB9KVxuXG4gICAgY29uc3Qgb2Zmc2V0ID0gY29tcHV0ZWQ8bnVtYmVyPigoKSA9PiB7XG4gICAgICByZXR1cm4gaXNEaXJlY3RZLnZhbHVlID8gZGF0YS5vZmZzZXRUb3AhIDogZGF0YS5vZmZzZXRMZWZ0IVxuICAgIH0pXG5cbiAgICBjb25zdCBkaXJlY3Rpb24gPSBjb21wdXRlZDxzdHJpbmc+KCgpID0+IHtcbiAgICAgIHJldHVybiBpc0RpcmVjdFkudmFsdWUgPyAnY2xpZW50WScgOiAnY2xpZW50WCdcbiAgICB9KVxuXG4gICAgZnVuY3Rpb24gbW92ZVJldmVyc2Uoc2l6ZSkge1xuICAgICAgY29uc3QgeyBwYXJlbnROb2RlLCBsZWZ0LCB0b3AgfSA9IGRhdGFcbiAgICAgIGNvbnN0IHJldmVyc2VUbyA9IHJldmVyc2VEaXJlY3Rpb24udmFsdWVcblxuICAgICAgY29uc3QgdmFsdWUgPSAhaXNEaXJlY3RZLnZhbHVlXG4gICAgICAgID8gY3VycmVudFNpemUudmFsdWUgLSBzaXplICsgbGVmdFxuICAgICAgICA6IGN1cnJlbnRTaXplLnZhbHVlIC0gc2l6ZSArIHRvcFxuXG4gICAgICBwYXJlbnROb2RlIS5zdHlsZVtyZXZlcnNlVG9dID0gYCR7IHZhbHVlIH1weGBcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRPckVtaXRTaXplKHNpemUpIHtcbiAgICAgIGlmIChwcm9wcy5lbWl0KSByZXR1cm4gZW1pdCgnc2l6ZScsIHNpemUpXG5cbiAgICAgIGRhdGEucGFyZW50Tm9kZSEuc3R5bGVbc2l6ZVByb3AudmFsdWVdID0gYCR7IHNpemUgfXB4YFxuXG4gICAgICBpc05lZWRSZXZlcnNlLnZhbHVlICYmIG1vdmVSZXZlcnNlKHNpemUpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVzaXplKGUpIHtcbiAgICAgIGxldCBzaXplXG5cbiAgICAgIGlmIChpc05lZWRSZXZlcnNlLnZhbHVlKSB7XG4gICAgICAgIHNpemUgPSBjdXJyZW50U2l6ZS52YWx1ZSAtIChlW2RpcmVjdGlvbi52YWx1ZV0gLSBvZmZzZXQudmFsdWUpICtcbiAgICAgICAgICBkYXRhLnN0YXJ0T2Zmc2V0IVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2l6ZSA9IGN1cnJlbnRTaXplLnZhbHVlICsgKGVbZGlyZWN0aW9uLnZhbHVlXSAtIGN1cnJlbnRTaXplLnZhbHVlIC1cbiAgICAgICAgICBvZmZzZXQudmFsdWUgLSBkYXRhLnN0YXJ0T2Zmc2V0ISlcbiAgICAgIH1cblxuICAgICAgc2l6ZSA+IHByb3BzLm1pblNpemUgJiYgc2V0T3JFbWl0U2l6ZShzaXplKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlc2V0TWluTWF4U3R5bGVzKCkge1xuICAgICAgaWYgKGlzRGlyZWN0WS52YWx1ZSkge1xuICAgICAgICBkYXRhLnBhcmVudE5vZGUhLnN0eWxlLm1heEhlaWdodCA9ICcnXG4gICAgICAgIGRhdGEucGFyZW50Tm9kZSEuc3R5bGUubWluSGVpZ2h0ID0gJydcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRhdGEucGFyZW50Tm9kZSEuc3R5bGUubWF4V2lkdGggPSAnJ1xuICAgICAgICBkYXRhLnBhcmVudE5vZGUhLnN0eWxlLm1pbldpZHRoID0gJydcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRQYXJlbnQoKSB7XG4gICAgICBjb25zdCBwYXJlbnQgPSByZXNSZWYudmFsdWUhLnBhcmVudE5vZGVcbiAgICAgIGRhdGEucGFyZW50Tm9kZSA9IHBhcmVudCBhcyBIVE1MRWxlbWVudFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNvbXB1dGVTaXplcygpIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgdG9wLFxuICAgICAgICBsZWZ0LFxuICAgICAgICBoZWlnaHQsXG4gICAgICAgIHdpZHRoLFxuICAgICAgICBtYXJnaW5MZWZ0LFxuICAgICAgICBtYXJnaW5Ub3AsXG4gICAgICB9ID0gZ2V0Q29tcHV0ZWRTdHlsZShkYXRhLnBhcmVudE5vZGUhKVxuXG4gICAgICBkYXRhLm9mZnNldFRvcCA9IGRhdGEucGFyZW50Tm9kZSEub2Zmc2V0VG9wXG4gICAgICBkYXRhLm9mZnNldExlZnQgPSBkYXRhLnBhcmVudE5vZGUhLm9mZnNldExlZnRcbiAgICAgIGRhdGEubWFyZ2luTGVmdCA9IHBhcnNlRmxvYXQobWFyZ2luTGVmdClcbiAgICAgIGRhdGEubWFyZ2luVG9wID0gcGFyc2VGbG9hdChtYXJnaW5Ub3ApXG4gICAgICBkYXRhLnBhcmVudEhlaWdodCA9IHBhcnNlRmxvYXQoaGVpZ2h0KVxuICAgICAgZGF0YS5wYXJlbnRXaWR0aCA9IHBhcnNlRmxvYXQod2lkdGgpXG4gICAgICBkYXRhLnRvcCA9IHBhcnNlRmxvYXQodG9wKVxuICAgICAgZGF0YS5sZWZ0ID0gcGFyc2VGbG9hdChsZWZ0KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldFN0YXJ0UG9zaXRpb25zKCkge1xuICAgICAgY29uc3Qgc2lkZSA9IHJldmVyc2VEaXJlY3Rpb24udmFsdWVcbiAgICAgIGNvbnN0IG9mZnNldCA9IHJldmVyc2VPZmZzZXRLZXkudmFsdWVcblxuICAgICAgaWYgKGRhdGFbc2lkZV0gPT09IGRhdGFbb2Zmc2V0XSkge1xuICAgICAgICBkYXRhLnBhcmVudE5vZGUhLnN0eWxlW3NpZGVdID0gYCR7IGRhdGFbb2Zmc2V0XSB9cHhgXG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGlzYWJsZVNlbGVjdGlvbihlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0UmVzaXplKGUpIHtcbiAgICAgIGlmICghZGF0YS5pc0FjdGl2ZSkge1xuICAgICAgICBkYXRhLmlzQWN0aXZlID0gdHJ1ZVxuICAgICAgICBjb21wdXRlU2l6ZXMoKVxuICAgICAgICByZXNldE1pbk1heFN0eWxlcygpXG4gICAgICAgIHNldFN0YXJ0UG9zaXRpb25zKClcbiAgICAgICAgc2V0U3RhcnRPZmZzZXQoZSlcbiAgICAgIH1cblxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHJlc2l6ZShlKSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRTdGFydE9mZnNldChlKSB7XG4gICAgICBpZiAoaXNOZWVkUmV2ZXJzZS52YWx1ZSkgZGF0YS5zdGFydE9mZnNldCA9IGVbZGlyZWN0aW9uLnZhbHVlXVxuICAgICAgZWxzZSBkYXRhLnN0YXJ0T2Zmc2V0ID0gZVtkaXJlY3Rpb24udmFsdWVdIC0gY3VycmVudFNpemUudmFsdWVcblxuICAgICAgZGF0YS5zdGFydE9mZnNldCEgLT0gb2Zmc2V0LnZhbHVlXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICBkYXRhLmlzQWN0aXZlID0gZmFsc2VcbiAgICAgIHJlc2V0TWluTWF4U3R5bGVzKClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbk1vdXNldXAoKSB7XG4gICAgICByZXNldCgpXG4gICAgICByZW1vdmVIYW5kbGVycygpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gb25Nb3VzZWRvd24oKSB7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBpbml0UmVzaXplKVxuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIG9uTW91c2V1cClcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3NlbGVjdHN0YXJ0JywgZGlzYWJsZVNlbGVjdGlvbilcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZW1vdmVIYW5kbGVycygpIHtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGluaXRSZXNpemUpXG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgb25Nb3VzZXVwKVxuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2VsZWN0c3RhcnQnLCBkaXNhYmxlU2VsZWN0aW9uKVxuICAgIH1cblxuICAgIG9uTW91bnRlZCgoKSA9PiB7XG4gICAgICBzZXRQYXJlbnQoKVxuICAgIH0pXG5cbiAgICBvbkJlZm9yZVVubW91bnQoKCkgPT4ge1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgb25Nb3VzZWRvd24pXG4gICAgfSlcblxuICAgIHJldHVybiAoKSA9PlxuICAgICAgaCgnZGl2Jywge1xuICAgICAgICBjbGFzczoge1xuICAgICAgICAgIC4uLmNsYXNzZXMudmFsdWUsXG4gICAgICAgIH0sXG4gICAgICAgIGtleTogJ3Jlc2l6ZScsXG4gICAgICAgIHJlZjogcmVzUmVmLFxuICAgICAgICBvbk1vdXNlZG93bixcbiAgICAgIH0pXG4gIH0sXG59KVxuIl19