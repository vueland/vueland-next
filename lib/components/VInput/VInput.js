import { defineComponent, h, watch, inject, computed, onBeforeMount, onBeforeUnmount, } from 'vue';
import { validationProps } from '../../composables/use-validation';
import { useColors, colorProps } from '../../composables/use-colors';
import { useInputStates } from '../../composables/use-input-states';
import { useTransition } from '../../composables/use-transition';
import { VLabel } from '../VLabel';
import { VIcon } from '../VIcon';
export default defineComponent({
    name: 'v-input',
    components: {
        VLabel,
        VIcon,
    },
    inheritAttrs: false,
    props: {
        label: {
            type: String,
            default: '',
        },
        prependIcon: {
            type: String,
            default: '',
        },
        appendIcon: {
            type: String,
            default: '',
        },
        disabled: Boolean,
        focused: Boolean,
        readonly: Boolean,
        file: Boolean,
        hints: {
            type: Boolean,
            default: true,
        },
        hintMessage: {
            type: String,
            default: '',
        },
        textColor: {
            type: String,
            default: '',
        },
        ...validationProps(),
        ...colorProps(),
    },
    setup(props, { attrs, emit, slots, expose }) {
        const { setTextCssColor, setTextClassNameColor } = useColors();
        const { inputState, errorState, isDisabled, isReadonly, stateClasses, validate, onFocus, onBlur } = useInputStates(props, { attrs, emit });
        const form = inject('$v_form', null);
        const textClassColor = setTextClassNameColor(props.textColor);
        const textCssColor = setTextCssColor(props.textColor);
        const hasPrependIcon = computed(() => {
            return !!props.prependIcon || !!slots['prepend-icon'];
        });
        const hasAppendIcon = computed(() => {
            return !!props.appendIcon || !!slots['append-icon'];
        });
        const classes = computed(() => ({
            'v-input': true,
            'v-input--focused': inputState.focused && !isReadonly.value,
            'v-input--disabled': isDisabled.value,
            'v-input--readonly': isReadonly.value,
            'v-input--file': props.file,
            'v-input--has-prepend-icon': hasPrependIcon.value,
            'v-input--has-append-icon': hasAppendIcon.value,
            'v-input--not-valid': !!errorState.innerError,
            ...stateClasses.value,
            ...(!props.disabled && !errorState.innerError ? setTextClassNameColor(props.color) : {}),
            ...attrs.class,
        }));
        const styles = computed(() => ({
            ...(!props.disabled && !errorState.innerError ? setTextCssColor(props.color) : {}),
            ...attrs.style,
        }));
        watch(() => props.value, (to) => inputState.value = to);
        const genLabel = () => {
            const label = h(VLabel, {
                class: 'v-label--on-input',
                disabled: isDisabled.value,
                focused: inputState.focused,
                color: !errorState.innerError ? props.color : '',
            }, {
                default: () => props.label,
            });
            return h('div', { class: 'v-input__label' }, [label]);
        };
        const genIcon = (iconName, clickable = false) => {
            return h(VIcon, {
                icon: iconName,
                size: 16,
                disabled: props.disabled,
                clickable,
            });
        };
        const genPrependIcon = () => {
            let content;
            if (props.prependIcon) {
                content = genIcon(props.prependIcon);
            }
            else {
                content = slots['prepend-icon']?.();
            }
            return content ?
                h('div', { class: 'v-input__prepend-icon' }, content)
                : null;
        };
        const genAppendIcon = () => {
            let content;
            if (props.appendIcon) {
                content = genIcon(props.appendIcon);
            }
            else {
                content = slots['append-icon']?.();
            }
            return content ?
                h('div', { class: 'v-input__append-icon' }, content)
                : null;
        };
        const genTextFieldSlot = () => {
            const prependIconContent = genPrependIcon();
            const appendIconContent = genAppendIcon();
            const { disabled } = props;
            const textFieldContent = slots['text-field']?.({
                textCssColor,
                textClassColor,
                disabled,
            });
            return h('div', { class: 'v-input__text-field' }, [prependIconContent, textFieldContent, appendIconContent]);
        };
        const genHintMessage = () => {
            return !!errorState.innerErrorMessage ? h('span', { class: 'v-input__hints-message' }, [errorState.innerErrorMessage]) : null;
        };
        const genHints = () => {
            return h('div', { class: 'v-input__hints' }, useTransition(genHintMessage(), 'fade'));
        };
        const genSelectSlot = () => {
            return slots.select ?
                h('div', { class: 'v-input__selects' }, slots.select?.())
                : null;
        };
        onBeforeMount(() => {
            if (props.rules)
                form?.add(validate);
        });
        onBeforeUnmount(() => {
            form?.remove(validate);
        });
        expose({
            onFocus,
            onBlur,
        });
        return () => h('div', { class: classes.value, style: styles.value }, [
            genLabel(),
            genTextFieldSlot(),
            genHints(),
            genSelectSlot(),
        ]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVklucHV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvdnVlbGFuZC9zcmMvY29tcG9uZW50cy9WSW5wdXQvVklucHV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFDTCxlQUFlLEVBQ2YsQ0FBQyxFQUNELEtBQUssRUFDTCxNQUFNLEVBQ04sUUFBUSxFQUNSLGFBQWEsRUFDYixlQUFlLEdBRWhCLE1BQU0sS0FBSyxDQUFBO0FBR1osT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGtDQUFrQyxDQUFBO0FBQ2xFLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sOEJBQThCLENBQUE7QUFDcEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9DQUFvQyxDQUFBO0FBQ25FLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQTtBQUdoRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBQ2xDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFPaEMsZUFBZSxlQUFlLENBQUM7SUFDN0IsSUFBSSxFQUFFLFNBQVM7SUFDZixVQUFVLEVBQUU7UUFDVixNQUFNO1FBQ04sS0FBSztLQUNOO0lBQ0QsWUFBWSxFQUFFLEtBQUs7SUFDbkIsS0FBSyxFQUFFO1FBQ0wsS0FBSyxFQUFFO1lBQ0wsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsRUFBRTtTQUNaO1FBQ0QsV0FBVyxFQUFFO1lBQ1gsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsRUFBRTtTQUNaO1FBQ0QsVUFBVSxFQUFFO1lBQ1YsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsRUFBRTtTQUNaO1FBQ0QsUUFBUSxFQUFFLE9BQU87UUFDakIsT0FBTyxFQUFFLE9BQU87UUFDaEIsUUFBUSxFQUFFLE9BQU87UUFDakIsSUFBSSxFQUFFLE9BQU87UUFD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RTtZQUNWLGFBQWEsRUFBRTtTQUNoQixDQUNGLENBQUE7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVnVlIEFQSVxuaW1wb3J0IHtcbiAgZGVmaW5lQ29tcG9uZW50LFxuICBoLFxuICB3YXRjaCxcbiAgaW5qZWN0LFxuICBjb21wdXRlZCxcbiAgb25CZWZvcmVNb3VudCxcbiAgb25CZWZvcmVVbm1vdW50LFxuICBWTm9kZSxcbn0gZnJvbSAndnVlJ1xuXG4vLyBDb21wb3NhYmxlXG5pbXBvcnQgeyB2YWxpZGF0aW9uUHJvcHMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlcy91c2UtdmFsaWRhdGlvbidcbmltcG9ydCB7IHVzZUNvbG9ycywgY29sb3JQcm9wcyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGVzL3VzZS1jb2xvcnMnXG5pbXBvcnQgeyB1c2VJbnB1dFN0YXRlcyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGVzL3VzZS1pbnB1dC1zdGF0ZXMnXG5pbXBvcnQgeyB1c2VUcmFuc2l0aW9uIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZXMvdXNlLXRyYW5zaXRpb24nXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCB7IFZMYWJlbCB9IGZyb20gJy4uL1ZMYWJlbCdcbmltcG9ydCB7IFZJY29uIH0gZnJvbSAnLi4vVkljb24nXG5cbnR5cGUgRm9ybSA9IHtcbiAgYWRkOiAoaXRlbTogKHZhbD86IGFueSkgPT4gYm9vbGVhbiB8IHZvaWQpID0+IHZvaWRcbiAgcmVtb3ZlOiAoaXRlbTogKHZhbD86IGFueSkgPT4gYm9vbGVhbiB8IHZvaWQpID0+IHZvaWRcbn1cblxuZXhwb3J0IGRlZmF1bHQgZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3YtaW5wdXQnLFxuICBjb21wb25lbnRzOiB7XG4gICAgVkxhYmVsLFxuICAgIFZJY29uLFxuICB9LFxuICBpbmhlcml0QXR0cnM6IGZhbHNlLFxuICBwcm9wczoge1xuICAgIGxhYmVsOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJyxcbiAgICB9LFxuICAgIHByZXBlbmRJY29uOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJyxcbiAgICB9LFxuICAgIGFwcGVuZEljb246IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcnLFxuICAgIH0sXG4gICAgZGlzYWJsZWQ6IEJvb2xlYW4sXG4gICAgZm9jdXNlZDogQm9vbGVhbixcbiAgICByZWFkb25seTogQm9vbGVhbixcbiAgICBmaWxlOiBCb29sZWFuLFxuICAgIGhpbnRzOiB7XG4gICAgICB0eXBlOiBCb29sZWFuLFxuICAgICAgZGVmYXVsdDogdHJ1ZSxcbiAgICB9LFxuICAgIGhpbnRNZXNzYWdlOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJyxcbiAgICB9LFxuICAgIHRleHRDb2xvcjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJycsXG4gICAgfSxcbiAgICAuLi52YWxpZGF0aW9uUHJvcHMoKSxcbiAgICAuLi5jb2xvclByb3BzKCksXG4gIH0sXG5cbiAgc2V0dXAocHJvcHMsIHsgYXR0cnMsIGVtaXQsIHNsb3RzLCBleHBvc2UgfSkge1xuICAgIGNvbnN0IHsgc2V0VGV4dENzc0NvbG9yLCBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IgfSA9IHVzZUNvbG9ycygpXG4gICAgY29uc3Qge1xuICAgICAgaW5wdXRTdGF0ZSxcbiAgICAgIGVycm9yU3RhdGUsXG4gICAgICBpc0Rpc2FibGVkLFxuICAgICAgaXNSZWFkb25seSxcbiAgICAgIHN0YXRlQ2xhc3NlcyxcbiAgICAgIHZhbGlkYXRlLFxuICAgICAgb25Gb2N1cyxcbiAgICAgIG9uQmx1clxuICAgIH0gPSB1c2VJbnB1dFN0YXRlcyhwcm9wcywgeyBhdHRycywgZW1pdCB9KVxuXG4gICAgY29uc3QgZm9ybTogTWF5YmU8Rm9ybT4gPSBpbmplY3QoJyR2X2Zvcm0nLCBudWxsIGFzIGFueSlcblxuICAgIGNvbnN0IHRleHRDbGFzc0NvbG9yID0gc2V0VGV4dENsYXNzTmFtZUNvbG9yKHByb3BzLnRleHRDb2xvcilcbiAgICBjb25zdCB0ZXh0Q3NzQ29sb3IgPSBzZXRUZXh0Q3NzQ29sb3IocHJvcHMudGV4dENvbG9yKVxuXG4gICAgY29uc3QgaGFzUHJlcGVuZEljb24gPSBjb21wdXRlZDxib29sZWFuPigoKSA9PiB7XG4gICAgICByZXR1cm4gISFwcm9wcy5wcmVwZW5kSWNvbiB8fCAhIXNsb3RzWydwcmVwZW5kLWljb24nXVxuICAgIH0pXG5cbiAgICBjb25zdCBoYXNBcHBlbmRJY29uID0gY29tcHV0ZWQ8Ym9vbGVhbj4oKCkgPT4ge1xuICAgICAgcmV0dXJuICEhcHJvcHMuYXBwZW5kSWNvbiB8fCAhIXNsb3RzWydhcHBlbmQtaWNvbiddXG4gICAgfSlcblxuICAgIGNvbnN0IGNsYXNzZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBib29sZWFuPj4oKCkgPT4gKHtcbiAgICAgICd2LWlucHV0JzogdHJ1ZSxcbiAgICAgICd2LWlucHV0LS1mb2N1c2VkJzogaW5wdXRTdGF0ZS5mb2N1c2VkICYmICFpc1JlYWRvbmx5LnZhbHVlLFxuICAgICAgJ3YtaW5wdXQtLWRpc2FibGVkJzogaXNEaXNhYmxlZC52YWx1ZSxcbiAgICAgICd2LWlucHV0LS1yZWFkb25seSc6IGlzUmVhZG9ubHkudmFsdWUsXG4gICAgICAndi1pbnB1dC0tZmlsZSc6IHByb3BzLmZpbGUsXG4gICAgICAndi1pbnB1dC0taGFzLXByZXBlbmQtaWNvbic6IGhhc1ByZXBlbmRJY29uLnZhbHVlLFxuICAgICAgJ3YtaW5wdXQtLWhhcy1hcHBlbmQtaWNvbic6IGhhc0FwcGVuZEljb24udmFsdWUsXG4gICAgICAndi1pbnB1dC0tbm90LXZhbGlkJzogISFlcnJvclN0YXRlLmlubmVyRXJyb3IsXG4gICAgICAuLi5zdGF0ZUNsYXNzZXMudmFsdWUsXG4gICAgICAuLi4oIXByb3BzLmRpc2FibGVkICYmICFlcnJvclN0YXRlLmlubmVyRXJyb3IgPyBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgICAgLi4uKGF0dHJzLmNsYXNzIGFzIG9iamVjdCksXG4gICAgfSkpXG5cbiAgICBjb25zdCBzdHlsZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+PigoKSA9PiAoe1xuICAgICAgLi4uKCFwcm9wcy5kaXNhYmxlZCAmJiAhZXJyb3JTdGF0ZS5pbm5lckVycm9yID8gc2V0VGV4dENzc0NvbG9yKHByb3BzLmNvbG9yKSA6IHt9KSxcbiAgICAgIC4uLihhdHRycy5zdHlsZSBhcyBvYmplY3QpLFxuICAgIH0pKVxuXG4gICAgd2F0Y2goXG4gICAgICAoKSA9PiBwcm9wcy52YWx1ZSxcbiAgICAgICh0bykgPT4gaW5wdXRTdGF0ZS52YWx1ZSA9IHRvIGFzIHN0cmluZyxcbiAgICApXG5cbiAgICBjb25zdCBnZW5MYWJlbCA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBsYWJlbCA9IGgoVkxhYmVsLCB7XG4gICAgICAgICAgY2xhc3M6ICd2LWxhYmVsLS1vbi1pbnB1dCcsXG4gICAgICAgICAgZGlzYWJsZWQ6IGlzRGlzYWJsZWQudmFsdWUsXG4gICAgICAgICAgZm9jdXNlZDogaW5wdXRTdGF0ZS5mb2N1c2VkLFxuICAgICAgICAgIGNvbG9yOiAhZXJyb3JTdGF0ZS5pbm5lckVycm9yID8gcHJvcHMuY29sb3IgOiAnJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRlZmF1bHQ6ICgpID0+IHByb3BzLmxhYmVsLFxuICAgICAgICB9LFxuICAgICAgKVxuXG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogJ3YtaW5wdXRfX2xhYmVsJyB9LCBbbGFiZWxdKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkljb24gPSAoaWNvbk5hbWUsIGNsaWNrYWJsZSA9IGZhbHNlKTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoVkljb24sIHtcbiAgICAgICAgaWNvbjogaWNvbk5hbWUsXG4gICAgICAgIHNpemU6IDE2LFxuICAgICAgICBkaXNhYmxlZDogcHJvcHMuZGlzYWJsZWQsXG4gICAgICAgIGNsaWNrYWJsZSxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUHJlcGVuZEljb24gPSAoKTogTWF5YmU8Vk5vZGU+ID0+IHtcbiAgICAgIGxldCBjb250ZW50XG5cbiAgICAgIGlmIChwcm9wcy5wcmVwZW5kSWNvbikge1xuICAgICAgICBjb250ZW50ID0gZ2VuSWNvbihwcm9wcy5wcmVwZW5kSWNvbilcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnRlbnQgPSBzbG90c1sncHJlcGVuZC1pY29uJ10/LigpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjb250ZW50ID9cbiAgICAgICAgaCgnZGl2JywgeyBjbGFzczogJ3YtaW5wdXRfX3ByZXBlbmQtaWNvbicgfSwgY29udGVudClcbiAgICAgICAgOiBudWxsXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuQXBwZW5kSWNvbiA9ICgpOiBNYXliZTxWTm9kZT4gPT4ge1xuICAgICAgbGV0IGNvbnRlbnRcblxuICAgICAgaWYgKHByb3BzLmFwcGVuZEljb24pIHtcbiAgICAgICAgY29udGVudCA9IGdlbkljb24ocHJvcHMuYXBwZW5kSWNvbilcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnRlbnQgPSBzbG90c1snYXBwZW5kLWljb24nXT8uKClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNvbnRlbnQgP1xuICAgICAgICBoKCdkaXYnLCB7IGNsYXNzOiAndi1pbnB1dF9fYXBwZW5kLWljb24nIH0sIGNvbnRlbnQpXG4gICAgICAgIDogbnVsbFxuICAgIH1cblxuICAgIGNvbnN0IGdlblRleHRGaWVsZFNsb3QgPSAoKSA9PiB7XG4gICAgICBjb25zdCBwcmVwZW5kSWNvbkNvbnRlbnQgPSBnZW5QcmVwZW5kSWNvbigpXG4gICAgICBjb25zdCBhcHBlbmRJY29uQ29udGVudCA9IGdlbkFwcGVuZEljb24oKVxuICAgICAgY29uc3QgeyBkaXNhYmxlZCB9ID0gcHJvcHNcblxuICAgICAgY29uc3QgdGV4dEZpZWxkQ29udGVudCA9IHNsb3RzWyd0ZXh0LWZpZWxkJ10/Lih7XG4gICAgICAgIHRleHRDc3NDb2xvcixcbiAgICAgICAgdGV4dENsYXNzQ29sb3IsXG4gICAgICAgIGRpc2FibGVkLFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWlucHV0X190ZXh0LWZpZWxkJyB9LFxuICAgICAgICBbcHJlcGVuZEljb25Db250ZW50LCB0ZXh0RmllbGRDb250ZW50LCBhcHBlbmRJY29uQ29udGVudF0sXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuSGludE1lc3NhZ2UgPSAoKTogTWF5YmU8Vk5vZGU+ID0+IHtcbiAgICAgIHJldHVybiAhIWVycm9yU3RhdGUuaW5uZXJFcnJvck1lc3NhZ2UgPyBoKFxuICAgICAgICAnc3BhbicsXG4gICAgICAgIHsgY2xhc3M6ICd2LWlucHV0X19oaW50cy1tZXNzYWdlJyB9LFxuICAgICAgICBbZXJyb3JTdGF0ZS5pbm5lckVycm9yTWVzc2FnZV0sXG4gICAgICApIDogbnVsbFxuICAgIH1cblxuICAgIGNvbnN0IGdlbkhpbnRzID0gKCk6IE1heWJlPFZOb2RlPiA9PiB7XG4gICAgICByZXR1cm4gaChcbiAgICAgICAgJ2RpdicsXG4gICAgICAgIHsgY2xhc3M6ICd2LWlucHV0X19oaW50cycgfSxcbiAgICAgICAgdXNlVHJhbnNpdGlvbihnZW5IaW50TWVzc2FnZSgpISwgJ2ZhZGUnKSxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5TZWxlY3RTbG90ID0gKCk6IE1heWJlPFZOb2RlPiA9PiB7XG4gICAgICByZXR1cm4gc2xvdHMuc2VsZWN0ID9cbiAgICAgICAgaCgnZGl2JywgeyBjbGFzczogJ3YtaW5wdXRfX3NlbGVjdHMnIH0sIHNsb3RzLnNlbGVjdD8uKCkpXG4gICAgICAgIDogbnVsbFxuICAgIH1cblxuICAgIG9uQmVmb3JlTW91bnQoKCkgPT4ge1xuICAgICAgaWYgKHByb3BzLnJ1bGVzKSBmb3JtPy5hZGQodmFsaWRhdGUpXG4gICAgfSlcblxuICAgIG9uQmVmb3JlVW5tb3VudCgoKSA9PiB7XG4gICAgICBmb3JtPy5yZW1vdmUodmFsaWRhdGUpXG4gICAgfSlcblxuICAgIGV4cG9zZSh7XG4gICAgICBvbkZvY3VzLFxuICAgICAgb25CbHVyLFxuICAgIH0pXG5cbiAgICByZXR1cm4gKCkgPT4gaCgnZGl2JywgeyBjbGFzczogY2xhc3Nlcy52YWx1ZSwgc3R5bGU6IHN0eWxlcy52YWx1ZSB9LFxuICAgICAgW1xuICAgICAgICBnZW5MYWJlbCgpLFxuICAgICAgICBnZW5UZXh0RmllbGRTbG90KCksXG4gICAgICAgIGdlbkhpbnRzKCksXG4gICAgICAgIGdlblNlbGVjdFNsb3QoKSxcbiAgICAgIF0sXG4gICAgKVxuICB9LFxufSlcbiJdfQ==