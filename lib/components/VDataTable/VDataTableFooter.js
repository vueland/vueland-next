import { watch, computed, defineComponent, h, ref } from 'vue';
import { VIcon } from '../VIcon';
import { VButton } from '../VButton';
import { VMenu } from '../VMenu';
import { useColors } from '../../composables/use-colors';
import { useIcons } from '../../composables/use-icons';
export const VDataTableFooter = defineComponent({
    name: 'v-data-table-footer',
    props: {
        pages: Number,
        page: Number,
        firstOnPage: Number,
        lastOnPage: Number,
        pageCorrection: Number,
        rowsLength: Number,
        rowsOnPage: Number,
        options: Object,
    },
    emits: [
        'last-page',
        'correct-page',
        'select-rows-count',
        'next-page',
        'prev-page',
    ],
    setup(props, { emit, slots }) {
        const { setBackgroundCssColor, setBackgroundClassNameColor, setTextClassNameColor, setTextCssColor, } = useColors();
        const { icons } = useIcons();
        const activator = ref(null);
        const paginationDisplayText = computed(() => {
            return `${props.firstOnPage} - ${props.lastOnPage}
        of ${props.rowsLength}`;
        });
        const isLastPage = computed(() => {
            return props.page >= props.pages;
        });
        watch(() => isLastPage.value, (to) => to && emit('last-page'));
        function changeTableRowsPage(isNext) {
            if (props.page === props.pages && isNext)
                return;
            const event = isNext ? 'next-page' : 'prev-page';
            emit(event, isNext ? 1 : -1);
        }
        function genPaginationButton(isNext = false) {
            const btnColor = props.options?.pagination?.buttonsColor || 'primary';
            const contentColor = props.options.contentColor || 'white';
            const disableIf = (isNext && props.lastOnPage >= props.rowsLength) ||
                (!isNext && props.firstOnPage === 1);
            const propsData = {
                width: 42,
                color: btnColor,
                elevation: 3,
                disabled: disableIf,
                text: disableIf,
                onClick: () => changeTableRowsPage(isNext),
            };
            return h(VButton, propsData, {
                default: () => h(VIcon, {
                    icon: isNext ? icons.$arrowRight : icons.$arrowLeft,
                    color: disableIf ? 'grey lighten-1' : contentColor,
                }),
            });
        }
        function genPaginationPageDisplay() {
            const displayColor = props.options?.pagination?.displayColor || 'primary';
            const propsData = {
                width: 42,
                style: { margin: '0 10px' },
                color: displayColor,
                elevation: 3,
            };
            return h(VButton, propsData, { default: () => props.page });
        }
        const genRowsCountSelectList = () => {
            const options = props.options.counts?.rowsPerPageOptions || [5, 10, 15, 20];
            const color = props.options?.counts?.displayColor || 'primary';
            const contentColor = props.options.contentColor || 'white';
            return h('div', {
                class: {
                    'v-data-table__rows-count-list': true,
                    ...(color ? setBackgroundClassNameColor(color) : {}),
                    ...(contentColor ? setTextClassNameColor(contentColor) : {}),
                },
                style: {
                    ...(color ? setBackgroundCssColor(color) : {}),
                    ...(contentColor ? setTextCssColor(contentColor) : {}),
                },
            }, options.map((it) => h('div', {
                class: 'v-data-table__rows-count-item',
                onClick: () => emit('select-rows-count', it),
            }, [it])));
        };
        const genMenu = () => {
            return h(VMenu, {
                activator: activator.value,
                maxHeight: 240,
                zIndex: 12,
                openOnClick: true,
            }, {
                default: () => genRowsCountSelectList(),
            });
        };
        const genRowsCountField = () => {
            return h('div', {
                class: 'v-data-table__rows-count-value',
                textColor: props.options.contentColor,
            }, props.rowsOnPage);
        };
        const genRowsCountSelect = () => {
            const displayColor = props.options?.counts?.displayColor || 'primary';
            return h(VButton, {
                color: displayColor,
                ref: activator,
            }, {
                default: () => [
                    genRowsCountField(),
                    activator.value && genMenu(),
                ],
            });
        };
        const genRowsCountSelectCaption = () => {
            const color = props.options.contentColor;
            const propsData = {
                class: {
                    'v-data-table__pagination-label': true,
                    ...(color ? setTextClassNameColor(color) : {}),
                },
                style: {
                    ...(color ? setTextCssColor(color) : {}),
                },
            };
            return h('span', propsData, props.options?.counts?.rowsPerPageText || 'Rows per page');
        };
        const genRowsCountSelectBlock = () => {
            return h('div', { class: 'v-data-table__pagination-select' }, [
                genRowsCountSelectCaption(),
                genRowsCountSelect(),
            ]);
        };
        const genPagesCountDisplay = () => {
            const color = props.options.contentColor;
            const propsData = {
                class: {
                    'v-data-table__pagination-pages': true,
                    ...(color ? setTextClassNameColor(color) : {}),
                },
                style: {
                    ...(color ? setTextCssColor(color) : {}),
                },
            };
            props.pageCorrection && emit('correct-page', -props.pageCorrection);
            return h('div', propsData, (props.rowsLength && slots['pagination-text']?.()) ||
                (props.rowsLength && paginationDisplayText.value) ||
                '-');
        };
        const genPaginationButtonsBlock = () => {
            return h('div', { class: { 'v-data-table__pagination-route': true } }, [
                genPaginationButton(),
                genPaginationPageDisplay(),
                genPaginationButton(true),
            ]);
        };
        const genPaginationBlock = () => {
            return h('div', { class: 'v-data-table__pagination' }, [
                genRowsCountSelectBlock(),
                genPagesCountDisplay(),
                genPaginationButtonsBlock(),
            ]);
        };
        return () => {
            const propsData = {
                class: {
                    'v-data-table__footer': true,
                    ...(props.options.color
                        ? setBackgroundClassNameColor(props.options.color)
                        : {}),
                },
                style: {
                    ...(props.options.color
                        ? setBackgroundCssColor(props.options.color)
                        : {}),
                },
            };
            return h('div', propsData, genPaginationBlock());
        };
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGFUYWJsZUZvb3Rlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL3Z1ZWxhbmQvc3JjL2NvbXBvbmVudHMvVkRhdGFUYWJsZS9WRGF0YVRhYmxlRm9vdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLGVBQWUsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFZLE1BQU0sS0FBSyxDQUFBO0FBR3hFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDaEMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFlBQVksQ0FBQTtBQUNwQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBR2hDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQTtBQUV4RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sNkJBQTZCLENBQUE7QUFLdEQsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUcsZUFBZSxDQUFDO0lBQzlDLElBQUksRUFBRSxxQkFBcUI7SUFDM0IsS0FBSyxFQUFFO1FBQ0wsS0FBSyxFQUFFLE1BQU07UUFDYixJQUFJLEVBQUUsTUFBTTtRQUNaLFdBQVcsRUFBRSxNQUFNO1FBQ25CLFVBQVUsRUFBRSxNQUFNO1FBQ2xCLGNBQWMsRUFBRSxNQUFNO1FBQ3RCLFVBQVUsRUFBRSxNQUFNO1FBQ2xCLFVBQVUsRUFBRSxNQUFNO1FBQ2xCLE9BQU8sRUFBRSxNQUEyQztLQUM5QztJQUVSLEtBQUssRUFBRTtRQUNMLFdBQVc7UUFDWCxjQUFjO1FBQ2QsbUJBQW1CO1FBQ25CLFdBQVc7UUFDWCxXQUFXO0tBQ1o7SUFFRCxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRTtRQUMxQixNQUFNLEVBQ0oscUJBQXFCLEVBQ3JCLDJCQUEyQixFQUMzQixxQkFBcUIsRUFDckIsZUFB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O29CQUNMLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUs7d0JBQ3JCLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQzt3QkFDNUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztpQkFDUjthQUNGLENBQUE7WUFFRCxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLGtCQUFrQixFQUFFLENBQUMsQ0FBQTtRQUNsRCxDQUFDLENBQUE7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVnVlIEFQSVxuaW1wb3J0IHsgd2F0Y2gsIGNvbXB1dGVkLCBkZWZpbmVDb21wb25lbnQsIGgsIHJlZiwgUHJvcFR5cGUgfSBmcm9tICd2dWUnXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCB7IFZJY29uIH0gZnJvbSAnLi4vVkljb24nXG5pbXBvcnQgeyBWQnV0dG9uIH0gZnJvbSAnLi4vVkJ1dHRvbidcbmltcG9ydCB7IFZNZW51IH0gZnJvbSAnLi4vVk1lbnUnXG5cbi8vIEVmZmVjdHNcbmltcG9ydCB7IHVzZUNvbG9ycyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGVzL3VzZS1jb2xvcnMnXG5cbmltcG9ydCB7IHVzZUljb25zIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZXMvdXNlLWljb25zJ1xuLy8gVHlwZXNcbmltcG9ydCB7IFZOb2RlIH0gZnJvbSAndnVlJ1xuaW1wb3J0IHsgSURhdGFUYWJsZUZvb3Rlck9wdGlvbnMgfSBmcm9tICcuL3R5cGVzJ1xuXG5leHBvcnQgY29uc3QgVkRhdGFUYWJsZUZvb3RlciA9IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LWRhdGEtdGFibGUtZm9vdGVyJyxcbiAgcHJvcHM6IHtcbiAgICBwYWdlczogTnVtYmVyLFxuICAgIHBhZ2U6IE51bWJlcixcbiAgICBmaXJzdE9uUGFnZTogTnVtYmVyLFxuICAgIGxhc3RPblBhZ2U6IE51bWJlcixcbiAgICBwYWdlQ29ycmVjdGlvbjogTnVtYmVyLFxuICAgIHJvd3NMZW5ndGg6IE51bWJlcixcbiAgICByb3dzT25QYWdlOiBOdW1iZXIsXG4gICAgb3B0aW9uczogT2JqZWN0IGFzIFByb3BUeXBlPElEYXRhVGFibGVGb290ZXJPcHRpb25zPixcbiAgfSBhcyBhbnksXG5cbiAgZW1pdHM6IFtcbiAgICAnbGFzdC1wYWdlJyxcbiAgICAnY29ycmVjdC1wYWdlJyxcbiAgICAnc2VsZWN0LXJvd3MtY291bnQnLFxuICAgICduZXh0LXBhZ2UnLFxuICAgICdwcmV2LXBhZ2UnLFxuICBdLFxuXG4gIHNldHVwKHByb3BzLCB7IGVtaXQsIHNsb3RzIH0pOiAoKSA9PiBWTm9kZSB7XG4gICAgY29uc3Qge1xuICAgICAgc2V0QmFja2dyb3VuZENzc0NvbG9yLFxuICAgICAgc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yLFxuICAgICAgc2V0VGV4dENsYXNzTmFtZUNvbG9yLFxuICAgICAgc2V0VGV4dENzc0NvbG9yLFxuICAgIH0gPSB1c2VDb2xvcnMoKVxuICAgIGNvbnN0IHsgaWNvbnMgfSA9IHVzZUljb25zKClcblxuICAgIGNvbnN0IGFjdGl2YXRvciA9IHJlZjxNYXliZTxIVE1MRWxlbWVudD4+KG51bGwpXG5cbiAgICBjb25zdCBwYWdpbmF0aW9uRGlzcGxheVRleHQgPSBjb21wdXRlZDxzdHJpbmc+KCgpID0+IHtcbiAgICAgIHJldHVybiBgJHsgcHJvcHMuZmlyc3RPblBhZ2UgfSAtICR7IHByb3BzLmxhc3RPblBhZ2UgfVxuICAgICAgICBvZiAkeyBwcm9wcy5yb3dzTGVuZ3RoIH1gXG4gICAgfSlcblxuICAgIGNvbnN0IGlzTGFzdFBhZ2UgPSBjb21wdXRlZDxib29sZWFuPigoKSA9PiB7XG4gICAgICByZXR1cm4gcHJvcHMucGFnZSA+PSBwcm9wcy5wYWdlc1xuICAgIH0pXG5cbiAgICB3YXRjaChcbiAgICAgICgpID0+IGlzTGFzdFBhZ2UudmFsdWUsXG4gICAgICAodG8pID0+IHRvICYmIGVtaXQoJ2xhc3QtcGFnZScpLFxuICAgIClcblxuICAgIGZ1bmN0aW9uIGNoYW5nZVRhYmxlUm93c1BhZ2UoaXNOZXh0KSB7XG4gICAgICBpZiAocHJvcHMucGFnZSA9PT0gcHJvcHMucGFnZXMgJiYgaXNOZXh0KSByZXR1cm5cblxuICAgICAgY29uc3QgZXZlbnQgPSBpc05leHQgPyAnbmV4dC1wYWdlJyA6ICdwcmV2LXBhZ2UnXG4gICAgICBlbWl0KGV2ZW50LCBpc05leHQgPyAxIDogLTEpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuUGFnaW5hdGlvbkJ1dHRvbihpc05leHQgPSBmYWxzZSk6IFZOb2RlIHtcbiAgICAgIGNvbnN0IGJ0bkNvbG9yID0gcHJvcHMub3B0aW9ucz8ucGFnaW5hdGlvbj8uYnV0dG9uc0NvbG9yIHx8ICdwcmltYXJ5J1xuICAgICAgY29uc3QgY29udGVudENvbG9yID0gcHJvcHMub3B0aW9ucy5jb250ZW50Q29sb3IgfHwgJ3doaXRlJ1xuXG4gICAgICBjb25zdCBkaXNhYmxlSWYgPVxuICAgICAgICAoaXNOZXh0ICYmIHByb3BzLmxhc3RPblBhZ2UgPj0gcHJvcHMucm93c0xlbmd0aCkgfHxcbiAgICAgICAgKCFpc05leHQgJiYgcHJvcHMuZmlyc3RPblBhZ2UgPT09IDEpXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgd2lkdGg6IDQyLFxuICAgICAgICBjb2xvcjogYnRuQ29sb3IsXG4gICAgICAgIGVsZXZhdGlvbjogMyxcbiAgICAgICAgZGlzYWJsZWQ6IGRpc2FibGVJZixcbiAgICAgICAgdGV4dDogZGlzYWJsZUlmLFxuICAgICAgICBvbkNsaWNrOiAoKSA9PiBjaGFuZ2VUYWJsZVJvd3NQYWdlKGlzTmV4dCksXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKFZCdXR0b24sIHByb3BzRGF0YSwge1xuICAgICAgICBkZWZhdWx0OiAoKSA9PlxuICAgICAgICAgIGgoVkljb24sIHtcbiAgICAgICAgICAgIGljb246IGlzTmV4dCA/IGljb25zLiRhcnJvd1JpZ2h0IDogaWNvbnMuJGFycm93TGVmdCxcbiAgICAgICAgICAgIGNvbG9yOiBkaXNhYmxlSWYgPyAnZ3JleSBsaWdodGVuLTEnIDogY29udGVudENvbG9yLFxuICAgICAgICAgIH0pLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5QYWdpbmF0aW9uUGFnZURpc3BsYXkoKTogVk5vZGUge1xuICAgICAgY29uc3QgZGlzcGxheUNvbG9yID0gcHJvcHMub3B0aW9ucz8ucGFnaW5hdGlvbj8uZGlzcGxheUNvbG9yIHx8ICdwcmltYXJ5J1xuXG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIHdpZHRoOiA0MixcbiAgICAgICAgc3R5bGU6IHsgbWFyZ2luOiAnMCAxMHB4JyB9LFxuICAgICAgICBjb2xvcjogZGlzcGxheUNvbG9yLFxuICAgICAgICBlbGV2YXRpb246IDMsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKFZCdXR0b24sIHByb3BzRGF0YSwgeyBkZWZhdWx0OiAoKSA9PiBwcm9wcy5wYWdlIH0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUm93c0NvdW50U2VsZWN0TGlzdCA9ICgpID0+IHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSBwcm9wcy5vcHRpb25zLmNvdW50cz8ucm93c1BlclBhZ2VPcHRpb25zIHx8IFs1LCAxMCwgMTUsIDIwXVxuICAgICAgY29uc3QgY29sb3IgPSBwcm9wcy5vcHRpb25zPy5jb3VudHM/LmRpc3BsYXlDb2xvciB8fCAncHJpbWFyeSdcbiAgICAgIGNvbnN0IGNvbnRlbnRDb2xvciA9IHByb3BzLm9wdGlvbnMuY29udGVudENvbG9yIHx8ICd3aGl0ZSdcblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHtcbiAgICAgICAgICBjbGFzczoge1xuICAgICAgICAgICAgJ3YtZGF0YS10YWJsZV9fcm93cy1jb3VudC1saXN0JzogdHJ1ZSxcbiAgICAgICAgICAgIC4uLihjb2xvciA/IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcihjb2xvcikgOiB7fSksXG4gICAgICAgICAgICAuLi4oY29udGVudENvbG9yID8gc2V0VGV4dENsYXNzTmFtZUNvbG9yKGNvbnRlbnRDb2xvcikgOiB7fSksXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdHlsZToge1xuICAgICAgICAgICAgLi4uKGNvbG9yID8gc2V0QmFja2dyb3VuZENzc0NvbG9yKGNvbG9yKSA6IHt9KSxcbiAgICAgICAgICAgIC4uLihjb250ZW50Q29sb3IgPyBzZXRUZXh0Q3NzQ29sb3IoY29udGVudENvbG9yKSA6IHt9KSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LCBvcHRpb25zLm1hcCgoaXQpID0+IGgoJ2RpdicsIHtcbiAgICAgICAgICBjbGFzczogJ3YtZGF0YS10YWJsZV9fcm93cy1jb3VudC1pdGVtJyxcbiAgICAgICAgICBvbkNsaWNrOiAoKSA9PiBlbWl0KCdzZWxlY3Qtcm93cy1jb3VudCcsIGl0KSxcbiAgICAgICAgfSwgW2l0XSkpLFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbk1lbnUgPSAoKSA9PiB7XG5cbiAgICAgIHJldHVybiBoKFZNZW51LCB7XG4gICAgICAgIGFjdGl2YXRvcjogYWN0aXZhdG9yLnZhbHVlISxcbiAgICAgICAgbWF4SGVpZ2h0OiAyNDAsXG4gICAgICAgIHpJbmRleDogMTIsXG4gICAgICAgIG9wZW5PbkNsaWNrOiB0cnVlLFxuICAgICAgfSwge1xuICAgICAgICBkZWZhdWx0OiAoKSA9PiBnZW5Sb3dzQ291bnRTZWxlY3RMaXN0KCksXG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGdlblJvd3NDb3VudEZpZWxkID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIGgoJ2RpdicsIHtcbiAgICAgICAgY2xhc3M6ICd2LWRhdGEtdGFibGVfX3Jvd3MtY291bnQtdmFsdWUnLFxuICAgICAgICB0ZXh0Q29sb3I6IHByb3BzLm9wdGlvbnMuY29udGVudENvbG9yLFxuICAgICAgfSwgcHJvcHMucm93c09uUGFnZSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5Sb3dzQ291bnRTZWxlY3QgPSAoKSA9PiB7XG4gICAgICBjb25zdCBkaXNwbGF5Q29sb3IgPSBwcm9wcy5vcHRpb25zPy5jb3VudHM/LmRpc3BsYXlDb2xvciB8fCAncHJpbWFyeSdcblxuICAgICAgcmV0dXJuIGgoVkJ1dHRvbiwge1xuICAgICAgICBjb2xvcjogZGlzcGxheUNvbG9yLFxuICAgICAgICByZWY6IGFjdGl2YXRvcixcbiAgICAgIH0sIHtcbiAgICAgICAgZGVmYXVsdDogKCkgPT4gW1xuICAgICAgICAgIGdlblJvd3NDb3VudEZpZWxkKCksXG4gICAgICAgICAgYWN0aXZhdG9yLnZhbHVlICYmIGdlbk1lbnUoKSxcbiAgICAgICAgXSxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUm93c0NvdW50U2VsZWN0Q2FwdGlvbiA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBjb2xvciA9IHByb3BzLm9wdGlvbnMuY29udGVudENvbG9yXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1kYXRhLXRhYmxlX19wYWdpbmF0aW9uLWxhYmVsJzogdHJ1ZSxcbiAgICAgICAgICAuLi4oY29sb3IgPyBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IoY29sb3IpIDoge30pLFxuICAgICAgICB9LFxuICAgICAgICBzdHlsZToge1xuICAgICAgICAgIC4uLihjb2xvciA/IHNldFRleHRDc3NDb2xvcihjb2xvcikgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKFxuICAgICAgICAnc3BhbicsXG4gICAgICAgIHByb3BzRGF0YSxcbiAgICAgICAgcHJvcHMub3B0aW9ucz8uY291bnRzPy5yb3dzUGVyUGFnZVRleHQgfHwgJ1Jvd3MgcGVyIHBhZ2UnLFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlblJvd3NDb3VudFNlbGVjdEJsb2NrID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKCdkaXYnLCB7IGNsYXNzOiAndi1kYXRhLXRhYmxlX19wYWdpbmF0aW9uLXNlbGVjdCcgfSwgW1xuICAgICAgICBnZW5Sb3dzQ291bnRTZWxlY3RDYXB0aW9uKCksXG4gICAgICAgIGdlblJvd3NDb3VudFNlbGVjdCgpLFxuICAgICAgXSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5QYWdlc0NvdW50RGlzcGxheSA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBjb2xvciA9IHByb3BzLm9wdGlvbnMuY29udGVudENvbG9yXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1kYXRhLXRhYmxlX19wYWdpbmF0aW9uLXBhZ2VzJzogdHJ1ZSxcbiAgICAgICAgICAuLi4oY29sb3IgPyBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IoY29sb3IpIDoge30pLFxuICAgICAgICB9LFxuICAgICAgICBzdHlsZToge1xuICAgICAgICAgIC4uLihjb2xvciA/IHNldFRleHRDc3NDb2xvcihjb2xvcikgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICB9XG5cbiAgICAgIHByb3BzLnBhZ2VDb3JyZWN0aW9uICYmIGVtaXQoJ2NvcnJlY3QtcGFnZScsIC1wcm9wcy5wYWdlQ29ycmVjdGlvbilcblxuICAgICAgcmV0dXJuIGgoXG4gICAgICAgICdkaXYnLFxuICAgICAgICBwcm9wc0RhdGEsXG4gICAgICAgIChwcm9wcy5yb3dzTGVuZ3RoICYmIHNsb3RzWydwYWdpbmF0aW9uLXRleHQnXT8uKCkpIHx8XG4gICAgICAgIChwcm9wcy5yb3dzTGVuZ3RoICYmIHBhZ2luYXRpb25EaXNwbGF5VGV4dC52YWx1ZSkgfHxcbiAgICAgICAgJy0nLFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlblBhZ2luYXRpb25CdXR0b25zQmxvY2sgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgcmV0dXJuIGgoJ2RpdicsIHsgY2xhc3M6IHsgJ3YtZGF0YS10YWJsZV9fcGFnaW5hdGlvbi1yb3V0ZSc6IHRydWUgfSB9LCBbXG4gICAgICAgIGdlblBhZ2luYXRpb25CdXR0b24oKSxcbiAgICAgICAgZ2VuUGFnaW5hdGlvblBhZ2VEaXNwbGF5KCksXG4gICAgICAgIGdlblBhZ2luYXRpb25CdXR0b24odHJ1ZSksXG4gICAgICBdKVxuICAgIH1cblxuICAgIGNvbnN0IGdlblBhZ2luYXRpb25CbG9jayA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogJ3YtZGF0YS10YWJsZV9fcGFnaW5hdGlvbicgfSwgW1xuICAgICAgICBnZW5Sb3dzQ291bnRTZWxlY3RCbG9jaygpLFxuICAgICAgICBnZW5QYWdlc0NvdW50RGlzcGxheSgpLFxuICAgICAgICBnZW5QYWdpbmF0aW9uQnV0dG9uc0Jsb2NrKCksXG4gICAgICBdKVxuICAgIH1cblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgJ3YtZGF0YS10YWJsZV9fZm9vdGVyJzogdHJ1ZSxcbiAgICAgICAgICAuLi4ocHJvcHMub3B0aW9ucy5jb2xvclxuICAgICAgICAgICAgPyBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IocHJvcHMub3B0aW9ucy5jb2xvcilcbiAgICAgICAgICAgIDoge30pLFxuICAgICAgICB9LFxuICAgICAgICBzdHlsZToge1xuICAgICAgICAgIC4uLihwcm9wcy5vcHRpb25zLmNvbG9yXG4gICAgICAgICAgICA/IHNldEJhY2tncm91bmRDc3NDb2xvcihwcm9wcy5vcHRpb25zLmNvbG9yKVxuICAgICAgICAgICAgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCBwcm9wc0RhdGEsIGdlblBhZ2luYXRpb25CbG9jaygpKVxuICAgIH1cbiAgfSxcbn0pXG4iXX0=