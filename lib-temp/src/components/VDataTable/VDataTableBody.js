import { h, ref, watch, computed, defineComponent } from 'vue';
import { colorProps, useColors } from '../../composable/use-colors';
import { VDataTableCell } from './VDataTableCell';
import { VCheckbox } from '../VCheckbox';
export const VDataTableBody = defineComponent({
    name: 'v-data-table-body',
    props: {
        cols: Array,
        rows: Array,
        dark: Boolean,
        showSequence: Boolean,
        showCheckbox: Boolean,
        checkAllRows: Boolean,
        align: String,
        colWidth: {
            type: [String, Number],
            default: 125,
        },
        page: Number,
        rowsOnPage: Number,
        ...colorProps(),
    },
    emits: ['select', 'click:row', 'dblclick:row', 'contextmenu:row'],
    setup(props, { slots, emit }) {
        const checkedRows = ref([]);
        const { setBackgroundCssColor, setBackgroundClassNameColor } = useColors();
        const classes = computed(() => ({
            'v-data-table__body': true,
            ...(props.color ? setBackgroundClassNameColor(props.color) : {}),
        }));
        const styles = computed(() => ({
            ...(props.color ? setBackgroundCssColor(props.color) : {}),
        }));
        const rowsOnTable = computed(() => {
            return props.rows?.slice((props.page - 1) * props.rowsOnPage, props.page * props.rowsOnPage);
        });
        watch(() => props.checkAllRows, (to) => {
            if (to)
                onSelectRows(props.rows);
            else
                onSelectRows([]);
        });
        function onSelectRows(rows) {
            checkedRows.value = rows;
            emit('select', checkedRows.value);
        }
        function genNumberCell(count) {
            return h(VDataTableCell, {
                width: 50,
                align: 'center',
                dark: props.dark,
                color: props.color,
                class: 'v-data-table__row-number',
            }, {
                default: () => count + 1,
            });
        }
        function genCheckboxCell(row) {
            return h(VDataTableCell, {
                width: 50,
                align: 'center',
                dark: props.dark,
                color: props.color,
                class: 'v-data-table__row-checkbox',
            }, {
                default: () => h(VCheckbox, {
                    modelValue: checkedRows.value,
                    color: props.dark ? 'white' : '',
                    value: row,
                    onChecked: onSelectRows,
                }),
            });
        }
        function genRowCell(col, row) {
            const { format } = col;
            const slotContent = slots[col.key] &&
                slots[col.key]({
                    row,
                    format,
                });
            return h(VDataTableCell, {
                width: col.width,
                align: col.align || props.align,
                dark: props.dark,
            }, {
                default: () => slotContent
                    ? slotContent
                    : format
                        ? format(row)
                        : String(row[col.key]),
            });
        }
        function genTableRow(row, rowCount) {
            const rowCells = [];
            props.showSequence && rowCells.push(genNumberCell(rowCount));
            props.showCheckbox && rowCells.push(genCheckboxCell(row));
            props.cols.forEach((col) => {
                col.show && rowCells.push(genRowCell(col, row));
            });
            return h('div', {
                class: { 'v-data-table__row': true },
                onClick: () => emit('click:row', row),
                onDblclick: () => emit('dblclick:row', row),
                onContextmenu: (e) => {
                    e.preventDefault();
                    emit('contextmenu:row', row);
                },
            }, rowCells);
        }
        function genTableRows() {
            const tableRows = [];
            const rowsLength = rowsOnTable.value?.length;
            const count = (props.page - 1) * props.rowsOnPage;
            for (let i = 0; i < rowsLength; i += 1) {
                tableRows.push(genTableRow(rowsOnTable.value[i], count + i));
            }
            return tableRows;
        }
        return () => h('div', {
            class: classes.value,
            style: styles.value,
        }, genTableRows());
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGFUYWJsZUJvZHkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WRGF0YVRhYmxlL1ZEYXRhVGFibGVCb2R5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsZUFBZSxFQUFFLE1BQU0sS0FBSyxDQUFBO0FBRzlELE9BQU8sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sNkJBQTZCLENBQUE7QUFHbkUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFBO0FBQ2pELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUE7QUFLeEMsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLGVBQWUsQ0FBQztJQUM1QyxJQUFJLEVBQUUsbUJBQW1CO0lBRXpCLEtBQUssRUFBRTtRQUNMLElBQUksRUFBRSxLQUFLO1FBQ1gsSUFBSSxFQUFFLEtBQUs7UUFDWCxJQUFJLEVBQUUsT0FBTztRQUNiLFlBQVksRUFBRSxPQUFPO1FBQ3JCLFlBQVksRUFBRSxPQUFPO1FBQ3JCLFlBQVksRUFBRSxPQUFPO1FBQ3JCLEtBQUssRUFBRSxNQUFNO1FBQ2IsUUFBUSxFQUFFO1lBQ1IsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztZQUN0QixPQUFPLEVBQUUsR0FBRztTQUNiO1FBQ0QsSUFBSSxFQUFFLE1BQU07UUFDWixVQUFVLEVBQUUsTUFBTTtRQUNsQixHQUFHLFVBQVUsRUFBRTtLQUNUO0lBRVIsS0FBSyxFQUFFLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsaUJBQWlCLENBQUM7SUFFakUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7UUFDMUIsTUFBTSxXQUFXLEdBQUcsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBRTNC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V0FBVyxFQUFFLEdBQUcsQ0FBQztnQkFDckMsVUFBVSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsR0FBRyxDQUFDO2dCQUMzQyxhQUFhLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtvQkFDbkIsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFBO29CQUNsQixJQUFJLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxDQUFDLENBQUE7Z0JBQzlCLENBQUM7YUFDRixFQUNELFFBQVEsQ0FDVCxDQUFBO1FBQ0gsQ0FBQztRQUVELFNBQVMsWUFBWTtZQUNuQixNQUFNLFNBQVMsR0FBWSxFQUFFLENBQUE7WUFDN0IsTUFBTSxVQUFVLEdBQUcsV0FBVyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUE7WUFDNUMsTUFBTSxLQUFLLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUE7WUFFakQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUN0QyxTQUFTLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFBO2FBQzdEO1lBRUQsT0FBTyxTQUFTLENBQUE7UUFDbEIsQ0FBQztRQUVELE9BQU8sR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRTtZQUNwQixLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7WUFDcEIsS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFLO1NBQ3BCLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQTtJQUNwQixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVnVlIEFQSVxuaW1wb3J0IHsgaCwgcmVmLCB3YXRjaCwgY29tcHV0ZWQsIGRlZmluZUNvbXBvbmVudCB9IGZyb20gJ3Z1ZSdcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgY29sb3JQcm9wcywgdXNlQ29sb3JzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtY29sb3JzJ1xuXG4vLyBDb21wb25lbnRzXG5pbXBvcnQgeyBWRGF0YVRhYmxlQ2VsbCB9IGZyb20gJy4vVkRhdGFUYWJsZUNlbGwnXG5pbXBvcnQgeyBWQ2hlY2tib3ggfSBmcm9tICcuLi9WQ2hlY2tib3gnXG5cbi8vIFR5cGVzXG5pbXBvcnQgeyBWTm9kZSB9IGZyb20gJ3Z1ZSdcblxuZXhwb3J0IGNvbnN0IFZEYXRhVGFibGVCb2R5ID0gZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3YtZGF0YS10YWJsZS1ib2R5JyxcblxuICBwcm9wczoge1xuICAgIGNvbHM6IEFycmF5LFxuICAgIHJvd3M6IEFycmF5LFxuICAgIGRhcms6IEJvb2xlYW4sXG4gICAgc2hvd1NlcXVlbmNlOiBCb29sZWFuLFxuICAgIHNob3dDaGVja2JveDogQm9vbGVhbixcbiAgICBjaGVja0FsbFJvd3M6IEJvb2xlYW4sXG4gICAgYWxpZ246IFN0cmluZyxcbiAgICBjb2xXaWR0aDoge1xuICAgICAgdHlwZTogW1N0cmluZywgTnVtYmVyXSxcbiAgICAgIGRlZmF1bHQ6IDEyNSxcbiAgICB9LFxuICAgIHBhZ2U6IE51bWJlcixcbiAgICByb3dzT25QYWdlOiBOdW1iZXIsXG4gICAgLi4uY29sb3JQcm9wcygpLFxuICB9IGFzIGFueSxcblxuICBlbWl0czogWydzZWxlY3QnLCAnY2xpY2s6cm93JywgJ2RibGNsaWNrOnJvdycsICdjb250ZXh0bWVudTpyb3cnXSxcblxuICBzZXR1cChwcm9wcywgeyBzbG90cywgZW1pdCB9KTogKCkgPT4gVk5vZGUge1xuICAgIGNvbnN0IGNoZWNrZWRSb3dzID0gcmVmKFtdKVxuXG4gICAgY29uc3QgeyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IsIHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvciB9ID0gdXNlQ29sb3JzKClcblxuICAgIGNvbnN0IGNsYXNzZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBib29sZWFuPj4oKCkgPT4gKHtcbiAgICAgICd2LWRhdGEtdGFibGVfX2JvZHknOiB0cnVlLFxuICAgICAgLi4uKHByb3BzLmNvbG9yID8gc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yKHByb3BzLmNvbG9yKSA6IHt9KSxcbiAgICB9KSlcblxuICAgIGNvbnN0IHN0eWxlcyA9IGNvbXB1dGVkKCgpID0+ICh7XG4gICAgICAuLi4ocHJvcHMuY29sb3IgPyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgIH0pKVxuXG4gICAgY29uc3Qgcm93c09uVGFibGUgPSBjb21wdXRlZDxhbnlbXT4oKCkgPT4ge1xuICAgICAgcmV0dXJuIHByb3BzLnJvd3M/LnNsaWNlKFxuICAgICAgICAocHJvcHMucGFnZSAtIDEpICogcHJvcHMucm93c09uUGFnZSxcbiAgICAgICAgcHJvcHMucGFnZSAqIHByb3BzLnJvd3NPblBhZ2UsXG4gICAgICApXG4gICAgfSlcblxuICAgIHdhdGNoKFxuICAgICAgKCkgPT4gcHJvcHMuY2hlY2tBbGxSb3dzLFxuICAgICAgKHRvKSA9PiB7XG4gICAgICAgIGlmICh0bykgb25TZWxlY3RSb3dzKHByb3BzLnJvd3MpXG4gICAgICAgIGVsc2Ugb25TZWxlY3RSb3dzKFtdKVxuICAgICAgfSxcbiAgICApXG5cbiAgICBmdW5jdGlvbiBvblNlbGVjdFJvd3Mocm93cykge1xuICAgICAgY2hlY2tlZFJvd3MudmFsdWUgPSByb3dzXG4gICAgICBlbWl0KCdzZWxlY3QnLCBjaGVja2VkUm93cy52YWx1ZSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5OdW1iZXJDZWxsKGNvdW50KTogVk5vZGUge1xuICAgICAgcmV0dXJuIGgoXG4gICAgICAgIFZEYXRhVGFibGVDZWxsLFxuICAgICAgICB7XG4gICAgICAgICAgd2lkdGg6IDUwLFxuICAgICAgICAgIGFsaWduOiAnY2VudGVyJyxcbiAgICAgICAgICBkYXJrOiBwcm9wcy5kYXJrLFxuICAgICAgICAgIGNvbG9yOiBwcm9wcy5jb2xvcixcbiAgICAgICAgICBjbGFzczogJ3YtZGF0YS10YWJsZV9fcm93LW51bWJlcicsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWZhdWx0OiAoKSA9PiBjb3VudCArIDEsXG4gICAgICAgIH0sXG4gICAgICApXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuQ2hlY2tib3hDZWxsKHJvdyk6IFZOb2RlIHtcbiAgICAgIHJldHVybiBoKFxuICAgICAgICBWRGF0YVRhYmxlQ2VsbCxcbiAgICAgICAge1xuICAgICAgICAgIHdpZHRoOiA1MCxcbiAgICAgICAgICBhbGlnbjogJ2NlbnRlcicsXG4gICAgICAgICAgZGFyazogcHJvcHMuZGFyayxcbiAgICAgICAgICBjb2xvcjogcHJvcHMuY29sb3IsXG4gICAgICAgICAgY2xhc3M6ICd2LWRhdGEtdGFibGVfX3Jvdy1jaGVja2JveCcsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWZhdWx0OiAoKSA9PlxuICAgICAgICAgICAgaChWQ2hlY2tib3gsIHtcbiAgICAgICAgICAgICAgbW9kZWxWYWx1ZTogY2hlY2tlZFJvd3MudmFsdWUsXG4gICAgICAgICAgICAgIGNvbG9yOiBwcm9wcy5kYXJrID8gJ3doaXRlJyA6ICcnLFxuICAgICAgICAgICAgICB2YWx1ZTogcm93LFxuICAgICAgICAgICAgICBvbkNoZWNrZWQ6IG9uU2VsZWN0Um93cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlblJvd0NlbGwoY29sLCByb3cpOiBWTm9kZSB7XG4gICAgICBjb25zdCB7IGZvcm1hdCB9ID0gY29sXG4gICAgICBjb25zdCBzbG90Q29udGVudCA9XG4gICAgICAgIHNsb3RzW2NvbC5rZXldICYmXG4gICAgICAgIHNsb3RzW2NvbC5rZXldISh7XG4gICAgICAgICAgcm93LFxuICAgICAgICAgIGZvcm1hdCxcbiAgICAgICAgfSlcblxuICAgICAgcmV0dXJuIGgoXG4gICAgICAgIFZEYXRhVGFibGVDZWxsLFxuICAgICAgICB7XG4gICAgICAgICAgd2lkdGg6IGNvbC53aWR0aCxcbiAgICAgICAgICBhbGlnbjogY29sLmFsaWduIHx8IHByb3BzLmFsaWduLFxuICAgICAgICAgIGRhcms6IHByb3BzLmRhcmssXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWZhdWx0OiAoKSA9PlxuICAgICAgICAgICAgc2xvdENvbnRlbnRcbiAgICAgICAgICAgICAgPyBzbG90Q29udGVudFxuICAgICAgICAgICAgICA6IGZvcm1hdFxuICAgICAgICAgICAgICA/IGZvcm1hdChyb3cpXG4gICAgICAgICAgICAgIDogU3RyaW5nKHJvd1tjb2wua2V5XSksXG4gICAgICAgIH0sXG4gICAgICApXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuVGFibGVSb3cocm93LCByb3dDb3VudDogbnVtYmVyKTogVk5vZGUge1xuICAgICAgY29uc3Qgcm93Q2VsbHM6IFZOb2RlW10gPSBbXVxuXG4gICAgICBwcm9wcy5zaG93U2VxdWVuY2UgJiYgcm93Q2VsbHMucHVzaChnZW5OdW1iZXJDZWxsKHJvd0NvdW50KSlcbiAgICAgIHByb3BzLnNob3dDaGVja2JveCAmJiByb3dDZWxscy5wdXNoKGdlbkNoZWNrYm94Q2VsbChyb3cpKVxuXG4gICAgICBwcm9wcy5jb2xzLmZvckVhY2goKGNvbCkgPT4ge1xuICAgICAgICBjb2wuc2hvdyAmJiByb3dDZWxscy5wdXNoKGdlblJvd0NlbGwoY29sLCByb3cpKVxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIGgoXG4gICAgICAgICdkaXYnLFxuICAgICAgICB7XG4gICAgICAgICAgY2xhc3M6IHsgJ3YtZGF0YS10YWJsZV9fcm93JzogdHJ1ZSB9LFxuICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IGVtaXQoJ2NsaWNrOnJvdycsIHJvdyksXG4gICAgICAgICAgb25EYmxjbGljazogKCkgPT4gZW1pdCgnZGJsY2xpY2s6cm93Jywgcm93KSxcbiAgICAgICAgICBvbkNvbnRleHRtZW51OiAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICBlbWl0KCdjb250ZXh0bWVudTpyb3cnLCByb3cpXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcm93Q2VsbHMsXG4gICAgICApXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuVGFibGVSb3dzKCk6IFZOb2RlW10ge1xuICAgICAgY29uc3QgdGFibGVSb3dzOiBWTm9kZVtdID0gW11cbiAgICAgIGNvbnN0IHJvd3NMZW5ndGggPSByb3dzT25UYWJsZS52YWx1ZT8ubGVuZ3RoXG4gICAgICBjb25zdCBjb3VudCA9IChwcm9wcy5wYWdlIC0gMSkgKiBwcm9wcy5yb3dzT25QYWdlXG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm93c0xlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIHRhYmxlUm93cy5wdXNoKGdlblRhYmxlUm93KHJvd3NPblRhYmxlLnZhbHVlW2ldLCBjb3VudCArIGkpKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGFibGVSb3dzXG4gICAgfVxuXG4gICAgcmV0dXJuICgpID0+IGgoJ2RpdicsIHtcbiAgICAgIGNsYXNzOiBjbGFzc2VzLnZhbHVlLFxuICAgICAgc3R5bGU6IHN0eWxlcy52YWx1ZSxcbiAgICB9LCBnZW5UYWJsZVJvd3MoKSlcbiAgfSxcbn0pXG4iXX0=