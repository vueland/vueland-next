import { computed, defineComponent, h, provide, reactive, ref } from 'vue';
import { useColors } from '../../composable/use-colors';
import { elevationProps, useElevation } from '../../composable/use-elevation';
import { useTransition } from '../../composable/use-transition';
import { VTextField } from '../VTextField';
import { VDatepickerHeader } from './VDatepickerHeader';
import { VDatePickerDates } from './VDatePickerDates';
import { VDatePickerYears } from './VDatePickerYears';
import { VDatePickerMonths } from './VDatePickerMonths';
import { VMenu } from '../VMenu';
import { parseDate } from './helpers';
import { addScopedSlot } from '../../helpers';
import { formatDate } from './utils';
import { locale } from '../../services/locale';
export default defineComponent({
    name: 'v-date-picker',
    props: {
        dark: Boolean,
        disabled: Boolean,
        clearable: Boolean,
        readonly: Boolean,
        typeable: Boolean,
        mondayFirst: Boolean,
        today: Boolean,
        useMls: Boolean,
        useUtc: Boolean,
        lang: {
            type: String,
            default: 'en',
        },
        label: String,
        prependIcon: String,
        format: {
            type: String,
            default: 'yyyy MM dd D',
        },
        rules: Array,
        value: [String, Date, Number],
        modelValue: [String, Date, Number],
        disabledDates: Object,
        highlighted: Object,
        contentColor: {
            type: String,
            default: 'primary',
        },
        color: {
            type: String,
            default: 'white',
        },
        ...elevationProps(),
    },
    emits: ['update:value', 'update:modelValue', 'selected'],
    setup(props, { emit, slots }) {
        const data = reactive({
            year: null,
            month: null,
            date: null,
            day: null,
            selected: null,
            tableMonth: null,
            tableYear: null,
            convertedDateString: null,
            isYears: false,
            isMonths: false,
            isDates: true,
            isActive: false,
        });
        const { setTextClassNameColor, setTextCssColor, setBackgroundClassNameColor, setBackgroundCssColor, } = useColors();
        const { elevationClasses } = useElevation(props);
        const localeMonths = locale[props.lang].monthsAbbr;
        const localeWeek = locale[props.lang].week;
        const contentColor = props.dark ? 'white' : props.contentColor;
        const handlers = ref({});
        const activator = ref(null);
        const closeConditional = ref(false);
        provide('handlers', handlers);
        const classes = computed(() => ({
            'v-date-picker': true,
            'v-date-picker--typeable': props.typeable,
            'v-date-picker--readonly': !props.typeable || props.readonly,
        }));
        const tableClasses = computed(() => ({
            'v-date-picker__table': true,
            ...elevationClasses.value,
            ...(props.color ? setBackgroundClassNameColor(props.color) : {}),
            ...(contentColor ? setTextClassNameColor(contentColor) : {}),
        }));
        const tableStyles = computed(() => ({
            ...(props.color ? setBackgroundCssColor(props.color) : {}),
            ...(contentColor ? setTextCssColor(contentColor) : {}),
        }));
        const headerValue = computed(() => {
            return data.isYears || data.isMonths
                ? `${data.tableYear}`
                : data.isDates
                    ? `${data.tableYear} ${localeMonths[data.tableMonth]}`
                    : '';
        });
        const displayDate = computed(() => {
            const { month, date, day } = data.selected;
            return `${localeMonths[month]} ${date} ${localeWeek[day]}`;
        });
        const computedValue = computed(() => {
            const { year, month, date } = data.selected;
            return new Date(year, month, date);
        });
        const setInitDate = () => {
            if (props.value)
                setParsedDate(props.value);
            else if (props.modelValue)
                setParsedDate(props.modelValue);
            else
                setParsedDate();
            if (props.today || props.value || props.modelValue) {
                data.convertedDateString = convertToFormat();
            }
        };
        const onTableChange = () => {
            if (data.isYears) {
                data.isYears = false;
                return (data.isMonths = true);
            }
            if (data.isMonths) {
                data.isMonths = false;
                return (data.isYears = true);
            }
            if (data.isDates) {
                data.isDates = false;
                return (data.isMonths = true);
            }
            return undefined;
        };
        const setDataDate = ({ year, month, date, day, }) => {
            data.tableMonth = month;
            data.tableYear = year;
            data.year = year;
            data.month = month;
            data.date = date;
            data.day = day;
        };
        const setParsedDate = (selectedDate = null) => {
            const dateForParsing = selectedDate || new Date();
            data.selected = parseDate(dateForParsing);
            !selectedDate && (data.selected.default = !selectedDate);
            setDataDate(data.selected);
        };
        const onYearUpdate = (year) => {
            data.tableYear = year;
            data.isMonths = true;
            data.isYears = false;
        };
        const onMonthUpdate = (month) => {
            data.tableMonth = month;
            data.isMonths = false;
            data.isYears = false;
            data.isDates = true;
        };
        const onDateUpdate = (date) => {
            if (!date)
                return;
            closeConditional.value = true;
            data.selected = date;
            data.tableMonth = date.month;
            data.tableYear = date.year;
            data.convertedDateString = convertToFormat();
            emit('update:value', computedValue.value);
            emit('update:modelValue', computedValue.value);
            emit('selected', computedValue.value);
            requestAnimationFrame(() => (closeConditional.value = false));
        };
        const onDateMonthUpdate = (dateObject) => {
            data.tableMonth = dateObject.month;
            if (dateObject.year)
                data.tableYear = dateObject.year;
        };
        const onDateInput = (date) => {
            onDateUpdate(stringToDate(date));
        };
        const stringToDate = (date) => {
            if (date.length === 10) {
                const dateArray = date.trim().split(/\W/);
                if (dateArray[0].length < 4) {
                    date = dateArray.reverse().join('.');
                }
                return parseDate(new Date(Date.parse(date)));
            }
            return null;
        };
        const convertToFormat = () => {
            if (!data.selected)
                return '';
            return formatDate(new Date(data.selected.year, data.selected.month, data.selected.date), props.format, locale[props.lang]);
        };
        const genDisplayValue = (value) => {
            const propsData = {
                class: 'v-date-picker__display-value',
            };
            return useTransition(h('span', propsData, value), 'scale-in-out', 'out-in');
        };
        const genDatepickerDisplayInner = () => {
            const propsData = {
                class: 'v-date-picker__display-inner',
            };
            return h('div', propsData, [
                genDisplayValue(data.selected?.year),
                genDisplayValue(displayDate.value),
            ]);
        };
        const genDatepickerDisplay = () => {
            const propsData = {
                class: {
                    'v-date-picker__display': true,
                    ...(contentColor ? setBackgroundClassNameColor(contentColor) : {}),
                    ...(props.color ? setTextClassNameColor(props.color) : {}),
                },
                style: {
                    ...(contentColor ? setBackgroundCssColor(contentColor) : {}),
                    ...(props.color ? setTextCssColor(props.color) : {}),
                },
            };
            return h('div', propsData, genDatepickerDisplayInner());
        };
        const genDatepickerHeader = () => {
            return h(VDatepickerHeader, {
                onNext: () => handlers.value.onNext(),
                onPrev: () => handlers.value.onPrev(),
                onTable: onTableChange,
            }, {
                default: () => headerValue.value,
            });
        };
        const genDatepickerYearsTable = () => {
            const propsData = {
                year: data.tableYear,
                ['onUpdate:year']: onYearUpdate,
            };
            return h(VDatePickerYears, propsData);
        };
        const genDatepickerMonthsTable = () => {
            return h(VDatePickerMonths, {
                lang: props.lang,
                month: data.tableMonth,
                year: data.tableYear,
                locale: localeMonths,
                ['onUpdate:month']: onMonthUpdate,
                ['onUpdate:year']: onYearUpdate,
            });
        };
        const genDatepickerDatesTable = () => {
            return h(VDatePickerDates, {
                locale: localeWeek,
                mondayFirst: props.mondayFirst,
                month: data.tableMonth,
                year: data.tableYear,
                value: data.selected,
                disabledDates: props.disabledDates,
                ['onUpdate:value']: onDateUpdate,
                ['onUpdate:month']: onDateMonthUpdate,
            }, {
                date: slots.date && addScopedSlot('date', slots),
            });
        };
        const genDatepickerBody = () => {
            const propsData = {
                class: {
                    'v-date-picker__body': true,
                },
            };
            return h('div', propsData, useTransition(((data.isYears && genDatepickerYearsTable()) ||
                (data.isMonths && genDatepickerMonthsTable()) ||
                (data.isDates && genDatepickerDatesTable())), 'slide-in-left', 'out-in'));
        };
        const genDatepickerInput = () => {
            return h(VTextField, {
                modelValue: data.convertedDateString,
                dark: props.dark,
                label: props.label,
                readonly: !props.typeable,
                disabled: props.disabled,
                prependIcon: props.prependIcon,
                rules: props.rules,
                clearable: props.clearable,
                ref: activator,
                onInput: onDateInput,
                onClear: () => {
                    data.convertedDateString = '';
                    emit('update:value', null);
                    emit('update:modelValue', null);
                    emit('selected', null);
                },
            });
        };
        const genDatepickerTable = () => {
            const propsData = {
                class: tableClasses.value,
                style: tableStyles.value,
            };
            return h('div', propsData, [
                genDatepickerDisplay(),
                genDatepickerHeader(),
                genDatepickerBody(),
            ]);
        };
        const genMenu = () => {
            return h(VMenu, {
                activator: activator.value,
                internalActivator: true,
                inputActivator: '.v-input__text-field',
                width: 'auto',
                maxHeight: 'auto',
                bottom: props.typeable,
                openOnClick: true,
                closeOnClick: closeConditional.value,
            }, {
                default: () => genDatepickerTable(),
            });
        };
        const genDatepicker = () => {
            const propsData = {
                class: classes.value,
            };
            return h('div', propsData, [
                genDatepickerInput(),
                activator.value && genMenu(),
            ]);
        };
        setInitDate();
        return () => genDatepicker();
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGVQaWNrZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WRGF0ZVBpY2tlci9WRGF0ZVBpY2tlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsUUFBUSxFQUFFLGVBQWUsRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsTUFBTSxLQUFLLENBQUE7QUFHMUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDZCQUE2QixDQUFBO0FBQ3ZELE9BQU8sRUFBRSxjQUFjLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0NBQWdDLENBQUE7QUFDN0UsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlDQUFpQyxDQUFBO0FBRy9ELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFDMUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUE7QUFDdkQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFDckQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFDckQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUE7QUFDdkQsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUdoQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBQ3JDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFHN0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLFNBQVMsQ0FBQTtBQVFwQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sdUJBQXVCLENBQUE7QUFpQjlDLGVBQWUsZUFBZSxDQUFDO0lBQzdCLElBQUksRUFBRSxlQUFlO0lBQ3JCLEtBQUssRUFBRTtRQUNMLElBQUksRUFBRSxPQUFPO1FBQ2IsUUFBUSxFQUFFLE9BQU87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QUN0QixXQUFXLEVBQUUsSUFBSTtnQkFDakIsWUFBWSxFQUFFLGdCQUFnQixDQUFDLEtBQUs7YUFDckMsRUFDRDtnQkFDRSxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsa0JBQWtCLEVBQUU7YUFDcEMsQ0FDRixDQUFBO1FBQ0gsQ0FBQyxDQUFBO1FBRUQsTUFBTSxhQUFhLEdBQUcsR0FBVSxFQUFFO1lBQ2hDLE1BQU0sU0FBUyxHQUFHO2dCQUNoQixLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7YUFDckIsQ0FBQTtZQUVELE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUU7Z0JBQ3pCLGtCQUFrQixFQUFFO2dCQUNwQixTQUFTLENBQUMsS0FBSyxJQUFJLE9BQU8sRUFBRTthQUM3QixDQUFDLENBQUE7UUFDSixDQUFDLENBQUE7UUFFRCxXQUFXLEVBQUUsQ0FBQTtRQUViLE9BQU8sR0FBRyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUE7SUFDOUIsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7IGNvbXB1dGVkLCBkZWZpbmVDb21wb25lbnQsIGgsIHByb3ZpZGUsIHJlYWN0aXZlLCByZWYgfSBmcm9tICd2dWUnXG5cbi8vIEVmZmVjdHNcbmltcG9ydCB7IHVzZUNvbG9ycyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvdXNlLWNvbG9ycydcbmltcG9ydCB7IGVsZXZhdGlvblByb3BzLCB1c2VFbGV2YXRpb24gfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS1lbGV2YXRpb24nXG5pbXBvcnQgeyB1c2VUcmFuc2l0aW9uIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtdHJhbnNpdGlvbidcblxuLy8gQ29tcG9uZW50c1xuaW1wb3J0IHsgVlRleHRGaWVsZCB9IGZyb20gJy4uL1ZUZXh0RmllbGQnXG5pbXBvcnQgeyBWRGF0ZXBpY2tlckhlYWRlciB9IGZyb20gJy4vVkRhdGVwaWNrZXJIZWFkZXInXG5pbXBvcnQgeyBWRGF0ZVBpY2tlckRhdGVzIH0gZnJvbSAnLi9WRGF0ZVBpY2tlckRhdGVzJ1xuaW1wb3J0IHsgVkRhdGVQaWNrZXJZZWFycyB9IGZyb20gJy4vVkRhdGVQaWNrZXJZZWFycydcbmltcG9ydCB7IFZEYXRlUGlja2VyTW9udGhzIH0gZnJvbSAnLi9WRGF0ZVBpY2tlck1vbnRocydcbmltcG9ydCB7IFZNZW51IH0gZnJvbSAnLi4vVk1lbnUnXG5cbi8vIEhlbHBlcnNcbmltcG9ydCB7IHBhcnNlRGF0ZSB9IGZyb20gJy4vaGVscGVycydcbmltcG9ydCB7IGFkZFNjb3BlZFNsb3QgfSBmcm9tICcuLi8uLi9oZWxwZXJzJ1xuXG4vLyBVdGlsc1xuaW1wb3J0IHsgZm9ybWF0RGF0ZSB9IGZyb20gJy4vdXRpbHMnXG5cbi8vIFR5cGVzXG5pbXBvcnQgeyBWTm9kZSB9IGZyb20gJ3Z1ZSdcbmltcG9ydCB7IERhdGVQaWNrZXJCdG5IYW5kbGVycywgRGF0ZVBpY2tlckRhdGUgfSBmcm9tICcuLi8uLi8uLi90eXBlcydcbmltcG9ydCB7IE1heWJlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvYmFzZSdcblxuLy8gU2VydmljZXNcbmltcG9ydCB7IGxvY2FsZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2xvY2FsZSdcblxudHlwZSBEYXRlUGlja2VyRGF0YSA9IHtcbiAgeWVhcjogbnVtYmVyIHwgbnVsbFxuICBtb250aDogbnVtYmVyIHwgbnVsbFxuICBkYXRlOiBudW1iZXIgfCBudWxsXG4gIGRheTogbnVtYmVyIHwgbnVsbFxuICBzZWxlY3RlZDogRGF0ZVBpY2tlckRhdGUgfCBudWxsXG4gIHRhYmxlTW9udGg6IG51bWJlciB8IG51bGxcbiAgdGFibGVZZWFyOiBudW1iZXIgfCBudWxsXG4gIGNvbnZlcnRlZERhdGVTdHJpbmc6IHN0cmluZyB8IG51bGxcbiAgaXNZZWFyczogYm9vbGVhblxuICBpc01vbnRoczogYm9vbGVhblxuICBpc0RhdGVzOiBib29sZWFuXG4gIGlzQWN0aXZlOiBib29sZWFuXG59XG5cbmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LWRhdGUtcGlja2VyJyxcbiAgcHJvcHM6IHtcbiAgICBkYXJrOiBCb29sZWFuLFxuICAgIGRpc2FibGVkOiBCb29sZWFuLFxuICAgIGNsZWFyYWJsZTogQm9vbGVhbixcbiAgICByZWFkb25seTogQm9vbGVhbixcbiAgICB0eXBlYWJsZTogQm9vbGVhbixcbiAgICBtb25kYXlGaXJzdDogQm9vbGVhbixcbiAgICB0b2RheTogQm9vbGVhbixcbiAgICB1c2VNbHM6IEJvb2xlYW4sXG4gICAgdXNlVXRjOiBCb29sZWFuLFxuICAgIGxhbmc6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdlbicsXG4gICAgfSxcbiAgICBsYWJlbDogU3RyaW5nLFxuICAgIHByZXBlbmRJY29uOiBTdHJpbmcsXG4gICAgZm9ybWF0OiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAneXl5eSBNTSBkZCBEJyxcbiAgICB9LFxuICAgIHJ1bGVzOiBBcnJheSxcbiAgICB2YWx1ZTogW1N0cmluZywgRGF0ZSwgTnVtYmVyXSxcbiAgICBtb2RlbFZhbHVlOiBbU3RyaW5nLCBEYXRlLCBOdW1iZXJdLFxuICAgIGRpc2FibGVkRGF0ZXM6IE9iamVjdCxcbiAgICBoaWdobGlnaHRlZDogT2JqZWN0LFxuICAgIGNvbnRlbnRDb2xvcjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ3ByaW1hcnknLFxuICAgIH0sXG4gICAgY29sb3I6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICd3aGl0ZScsXG4gICAgfSxcbiAgICAuLi5lbGV2YXRpb25Qcm9wcygpLFxuICB9IGFzIGFueSxcblxuICBlbWl0czogWyd1cGRhdGU6dmFsdWUnLCAndXBkYXRlOm1vZGVsVmFsdWUnLCAnc2VsZWN0ZWQnXSxcblxuICBzZXR1cChwcm9wcywgeyBlbWl0LCBzbG90cyB9KSB7XG4gICAgY29uc3QgZGF0YTogRGF0ZVBpY2tlckRhdGEgPSByZWFjdGl2ZSh7XG4gICAgICB5ZWFyOiBudWxsLFxuICAgICAgbW9udGg6IG51bGwsXG4gICAgICBkYXRlOiBudWxsLFxuICAgICAgZGF5OiBudWxsLFxuICAgICAgc2VsZWN0ZWQ6IG51bGwsXG4gICAgICB0YWJsZU1vbnRoOiBudWxsLFxuICAgICAgdGFibGVZZWFyOiBudWxsLFxuICAgICAgY29udmVydGVkRGF0ZVN0cmluZzogbnVsbCxcbiAgICAgIGlzWWVhcnM6IGZhbHNlLFxuICAgICAgaXNNb250aHM6IGZhbHNlLFxuICAgICAgaXNEYXRlczogdHJ1ZSxcbiAgICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgICB9KVxuXG4gICAgY29uc3Qge1xuICAgICAgc2V0VGV4dENsYXNzTmFtZUNvbG9yLFxuICAgICAgc2V0VGV4dENzc0NvbG9yLFxuICAgICAgc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yLFxuICAgICAgc2V0QmFja2dyb3VuZENzc0NvbG9yLFxuICAgIH0gPSB1c2VDb2xvcnMoKVxuICAgIGNvbnN0IHsgZWxldmF0aW9uQ2xhc3NlcyB9ID0gdXNlRWxldmF0aW9uKHByb3BzKVxuXG4gICAgY29uc3QgbG9jYWxlTW9udGhzOiBzdHJpbmdbXSA9IGxvY2FsZVtwcm9wcy5sYW5nXS5tb250aHNBYmJyXG4gICAgY29uc3QgbG9jYWxlV2Vlazogc3RyaW5nW10gPSBsb2NhbGVbcHJvcHMubGFuZ10ud2Vla1xuICAgIGNvbnN0IGNvbnRlbnRDb2xvcjogc3RyaW5nID0gcHJvcHMuZGFyayA/ICd3aGl0ZScgOiBwcm9wcy5jb250ZW50Q29sb3JcblxuICAgIGNvbnN0IGhhbmRsZXJzID0gcmVmPERhdGVQaWNrZXJCdG5IYW5kbGVycz4oe30pXG4gICAgY29uc3QgYWN0aXZhdG9yID0gcmVmPE1heWJlPFZOb2RlPj4obnVsbClcbiAgICBjb25zdCBjbG9zZUNvbmRpdGlvbmFsID0gcmVmPGJvb2xlYW4+KGZhbHNlKVxuXG4gICAgcHJvdmlkZSgnaGFuZGxlcnMnLCBoYW5kbGVycylcblxuICAgIGNvbnN0IGNsYXNzZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBib29sZWFuPj4oKCkgPT4gKHtcbiAgICAgICd2LWRhdGUtcGlja2VyJzogdHJ1ZSxcbiAgICAgICd2LWRhdGUtcGlja2VyLS10eXBlYWJsZSc6IHByb3BzLnR5cGVhYmxlLFxuICAgICAgJ3YtZGF0ZS1waWNrZXItLXJlYWRvbmx5JzogIXByb3BzLnR5cGVhYmxlIHx8IHByb3BzLnJlYWRvbmx5LFxuICAgIH0pKVxuXG4gICAgY29uc3QgdGFibGVDbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+ICh7XG4gICAgICAndi1kYXRlLXBpY2tlcl9fdGFibGUnOiB0cnVlLFxuICAgICAgLi4uZWxldmF0aW9uQ2xhc3Nlcy52YWx1ZSxcbiAgICAgIC4uLihwcm9wcy5jb2xvciA/IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcihwcm9wcy5jb2xvcikgOiB7fSksXG4gICAgICAuLi4oY29udGVudENvbG9yID8gc2V0VGV4dENsYXNzTmFtZUNvbG9yKGNvbnRlbnRDb2xvcikgOiB7fSksXG4gICAgfSkpXG5cbiAgICBjb25zdCB0YWJsZVN0eWxlcyA9IGNvbXB1dGVkKCgpID0+ICh7XG4gICAgICAuLi4ocHJvcHMuY29sb3IgPyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgICAgLi4uKGNvbnRlbnRDb2xvciA/IHNldFRleHRDc3NDb2xvcihjb250ZW50Q29sb3IpIDoge30pLFxuICAgIH0pKVxuXG4gICAgY29uc3QgaGVhZGVyVmFsdWUgPSBjb21wdXRlZDxzdHJpbmc+KCgpID0+IHtcbiAgICAgIHJldHVybiBkYXRhLmlzWWVhcnMgfHwgZGF0YS5pc01vbnRoc1xuICAgICAgICA/IGAkeyBkYXRhLnRhYmxlWWVhciB9YFxuICAgICAgICA6IGRhdGEuaXNEYXRlc1xuICAgICAgICAgID8gYCR7IGRhdGEudGFibGVZZWFyIH0gJHsgbG9jYWxlTW9udGhzW2RhdGEudGFibGVNb250aCFdIH1gXG4gICAgICAgICAgOiAnJ1xuICAgIH0pXG5cbiAgICBjb25zdCBkaXNwbGF5RGF0ZSA9IGNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuICAgICAgY29uc3QgeyBtb250aCwgZGF0ZSwgZGF5IH0gPSBkYXRhLnNlbGVjdGVkIGFzIERhdGVQaWNrZXJEYXRlXG4gICAgICByZXR1cm4gYCR7IGxvY2FsZU1vbnRoc1ttb250aF0gfSAkeyBkYXRlIH0gJHsgbG9jYWxlV2Vla1tkYXldIH1gXG4gICAgfSlcblxuICAgIGNvbnN0IGNvbXB1dGVkVmFsdWUgPSBjb21wdXRlZDxzdHJpbmcgfCBudW1iZXIgfCBEYXRlPigoKSA9PiB7XG4gICAgICBjb25zdCB7IHllYXIsIG1vbnRoLCBkYXRlIH0gPSBkYXRhLnNlbGVjdGVkIGFzIERhdGVQaWNrZXJEYXRlXG4gICAgICByZXR1cm4gbmV3IERhdGUoeWVhciwgbW9udGgsIGRhdGUgYXMgbnVtYmVyKVxuICAgIH0pXG5cbiAgICBjb25zdCBzZXRJbml0RGF0ZSA9ICgpID0+IHtcbiAgICAgIGlmIChwcm9wcy52YWx1ZSkgc2V0UGFyc2VkRGF0ZShwcm9wcy52YWx1ZSlcbiAgICAgIGVsc2UgaWYgKHByb3BzLm1vZGVsVmFsdWUpIHNldFBhcnNlZERhdGUocHJvcHMubW9kZWxWYWx1ZSlcbiAgICAgIGVsc2Ugc2V0UGFyc2VkRGF0ZSgpXG5cbiAgICAgIGlmIChwcm9wcy50b2RheSB8fCBwcm9wcy52YWx1ZSB8fCBwcm9wcy5tb2RlbFZhbHVlKSB7XG4gICAgICAgIGRhdGEuY29udmVydGVkRGF0ZVN0cmluZyA9IGNvbnZlcnRUb0Zvcm1hdCgpIGFzIHN0cmluZ1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IG9uVGFibGVDaGFuZ2UgPSAoKTogdW5kZWZpbmVkIHwgYm9vbGVhbiA9PiB7XG4gICAgICBpZiAoZGF0YS5pc1llYXJzKSB7XG4gICAgICAgIGRhdGEuaXNZZWFycyA9IGZhbHNlXG4gICAgICAgIHJldHVybiAoZGF0YS5pc01vbnRocyA9IHRydWUpXG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5pc01vbnRocykge1xuICAgICAgICBkYXRhLmlzTW9udGhzID0gZmFsc2VcbiAgICAgICAgcmV0dXJuIChkYXRhLmlzWWVhcnMgPSB0cnVlKVxuICAgICAgfVxuICAgICAgaWYgKGRhdGEuaXNEYXRlcykge1xuICAgICAgICBkYXRhLmlzRGF0ZXMgPSBmYWxzZVxuICAgICAgICByZXR1cm4gKGRhdGEuaXNNb250aHMgPSB0cnVlKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgfVxuXG4gICAgY29uc3Qgc2V0RGF0YURhdGUgPSA8VCBleHRlbmRzIERhdGVQaWNrZXJEYXRlPih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHllYXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OiBUKSA9PiB7XG4gICAgICBkYXRhLnRhYmxlTW9udGggPSBtb250aFxuICAgICAgZGF0YS50YWJsZVllYXIgPSB5ZWFyXG5cbiAgICAgIGRhdGEueWVhciA9IHllYXJcbiAgICAgIGRhdGEubW9udGggPSBtb250aFxuICAgICAgZGF0YS5kYXRlID0gZGF0ZVxuICAgICAgZGF0YS5kYXkgPSBkYXlcbiAgICB9XG5cbiAgICBjb25zdCBzZXRQYXJzZWREYXRlID0gKHNlbGVjdGVkRGF0ZTogc3RyaW5nIHwgbnVsbCA9IG51bGwpID0+IHtcbiAgICAgIGNvbnN0IGRhdGVGb3JQYXJzaW5nID0gc2VsZWN0ZWREYXRlIHx8IG5ldyBEYXRlKClcblxuICAgICAgZGF0YS5zZWxlY3RlZCA9IHBhcnNlRGF0ZShkYXRlRm9yUGFyc2luZylcbiAgICAgICFzZWxlY3RlZERhdGUgJiYgKGRhdGEuc2VsZWN0ZWQhLmRlZmF1bHQgPSAhc2VsZWN0ZWREYXRlKVxuXG4gICAgICBzZXREYXRhRGF0ZShkYXRhLnNlbGVjdGVkISlcbiAgICB9XG5cbiAgICBjb25zdCBvblllYXJVcGRhdGUgPSAoeWVhcjogbnVtYmVyKSA9PiB7XG4gICAgICBkYXRhLnRhYmxlWWVhciA9IHllYXJcbiAgICAgIGRhdGEuaXNNb250aHMgPSB0cnVlXG4gICAgICBkYXRhLmlzWWVhcnMgPSBmYWxzZVxuICAgIH1cblxuICAgIGNvbnN0IG9uTW9udGhVcGRhdGUgPSAobW9udGg6IG51bWJlcikgPT4ge1xuICAgICAgZGF0YS50YWJsZU1vbnRoID0gbW9udGhcbiAgICAgIGRhdGEuaXNNb250aHMgPSBmYWxzZVxuICAgICAgZGF0YS5pc1llYXJzID0gZmFsc2VcbiAgICAgIGRhdGEuaXNEYXRlcyA9IHRydWVcbiAgICB9XG5cbiAgICBjb25zdCBvbkRhdGVVcGRhdGUgPSAoZGF0ZTogRGF0ZVBpY2tlckRhdGUpID0+IHtcbiAgICAgIGlmICghZGF0ZSkgcmV0dXJuXG5cbiAgICAgIGNsb3NlQ29uZGl0aW9uYWwudmFsdWUgPSB0cnVlXG5cbiAgICAgIGRhdGEuc2VsZWN0ZWQgPSBkYXRlXG4gICAgICBkYXRhLnRhYmxlTW9udGggPSBkYXRlLm1vbnRoXG4gICAgICBkYXRhLnRhYmxlWWVhciA9IGRhdGUueWVhclxuXG4gICAgICBkYXRhLmNvbnZlcnRlZERhdGVTdHJpbmcgPSBjb252ZXJ0VG9Gb3JtYXQoKSBhcyBzdHJpbmdcblxuICAgICAgZW1pdCgndXBkYXRlOnZhbHVlJywgY29tcHV0ZWRWYWx1ZS52YWx1ZSlcbiAgICAgIGVtaXQoJ3VwZGF0ZTptb2RlbFZhbHVlJywgY29tcHV0ZWRWYWx1ZS52YWx1ZSlcbiAgICAgIGVtaXQoJ3NlbGVjdGVkJywgY29tcHV0ZWRWYWx1ZS52YWx1ZSlcblxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IChjbG9zZUNvbmRpdGlvbmFsLnZhbHVlID0gZmFsc2UpKVxuICAgIH1cblxuICAgIGNvbnN0IG9uRGF0ZU1vbnRoVXBkYXRlID0gKGRhdGVPYmplY3QpID0+IHtcbiAgICAgIGRhdGEudGFibGVNb250aCA9IGRhdGVPYmplY3QubW9udGhcbiAgICAgIGlmIChkYXRlT2JqZWN0LnllYXIpIGRhdGEudGFibGVZZWFyID0gZGF0ZU9iamVjdC55ZWFyXG4gICAgfVxuXG4gICAgY29uc3Qgb25EYXRlSW5wdXQgPSAoZGF0ZTogc3RyaW5nKTogYW55ID0+IHtcbiAgICAgIG9uRGF0ZVVwZGF0ZShzdHJpbmdUb0RhdGUoZGF0ZSkhKVxuICAgIH1cblxuICAgIGNvbnN0IHN0cmluZ1RvRGF0ZSA9IChkYXRlOiBzdHJpbmcpOiBEYXRlUGlja2VyRGF0ZSB8IG51bGwgPT4ge1xuICAgICAgaWYgKGRhdGUubGVuZ3RoID09PSAxMCkge1xuICAgICAgICBjb25zdCBkYXRlQXJyYXkgPSBkYXRlLnRyaW0oKS5zcGxpdCgvXFxXLylcblxuICAgICAgICBpZiAoZGF0ZUFycmF5WzBdLmxlbmd0aCA8IDQpIHtcbiAgICAgICAgICBkYXRlID0gZGF0ZUFycmF5LnJldmVyc2UoKS5qb2luKCcuJylcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwYXJzZURhdGUobmV3IERhdGUoRGF0ZS5wYXJzZShkYXRlKSkpXG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIGNvbnN0IGNvbnZlcnRUb0Zvcm1hdCA9ICgpOiBzdHJpbmcgPT4ge1xuICAgICAgaWYgKCFkYXRhLnNlbGVjdGVkKSByZXR1cm4gJydcbiAgICAgIHJldHVybiBmb3JtYXREYXRlKFxuICAgICAgICBuZXcgRGF0ZShcbiAgICAgICAgICBkYXRhLnNlbGVjdGVkIS55ZWFyLFxuICAgICAgICAgIGRhdGEuc2VsZWN0ZWQhLm1vbnRoLFxuICAgICAgICAgIGRhdGEuc2VsZWN0ZWQhLmRhdGUgYXMgbnVtYmVyLFxuICAgICAgICApLFxuICAgICAgICBwcm9wcy5mb3JtYXQsXG4gICAgICAgIGxvY2FsZVtwcm9wcy5sYW5nXSxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5EaXNwbGF5VmFsdWUgPSAodmFsdWU6IHN0cmluZyB8IG51bWJlcik6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6ICd2LWRhdGUtcGlja2VyX19kaXNwbGF5LXZhbHVlJyxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHVzZVRyYW5zaXRpb24oXG4gICAgICAgIGgoJ3NwYW4nLCBwcm9wc0RhdGEsIHZhbHVlKSxcbiAgICAgICAgJ3NjYWxlLWluLW91dCcsXG4gICAgICAgICdvdXQtaW4nLFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkRhdGVwaWNrZXJEaXNwbGF5SW5uZXIgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczogJ3YtZGF0ZS1waWNrZXJfX2Rpc3BsYXktaW5uZXInLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaCgnZGl2JywgcHJvcHNEYXRhLCBbXG4gICAgICAgIGdlbkRpc3BsYXlWYWx1ZShkYXRhLnNlbGVjdGVkPy55ZWFyIGFzIG51bWJlciksXG4gICAgICAgIGdlbkRpc3BsYXlWYWx1ZShkaXNwbGF5RGF0ZS52YWx1ZSksXG4gICAgICBdKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkRhdGVwaWNrZXJEaXNwbGF5ID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1kYXRlLXBpY2tlcl9fZGlzcGxheSc6IHRydWUsXG4gICAgICAgICAgLi4uKGNvbnRlbnRDb2xvciA/IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcihjb250ZW50Q29sb3IpIDoge30pLFxuICAgICAgICAgIC4uLihwcm9wcy5jb2xvciA/IHNldFRleHRDbGFzc05hbWVDb2xvcihwcm9wcy5jb2xvcikgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgLi4uKGNvbnRlbnRDb2xvciA/IHNldEJhY2tncm91bmRDc3NDb2xvcihjb250ZW50Q29sb3IpIDoge30pLFxuICAgICAgICAgIC4uLihwcm9wcy5jb2xvciA/IHNldFRleHRDc3NDb2xvcihwcm9wcy5jb2xvcikgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCBwcm9wc0RhdGEsIGdlbkRhdGVwaWNrZXJEaXNwbGF5SW5uZXIoKSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlcGlja2VySGVhZGVyID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKFxuICAgICAgICBWRGF0ZXBpY2tlckhlYWRlcixcbiAgICAgICAge1xuICAgICAgICAgIG9uTmV4dDogKCkgPT4gaGFuZGxlcnMudmFsdWUub25OZXh0ISgpLFxuICAgICAgICAgIG9uUHJldjogKCkgPT4gaGFuZGxlcnMudmFsdWUub25QcmV2ISgpLFxuICAgICAgICAgIG9uVGFibGU6IG9uVGFibGVDaGFuZ2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWZhdWx0OiAoKSA9PiBoZWFkZXJWYWx1ZS52YWx1ZSxcbiAgICAgICAgfSxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlcGlja2VyWWVhcnNUYWJsZSA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIHllYXI6IGRhdGEudGFibGVZZWFyLFxuICAgICAgICBbJ29uVXBkYXRlOnllYXInXTogb25ZZWFyVXBkYXRlLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWRGF0ZVBpY2tlclllYXJzLCBwcm9wc0RhdGEpXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuRGF0ZXBpY2tlck1vbnRoc1RhYmxlID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKFZEYXRlUGlja2VyTW9udGhzLCB7XG4gICAgICAgIGxhbmc6IHByb3BzLmxhbmcsXG4gICAgICAgIG1vbnRoOiBkYXRhLnRhYmxlTW9udGgsXG4gICAgICAgIHllYXI6IGRhdGEudGFibGVZZWFyLFxuICAgICAgICBsb2NhbGU6IGxvY2FsZU1vbnRocyxcbiAgICAgICAgWydvblVwZGF0ZTptb250aCddOiBvbk1vbnRoVXBkYXRlLFxuICAgICAgICBbJ29uVXBkYXRlOnllYXInXTogb25ZZWFyVXBkYXRlLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlcGlja2VyRGF0ZXNUYWJsZSA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaChcbiAgICAgICAgVkRhdGVQaWNrZXJEYXRlcyxcbiAgICAgICAge1xuICAgICAgICAgIGxvY2FsZTogbG9jYWxlV2VlayxcbiAgICAgICAgICBtb25kYXlGaXJzdDogcHJvcHMubW9uZGF5Rmlyc3QsXG4gICAgICAgICAgbW9udGg6IGRhdGEudGFibGVNb250aCxcbiAgICAgICAgICB5ZWFyOiBkYXRhLnRhYmxlWWVhcixcbiAgICAgICAgICB2YWx1ZTogZGF0YS5zZWxlY3RlZCxcbiAgICAgICAgICBkaXNhYmxlZERhdGVzOiBwcm9wcy5kaXNhYmxlZERhdGVzLFxuICAgICAgICAgIFsnb25VcGRhdGU6dmFsdWUnXTogb25EYXRlVXBkYXRlLFxuICAgICAgICAgIFsnb25VcGRhdGU6bW9udGgnXTogb25EYXRlTW9udGhVcGRhdGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkYXRlOiBzbG90cy5kYXRlICYmIGFkZFNjb3BlZFNsb3QoJ2RhdGUnLCBzbG90cyksXG4gICAgICAgIH0sXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuRGF0ZXBpY2tlckJvZHkgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczoge1xuICAgICAgICAgICd2LWRhdGUtcGlja2VyX19ib2R5JzogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoXG4gICAgICAgICdkaXYnLFxuICAgICAgICBwcm9wc0RhdGEsXG4gICAgICAgIHVzZVRyYW5zaXRpb24oXG4gICAgICAgICAgKChkYXRhLmlzWWVhcnMgJiYgZ2VuRGF0ZXBpY2tlclllYXJzVGFibGUoKSkgfHxcbiAgICAgICAgICAgIChkYXRhLmlzTW9udGhzICYmIGdlbkRhdGVwaWNrZXJNb250aHNUYWJsZSgpKSB8fFxuICAgICAgICAgICAgKGRhdGEuaXNEYXRlcyAmJiBnZW5EYXRlcGlja2VyRGF0ZXNUYWJsZSgpKSkgYXMgVk5vZGUsXG4gICAgICAgICAgJ3NsaWRlLWluLWxlZnQnLFxuICAgICAgICAgICdvdXQtaW4nLFxuICAgICAgICApLFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkRhdGVwaWNrZXJJbnB1dCA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaChWVGV4dEZpZWxkLCB7XG4gICAgICAgIG1vZGVsVmFsdWU6IGRhdGEuY29udmVydGVkRGF0ZVN0cmluZyEsXG4gICAgICAgIGRhcms6IHByb3BzLmRhcmssXG4gICAgICAgIGxhYmVsOiBwcm9wcy5sYWJlbCxcbiAgICAgICAgcmVhZG9ubHk6ICFwcm9wcy50eXBlYWJsZSxcbiAgICAgICAgZGlzYWJsZWQ6IHByb3BzLmRpc2FibGVkLFxuICAgICAgICBwcmVwZW5kSWNvbjogcHJvcHMucHJlcGVuZEljb24sXG4gICAgICAgIHJ1bGVzOiBwcm9wcy5ydWxlcyxcbiAgICAgICAgY2xlYXJhYmxlOiBwcm9wcy5jbGVhcmFibGUsXG4gICAgICAgIHJlZjogYWN0aXZhdG9yLFxuICAgICAgICBvbklucHV0OiBvbkRhdGVJbnB1dCxcbiAgICAgICAgb25DbGVhcjogKCkgPT4ge1xuICAgICAgICAgIGRhdGEuY29udmVydGVkRGF0ZVN0cmluZyA9ICcnXG4gICAgICAgICAgZW1pdCgndXBkYXRlOnZhbHVlJywgbnVsbClcbiAgICAgICAgICBlbWl0KCd1cGRhdGU6bW9kZWxWYWx1ZScsIG51bGwpXG4gICAgICAgICAgZW1pdCgnc2VsZWN0ZWQnLCBudWxsKVxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlcGlja2VyVGFibGUgPSAoKTogVk5vZGUgPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczogdGFibGVDbGFzc2VzLnZhbHVlLFxuICAgICAgICBzdHlsZTogdGFibGVTdHlsZXMudmFsdWUsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCBwcm9wc0RhdGEsIFtcbiAgICAgICAgZ2VuRGF0ZXBpY2tlckRpc3BsYXkoKSxcbiAgICAgICAgZ2VuRGF0ZXBpY2tlckhlYWRlcigpLFxuICAgICAgICBnZW5EYXRlcGlja2VyQm9keSgpLFxuICAgICAgXSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5NZW51ID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIGgoXG4gICAgICAgIFZNZW51LFxuICAgICAgICB7XG4gICAgICAgICAgYWN0aXZhdG9yOiBhY3RpdmF0b3IudmFsdWUhLFxuICAgICAgICAgIGludGVybmFsQWN0aXZhdG9yOiB0cnVlLFxuICAgICAgICAgIGlucHV0QWN0aXZhdG9yOiAnLnYtaW5wdXRfX3RleHQtZmllbGQnLFxuICAgICAgICAgIHdpZHRoOiAnYXV0bycsXG4gICAgICAgICAgbWF4SGVpZ2h0OiAnYXV0bycsXG4gICAgICAgICAgYm90dG9tOiBwcm9wcy50eXBlYWJsZSxcbiAgICAgICAgICBvcGVuT25DbGljazogdHJ1ZSxcbiAgICAgICAgICBjbG9zZU9uQ2xpY2s6IGNsb3NlQ29uZGl0aW9uYWwudmFsdWUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWZhdWx0OiAoKSA9PiBnZW5EYXRlcGlja2VyVGFibGUoKSxcbiAgICAgICAgfSxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5EYXRlcGlja2VyID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IGNsYXNzZXMudmFsdWUsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCBwcm9wc0RhdGEsIFtcbiAgICAgICAgZ2VuRGF0ZXBpY2tlcklucHV0KCksXG4gICAgICAgIGFjdGl2YXRvci52YWx1ZSAmJiBnZW5NZW51KCksXG4gICAgICBdKVxuICAgIH1cblxuICAgIHNldEluaXREYXRlKClcblxuICAgIHJldHVybiAoKSA9PiBnZW5EYXRlcGlja2VyKClcbiAgfSxcbn0pXG4iXX0=