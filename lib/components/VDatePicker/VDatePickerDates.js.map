{"version":3,"sources":["../../../../src/components/VDatePicker/VDatePickerDates.ts"],"names":[],"mappings":"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","sourcesContent":["// Styles\nimport './VDatePickerDates.scss'\n\n// Vue API\nimport { h, ref, inject, computed, watch, defineComponent } from 'vue'\n\n// Helpers\nimport { genTableRows, parseDate, toDateString } from './helpers'\n\n// Effects\nimport { useTransition } from '../../effects/use-transition'\n\n// Types\nimport { VNode, Ref } from 'vue'\nimport { DatePickerBtnHandlers, DatePickerDate } from '../../types'\n\ntype UpdateParams = {\n  month?: number\n  year?: number\n}\n\nexport const VDatePickerDates = defineComponent({\n  name: 'v-date-picker-dates',\n\n  props: {\n    locale: Array,\n    year: [String, Number],\n    month: [String, Number],\n    date: [String, Number],\n    value: Object,\n    mondayFirst: Boolean,\n    disabledDates: Object\n  } as any,\n\n  emits: ['update:month', 'update:value'],\n\n  setup(props, { emit }): () => VNode {\n    const FIRST_MONTH = 0\n    const LAST_MONTH = 11\n    const DAYS = [0, 1, 2, 3, 4, 5, 6]\n    const ANIMATION_TIMEOUT = 0\n\n    const dates = ref<(DatePickerDate | null)[]>([])\n    const isDatesChanged = ref<boolean>(false)\n    const today = parseDate(new Date())\n\n    const handlers = inject('handlers') as Ref<DatePickerBtnHandlers>\n\n    handlers.value = {\n      onNext: () => updateMonth(true),\n      onPrev: () => updateMonth(false)\n    }\n\n    if (props.mondayFirst) {\n      DAYS.push(DAYS.splice(0, 1)[0])\n    }\n\n    const daysInMonth = computed<number>(() => {\n      return new Date(props.year, props.month + 1, 0).getDate()\n    })\n\n    watch(\n      () => props.month,\n      () => genTableDates(),\n      { immediate: true }\n    )\n\n    watch(\n      () => isDatesChanged.value,\n      () =>\n        setTimeout(() => {\n          isDatesChanged.value = false\n        }, ANIMATION_TIMEOUT)\n    )\n\n    function updateMonth(isNext: boolean) {\n      const params: UpdateParams = {}\n\n      params.month = props.month + (isNext ? 1 : -1)\n\n      if (!isNext && params.month! < FIRST_MONTH) params.month = LAST_MONTH\n      if (isNext && params.month! > LAST_MONTH) params.month = FIRST_MONTH\n      if (isNext && !params.month) params.year = props.year + 1\n      if (!isNext && params.month === LAST_MONTH) params.year = props.year - 1\n\n      isDatesChanged.value = true\n      emit('update:month', params)\n    }\n\n    function genWeekDays(): VNode[] {\n      const propsData = {\n        class: 'v-date-picker-dates__day'\n      }\n\n      return DAYS.map((day) =>\n        h('span', propsData, props.locale![day] as string)\n      )\n    }\n\n    function genDateObject(date): DatePickerDate {\n      const { year, month } = props\n      return parseDate(new Date(year, month, date))\n    }\n\n    function setEmptiesBeforeFirstDate(dateObject) {\n      const firstDay = DAYS[0]\n\n      const startDay = firstDay && !dateObject.day ? dateObject.day : firstDay\n\n      const tillDay =\n        firstDay && !dateObject.day ? DAYS.length - 1 : dateObject.day\n\n      for (let i = startDay; i <= tillDay; i += 1) {\n        dates.value[i] = { date: null } as any\n      }\n\n      dates.value[tillDay] = dateObject\n    }\n\n    function genTableDates() {\n      dates.value = []\n      for (let i = 1; i <= daysInMonth.value; i += 1) {\n        const dateObject = genDateObject(i)\n        if (i === 1) {\n          setEmptiesBeforeFirstDate(dateObject)\n        } else {\n          dates.value[dates.value.length] = dateObject as any\n        }\n      }\n    }\n\n    function compareDates(date1, date2) {\n      return (\n        date1.date === date2.date &&\n        date1.month === date2.month &&\n        date1.year === date2.year\n      )\n    }\n\n    function setDisabled(date: DatePickerDate): boolean {\n      if (!date.date) return false\n      if (!props.disabledDates) return !!date.isHoliday\n      const { disabledDates } = props\n\n      return (\n        (disabledDates.daysOfMonth && disableDaysOfMonth(date)) ||\n        (disabledDates.from && disableFromTo(date, disabledDates)) ||\n        (disabledDates.dates && disableDates(date)) ||\n        (disabledDates.days && disableDays(date)) ||\n        (disabledDates.ranges && disableRanges(date)) ||\n        (disabledDates.custom && disabledDates.custom(date))\n      )\n    }\n\n    function disableFromTo(date: DatePickerDate, { from, to }): boolean {\n      const dateFrom: DatePickerDate = parseDate(from)\n      const dateTo: DatePickerDate = parseDate(to)\n\n      return (\n        date.mls >= dateFrom.mls &&\n        date.mls <= dateTo.mls\n      )\n    }\n\n    function disableDaysOfMonth(date: DatePickerDate) {\n      return !!props.disabledDates.daysOfMonth.find((it) => it === date.date)\n    }\n\n    function disableDates(date: DatePickerDate): boolean {\n      return props.disabledDates.dates.find((d) => {\n        return String(d) === String(toDateString(date))\n      })\n    }\n\n    function disableDays(date: DatePickerDate): boolean {\n      return props.disabledDates.days.find((d) => d === date.day) >= 0\n    }\n\n    function disableRanges(date: DatePickerDate) {\n      const { ranges } = props.disabledDates\n\n      for (let i = 0; i < ranges.length; i += 1) {\n        if (disableFromTo(date, ranges[i])) return true\n      }\n    }\n\n    function genDateCell(date: DatePickerDate): VNode {\n      const isSelected: boolean = compareDates(date, props.value)\n      const isToday: boolean = compareDates(date, today)\n\n      date.isHoliday = setDisabled(date)\n\n      const propsData = {\n        class: {\n          'v-date-picker-dates__cell': !!date.date,\n          'v-date-picker-dates__cell--empty': !date.date,\n          'v-date-picker-dates__cell--selected': isSelected,\n          'v-date-picker-dates__cell--current-date': isToday,\n          'v-date-picker-dates__cell--holiday': date.date && date.isHoliday\n        },\n        onClick: () => date.date && emit('update:value', date)\n      }\n\n      return h('div', propsData, date.date as number)\n    }\n\n    function genDateCells(): VNode[] {\n      return dates.value.reduce((acc, dateObject) => {\n        acc.push(genDateCell(dateObject!))\n        return acc\n      }, [] as VNode[])\n    }\n\n    function genDateRows(): VNode[] {\n      const datesVNodes = genDateCells()\n\n      return genTableRows(datesVNodes, 'v-date-picker-dates__row', DAYS.length)\n    }\n\n    function genDates(): VNode | null {\n      return (\n        (!isDatesChanged.value &&\n          h('div', { class: 'v-date-picker-dates__dates' }, genDateRows())) ||\n        null\n      )\n    }\n\n    function genWeek(): VNode {\n      return h('div', { class: 'v-date-picker-dates__week' }, genWeekDays())\n    }\n\n    return () =>\n      h('div', { class: 'v-date-picker-dates' }, [\n        genWeek(),\n        useTransition(genDates() as any, 'fade')\n      ])\n  }\n})\n"],"sourceRoot":"","file":"VDatePickerDates.js"}