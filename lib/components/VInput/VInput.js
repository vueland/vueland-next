import { defineComponent, h, watch, inject, computed, onBeforeMount, onBeforeUnmount, } from 'vue';
import { useValidation, validationProps } from '../../composable/use-validation';
import { useColors, colorProps } from '../../composable/use-colors';
import { useInputStates } from '../../composable/use-input-states';
import { useTransition } from '../../composable/use-transition';
import { VLabel } from '../VLabel';
import { VIcon } from '../VIcon';
export default defineComponent({
    name: 'v-input',
    components: {
        VLabel,
        VIcon,
    },
    inheritAttrs: false,
    props: {
        label: {
            type: String,
            default: '',
        },
        prependIcon: {
            type: String,
            default: '',
        },
        appendIcon: {
            type: String,
            default: '',
        },
        disabled: Boolean,
        focused: Boolean,
        readonly: Boolean,
        file: Boolean,
        hints: {
            type: Boolean,
            default: true,
        },
        hintMessage: {
            type: String,
            default: '',
        },
        textColor: {
            type: String,
            default: '',
        },
        ...validationProps(),
        ...colorProps(),
    },
    setup(props, { attrs, emit, slots }) {
        const { validate, errorState } = useValidation(props);
        const { setTextCssColor, setTextClassNameColor } = useColors();
        const { isDisabled, isReadonly } = useInputStates(props, { attrs, emit });
        const form = inject('form', null);
        const textClassColor = setTextClassNameColor(props.textColor);
        const textCssColor = setTextCssColor(props.textColor);
        const hasPrependIcon = computed(() => {
            return !!props.prependIcon || !!slots['prepend-icon'];
        });
        const hasAppendIcon = computed(() => {
            return !!props.appendIcon || !!slots['append-icon'];
        });
        const classes = computed(() => ({
            'v-input': true,
            'v-input--primary': !props.color && !errorState.innerError,
            'v-input--focused': props.focused && !isReadonly.value,
            'v-input--disabled': isDisabled.value,
            'v-input--readonly': isReadonly.value,
            'v-input--file': props.file,
            'v-input--has-prepend-icon': hasPrependIcon.value,
            'v-input--has-append-icon': hasAppendIcon.value,
            'v-input--not-valid': !!errorState.innerError,
            ...(!props.disabled && !errorState.innerError ? setTextClassNameColor(props.color) : {}),
            ...attrs.class,
        }));
        const styles = computed(() => ({
            ...(!props.disabled && !errorState.innerError ? setTextCssColor(props.color) : {}),
            ...attrs.style,
        }));
        watch(() => props.focused, (to) => !to && validate());
        watch(() => props.value, () => validate());
        const genLabel = () => {
            const label = h(VLabel, {
                class: 'v-label--on-input',
                disabled: isDisabled.value,
                focused: props.focused,
                color: !errorState.innerError ? props.color : '',
            }, {
                default: () => props.label,
            });
            return h('div', { class: 'v-input__label' }, [label]);
        };
        const genIcon = (iconName, clickable = false) => {
            return h(VIcon, {
                icon: iconName,
                size: 16,
                disabled: props.disabled,
                clickable,
            });
        };
        const genPrependIcon = () => {
            let content;
            if (props.prependIcon) {
                content = genIcon(props.prependIcon);
            }
            else {
                content = slots['prepend-icon']?.();
            }
            return content ?
                h('div', { class: 'v-input__prepend-icon' }, content)
                : null;
        };
        const genAppendIcon = () => {
            let content;
            if (props.appendIcon) {
                content = genIcon(props.appendIcon);
            }
            else {
                content = slots['append-icon']?.();
            }
            return content ?
                h('div', { class: 'v-input__append-icon' }, content)
                : null;
        };
        const genTextFieldSlot = () => {
            const prependIconContent = genPrependIcon();
            const appendIconContent = genAppendIcon();
            const { disabled } = props;
            const textFieldContent = slots['text-field']?.({
                textCssColor,
                textClassColor,
                disabled,
            });
            return h('div', { class: 'v-input__text-field' }, [prependIconContent, textFieldContent, appendIconContent]);
        };
        const genHintMessage = () => {
            return !!errorState.innerErrorMessage ? h('span', { class: 'v-input__hints-message' }, [errorState.innerErrorMessage]) : null;
        };
        const genHints = () => {
            return h('div', { class: 'v-input__hints' }, useTransition(genHintMessage(), 'fade'));
        };
        const genSelectSlot = () => {
            return slots.select ?
                h('div', { class: 'v-input__selects' }, slots.select?.())
                : null;
        };
        onBeforeMount(() => {
            if (props.rules)
                form?.add(validate);
        });
        onBeforeUnmount(() => {
            form?.remove(validate);
        });
        return () => h('div', { class: classes.value, style: styles.value }, [
            genLabel(),
            genTextFieldSlot(),
            genHints(),
            genSelectSlot(),
        ]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVklucHV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVklucHV0L1ZJbnB1dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0wsZUFBZSxFQUNmLENBQUMsRUFDRCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFFBQVEsRUFDUixhQUFhLEVBQ2IsZUFBZSxHQUVoQixNQUFNLEtBQUssQ0FBQTtBQUdaLE9BQU8sRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFFLE1BQU0saUNBQWlDLENBQUE7QUFDaEYsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUNuRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sbUNBQW1DLENBQUE7QUFDbEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlDQUFpQyxDQUFBO0FBRy9ELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFDbEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQVNoQyxlQUFlLGVBQWUsQ0FBQztJQUM3QixJQUFJLEVBQUUsU0FBUztJQUNmLFVBQVUsRUFBRTtRQUNWLE1BQU07UUFDTixLQUFLO0tBQ047SUFDRCxZQUFZLEVBQUUsS0FBSztJQUNuQixLQUFLLEVBQUU7UUFDTCxLQUFLLEVBQUU7WUFDTCxJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxXQUFXLEVBQUU7WUFDWCxJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxVQUFVLEVBQUU7WUFDVixJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxRQUFRLEVBQUUsT0FBTztRQUNqQixPQUFPLEVBQUUsT0FBTztRQUNoQixRQUFRLEVBQUUsT0FBTztRQUNqQixJQUFJLEVBQUUsT0FBTztRQUNiLEtBQUssRUFBRTtZ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RUFBRSxFQUNqRTtZQUNFLFFBQVEsRUFBRTtZQUNWLGdCQUFnQixFQUFFO1lBQ2xCLFFBQVEsRUFBRTtZQUNWLGFBQWEsRUFBRTtTQUNoQixDQUNGLENBQUE7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVnVlIEFQSVxuaW1wb3J0IHtcbiAgZGVmaW5lQ29tcG9uZW50LFxuICBoLFxuICB3YXRjaCxcbiAgaW5qZWN0LFxuICBjb21wdXRlZCxcbiAgb25CZWZvcmVNb3VudCxcbiAgb25CZWZvcmVVbm1vdW50LFxuICBWTm9kZSxcbn0gZnJvbSAndnVlJ1xuXG4vLyBDb21wb3NhYmxlXG5pbXBvcnQgeyB1c2VWYWxpZGF0aW9uLCB2YWxpZGF0aW9uUHJvcHMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS12YWxpZGF0aW9uJ1xuaW1wb3J0IHsgdXNlQ29sb3JzLCBjb2xvclByb3BzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtY29sb3JzJ1xuaW1wb3J0IHsgdXNlSW5wdXRTdGF0ZXMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS1pbnB1dC1zdGF0ZXMnXG5pbXBvcnQgeyB1c2VUcmFuc2l0aW9uIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtdHJhbnNpdGlvbidcblxuLy8gQ29tcG9uZW50c1xuaW1wb3J0IHsgVkxhYmVsIH0gZnJvbSAnLi4vVkxhYmVsJ1xuaW1wb3J0IHsgVkljb24gfSBmcm9tICcuLi9WSWNvbidcblxuaW1wb3J0IHsgTWF5YmUgfSBmcm9tICcuLi8uLi8uLi90eXBlcy9iYXNlJ1xuXG50eXBlIEZvcm0gPSB7XG4gIGFkZDogKGl0ZW06ICh2YWw/OiBhbnkpID0+IGJvb2xlYW4gfCB2b2lkKSA9PiB2b2lkXG4gIHJlbW92ZTogKGl0ZW06ICh2YWw/OiBhbnkpID0+IGJvb2xlYW4gfCB2b2lkKSA9PiB2b2lkXG59XG5cbmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LWlucHV0JyxcbiAgY29tcG9uZW50czoge1xuICAgIFZMYWJlbCxcbiAgICBWSWNvbixcbiAgfSxcbiAgaW5oZXJpdEF0dHJzOiBmYWxzZSxcbiAgcHJvcHM6IHtcbiAgICBsYWJlbDoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJycsXG4gICAgfSxcbiAgICBwcmVwZW5kSWNvbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJycsXG4gICAgfSxcbiAgICBhcHBlbmRJY29uOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJyxcbiAgICB9LFxuICAgIGRpc2FibGVkOiBCb29sZWFuLFxuICAgIGZvY3VzZWQ6IEJvb2xlYW4sXG4gICAgcmVhZG9ubHk6IEJvb2xlYW4sXG4gICAgZmlsZTogQm9vbGVhbixcbiAgICBoaW50czoge1xuICAgICAgdHlwZTogQm9vbGVhbixcbiAgICAgIGRlZmF1bHQ6IHRydWUsXG4gICAgfSxcbiAgICBoaW50TWVzc2FnZToge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJycsXG4gICAgfSxcbiAgICB0ZXh0Q29sb3I6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcnLFxuICAgIH0sXG4gICAgLi4udmFsaWRhdGlvblByb3BzKCksXG4gICAgLi4uY29sb3JQcm9wcygpLFxuICB9LFxuXG4gIHNldHVwKHByb3BzLCB7IGF0dHJzLCBlbWl0LCBzbG90cyB9KSB7XG4gICAgY29uc3QgeyB2YWxpZGF0ZSwgZXJyb3JTdGF0ZSB9ID0gdXNlVmFsaWRhdGlvbihwcm9wcylcbiAgICBjb25zdCB7IHNldFRleHRDc3NDb2xvciwgc2V0VGV4dENsYXNzTmFtZUNvbG9yIH0gPSB1c2VDb2xvcnMoKVxuICAgIGNvbnN0IHsgaXNEaXNhYmxlZCwgaXNSZWFkb25seSB9ID0gdXNlSW5wdXRTdGF0ZXMocHJvcHMsIHsgYXR0cnMsIGVtaXQgfSlcblxuICAgIGNvbnN0IGZvcm06IE1heWJlPEZvcm0+ID0gaW5qZWN0KCdmb3JtJywgbnVsbCBhcyBhbnkpXG5cbiAgICBjb25zdCB0ZXh0Q2xhc3NDb2xvciA9IHNldFRleHRDbGFzc05hbWVDb2xvcihwcm9wcy50ZXh0Q29sb3IpXG4gICAgY29uc3QgdGV4dENzc0NvbG9yID0gc2V0VGV4dENzc0NvbG9yKHByb3BzLnRleHRDb2xvcilcblxuICAgIGNvbnN0IGhhc1ByZXBlbmRJY29uID0gY29tcHV0ZWQ8Ym9vbGVhbj4oKCkgPT4ge1xuICAgICAgcmV0dXJuICEhcHJvcHMucHJlcGVuZEljb24gfHwgISFzbG90c1sncHJlcGVuZC1pY29uJ11cbiAgICB9KVxuXG4gICAgY29uc3QgaGFzQXBwZW5kSWNvbiA9IGNvbXB1dGVkPGJvb2xlYW4+KCgpID0+IHtcbiAgICAgIHJldHVybiAhIXByb3BzLmFwcGVuZEljb24gfHwgISFzbG90c1snYXBwZW5kLWljb24nXVxuICAgIH0pXG5cbiAgICBjb25zdCBjbGFzc2VzID0gY29tcHV0ZWQ8UmVjb3JkPHN0cmluZywgYm9vbGVhbj4+KCgpID0+ICh7XG4gICAgICAndi1pbnB1dCc6IHRydWUsXG4gICAgICAndi1pbnB1dC0tcHJpbWFyeSc6ICFwcm9wcy5jb2xvciAmJiAhZXJyb3JTdGF0ZS5pbm5lckVycm9yLFxuICAgICAgJ3YtaW5wdXQtLWZvY3VzZWQnOiBwcm9wcy5mb2N1c2VkICYmICFpc1JlYWRvbmx5LnZhbHVlLFxuICAgICAgJ3YtaW5wdXQtLWRpc2FibGVkJzogaXNEaXNhYmxlZC52YWx1ZSxcbiAgICAgICd2LWlucHV0LS1yZWFkb25seSc6IGlzUmVhZG9ubHkudmFsdWUsXG4gICAgICAndi1pbnB1dC0tZmlsZSc6IHByb3BzLmZpbGUsXG4gICAgICAndi1pbnB1dC0taGFzLXByZXBlbmQtaWNvbic6IGhhc1ByZXBlbmRJY29uLnZhbHVlLFxuICAgICAgJ3YtaW5wdXQtLWhhcy1hcHBlbmQtaWNvbic6IGhhc0FwcGVuZEljb24udmFsdWUsXG4gICAgICAndi1pbnB1dC0tbm90LXZhbGlkJzogISFlcnJvclN0YXRlLmlubmVyRXJyb3IsXG4gICAgICAuLi4oIXByb3BzLmRpc2FibGVkICYmICFlcnJvclN0YXRlLmlubmVyRXJyb3IgPyBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IocHJvcHMuY29sb3IpIDoge30pLFxuICAgICAgLi4uKGF0dHJzLmNsYXNzIGFzIG9iamVjdCksXG4gICAgfSkpXG5cbiAgICBjb25zdCBzdHlsZXMgPSBjb21wdXRlZDxSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+PigoKSA9PiAoe1xuICAgICAgLi4uKCFwcm9wcy5kaXNhYmxlZCAmJiAhZXJyb3JTdGF0ZS5pbm5lckVycm9yID8gc2V0VGV4dENzc0NvbG9yKHByb3BzLmNvbG9yKSA6IHt9KSxcbiAgICAgIC4uLihhdHRycy5zdHlsZSBhcyBvYmplY3QpLFxuICAgIH0pKVxuXG4gICAgd2F0Y2goXG4gICAgICAoKSA9PiBwcm9wcy5mb2N1c2VkLFxuICAgICAgKHRvKSA9PiAhdG8gJiYgdmFsaWRhdGUoKSxcbiAgICApXG5cbiAgICB3YXRjaChcbiAgICAgICgpID0+IHByb3BzLnZhbHVlLFxuICAgICAgKCkgPT4gdmFsaWRhdGUoKSxcbiAgICApXG5cbiAgICBjb25zdCBnZW5MYWJlbCA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBsYWJlbCA9IGgoVkxhYmVsLCB7XG4gICAgICAgICAgY2xhc3M6ICd2LWxhYmVsLS1vbi1pbnB1dCcsXG4gICAgICAgICAgZGlzYWJsZWQ6IGlzRGlzYWJsZWQudmFsdWUsXG4gICAgICAgICAgZm9jdXNlZDogcHJvcHMuZm9jdXNlZCxcbiAgICAgICAgICBjb2xvcjogIWVycm9yU3RhdGUuaW5uZXJFcnJvciA/IHByb3BzLmNvbG9yIDogJycsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWZhdWx0OiAoKSA9PiBwcm9wcy5sYWJlbCxcbiAgICAgICAgfSxcbiAgICAgIClcblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWlucHV0X19sYWJlbCcgfSwgW2xhYmVsXSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5JY29uID0gKGljb25OYW1lLCBjbGlja2FibGUgPSBmYWxzZSk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKFZJY29uLCB7XG4gICAgICAgIGljb246IGljb25OYW1lLFxuICAgICAgICBzaXplOiAxNixcbiAgICAgICAgZGlzYWJsZWQ6IHByb3BzLmRpc2FibGVkLFxuICAgICAgICBjbGlja2FibGUsXG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGdlblByZXBlbmRJY29uID0gKCk6IE1heWJlPFZOb2RlPiA9PiB7XG4gICAgICBsZXQgY29udGVudFxuXG4gICAgICBpZiAocHJvcHMucHJlcGVuZEljb24pIHtcbiAgICAgICAgY29udGVudCA9IGdlbkljb24ocHJvcHMucHJlcGVuZEljb24pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250ZW50ID0gc2xvdHNbJ3ByZXBlbmQtaWNvbiddPy4oKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gY29udGVudCA/XG4gICAgICAgIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWlucHV0X19wcmVwZW5kLWljb24nIH0sIGNvbnRlbnQpXG4gICAgICAgIDogbnVsbFxuICAgIH1cblxuICAgIGNvbnN0IGdlbkFwcGVuZEljb24gPSAoKTogTWF5YmU8Vk5vZGU+ID0+IHtcbiAgICAgIGxldCBjb250ZW50XG5cbiAgICAgIGlmIChwcm9wcy5hcHBlbmRJY29uKSB7XG4gICAgICAgIGNvbnRlbnQgPSBnZW5JY29uKHByb3BzLmFwcGVuZEljb24pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250ZW50ID0gc2xvdHNbJ2FwcGVuZC1pY29uJ10/LigpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjb250ZW50ID9cbiAgICAgICAgaCgnZGl2JywgeyBjbGFzczogJ3YtaW5wdXRfX2FwcGVuZC1pY29uJyB9LCBjb250ZW50KVxuICAgICAgICA6IG51bGxcbiAgICB9XG5cbiAgICBjb25zdCBnZW5UZXh0RmllbGRTbG90ID0gKCkgPT4ge1xuICAgICAgY29uc3QgcHJlcGVuZEljb25Db250ZW50ID0gZ2VuUHJlcGVuZEljb24oKVxuICAgICAgY29uc3QgYXBwZW5kSWNvbkNvbnRlbnQgPSBnZW5BcHBlbmRJY29uKClcbiAgICAgIGNvbnN0IHsgZGlzYWJsZWQgfSA9IHByb3BzXG5cbiAgICAgIGNvbnN0IHRleHRGaWVsZENvbnRlbnQgPSBzbG90c1sndGV4dC1maWVsZCddPy4oe1xuICAgICAgICB0ZXh0Q3NzQ29sb3IsXG4gICAgICAgIHRleHRDbGFzc0NvbG9yLFxuICAgICAgICBkaXNhYmxlZCxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCB7IGNsYXNzOiAndi1pbnB1dF9fdGV4dC1maWVsZCcgfSxcbiAgICAgICAgW3ByZXBlbmRJY29uQ29udGVudCwgdGV4dEZpZWxkQ29udGVudCwgYXBwZW5kSWNvbkNvbnRlbnRdLFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlbkhpbnRNZXNzYWdlID0gKCk6IE1heWJlPFZOb2RlPiA9PiB7XG4gICAgICByZXR1cm4gISFlcnJvclN0YXRlLmlubmVyRXJyb3JNZXNzYWdlID8gaChcbiAgICAgICAgJ3NwYW4nLFxuICAgICAgICB7IGNsYXNzOiAndi1pbnB1dF9faGludHMtbWVzc2FnZScgfSxcbiAgICAgICAgW2Vycm9yU3RhdGUuaW5uZXJFcnJvck1lc3NhZ2VdLFxuICAgICAgKSA6IG51bGxcbiAgICB9XG5cbiAgICBjb25zdCBnZW5IaW50cyA9ICgpOiBNYXliZTxWTm9kZT4gPT4ge1xuICAgICAgcmV0dXJuIGgoXG4gICAgICAgICdkaXYnLFxuICAgICAgICB7IGNsYXNzOiAndi1pbnB1dF9faGludHMnIH0sXG4gICAgICAgIHVzZVRyYW5zaXRpb24oZ2VuSGludE1lc3NhZ2UoKSEsICdmYWRlJyksXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuU2VsZWN0U2xvdCA9ICgpOiBNYXliZTxWTm9kZT4gPT4ge1xuICAgICAgcmV0dXJuIHNsb3RzLnNlbGVjdCA/XG4gICAgICAgIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWlucHV0X19zZWxlY3RzJyB9LCBzbG90cy5zZWxlY3Q/LigpKVxuICAgICAgICA6IG51bGxcbiAgICB9XG5cbiAgICBvbkJlZm9yZU1vdW50KCgpID0+IHtcbiAgICAgIGlmIChwcm9wcy5ydWxlcykgZm9ybT8uYWRkKHZhbGlkYXRlKVxuICAgIH0pXG5cbiAgICBvbkJlZm9yZVVubW91bnQoKCkgPT4ge1xuICAgICAgZm9ybT8ucmVtb3ZlKHZhbGlkYXRlKVxuICAgIH0pXG5cbiAgICByZXR1cm4gKCkgPT4gaCgnZGl2JywgeyBjbGFzczogY2xhc3Nlcy52YWx1ZSwgc3R5bGU6IHN0eWxlcy52YWx1ZSB9LFxuICAgICAgW1xuICAgICAgICBnZW5MYWJlbCgpLFxuICAgICAgICBnZW5UZXh0RmllbGRTbG90KCksXG4gICAgICAgIGdlbkhpbnRzKCksXG4gICAgICAgIGdlblNlbGVjdFNsb3QoKSxcbiAgICAgIF0sXG4gICAgKVxuICB9LFxufSlcbiJdfQ==