{"version":3,"sources":["../../../../src/components/VAutocomplete/VAutocomplete.ts"],"names":[],"mappings":";;;;;;;AACA;;AAGA;;AAaA;;AACA;;AAMA;;AACA;;AAGA;;;;;;;;AAQO,IAAM,aAAa,GAAG,0BAAgB;AAC3C,EAAA,IAAI,EAAE,UADqC;AAG3C,EAAA,KAAK,EAAE,CACL,OADK,EAEL,MAFK,EAGL,OAHK,EAIL,QAJK,EAKL,mBALK,EAML,cANK,CAHoC;AAY3C,EAAA,KAAK;AACH,IAAA,KAAK,EAAE,MADJ;AAEH,IAAA,KAAK,EAAE,KAFJ;AAGH,IAAA,IAAI,EAAE,OAHH;AAIH,IAAA,QAAQ,EAAE,MAJP;AAKH,IAAA,KAAK,EAAE,MALJ;AAMH,IAAA,SAAS,EAAE,MANR;AAOH,IAAA,QAAQ,EAAE,OAPP;AAQH,IAAA,UAAU,EAAE,CAAC,KAAD,EAAQ,MAAR,EAAgB,MAAhB,EAAwB,MAAxB;AART,KASA,kCATA,GAUA,6BAVA,CAZsC;AAyB3C,EAAA,KAzB2C,iBAyBrC,KAzBqC,QAyBtB;AAAA;;AAAA,QAAN,IAAM,QAAN,IAAM;AACnB,QAAM,KAAK,GAAgB,mBAAS;AAClC,MAAA,QAAQ,EAAE,IADwB;AAElC,MAAA,OAAO,EAAE,KAFyB;AAGlC,MAAA,YAAY,EAAE;AAHoB,KAAT,CAA3B;;AADmB,qBAOM,4BAPN;AAAA,QAOX,YAPW,cAOX,YAPW;;AASnB,QAAM,gBAAgB,GAAG,cAAI,IAAJ,CAAzB;;AATmB,uBAkBf,+BAAY,KAAZ,CAlBe;AAAA,QAYjB,QAZiB,gBAYjB,QAZiB;AAAA,QAajB,KAbiB,gBAajB,KAbiB;AAAA,QAcjB,MAdiB,gBAcjB,MAdiB;AAAA,QAejB,UAfiB,gBAejB,UAfiB;AAAA,QAgBjB,eAhBiB,gBAgBjB,eAhBiB;AAAA,QAiBjB,eAjBiB,gBAiBjB,eAjBiB;;AAoBnB,QAAM,MAAM,GAA2B,KAAK,CAAC,KAAN,IAAe,iBAAO,QAAP,CAAtD;AAEA,QAAM,SAAS,GAAG,mBAAS,YAAK;AAC9B,aAAO,KAAK,CAAC,YAAN,IAAsB,CAAC,KAAK,CAAC,OAA7B,GACH;AACA,QAAA,OAAO,EAAE,mBADT;AAEA,QAAA,gBAAgB,EAAE;AAFlB,OADG,GAKH,SALJ;AAMD,KAPiB,CAAlB;AASA,QAAM,OAAO,GAAG,mBAAkC;AAAA;AAChD,0BAAkB,IAD8B;AAEhD,oCAA4B,KAAK,CAAC,QAFc;AAGhD,mCAA2B,KAAK,CAAC;AAHe,SAI7C,eAAe,CAAC,KAJ6B;AAAA,KAAlC,CAAhB;AAOA,QAAM,kBAAkB,GAAG,mBAAiB,YAAK;AAC/C,aAAO,KAAK,CAAC,QAAN,GAAiB,KAAK,CAAC,QAAN,GACtB,KAAK,CAAC,QAAN,CAAe,KAAK,CAAC,QAArB,CADsB,GACW,KAAK,CAAC,QADlC,GAC6C,EADpD;AAED,KAH0B,CAA3B;AAKA,QAAM,aAAa,GAAG,mBAAS,YAAK;AAClC,aAAO,KAAK,CAAC,UAAN,IAAoB,KAAK,CAAC,KAAjC;AACD,KAFqB,CAAtB;AAIA,oBACE;AAAA,aAAM,aAAa,CAAC,KAApB;AAAA,KADF,EAEE,UAAA,KAAK,EAAG;AAAA;;AACN,MAAA,KAAK,CAAC,QAAN,GAAiB,KAAjB;AACA,OAAC,KAAK,CAAC,OAAP,IACA,UAAU,CAAC,OADX,qBAEA,KAAK,CAAC,KAFN,iDAEA,aAAa,MAFb,KAGA,aAAa,EAHb;AAID,KARH,EAQK;AAAE,MAAA,SAAS,EAAE;AAAb,KARL;;AAWA,QAAI,MAAM,SAAN,IAAA,MAAM,WAAN,IAAA,MAAM,CAAE,KAAR,qBAAiB,KAAK,CAAC,KAAvB,0CAAiB,cAAa,MAAlC,EAA0C;AACxC,MAAA,MAAM,CAAC,KAAP,CAAa,IAAb,CAAkB,aAAlB;AACD;;AAED,aAAS,aAAT,GAAsB;AAAA;;AACpB,aAAO,kBAAA,KAAK,CAAC,KAAN,gEAAa,MAAb,KAAuB,QAAQ,CACpC,kBAAkB,CAAC,KADiB,CAAtC;AAGD;;AAED,aAAS,mBAAT,GAA4B;AAC1B,MAAA,KAAK,CAAC,OAAN,GAAgB,KAAhB;AACA,MAAA,KAAK,CAAC,YAAN,GAAqB,KAArB;AACA,MAAA,qBAAqB,CAAC,aAAD,CAArB;AACD;;AAED,aAAS,OAAT,GAAgB;AACd,MAAA,KAAK,CAAC,YAAN,GAAqB,IAArB;AACA,MAAA,KAAK;AACL,MAAA,MAAM,CAAC,UAAU,CAAC,UAAZ,CAAN;AACD;;AAED,aAAS,OAAT,GAAgB;AACd,MAAA,KAAK,CAAC,OAAN,GAAgB,IAAhB;AACA,MAAA,IAAI,CAAC,OAAD,CAAJ;AACD;;AAED,aAAS,MAAT,GAAe;AACb,MAAA,KAAK,CAAC,OAAN,GAAgB,KAAhB;AACA,MAAA,IAAI,CAAC,MAAD,CAAJ;AACD;;AAED,aAAS,OAAT,CAAiB,CAAjB,EAAkB;AAChB,MAAA,eAAe,CAAC,CAAC,CAAC,MAAF,CAAS,KAAV,CAAf;AACA,MAAA,IAAI,CAAC,OAAD,EAAU,KAAK,CAAC,QAAhB,CAAJ;AACD;;AAED,aAAS,OAAT,GAAgB;AACd,MAAA,eAAe,CAAC,EAAD,CAAf;AACA,MAAA,qBAAqB,CAAC,aAAD,CAArB;AACD;;AAED,aAAS,UAAT,CAAoB,EAApB,EAAsB;AACpB,MAAA,KAAK,CAAC,QAAN,GAAiB,EAAjB;AACA,MAAA,IAAI,CAAC,QAAD,EAAW,EAAX,CAAJ;AACA,MAAA,IAAI,CAAC,mBAAD,EAAsB,EAAtB,CAAJ;AACA,MAAA,IAAI,CAAC,cAAD,EAAiB,EAAjB,CAAJ;AACD;;AAED,aAAS,eAAT,CAAyB,KAAzB,EAA8B;AAC5B,UAAI,KAAK,CAAC,QAAN,IAAkB,KAAK,CAAC,QAA5B,EAAsC;AACpC,QAAA,KAAK,CAAC,QAAN,CAAe,KAAK,CAAC,QAArB,IAAiC,KAAjC;AACD,OAFD,MAEO;AACL,QAAA,KAAK,CAAC,QAAN,GAAiB,KAAjB;AACD;;AACD,MAAA,IAAI,CAAC,mBAAD,EAAsB,KAAK,CAAC,QAA5B,CAAJ;AACA,MAAA,IAAI,CAAC,cAAD,EAAiB,KAAK,CAAC,QAAvB,CAAJ;AACD;;AAED,aAAS,QAAT,GAAiB;AAEf,UAAM,KAAK,GAAG,KAAK,CAAC,IAAN,GAAa,OAAb,GAAuB,EAArC;AAEA,UAAM,SAAS,GAAG;AAChB,QAAA,KAAK,EAAE,kBAAkB,CAAC,KADV;AAEhB,QAAA,QAAQ,EAAE,KAAK,CAAC,QAFA;AAGhB,QAAA,QAAQ,EAAE,KAAK,CAAC,QAAN,IAAkB,CAAC,KAAK,CAAC,QAHnB;AAIhB,QAAA,GAAG,EAAE,gBAJW;AAKhB,iBAAO;AACL,mCAAyB;AADpB,SALS;AAQhB,QAAA,OAAO,EAAP,OARgB;AAShB,QAAA,OAAO,EAAP,OATgB;AAUhB,QAAA,OAAO,EAAP,OAVgB;AAWhB,QAAA,MAAM,EAAN;AAXgB,OAAlB;AAcA,aAAO,YAAE,OAAF,EAAW,YAAY,CAAC,KAAD,EAAQ,SAAR,CAAvB,CAAP;AACD;;AAED,aAAS,mBAAT,GAA4B;AAC1B,UAAM,SAAS,GAAG;AAChB,QAAA,KAAK,EAAE,KAAK,CAAC,KADG;AAEhB,QAAA,QAAQ,EAAE,KAAK,CAAC,QAFA;AAGhB,QAAA,KAAK,EAAE,KAAK,CAAC,KAHG;AAIhB,QAAA,MAAM,EAAE,KAAK,CAAC,YAJE;AAKhB,QAAA,KAAK,EAAE,KAAK,CAAC,IAAN,GAAa,OAAb,GAAuB,EALd;AAMhB,QAAA,SAAS,EAAE,KAAK,CAAC,SAND;AAOhB,QAAA,QAAQ,EAAE,kBAAA,EAAE;AAAA,iBAAI,UAAU,CAAC,EAAD,CAAd;AAAA;AAPI,OAAlB;AASA,aAAO,yBACL,YAAE,oCAAF,EAAqB,SAArB,CADK,EAEL,CAAC,CAAC,wBAAD,EAAe,SAAS,CAAC,KAAzB,CAAD,CAFK,CAAP;AAID;;AAED,aAAS,eAAT,GAAwB;AACtB,aAAO,YACL,KADK,EAEL;AACE,iBAAO,OAAO,CAAC;AADjB,OAFK,EAKL,CACE,QAAQ,EADV,EAEE,KAAK,CAAC,KAAN,IAAe,mBAAmB,EAFpC,CALK,CAAP;AAUD;;AAED,8BAAgB,YAAK;AACnB,UAAI,MAAJ,aAAI,MAAJ,eAAI,MAAM,CAAE,KAAZ,EAAmB;AACjB,QAAA,MAAO,CAAC,KAAR,GAAgB,MAAO,CAAC,KAAR,CAAc,MAAd,CAAqB,UAAA,CAAC;AAAA,iBAAI,CAAC,KAAK,aAAV;AAAA,SAAtB,CAAhB;AACD;AACF,KAJD;AAMA,WAAO,YAAK;AACV,UAAM,SAAS,GAAG;AAChB,QAAA,KAAK,EAAE,KAAK,CAAC,KADG;AAEhB,QAAA,OAAO,EAAE,KAAK,CAAC,OAAN,IAAiB,KAAK,CAAC,YAFhB;AAGhB,QAAA,QAAQ,EAAE,CAAC,CAAC,kBAAkB,CAAC,KAHf;AAIhB,QAAA,QAAQ,EAAE,UAAU,CAAC,UAJL;AAKhB,QAAA,IAAI,EAAE,CAAC,CAAC,KAAK,CAAC,IALE;AAMhB,QAAA,KAAK,EAAE,eAAe,CAAC,KANP;AAOhB,QAAA,QAAQ,EAAE,CAAC,CAAC,KAAK,CAAC,QAPF;AAQhB,QAAA,OAAO,EAAE,CAAC,CAAC,UAAU,CAAC,OARN;AAShB,QAAA,OAAO,EAAE,UAAU,CAAC,iBATJ;AAUhB,QAAA,OAAO,EAAP;AAVgB,OAAlB;AAaA,aAAO,YAAE,cAAF,EAAU,SAAV,EAAqB;AAC1B,QAAA,MAAM,EAAE;AAAA,iBAAM,eAAe,EAArB;AAAA;AADkB,OAArB,CAAP;AAGD,KAjBD;AAkBD;AAxN0C,CAAhB,CAAtB","sourcesContent":["// Styles\nimport './VAutocomplete.scss'\n\n// Vue API\nimport {\n  h,\n  ref,\n  reactive,\n  computed,\n  defineComponent,\n  withDirectives,\n  watch,\n  inject,\n  onBeforeUnmount,\n} from 'vue'\n\n// Effects\nimport { validateProps, useValidate } from '../../effects/use-validate'\nimport { colorProps, useColors } from '../../effects/use-colors'\n\n// Types\nimport { VNode, Ref } from 'vue'\n\n// Components\nimport { VInput } from '../VInput'\nimport { VAutocompleteList } from './VAutocompleteList'\n\n// Directives\nimport { clickOutside } from '../../directives'\n\ntype SelectState = {\n  selected: any | null\n  focused: boolean\n  isMenuActive: boolean\n}\n\nexport const VAutocomplete = defineComponent({\n  name: 'v-select',\n\n  emits: [\n    'input',\n    'blur',\n    'focus',\n    'select',\n    'update:modelValue',\n    'update:value',\n  ],\n\n  props: {\n    label: String,\n    items: Array,\n    dark: Boolean,\n    valueKey: String,\n    idKey: String,\n    listColor: String,\n    disabled: Boolean,\n    modelValue: [Array, String, Object, Number],\n    ...validateProps(),\n    ...colorProps(),\n  } as any,\n\n  setup(props, { emit }): () => VNode {\n    const state: SelectState = reactive({\n      selected: null,\n      focused: false,\n      isMenuActive: false,\n    })\n\n    const { setTextColor } = useColors()\n\n    const inputTemplateRef = ref(null)\n\n    const {\n      validate,\n      dirty,\n      update,\n      errorState,\n      validateClasses,\n      validationState,\n    } = useValidate(props)\n\n    const fields: Ref<any[]> | undefined = props.rules && inject('fields')\n\n    const directive = computed(() => {\n      return state.isMenuActive && !state.focused\n        ? {\n          handler: clickOutsideHandler,\n          closeConditional: true,\n        }\n        : undefined\n    })\n\n    const classes = computed<Record<string, boolean>>(() => ({\n      'v-autocomplete': true,\n      'v-autocomplete--disabled': props.disabled,\n      'v-autocomplete--focused': state.focused,\n      ...validateClasses.value,\n    }))\n\n    const computedInputValue = computed<string>(() => {\n      return state.selected ? props.valueKey ?\n        state.selected[props.valueKey] : state.selected : ''\n    })\n\n    const computedValue = computed(() => {\n      return props.modelValue || props.value\n    })\n\n    watch(\n      () => computedValue.value,\n      value => {\n        state.selected = value\n        !state.focused &&\n        errorState.isDirty &&\n        props.rules?.length &&\n        validateValue()\n      }, { immediate: true },\n    )\n\n    if (fields?.value && props.rules?.length) {\n      fields.value.push(validateValue)\n    }\n\n    function validateValue() {\n      return props.rules?.length && validate(\n        computedInputValue.value,\n      )\n    }\n\n    function clickOutsideHandler() {\n      state.focused = false\n      state.isMenuActive = false\n      requestAnimationFrame(validateValue)\n    }\n\n    function onClick() {\n      state.isMenuActive = true\n      dirty()\n      update(errorState.innerError)\n    }\n\n    function onFocus() {\n      state.focused = true\n      emit('focus')\n    }\n\n    function onBlur() {\n      state.focused = false\n      emit('blur')\n    }\n\n    function onInput(e) {\n      setUpdatedValue(e.target.value)\n      emit('input', state.selected)\n    }\n\n    function onClear() {\n      setUpdatedValue('')\n      requestAnimationFrame(validateValue)\n    }\n\n    function selectItem(it) {\n      state.selected = it\n      emit('select', it)\n      emit('update:modelValue', it)\n      emit('update:value', it)\n    }\n\n    function setUpdatedValue(value) {\n      if (props.valueKey && state.selected) {\n        state.selected[props.valueKey] = value\n      } else {\n        state.selected = value\n      }\n      emit('update:modelValue', state.selected)\n      emit('update:value', state.selected)\n    }\n\n    function genInput(): VNode {\n\n      const color = props.dark ? 'white' : ''\n\n      const propsData = {\n        value: computedInputValue.value,\n        disabled: props.disabled,\n        readonly: props.readonly && !props.typeable,\n        ref: inputTemplateRef,\n        class: {\n          'v-autocomplete__input': true,\n        },\n        onClick,\n        onInput,\n        onFocus,\n        onBlur,\n      }\n\n      return h('input', setTextColor(color, propsData))\n    }\n\n    function genAutocompleteList(): VNode {\n      const propsData = {\n        items: props.items,\n        valueKey: props.valueKey,\n        idKey: props.idKey,\n        active: state.isMenuActive,\n        color: props.dark ? 'white' : '',\n        listColor: props.listColor,\n        onSelect: it => selectItem(it),\n      }\n      return withDirectives(\n        h(VAutocompleteList, propsData),\n        [[clickOutside, directive.value]],\n      )\n    }\n\n    function genAutocomplete(): VNode {\n      return h(\n        'div',\n        {\n          class: classes.value,\n        },\n        [\n          genInput(),\n          props.items && genAutocompleteList(),\n        ],\n      )\n    }\n\n    onBeforeUnmount(() => {\n      if (fields?.value) {\n        fields!.value = fields!.value.filter(v => v !== validateValue)\n      }\n    })\n\n    return () => {\n      const propsData = {\n        label: props.label,\n        focused: state.focused || state.isMenuActive,\n        hasState: !!computedInputValue.value,\n        hasError: errorState.innerError,\n        dark: !!props.dark,\n        color: validationState.value,\n        disabled: !!props.disabled,\n        isDirty: !!errorState.isDirty,\n        message: errorState.innerErrorMessage,\n        onClear,\n      } as any\n\n      return h(VInput, propsData, {\n        select: () => genAutocomplete(),\n      })\n    }\n  },\n})\n"],"sourceRoot":"","file":"VAutocomplete.js"}