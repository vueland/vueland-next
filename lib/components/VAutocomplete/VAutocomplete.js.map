{"version":3,"sources":["../../../../src/components/VAutocomplete/VAutocomplete.ts"],"names":[],"mappings":"AACA,OAAO,0DAAP;AAGA,SACE,CADF,EAEE,GAFF,EAGE,QAHF,EAIE,QAJF,EAKE,eALF,EAME,cANF,EAOE,KAPF,EAQE,MARF,EASE,eATF,QAUO,KAVP;AAaA,SAAS,aAAT,EAAwB,WAAxB,QAA2C,4BAA3C;AACA,SAAS,UAAT,EAAqB,SAArB,QAAsC,0BAAtC;AAMA,SAAS,MAAT,QAAuB,WAAvB;AACA,SAAS,iBAAT,QAAkC,qBAAlC;AAGA,SAAS,YAAT,QAA6B,kBAA7B;AAQA,OAAO,MAAM,aAAa,GAAG,eAAe,CAAC;AAC3C,EAAA,IAAI,EAAE,gBADqC;AAE3C,EAAA,KAAK,EAAE;AACL,IAAA,KAAK,EAAE,MADF;AAEL,IAAA,KAAK,EAAE,KAFF;AAGL,IAAA,IAAI,EAAE,OAHD;AAIL,IAAA,QAAQ,EAAE,MAJL;AAKL,IAAA,KAAK,EAAE,MALF;AAML,IAAA,SAAS,EAAE,MANN;AAOL,IAAA,QAAQ,EAAE,OAPL;AAQL,IAAA,UAAU,EAAE,CAAC,KAAD,EAAQ,MAAR,EAAgB,MAAhB,EAAwB,MAAxB,CARP;AASL,OAAG,aAAa,EATX;AAUL,OAAG,UAAU;AAVR,GAFoC;AAc3C,EAAA,KAAK,EAAE,CACL,OADK,EAEL,MAFK,EAGL,OAHK,EAIL,QAJK,EAKL,mBALK,EAML,cANK,CAdoC;;AAuB3C,EAAA,KAAK,CAAC,KAAD,EAAQ;AAAE,IAAA;AAAF,GAAR,EAAgB;AAAA;;AACnB,UAAM,KAAK,GAAgB,QAAQ,CAAC;AAClC,MAAA,OAAO,EAAE,KADyB;AAElC,MAAA,YAAY,EAAE,KAFoB;AAGlC,MAAA,MAAM,EAAE;AAH0B,KAAD,CAAnC;AAMA,UAAM;AAAE,MAAA;AAAF,QAAmB,SAAS,EAAlC;AAEA,UAAM,gBAAgB,GAAG,GAAG,CAAC,IAAD,CAA5B;AAEA,UAAM;AACJ,MAAA,QADI;AAEJ,MAAA,KAFI;AAGJ,MAAA,MAHI;AAIJ,MAAA,UAJI;AAKJ,MAAA,eALI;AAMJ,MAAA;AANI,QAOF,WAAW,CAAC,KAAD,CAPf;AASA,UAAM,MAAM,GAA2B,KAAK,CAAC,KAAN,IAAe,MAAM,CAAC,QAAD,CAA5D;AAEA,UAAM,SAAS,GAAG,QAAQ,CAAC,MAAK;AAC9B,aAAO,KAAK,CAAC,YAAN,IAAsB,CAAC,KAAK,CAAC,OAA7B,GACH;AACE,QAAA,OAAO,EAAE,mBADX;AAEE,QAAA,gBAAgB,EAAE;AAFpB,OADG,GAKH,SALJ;AAMD,KAPyB,CAA1B;AASA,UAAM,OAAO,GAAG,QAAQ,CAA0B,OAAO;AACvD,wBAAkB,IADqC;AAEvD,kCAA4B,KAAK,CAAC,QAFqB;AAGvD,iCAA2B,KAAK,CAAC,OAHsB;AAIvD,SAAG,eAAe,CAAC;AAJoC,KAAP,CAA1B,CAAxB;AAOA,UAAM,SAAS,GAAG,QAAQ,CAAM,MAAK;AACnC,aAAO,KAAK,CAAC,UAAN,IAAoB,KAAK,CAAC,KAAjC;AACD,KAFyB,CAA1B;AAIA,UAAM,UAAU,GAAG,QAAQ,CAAS,MAAK;AACvC,aAAO,KAAK,CAAC,QAAN,GAAiB,SAAS,CAAC,KAAV,CAAgB,KAAK,CAAC,QAAtB,CAAjB,GAAmD,SAAS,CAAC,KAApE;AACD,KAF0B,CAA3B;AAIA,UAAM,iBAAiB,GAAG,QAAQ,CAAU,MAAK;AAC/C,aAAO,CAAC,CAAC,KAAK,CAAC,KAAR,IAAiB,CAAC,CAAC,KAAK,CAAC,KAAN,CAAY,MAAtC;AACD,KAFiC,CAAlC;AAIA,IAAA,KAAK,CAAC,MAAN,GAAe,SAAS,CAAC,KAAV,GAAkB,UAAU,CAAC,KAA7B,GAAqC,EAApD;AAEA,IAAA,KAAK,CACH,MAAM,iBAAiB,CAAC,KADrB,EAEF,EAAD,IAAO;AACL,UAAI,EAAE,IAAI,CAAC,KAAK,CAAC,YAAb,IAA6B,KAAK,CAAC,OAAvC,EAAgD;AAC9C,QAAA,KAAK,CAAC,YAAN,GAAqB,IAArB;AACD;AACF,KANE,CAAL;;AASA,QAAI,MAAM,SAAN,IAAA,MAAM,WAAN,IAAA,MAAM,CAAE,KAAR,oBAAiB,KAAK,CAAC,KAAvB,yCAAiB,aAAa,MAAlC,EAA0C;AACxC,MAAA,MAAM,CAAC,KAAP,CAAa,IAAb,CAAkB,aAAlB;AACD;;AAED,aAAS,aAAT,GAAsB;AAAA;;AACpB,aAAO,kBAAA,KAAK,CAAC,KAAN,gEAAa,MAAb,KAAuB,QAAQ,CAAC,KAAK,CAAC,MAAP,CAAtC;AACD;;AAED,aAAS,mBAAT,GAA4B;AAC1B,MAAA,KAAK,CAAC,OAAN,GAAgB,KAAhB;AACA,MAAA,KAAK,CAAC,YAAN,GAAqB,KAArB;AACD;;AAED,aAAS,OAAT,GAAgB;AACd,MAAA,KAAK,CAAC,OAAN,GAAgB,IAAhB;AACA,MAAA,KAAK,CAAC,YAAN,GAAqB,iBAAiB,CAAC,KAAvC;AACA,MAAA,KAAK;AACL,MAAA,MAAM,CAAC,UAAU,CAAC,UAAZ,CAAN;AACA,MAAA,IAAI,CAAC,OAAD,CAAJ;AACD;;AAED,aAAS,MAAT,GAAe;AACb,UAAI,CAAC,SAAS,CAAC,KAAf,EAAsB;AACpB,QAAA,KAAK,CAAC,MAAN,GAAe,EAAf;AACD;;AACD,UAAI,CAAC,KAAK,CAAC,MAAP,IAAiB,SAAS,CAAC,KAA/B,EAAsC;AACpC,QAAA,qBAAqB,CAAC,MAAK;AACzB,UAAA,KAAK,CAAC,MAAN,GAAe,UAAU,CAAC,KAA1B;AACD,SAFoB,CAArB;AAGD;;AAED,MAAA,UAAU,CAAC,aAAD,CAAV;AAEA,MAAA,KAAK,CAAC,OAAN,GAAgB,KAAhB;AACA,MAAA,IAAI,CAAC,MAAD,CAAJ;AACD;;AAED,aAAS,OAAT,CAAiB,CAAjB,EAAkB;AAChB,MAAA,KAAK,CAAC,MAAN,GAAe,CAAC,CAAC,MAAF,CAAS,KAAxB;AACA,MAAA,IAAI,CAAC,OAAD,EAAU,CAAC,CAAC,MAAF,CAAS,KAAnB,CAAJ;AACD;;AAED,aAAS,OAAT,GAAgB;AACd,MAAA,KAAK,CAAC,MAAN,GAAe,EAAf;AACA,MAAA,IAAI,CAAC,QAAD,EAAW,EAAX,CAAJ;AACA,MAAA,IAAI,CAAC,mBAAD,EAAsB,EAAtB,CAAJ;AACA,MAAA,IAAI,CAAC,cAAD,EAAiB,EAAjB,CAAJ;AACA,MAAA,qBAAqB,CAAC,aAAD,CAArB;AACD;;AAED,aAAS,QAAT,CAAkB,EAAlB,EAAoB;AAClB,UAAI,KAAK,CAAC,QAAV,EAAoB;AAClB,QAAA,KAAK,CAAC,MAAN,GAAe,EAAE,CAAC,KAAK,CAAC,QAAP,CAAjB;AACD,OAFD,MAEO;AACL,QAAA,KAAK,CAAC,MAAN,GAAe,EAAf;AACD;;AACD,MAAA,IAAI,CAAC,QAAD,EAAW,EAAX,CAAJ;AACA,MAAA,IAAI,CAAC,mBAAD,EAAsB,EAAtB,CAAJ;AACA,MAAA,IAAI,CAAC,cAAD,EAAiB,EAAjB,CAAJ;AACA,MAAA,qBAAqB,CAAC,aAAD,CAArB;AACD;;AAED,aAAS,QAAT,GAAiB;AACf,YAAM,KAAK,GAAG,KAAK,CAAC,IAAN,GAAa,OAAb,GAAuB,EAArC;AAEA,YAAM,SAAS,GAAG;AAChB,QAAA,KAAK,EAAE,KAAK,CAAC,MADG;AAEhB,QAAA,QAAQ,EAAE,KAAK,CAAC,QAFA;AAGhB,QAAA,QAAQ,EAAE,KAAK,CAAC,QAAN,IAAkB,CAAC,KAAK,CAAC,QAHnB;AAIhB,QAAA,GAAG,EAAE,gBAJW;AAKhB,QAAA,KAAK,EAAE,uBALS;AAMhB,QAAA,OANgB;AAOhB,QAAA,OAPgB;AAQhB,QAAA;AARgB,OAAlB;AAWA,aAAO,CAAC,CAAC,OAAD,EAAU,YAAY,CAAC,KAAD,EAAQ,SAAR,CAAtB,CAAR;AACD;;AAED,aAAS,mBAAT,GAA4B;AAC1B,YAAM,SAAS,GAAG;AAChB,QAAA,KAAK,EAAE,KAAK,CAAC,KADG;AAEhB,QAAA,QAAQ,EAAE,KAAK,CAAC,QAFA;AAGhB,QAAA,KAAK,EAAE,KAAK,CAAC,KAHG;AAIhB,QAAA,MAAM,EAAE,KAAK,CAAC,YAJE;AAKhB,QAAA,KAAK,EAAE,KAAK,CAAC,IAAN,GAAa,OAAb,GAAuB,EALd;AAMhB,QAAA,SAAS,EAAE,KAAK,CAAC,SAND;AAOhB,QAAA;AAPgB,OAAlB;AASA,aAAO,cAAc,CAAC,CAAC,CAAC,iBAAD,EAAoB,SAApB,CAAF,EAAkC,CACrD,CAAC,YAAD,EAAe,SAAS,CAAC,KAAzB,CADqD,CAAlC,CAArB;AAGD;;AAED,aAAS,eAAT,GAAwB;AACtB,aAAO,CAAC,CAAC,KAAD,EAAQ;AAAE,QAAA,KAAK,EAAE,OAAO,CAAC;AAAjB,OAAR,EAAkC,CACxC,QAAQ,EADgC,EAExC,KAAK,CAAC,KAAN,IAAe,mBAAmB,EAFM,CAAlC,CAAR;AAID;;AAED,IAAA,eAAe,CAAC,MAAK;AACnB,UAAI,MAAJ,aAAI,MAAJ,eAAI,MAAM,CAAE,KAAZ,EAAmB;AACjB,QAAA,MAAO,CAAC,KAAR,GAAgB,MAAO,CAAC,KAAR,CAAc,MAAd,CAAsB,CAAD,IAAO,CAAC,KAAK,aAAlC,CAAhB;AACD;AACF,KAJc,CAAf;AAMA,WAAO,MAAK;AACV,YAAM,SAAS,GAAG;AAChB,QAAA,KAAK,EAAE,KAAK,CAAC,KADG;AAEhB,QAAA,OAAO,EAAE,KAAK,CAAC,OAAN,IAAiB,KAAK,CAAC,YAFhB;AAGhB,QAAA,QAAQ,EAAE,CAAC,CAAC,KAAK,CAAC,MAHF;AAIhB,QAAA,QAAQ,EAAE,UAAU,CAAC,UAJL;AAKhB,QAAA,IAAI,EAAE,CAAC,CAAC,KAAK,CAAC,IALE;AAMhB,QAAA,KAAK,EAAE,eAAe,CAAC,KANP;AAOhB,QAAA,QAAQ,EAAE,CAAC,CAAC,KAAK,CAAC,QAPF;AAQhB,QAAA,OAAO,EAAE,CAAC,CAAC,UAAU,CAAC,OARN;AAShB,QAAA,OAAO,EAAE,UAAU,CAAC,iBATJ;AAUhB,QAAA;AAVgB,OAAlB;AAaA,aAAO,CAAC,CAAC,MAAD,EAAS,SAAT,EAAoB;AAC1B,QAAA,MAAM,EAAE,MAAM,eAAe;AADH,OAApB,CAAR;AAGD,KAjBD;AAkBD;;AAjN0C,CAAD,CAArC","sourcesContent":["// Styles\nimport './VAutocomplete.scss'\n\n// Vue API\nimport {\n  h,\n  ref,\n  reactive,\n  computed,\n  defineComponent,\n  withDirectives,\n  watch,\n  inject,\n  onBeforeUnmount,\n} from 'vue'\n\n// Effects\nimport { validateProps, useValidate } from '../../effects/use-validate'\nimport { colorProps, useColors } from '../../effects/use-colors'\n\n// Types\nimport { VNode, Ref } from 'vue'\n\n// Components\nimport { VInput } from '../VInput'\nimport { VAutocompleteList } from './VAutocompleteList'\n\n// Directives\nimport { clickOutside } from '../../directives'\n\ntype SelectState = {\n  focused: boolean\n  isMenuActive: boolean\n  search: string\n}\n\nexport const VAutocomplete = defineComponent({\n  name: 'v-autocomplete',\n  props: {\n    label: String,\n    items: Array,\n    dark: Boolean,\n    valueKey: String,\n    idKey: String,\n    listColor: String,\n    disabled: Boolean,\n    modelValue: [Array, String, Object, Number],\n    ...validateProps(),\n    ...colorProps(),\n  } as any,\n  emits: [\n    'input',\n    'blur',\n    'focus',\n    'select',\n    'update:modelValue',\n    'update:value',\n  ],\n\n  setup(props, { emit }): () => VNode {\n    const state: SelectState = reactive({\n      focused: false,\n      isMenuActive: false,\n      search: '',\n    })\n\n    const { setTextColor } = useColors()\n\n    const inputTemplateRef = ref(null)\n\n    const {\n      validate,\n      dirty,\n      update,\n      errorState,\n      validateClasses,\n      validationState,\n    } = useValidate(props)\n\n    const fields: Ref<any[]> | undefined = props.rules && inject('fields')\n\n    const directive = computed(() => {\n      return state.isMenuActive && !state.focused\n        ? {\n            handler: clickOutsideHandler,\n            closeConditional: true,\n          }\n        : undefined\n    })\n\n    const classes = computed<Record<string, boolean>>(() => ({\n      'v-autocomplete': true,\n      'v-autocomplete--disabled': props.disabled,\n      'v-autocomplete--focused': state.focused,\n      ...validateClasses.value,\n    }))\n\n    const propValue = computed<any>(() => {\n      return props.modelValue || props.value\n    })\n\n    const inputValue = computed<string>(() => {\n      return props.valueKey ? propValue.value[props.valueKey] : propValue.value\n    })\n\n    const isListItemsExists = computed<boolean>(() => {\n      return !!props.items && !!props.items.length\n    })\n\n    state.search = propValue.value ? inputValue.value : ''\n\n    watch(\n      () => isListItemsExists.value,\n      (to) => {\n        if (to && !state.isMenuActive && state.focused) {\n          state.isMenuActive = true\n        }\n      }\n    )\n\n    if (fields?.value && props.rules?.length) {\n      fields.value.push(validateValue)\n    }\n\n    function validateValue() {\n      return props.rules?.length && validate(state.search)\n    }\n\n    function clickOutsideHandler() {\n      state.focused = false\n      state.isMenuActive = false\n    }\n\n    function onFocus() {\n      state.focused = true\n      state.isMenuActive = isListItemsExists.value\n      dirty()\n      update(errorState.innerError)\n      emit('focus')\n    }\n\n    function onBlur() {\n      if (!propValue.value) {\n        state.search = ''\n      }\n      if (!state.search && propValue.value) {\n        requestAnimationFrame(() => {\n          state.search = inputValue.value\n        })\n      }\n\n      setTimeout(validateValue)\n\n      state.focused = false\n      emit('blur')\n    }\n\n    function onInput(e) {\n      state.search = e.target.value\n      emit('input', e.target.value)\n    }\n\n    function onClear() {\n      state.search = ''\n      emit('select', '')\n      emit('update:modelValue', '')\n      emit('update:value', '')\n      requestAnimationFrame(validateValue)\n    }\n\n    function onSelect(it) {\n      if (props.valueKey) {\n        state.search = it[props.valueKey]\n      } else {\n        state.search = it\n      }\n      emit('select', it)\n      emit('update:modelValue', it)\n      emit('update:value', it)\n      requestAnimationFrame(validateValue)\n    }\n\n    function genInput(): VNode {\n      const color = props.dark ? 'white' : ''\n\n      const propsData = {\n        value: state.search,\n        disabled: props.disabled,\n        readonly: props.readonly && !props.typeable,\n        ref: inputTemplateRef,\n        class: 'v-autocomplete__input',\n        onInput,\n        onFocus,\n        onBlur,\n      }\n\n      return h('input', setTextColor(color, propsData))\n    }\n\n    function genAutocompleteList(): VNode {\n      const propsData = {\n        items: props.items,\n        valueKey: props.valueKey,\n        idKey: props.idKey,\n        active: state.isMenuActive,\n        color: props.dark ? 'white' : '',\n        listColor: props.listColor,\n        onSelect,\n      }\n      return withDirectives(h(VAutocompleteList, propsData), [\n        [clickOutside, directive.value],\n      ])\n    }\n\n    function genAutocomplete(): VNode {\n      return h('div', { class: classes.value }, [\n        genInput(),\n        props.items && genAutocompleteList(),\n      ])\n    }\n\n    onBeforeUnmount(() => {\n      if (fields?.value) {\n        fields!.value = fields!.value.filter((v) => v !== validateValue)\n      }\n    })\n\n    return () => {\n      const propsData = {\n        label: props.label,\n        focused: state.focused || state.isMenuActive,\n        hasState: !!state.search,\n        hasError: errorState.innerError,\n        dark: !!props.dark,\n        color: validationState.value,\n        disabled: !!props.disabled,\n        isDirty: !!errorState.isDirty,\n        message: errorState.innerErrorMessage,\n        onClear,\n      }\n\n      return h(VInput, propsData, {\n        select: () => genAutocomplete(),\n      })\n    }\n  },\n})\n"],"sourceRoot":"","file":"VAutocomplete.js"}