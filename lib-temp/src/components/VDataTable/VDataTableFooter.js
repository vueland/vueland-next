import { watch, computed, defineComponent, h } from 'vue';
import { VIcon } from '../VIcon';
import { VButton } from '../VButton';
import { VSelect } from '../VSelect';
import { useColors } from '../../composable/use-colors';
import { useIcons } from '../../composable/use-icons';
export const VDataTableFooter = defineComponent({
    name: 'v-data-table-footer',
    props: {
        pages: Number,
        page: Number,
        firstOnPage: Number,
        lastOnPage: Number,
        pageCorrection: Number,
        rowsLength: Number,
        rowsOnPage: Number,
        options: Object,
    },
    emits: [
        'last-page',
        'correct-page',
        'select-rows-count',
        'next-page',
        'prev-page',
    ],
    setup(props, { emit, slots }) {
        const { setBackgroundCssColor, setBackgroundClassNameColor, setTextClassNameColor, setTextCssColor, } = useColors();
        const { icons } = useIcons();
        const paginationDisplayText = computed(() => {
            return `${props.firstOnPage} - ${props.lastOnPage}
        of ${props.rowsLength}`;
        });
        const isLastPage = computed(() => {
            return props.page >= props.pages;
        });
        watch(() => isLastPage.value, (to) => to && emit('last-page'));
        function changeTableRowsPage(isNext) {
            if (props.page === props.pages && isNext)
                return;
            const event = isNext ? 'next-page' : 'prev-page';
            emit(event, isNext ? 1 : -1);
        }
        function genPaginationButton(isNext = false) {
            const btnColor = props.options?.pagination?.buttonsColor ||
                (props.options.dark ? 'white' : 'primary');
            const disableIf = (isNext && props.lastOnPage >= props.rowsLength) ||
                (!isNext && props.firstOnPage === 1);
            const propsData = {
                width: 42,
                color: btnColor,
                text: props.options.dark,
                elevation: 3,
                disabled: disableIf,
                onClick: () => changeTableRowsPage(isNext),
            };
            return h(VButton, propsData, {
                default: () => h(VIcon, {
                    icon: isNext ? icons.$arrowRight : icons.$arrowLeft,
                    color: props.options.dark ? 'white' : '',
                }),
            });
        }
        function genPaginationPageDisplay() {
            const displayColor = props.options?.pagination?.displayColor ||
                (props.options.dark ? 'white' : 'blue lighten-1');
            const propsData = {
                width: 42,
                style: { margin: '0 10px' },
                color: displayColor,
                text: props.options.dark,
                elevation: 3,
            };
            return h(VButton, propsData, { default: () => props.page });
        }
        function genRowsCountSelect() {
            const propsData = {
                items: props.options.rowsPerPageOptions,
                textColor: props.options.contentColor,
                modelValue: props.rowsOnPage,
                hints: false,
                showExpIcon: false,
                onSelect: (e) => emit('select-rows-count', e),
            };
            return h(VSelect, propsData);
        }
        function genRowsCountSelectCaption() {
            const color = props.options.contentColor;
            const propsData = {
                class: {
                    'v-data-table__pagination-label': true,
                    ...(color ? setTextClassNameColor(color) : {}),
                },
                style: {
                    ...(color ? setTextCssColor(color) : {}),
                },
            };
            return h('span', propsData, props.options?.rowsPerPageText || 'Rows per page');
        }
        function genRowsCountSelectBlock() {
            return h('div', { class: 'v-data-table__pagination-select' }, [
                genRowsCountSelectCaption(),
                genRowsCountSelect(),
            ]);
        }
        function genPagesCountDisplay() {
            const color = props.options.contentColor;
            const propsData = {
                class: {
                    'v-data-table__pagination-pages': true,
                    ...(color ? setTextClassNameColor(color) : {}),
                },
                style: {
                    ...(color ? setTextCssColor(color) : {}),
                },
            };
            props.pageCorrection && emit('correct-page', -props.pageCorrection);
            return h('div', propsData, (props.rowsLength && slots.paginationText && slots.paginationText()) ||
                (props.rowsLength && paginationDisplayText.value) ||
                '-');
        }
        function genPaginationButtonsBlock() {
            return h('div', { class: { 'v-data-table__pagination-route': true } }, [
                genPaginationButton(),
                genPaginationPageDisplay(),
                genPaginationButton(true),
            ]);
        }
        function genPaginationBlock() {
            return h('div', { class: 'v-data-table__pagination' }, [
                genRowsCountSelectBlock(),
                genPagesCountDisplay(),
                genPaginationButtonsBlock(),
            ]);
        }
        return () => {
            const propsData = {
                class: {
                    'v-data-table__footer': true,
                    ...(props.options.color
                        ? setBackgroundClassNameColor(props.options.color)
                        : {}),
                },
                style: {
                    ...(props.options.color
                        ? setBackgroundCssColor(props.options.color)
                        : {}),
                },
            };
            return h('div', propsData, genPaginationBlock());
        };
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGFUYWJsZUZvb3Rlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZEYXRhVGFibGUvVkRhdGFUYWJsZUZvb3Rlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxlQUFlLEVBQUUsQ0FBQyxFQUFFLE1BQU0sS0FBSyxDQUFBO0FBR3pELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDaEMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFlBQVksQ0FBQTtBQUNwQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sWUFBWSxDQUFBO0FBR3BDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUN2RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sNEJBQTRCLENBQUE7QUFLckQsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUcsZUFBZSxDQUFDO0lBQzlDLElBQUksRUFBRSxxQkFBcUI7SUFDM0IsS0FBSyxFQUFFO1FBQ0wsS0FBSyxFQUFFLE1BQU07UUFDYixJQUFJLEVBQUUsTUFBTTtRQUNaLFdBQVcsRUFBRSxNQUFNO1FBQ25CLFVBQVUsRUFBRSxNQUFNO1FBQ2xCLGNBQWMsRUFBRSxNQUFNO1FBQ3RCLFVBQVUsRUFBRSxNQUFNO1FBQ2xCLFVBQVUsRUFBRSxNQUFNO1FBQ2xCLE9BQU8sRUFBRSxNQUFNO0tBQ1Q7SUFFUixLQUFLLEVBQUU7UUFDTCxXQUFXO1FBQ1gsY0FBYztRQUNkLG1CQUFtQjtRQUNuQixXQUFXO1FBQ1gsV0FBVztLQUNaO0lBRUQsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUU7UUFDMUIsTUFBTSxFQUNKLHFCQUFxQixFQUNyQiwyQkFBMkIsRUFDM0IscUJBQXFCLEVBQ3JCLGVBQWUsR0FDaEIsR0FBRyxTQUFTLEVBQUUsQ0FBQTtRQUNmLE1B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QUF3QixFQUFFO2dCQUMxQixtQkFBbUIsQ0FBQyxJQUFJLENBQUM7YUFDMUIsQ0FBQyxDQUFBO1FBQ0osQ0FBQztRQUVELFNBQVMsa0JBQWtCO1lBQ3pCLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSwwQkFBMEIsRUFBRSxFQUFFO2dCQUNyRCx1QkFBdUIsRUFBRTtnQkFDekIsb0JBQW9CLEVBQUU7Z0JBQ3RCLHlCQUF5QixFQUFFO2FBQzVCLENBQUMsQ0FBQTtRQUNKLENBQUM7UUFFRCxPQUFPLEdBQUcsRUFBRTtZQUNWLE1BQU0sU0FBUyxHQUFHO2dCQUNoQixLQUFLLEVBQUU7b0JBQ0wsc0JBQXNCLEVBQUUsSUFBSTtvQkFDNUIsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSzt3QkFDckIsQ0FBQyxDQUFDLDJCQUEyQixDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO3dCQUNsRCxDQUFDLENBQUMsRUFBRSxDQUFDO2lCQUNSO2dCQUNELEtBQUssRUFBRTtvQkFDTCxHQUFHLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLO3dCQUNyQixDQUFDLENBQUMscUJBQXFCLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7d0JBQzVDLENBQUMsQ0FBQyxFQUFFLENBQUM7aUJBQ1I7YUFDRixDQUFBO1lBRUQsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUE7UUFDbEQsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7IHdhdGNoLCBjb21wdXRlZCwgZGVmaW5lQ29tcG9uZW50LCBoIH0gZnJvbSAndnVlJ1xuXG4vLyBDb21wb25lbnRzXG5pbXBvcnQgeyBWSWNvbiB9IGZyb20gJy4uL1ZJY29uJ1xuaW1wb3J0IHsgVkJ1dHRvbiB9IGZyb20gJy4uL1ZCdXR0b24nXG5pbXBvcnQgeyBWU2VsZWN0IH0gZnJvbSAnLi4vVlNlbGVjdCdcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgdXNlQ29sb3JzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS91c2UtY29sb3JzJ1xuaW1wb3J0IHsgdXNlSWNvbnMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL3VzZS1pY29ucydcblxuLy8gVHlwZXNcbmltcG9ydCB7IFZOb2RlIH0gZnJvbSAndnVlJ1xuXG5leHBvcnQgY29uc3QgVkRhdGFUYWJsZUZvb3RlciA9IGRlZmluZUNvbXBvbmVudCh7XG4gIG5hbWU6ICd2LWRhdGEtdGFibGUtZm9vdGVyJyxcbiAgcHJvcHM6IHtcbiAgICBwYWdlczogTnVtYmVyLFxuICAgIHBhZ2U6IE51bWJlcixcbiAgICBmaXJzdE9uUGFnZTogTnVtYmVyLFxuICAgIGxhc3RPblBhZ2U6IE51bWJlcixcbiAgICBwYWdlQ29ycmVjdGlvbjogTnVtYmVyLFxuICAgIHJvd3NMZW5ndGg6IE51bWJlcixcbiAgICByb3dzT25QYWdlOiBOdW1iZXIsXG4gICAgb3B0aW9uczogT2JqZWN0LFxuICB9IGFzIGFueSxcblxuICBlbWl0czogW1xuICAgICdsYXN0LXBhZ2UnLFxuICAgICdjb3JyZWN0LXBhZ2UnLFxuICAgICdzZWxlY3Qtcm93cy1jb3VudCcsXG4gICAgJ25leHQtcGFnZScsXG4gICAgJ3ByZXYtcGFnZScsXG4gIF0sXG5cbiAgc2V0dXAocHJvcHMsIHsgZW1pdCwgc2xvdHMgfSk6ICgpID0+IFZOb2RlIHtcbiAgICBjb25zdCB7XG4gICAgICBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IsXG4gICAgICBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IsXG4gICAgICBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IsXG4gICAgICBzZXRUZXh0Q3NzQ29sb3IsXG4gICAgfSA9IHVzZUNvbG9ycygpXG4gICAgY29uc3QgeyBpY29ucyB9ID0gdXNlSWNvbnMoKVxuXG4gICAgY29uc3QgcGFnaW5hdGlvbkRpc3BsYXlUZXh0ID0gY29tcHV0ZWQ8c3RyaW5nPigoKSA9PiB7XG4gICAgICByZXR1cm4gYCR7IHByb3BzLmZpcnN0T25QYWdlIH0gLSAkeyBwcm9wcy5sYXN0T25QYWdlIH1cbiAgICAgICAgb2YgJHsgcHJvcHMucm93c0xlbmd0aCB9YFxuICAgIH0pXG5cbiAgICBjb25zdCBpc0xhc3RQYWdlID0gY29tcHV0ZWQ8Ym9vbGVhbj4oKCkgPT4ge1xuICAgICAgcmV0dXJuIHByb3BzLnBhZ2UgPj0gcHJvcHMucGFnZXNcbiAgICB9KVxuXG4gICAgd2F0Y2goXG4gICAgICAoKSA9PiBpc0xhc3RQYWdlLnZhbHVlLFxuICAgICAgKHRvKSA9PiB0byAmJiBlbWl0KCdsYXN0LXBhZ2UnKSxcbiAgICApXG5cbiAgICBmdW5jdGlvbiBjaGFuZ2VUYWJsZVJvd3NQYWdlKGlzTmV4dCkge1xuICAgICAgaWYgKHByb3BzLnBhZ2UgPT09IHByb3BzLnBhZ2VzICYmIGlzTmV4dCkgcmV0dXJuXG5cbiAgICAgIGNvbnN0IGV2ZW50ID0gaXNOZXh0ID8gJ25leHQtcGFnZScgOiAncHJldi1wYWdlJ1xuICAgICAgZW1pdChldmVudCwgaXNOZXh0ID8gMSA6IC0xKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdlblBhZ2luYXRpb25CdXR0b24oaXNOZXh0ID0gZmFsc2UpOiBWTm9kZSB7XG4gICAgICBjb25zdCBidG5Db2xvciA9XG4gICAgICAgIHByb3BzLm9wdGlvbnM/LnBhZ2luYXRpb24/LmJ1dHRvbnNDb2xvciB8fFxuICAgICAgICAocHJvcHMub3B0aW9ucy5kYXJrID8gJ3doaXRlJyA6ICdwcmltYXJ5JylcblxuICAgICAgY29uc3QgZGlzYWJsZUlmID1cbiAgICAgICAgKGlzTmV4dCAmJiBwcm9wcy5sYXN0T25QYWdlID49IHByb3BzLnJvd3NMZW5ndGgpIHx8XG4gICAgICAgICghaXNOZXh0ICYmIHByb3BzLmZpcnN0T25QYWdlID09PSAxKVxuXG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIHdpZHRoOiA0MixcbiAgICAgICAgY29sb3I6IGJ0bkNvbG9yLFxuICAgICAgICB0ZXh0OiBwcm9wcy5vcHRpb25zLmRhcmssXG4gICAgICAgIGVsZXZhdGlvbjogMyxcbiAgICAgICAgZGlzYWJsZWQ6IGRpc2FibGVJZixcbiAgICAgICAgb25DbGljazogKCkgPT4gY2hhbmdlVGFibGVSb3dzUGFnZShpc05leHQpLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWQnV0dG9uLCBwcm9wc0RhdGEsIHtcbiAgICAgICAgZGVmYXVsdDogKCkgPT5cbiAgICAgICAgICBoKFZJY29uLCB7XG4gICAgICAgICAgICBpY29uOiBpc05leHQgPyBpY29ucy4kYXJyb3dSaWdodCA6IGljb25zLiRhcnJvd0xlZnQsXG4gICAgICAgICAgICBjb2xvcjogcHJvcHMub3B0aW9ucy5kYXJrID8gJ3doaXRlJyA6ICcnLFxuICAgICAgICAgIH0pLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5QYWdpbmF0aW9uUGFnZURpc3BsYXkoKTogVk5vZGUge1xuICAgICAgY29uc3QgZGlzcGxheUNvbG9yID1cbiAgICAgICAgcHJvcHMub3B0aW9ucz8ucGFnaW5hdGlvbj8uZGlzcGxheUNvbG9yIHx8XG4gICAgICAgIChwcm9wcy5vcHRpb25zLmRhcmsgPyAnd2hpdGUnIDogJ2JsdWUgbGlnaHRlbi0xJylcblxuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICB3aWR0aDogNDIsXG4gICAgICAgIHN0eWxlOiB7IG1hcmdpbjogJzAgMTBweCcgfSxcbiAgICAgICAgY29sb3I6IGRpc3BsYXlDb2xvcixcbiAgICAgICAgdGV4dDogcHJvcHMub3B0aW9ucy5kYXJrLFxuICAgICAgICBlbGV2YXRpb246IDMsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKFZCdXR0b24sIHByb3BzRGF0YSwgeyBkZWZhdWx0OiAoKSA9PiBwcm9wcy5wYWdlIH0pXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuUm93c0NvdW50U2VsZWN0KCk6IFZOb2RlIHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgaXRlbXM6IHByb3BzLm9wdGlvbnMucm93c1BlclBhZ2VPcHRpb25zLFxuICAgICAgICB0ZXh0Q29sb3I6IHByb3BzLm9wdGlvbnMuY29udGVudENvbG9yLFxuICAgICAgICBtb2RlbFZhbHVlOiBwcm9wcy5yb3dzT25QYWdlLFxuICAgICAgICBoaW50czogZmFsc2UsXG4gICAgICAgIHNob3dFeHBJY29uOiBmYWxzZSxcbiAgICAgICAgb25TZWxlY3Q6IChlKSA9PiBlbWl0KCdzZWxlY3Qtcm93cy1jb3VudCcsIGUpLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaChWU2VsZWN0LCBwcm9wc0RhdGEpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuUm93c0NvdW50U2VsZWN0Q2FwdGlvbigpOiBWTm9kZSB7XG4gICAgICBjb25zdCBjb2xvciA9IHByb3BzLm9wdGlvbnMuY29udGVudENvbG9yXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1kYXRhLXRhYmxlX19wYWdpbmF0aW9uLWxhYmVsJzogdHJ1ZSxcbiAgICAgICAgICAuLi4oY29sb3IgPyBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IoY29sb3IpIDoge30pLFxuICAgICAgICB9LFxuICAgICAgICBzdHlsZToge1xuICAgICAgICAgIC4uLihjb2xvciA/IHNldFRleHRDc3NDb2xvcihjb2xvcikgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKFxuICAgICAgICAnc3BhbicsXG4gICAgICAgIHByb3BzRGF0YSxcbiAgICAgICAgcHJvcHMub3B0aW9ucz8ucm93c1BlclBhZ2VUZXh0IHx8ICdSb3dzIHBlciBwYWdlJyxcbiAgICAgIClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5Sb3dzQ291bnRTZWxlY3RCbG9jaygpOiBWTm9kZSB7XG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogJ3YtZGF0YS10YWJsZV9fcGFnaW5hdGlvbi1zZWxlY3QnIH0sIFtcbiAgICAgICAgZ2VuUm93c0NvdW50U2VsZWN0Q2FwdGlvbigpLFxuICAgICAgICBnZW5Sb3dzQ291bnRTZWxlY3QoKSxcbiAgICAgIF0pXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuUGFnZXNDb3VudERpc3BsYXkoKTogVk5vZGUge1xuICAgICAgY29uc3QgY29sb3IgPSBwcm9wcy5vcHRpb25zLmNvbnRlbnRDb2xvclxuXG4gICAgICBjb25zdCBwcm9wc0RhdGEgPSB7XG4gICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgJ3YtZGF0YS10YWJsZV9fcGFnaW5hdGlvbi1wYWdlcyc6IHRydWUsXG4gICAgICAgICAgLi4uKGNvbG9yID8gc2V0VGV4dENsYXNzTmFtZUNvbG9yKGNvbG9yKSA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAuLi4oY29sb3IgPyBzZXRUZXh0Q3NzQ29sb3IoY29sb3IpIDoge30pLFxuICAgICAgICB9LFxuICAgICAgfVxuXG4gICAgICBwcm9wcy5wYWdlQ29ycmVjdGlvbiAmJiBlbWl0KCdjb3JyZWN0LXBhZ2UnLCAtcHJvcHMucGFnZUNvcnJlY3Rpb24pXG5cbiAgICAgIHJldHVybiBoKFxuICAgICAgICAnZGl2JyxcbiAgICAgICAgcHJvcHNEYXRhLFxuICAgICAgICAocHJvcHMucm93c0xlbmd0aCAmJiBzbG90cy5wYWdpbmF0aW9uVGV4dCAmJiBzbG90cy5wYWdpbmF0aW9uVGV4dCgpKSB8fFxuICAgICAgICAocHJvcHMucm93c0xlbmd0aCAmJiBwYWdpbmF0aW9uRGlzcGxheVRleHQudmFsdWUpIHx8XG4gICAgICAgICctJyxcbiAgICAgIClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5QYWdpbmF0aW9uQnV0dG9uc0Jsb2NrKCk6IFZOb2RlIHtcbiAgICAgIHJldHVybiBoKCdkaXYnLCB7IGNsYXNzOiB7ICd2LWRhdGEtdGFibGVfX3BhZ2luYXRpb24tcm91dGUnOiB0cnVlIH0gfSwgW1xuICAgICAgICBnZW5QYWdpbmF0aW9uQnV0dG9uKCksXG4gICAgICAgIGdlblBhZ2luYXRpb25QYWdlRGlzcGxheSgpLFxuICAgICAgICBnZW5QYWdpbmF0aW9uQnV0dG9uKHRydWUpLFxuICAgICAgXSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5QYWdpbmF0aW9uQmxvY2soKTogVk5vZGUge1xuICAgICAgcmV0dXJuIGgoJ2RpdicsIHsgY2xhc3M6ICd2LWRhdGEtdGFibGVfX3BhZ2luYXRpb24nIH0sIFtcbiAgICAgICAgZ2VuUm93c0NvdW50U2VsZWN0QmxvY2soKSxcbiAgICAgICAgZ2VuUGFnZXNDb3VudERpc3BsYXkoKSxcbiAgICAgICAgZ2VuUGFnaW5hdGlvbkJ1dHRvbnNCbG9jaygpLFxuICAgICAgXSlcbiAgICB9XG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgY29uc3QgcHJvcHNEYXRhID0ge1xuICAgICAgICBjbGFzczoge1xuICAgICAgICAgICd2LWRhdGEtdGFibGVfX2Zvb3Rlcic6IHRydWUsXG4gICAgICAgICAgLi4uKHByb3BzLm9wdGlvbnMuY29sb3JcbiAgICAgICAgICAgID8gc2V0QmFja2dyb3VuZENsYXNzTmFtZUNvbG9yKHByb3BzLm9wdGlvbnMuY29sb3IpXG4gICAgICAgICAgICA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAuLi4ocHJvcHMub3B0aW9ucy5jb2xvclxuICAgICAgICAgICAgPyBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IocHJvcHMub3B0aW9ucy5jb2xvcilcbiAgICAgICAgICAgIDoge30pLFxuICAgICAgICB9LFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaCgnZGl2JywgcHJvcHNEYXRhLCBnZW5QYWdpbmF0aW9uQmxvY2soKSlcbiAgICB9XG4gIH0sXG59KVxuIl19